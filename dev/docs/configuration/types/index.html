<!doctype html><html lang=en><head><title>Type Definitions</title>
<meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="An open source Identity Aware Proxy and an Access Control Decision service for cloud native applications"><meta name=dc.relation content="https://dadrus.github.io/"><meta name=theme-color content="#1A94D2"><link rel=stylesheet href=../../../css/styles.min.css media=screen><link rel='shortcut icon' type=image/x-icon href=../../../favicon.ico></head><body><header class="navbar navbar-expand-md navbar-dark bg-dark sticky-top"><nav class="container-xxl flex-wrap flex-lg-nowrap px-0" aria-label="Main navigation"><button class="btn btn-outline-dark d-lg-none navbar-toggler border-0 shadow-none ps-3" type=button data-bs-toggle=offcanvas data-bs-target=#docsMenuContent aria-controls=docsMenuContent aria-expanded=false aria-label="Open docs menu"><svg width="36" height="36" fill="currentcolor" class="bi bi-list" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M2.5 12a.5.5.0 01.5-.5h10a.5.5.0 010 1H3a.5.5.0 01-.5-.5m0-4a.5.5.0 01.5-.5h10a.5.5.0 010 1H3A.5.5.0 012.5 8m0-4a.5.5.0 01.5-.5h10a.5.5.0 010 1H3A.5.5.0 012.5 4"/></svg></button><nav class="offcanvas offcanvas-start d-md-none text-bg-light" tabindex=-1 id=docsMenuContent aria-labelledby=docsMenuContentLabel><div class=offcanvas-header><h5 class=offcanvas-title id=docsMenuContentLabel>Browse docs</h5><button type=button class=btn-close data-bs-dismiss=offcanvas aria-label="Close docs menu"></button></div><div class="offcanvas-body docs-sidebar"><div class=docs-search-button><button type=button class="btn btn-outline-secondary mb-3 d-none d-md-block w-100 text-start" data-bs-toggle=modal data-bs-target=#docSearch aria-controls=docSearch aria-expanded=false aria-label="Open search">
<svg width="20" height="20" fill="currentcolor" class="bi bi-search me-2" viewBox="0 0 20 20"><path d="M11.742 10.344a6.5 6.5.0 10-1.397 1.398h-.001q.044.06.098.115l3.85 3.85a1 1 0 001.415-1.414l-3.85-3.85a1 1 0 00-.115-.1zM12 6.5a5.5 5.5.0 11-11 0 5.5 5.5.0 0111 0"/></svg>
<span>Quick search...</span></button></div><nav id=SideBarToc><ul><li><span>Getting Started</span><ul><li><a href=../../../docs/getting_started/discover_heimdall/>Discover heimdall</a></li><li><a href=../../../docs/getting_started/installation/>Install heimdall</a></li><li><a href=../../../docs/getting_started/protect_an_app/>Protect an Application</a></li></ul></li><li><span>Concepts</span><ul><li><a href=../../../docs/concepts/pipelines/>Pipelines</a></li><li><a href=../../../docs/concepts/mechanisms/>Mechanisms</a></li><li><a href=../../../docs/concepts/rules/>Rules</a></li><li><a href=../../../docs/concepts/provider/>Rule Provider</a></li><li><a href=../../../docs/concepts/operating_modes/>Operating Modes</a></li></ul></li><li><span>Operations</span><ul><li><a href=../../../docs/operations/configuration/>Configuration</a></li><li><a href=../../../docs/operations/cli/>CLI</a></li><li><a href=../../../docs/operations/observability/>Observability</a></li><li><a href=../../../docs/operations/cache/>Caching</a></li><li><a href=../../../docs/operations/security/>Security</a></li></ul></li><li><span>Services</span><ul><li><a href=../../../docs/services/main/>Main Service</a></li><li><a href=../../../docs/services/management/>Management Service</a></li></ul></li><li><span>Mechanisms</span><ul><li><a href=../../../docs/mechanisms/catalogue/>Catalogue</a></li><li><a href=../../../docs/mechanisms/evaluation_objects/>Objects, Templating & Co</a></li><li><a href=../../../docs/mechanisms/authenticators/>Authenticators</a></li><li><a href=../../../docs/mechanisms/authorizers/>Authorizers</a></li><li><a href=../../../docs/mechanisms/contextualizers/>Contextualizers</a></li><li><a href=../../../docs/mechanisms/finalizers/>Finalizers</a></li><li><a href=../../../docs/mechanisms/error_handlers/>Error Handlers</a></li></ul></li><li><span>Rules</span><ul><li><a href=../../../docs/rules/regular_rule/>Regular Rule</a></li><li><a href=../../../docs/rules/default_rule/>Default Rule</a></li><li><a href=../../../docs/rules/rule_sets/>Rule Sets</a></li><li><a href=../../../docs/rules/providers/>Rule Providers</a></li></ul></li><li><span>Configuration Reference</span><ul><li><a class=active href=../../../docs/configuration/types/>Type Definitions</a></li><li><a href=../../../docs/configuration/reference/>Reference</a></li></ul></li></ul></nav></div></nav><div class="d-flex align-items-center px-4"><a class="navbar-brand navbar-brand-highlight text-white me-0" href=../../../ style=font-weight:500;font-size:1.5rem>Heimdall</a><ul class="navbar-nav d-none d-md-flex ms-3"><li class=nav-item><a class='nav-link text-white' href=../../../docs/getting_started/discover_heimdall>Docs</a></li><li class=nav-item><a class='nav-link text-white' href=../../../guides/>Guides</a></li><li class=nav-item><a class='nav-link text-white' href=../../../openapi/>API</a></li></ul></div><div class=d-flex><button type=button class="btn btn-outline-dark navbar-toggler border-0 shadow-none" data-bs-toggle=modal data-bs-target=#docSearch aria-controls=docSearch aria-expanded=false aria-label="Open search">
<span class="bi bi-search"></span>
</button>
<button class="btn btn-outline-dark navbar-toggler border-0 shadow-none pe-3" type=button data-bs-toggle=offcanvas data-bs-target=#mainMenuContent aria-controls=mainMenuContent aria-expanded=false aria-label="Open main menu"><svg width="24" height="24" fill="currentcolor" class="bi bi-three-dots" viewBox="0 0 16 16"><path d="M3 9.5a1.5 1.5.0 110-3 1.5 1.5.0 010 3m5 0a1.5 1.5.0 110-3 1.5 1.5.0 010 3m5 0a1.5 1.5.0 110-3 1.5 1.5.0 010 3"/></svg></button><div class="offcanvas offcanvas-end text-bg-dark" tabindex=-1 id=mainMenuContent aria-labelledby=mainMenuContentLabel><div class=offcanvas-header><h5 class="offcanvas-title text-white" id=mainMenuContentLabel>Heimdall</h5><button type=button class="btn-close btn-close-white" data-bs-dismiss=offcanvas aria-label="Close main menu"></button></div><div class=offcanvas-body><ul class="navbar-nav flex-column d-md-none d-lg-none d-xl-none"><li class=nav-item><a class='nav-link text-white' href=../../../docs/getting_started/discover_heimdall>Docs</a></li><li class=nav-item><a class='nav-link text-white' href=../../../guides/>Guides</a></li><li class=nav-item><a class='nav-link text-white' href=../../../openapi/>API</a></li></ul><hr class="text-white-50 d-md-none"><ul class="navbar-nav flex-column ms-auto"><doc-version-select class="nav-item dropdown" version-file=/heimdall/data.json current-version=dev current-page=/docs/configuration/types/><button class="btn btn-dark dropdown-toggle me-4" data-bs-toggle=dropdown aria-expanded=false>
dev</button></doc-version-select></ul><ul class="navbar-nav flex-column"><li class="nav-item mb-1 pe-4"><a class="nav-link text-white" style=align-self:center href=https://github.com/dadrus/heimdall><svg role="img" width="20" height="20" fill="currentcolor" class="bi bi-github text-white" viewBox="0 0 16 16"><title>GitHub</title><path d="M8 0C3.58.0.0 3.58.0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38.0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95.0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12.0.0.67-.21 2.2.82.64-.18 1.32-.27 2-.27s1.36.09 2 .27c1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15.0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48.0 1.07-.01 1.93-.01 2.2.0.21.15.46.55.38A8.012 8.012.0 0016 8c0-4.42-3.58-8-8-8z"/></svg>
<small class="ms-2 d-md-none">GitHub</small></a></li></ul></div></div></div></nav></header><div class=modal id=docSearch tabindex=-1 aria-labelledby=docSearchLabel aria-hidden=true><doc-search class="col-auto me-auto mw-75" index-file=/heimdall/dev/index.json path-prefix=/heimdall/dev><div class="modal-dialog modal-lg modal-dialog-scrollable"><div class=modal-content><div class="modal-header p-2"><div class=input-group><div class="input-group-text bg-body border-0 fs-4"><svg width="16" height="16" fill="currentcolor" class="bi bi-search text-secondary my-0" viewBox="0 0 16 16"><path d="M11.742 10.344a6.5 6.5.0 10-1.397 1.398h-.001q.044.06.098.115l3.85 3.85a1 1 0 001.415-1.414l-3.85-3.85a1 1 0 00-.115-.1zM12 6.5a5.5 5.5.0 11-11 0 5.5 5.5.0 0111 0"/></svg></div><input id=search-input class="form-control search-bar border-0" type=search placeholder="Search documentation " aria-label="Search docs..." autocomplete=off autofocus><div class="input-group-text bg-body border-0"><a class="btn input-group-text text-muted border p-1 bg-light-subtle fs-7 fw-bold font-monospace" data-bs-dismiss=modal aria-label=Close>ESC</a></div></div></div><div class=modal-body><div class=search-results><p class="text-center mt-5">No recent searches</p></div></div><div class=modal-footer></div></div></div></doc-search></div><div class="container-xxl docs-layout px-4"><aside class="d-none pe-3 docs-sidebar"><div class=docs-search-button><button type=button class="btn btn-outline-secondary mb-3 d-none d-md-block w-100 text-start" data-bs-toggle=modal data-bs-target=#docSearch aria-controls=docSearch aria-expanded=false aria-label="Open search">
<svg width="20" height="20" fill="currentcolor" class="bi bi-search me-2" viewBox="0 0 20 20"><path d="M11.742 10.344a6.5 6.5.0 10-1.397 1.398h-.001q.044.06.098.115l3.85 3.85a1 1 0 001.415-1.414l-3.85-3.85a1 1 0 00-.115-.1zM12 6.5a5.5 5.5.0 11-11 0 5.5 5.5.0 0111 0"/></svg>
<span>Quick search...</span></button></div><nav id=SideBarToc><ul><li><span>Getting Started</span><ul><li><a href=../../../docs/getting_started/discover_heimdall/>Discover heimdall</a></li><li><a href=../../../docs/getting_started/installation/>Install heimdall</a></li><li><a href=../../../docs/getting_started/protect_an_app/>Protect an Application</a></li></ul></li><li><span>Concepts</span><ul><li><a href=../../../docs/concepts/pipelines/>Pipelines</a></li><li><a href=../../../docs/concepts/mechanisms/>Mechanisms</a></li><li><a href=../../../docs/concepts/rules/>Rules</a></li><li><a href=../../../docs/concepts/provider/>Rule Provider</a></li><li><a href=../../../docs/concepts/operating_modes/>Operating Modes</a></li></ul></li><li><span>Operations</span><ul><li><a href=../../../docs/operations/configuration/>Configuration</a></li><li><a href=../../../docs/operations/cli/>CLI</a></li><li><a href=../../../docs/operations/observability/>Observability</a></li><li><a href=../../../docs/operations/cache/>Caching</a></li><li><a href=../../../docs/operations/security/>Security</a></li></ul></li><li><span>Services</span><ul><li><a href=../../../docs/services/main/>Main Service</a></li><li><a href=../../../docs/services/management/>Management Service</a></li></ul></li><li><span>Mechanisms</span><ul><li><a href=../../../docs/mechanisms/catalogue/>Catalogue</a></li><li><a href=../../../docs/mechanisms/evaluation_objects/>Objects, Templating & Co</a></li><li><a href=../../../docs/mechanisms/authenticators/>Authenticators</a></li><li><a href=../../../docs/mechanisms/authorizers/>Authorizers</a></li><li><a href=../../../docs/mechanisms/contextualizers/>Contextualizers</a></li><li><a href=../../../docs/mechanisms/finalizers/>Finalizers</a></li><li><a href=../../../docs/mechanisms/error_handlers/>Error Handlers</a></li></ul></li><li><span>Rules</span><ul><li><a href=../../../docs/rules/regular_rule/>Regular Rule</a></li><li><a href=../../../docs/rules/default_rule/>Default Rule</a></li><li><a href=../../../docs/rules/rule_sets/>Rule Sets</a></li><li><a href=../../../docs/rules/providers/>Rule Providers</a></li></ul></li><li><span>Configuration Reference</span><ul><li><a class=active href=../../../docs/configuration/types/>Type Definitions</a></li><li><a href=../../../docs/configuration/reference/>Reference</a></li></ul></li></ul></nav></aside><main class=docs-main><div class="d-md-none docs-location bg-body"><nav style="--bs-breadcrumb-divider:'>'" aria-label=breadcrumb><ol class="breadcrumb mb-0"><li class="breadcrumb-item fw-bold">Configuration Reference</li><li class="breadcrumb-item active" aria-current=page>Type Definitions</li></ol></nav></div><div class="docs-intro pt-3 pe-3"><h1>Type Definitions</h1><p></p></div><aside class="text-muted docs-toc"><strong class="d-md-block h6 pb-2 my-2 ms-2 border-bottom d-none d-md-none d-lg-block">On this page</strong><div id=page-content-toc class="mt-1 mb-3 text-muted d-none d-md-none d-lg-block docs-toc-content"><nav id=TableOfContents><ul><li><a href=#_assertions>Assertions</a></li><li><a href=#_authentication_data_source>Authentication Data Source</a><ul><li><a href=#_cookie_strategy>Cookie Strategy</a></li><li><a href=#_header_strategy>Header Strategy</a></li><li><a href=#_query_parameter_strategy>Query Parameter Strategy</a></li><li><a href=#_body_parameter_strategy>Body Parameter Strategy</a></li></ul></li><li><a href=#_authentication_data_forward_strategy>Authentication Data Forward Strategy</a><ul><li><a href=#_body_forward_strategy>Body Forward Strategy</a></li><li><a href=#_cookie_forward_strategy>Cookie Forward Strategy</a></li><li><a href=#_header_forward_strategy>Header Forward Strategy</a></li><li><a href=#_query_forward_strategy>Query Forward Strategy</a></li></ul></li><li><a href=#_authentication_strategy>Authentication Strategy</a><ul><li><a href=#_api_key_strategy>API Key Strategy</a></li><li><a href=#_basic_auth_strategy>Basic Auth Strategy</a></li><li><a href=#_http_message_signatures>HTTP Message Signatures</a></li><li><a href=#_oauth2_client_credentials_grant_flow_strategy>OAuth2 Client Credentials Grant Flow Strategy</a></li></ul></li><li><a href=#_authorization_expression>Authorization Expression</a></li><li><a href=#_bytesize>ByteSize</a></li><li><a href=#_cors>CORS</a></li><li><a href=#_duration>Duration</a></li><li><a href=#_endpoint>Endpoint</a></li><li><a href=#_errorstate_type>Error/State Type</a></li><li><a href=#_http_cache>HTTP Cache</a></li><li><a href=#_key_store>Key Store</a></li><li><a href=#_respond>Respond</a></li><li><a href=#_retry>Retry</a></li><li><a href=#_scopes_matcher>Scopes Matcher</a><ul><li><a href=#_exact>Exact</a></li><li><a href=#_hierarchic>Hierarchic</a></li><li><a href=#_wildcard>Wildcard</a></li></ul></li><li><a href=#_session_lifespan>Session Lifespan</a></li><li><a href=#_signer>Signer</a></li><li><a href=#_subject>Subject</a></li><li><a href=#_tls>TLS</a></li><li><a href=#_key_id_lookup>Key-Id Lookup</a></li></ul></nav></div><button class="btn btn-outline-secondary text-decoration-none d-lg-none collapsed" type=button data-bs-toggle=collapse data-bs-target=#page-content-toc-collapsible aria-expanded=false aria-controls=page-content-toc-collapsible>
On this page<svg width="16" height="16" fill="currentcolor" class="bi bi-chevron-expand" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M3.646 9.146a.5.5.0 01.708.0L8 12.793l3.646-3.647a.5.5.0 01.708.708l-4 4a.5.5.0 01-.708.0l-4-4a.5.5.0 010-.708m0-2.292a.5.5.0 00.708.0L8 3.207l3.646 3.647a.5.5.0 00.708-.708l-4-4a.5.5.0 00-.708.0l-4 4a.5.5.0 000 .708"/></svg></button><div id=page-content-toc-collapsible class="mt-1 mb-3 text-muted d-lg-none collapse docs-toc-content"><div class="card card-body"><nav id=TableOfContents><ul><li><a href=#_assertions>Assertions</a></li><li><a href=#_authentication_data_source>Authentication Data Source</a><ul><li><a href=#_cookie_strategy>Cookie Strategy</a></li><li><a href=#_header_strategy>Header Strategy</a></li><li><a href=#_query_parameter_strategy>Query Parameter Strategy</a></li><li><a href=#_body_parameter_strategy>Body Parameter Strategy</a></li></ul></li><li><a href=#_authentication_data_forward_strategy>Authentication Data Forward Strategy</a><ul><li><a href=#_body_forward_strategy>Body Forward Strategy</a></li><li><a href=#_cookie_forward_strategy>Cookie Forward Strategy</a></li><li><a href=#_header_forward_strategy>Header Forward Strategy</a></li><li><a href=#_query_forward_strategy>Query Forward Strategy</a></li></ul></li><li><a href=#_authentication_strategy>Authentication Strategy</a><ul><li><a href=#_api_key_strategy>API Key Strategy</a></li><li><a href=#_basic_auth_strategy>Basic Auth Strategy</a></li><li><a href=#_http_message_signatures>HTTP Message Signatures</a></li><li><a href=#_oauth2_client_credentials_grant_flow_strategy>OAuth2 Client Credentials Grant Flow Strategy</a></li></ul></li><li><a href=#_authorization_expression>Authorization Expression</a></li><li><a href=#_bytesize>ByteSize</a></li><li><a href=#_cors>CORS</a></li><li><a href=#_duration>Duration</a></li><li><a href=#_endpoint>Endpoint</a></li><li><a href=#_errorstate_type>Error/State Type</a></li><li><a href=#_http_cache>HTTP Cache</a></li><li><a href=#_key_store>Key Store</a></li><li><a href=#_respond>Respond</a></li><li><a href=#_retry>Retry</a></li><li><a href=#_scopes_matcher>Scopes Matcher</a><ul><li><a href=#_exact>Exact</a></li><li><a href=#_hierarchic>Hierarchic</a></li><li><a href=#_wildcard>Wildcard</a></li></ul></li><li><a href=#_session_lifespan>Session Lifespan</a></li><li><a href=#_signer>Signer</a></li><li><a href=#_subject>Subject</a></li><li><a href=#_tls>TLS</a></li><li><a href=#_key_id_lookup>Key-Id Lookup</a></li></ul></nav></div></div></aside><div class="docs-content pe-3"><div data-bs-spy=scroll data-bs-target=#page-content-toc class=mt-3><linkable-headline-area><div class=sect1><h2 id=_assertions>Assertions</h2><div class=sectionbody><div class=paragraph><p>This type enables configuration of required token and claim assertions. Depending on the object type (JWT or introspection response), the assertions apply to different parts of such objects.</p></div><div class=ulist><ul><li><p><strong><code>scopes</code></strong>: <em><a href=#_scopes_matcher>Scopes Matcher</a></em> (optional)</p><div class=paragraph><p>Required scopes given to the client.</p></div></li><li><p><strong><code>audience</code></strong>: <em>string array</em> (optional)</p><div class=paragraph><p>Values to be matched in the <code>aud</code> claim. This assertion evaluates to <code>true</code> if at least one entry in the given <code>audience</code> array is present in the <code>aud</code> claim. Both cases, either as whitespace separated string, or a JSON array are considered.</p></div></li><li><p><strong><code>issuers</code></strong>: <em>string array</em> (optional)</p><div class=paragraph><p>Issuers to trust.</p></div></li><li><p><strong><code>allowed_algorithms</code></strong>: <em>string array</em> (optional)</p><div class=paragraph><p>Algorithms, which are trusted (according to <a href=https://datatracker.ietf.org/doc/html/rfc7518>RFC 7518</a>). Defaults to the following list: ES256, ES384, ES512, PS256, PS384, PS512.</p></div></li><li><p><strong><code>validity_leeway</code></strong> <em><a href=#_duration>Duration</a></em> (optional)</p><div class=paragraph><p>The time leeway to consider while verifying the <code>iat</code>, <code>exp</code> and the <code>nbf</code>. Defaults to 10 seconds.</p></div></li></ul></div><div class=exampleblock><div class=title>Example 1. Assertions configuration</div><div class=content><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=yaml><span class=na>issuers</span><span class=pi>:</span>
 <span class=pi>-</span> <span class=s>foo</span>
 <span class=pi>-</span> <span class=s>bar</span>
<span class=na>audience</span><span class=pi>:</span>
 <span class=pi>-</span> <span class=s>zap</span>
<span class=na>scopes</span><span class=pi>:</span>
 <span class=pi>-</span> <span class=s>baz</span>
<span class=na>allowed_algorithms</span><span class=pi>:</span>
 <span class=pi>-</span> <span class=s>ES512</span>
<span class=na>validity_leeway</span><span class=pi>:</span> <span class=s>5s</span></code></pre></div></div><div class=paragraph><p>Here we say, the token must have been issued either by the issuer <code>foo</code>, or the issuer <code>bar</code>, the <code>aud</code> claim must contain <code>zap</code>, the scope claim (either <code>scp</code> or <code>scope</code>) must be present and contain the scope <code>baz</code>, if the token or the introspection response is signed, it must have been signed by using the <code>ES512</code> algorithm (ECDSA using P-521 and SHA-512) and if the information about token validity is present, we respect a deviation of 5 seconds.</p></div></div></div></div></div><div class=sect1><h2 id=_authentication_data_source>Authentication Data Source</h2><div class=sectionbody><div class=paragraph><p>An authentication data source is actually a list of possible strategies for subject authentication data retrieval. The entries following the first one are fallbacks and are only executed if the previous strategy could not retrieve the required authentication data from the request.</p></div><div class=paragraph><p>This fallback mechanism can become handy, if different clients of your application send the authentication data using different methods. <a href=https://datatracker.ietf.org/doc/html/rfc6750>RFC 6750</a> describes for example how to use bearer tokens in HTTP requests to access OAuth 2.0 protected resources. This RFC says, a token can either be sent in the <code>Authorization</code> header, or in a query parameter, or even as part of the HTTP body. So you can define the following list to let Heimdall try to extract the access token from all three places:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=yaml><span class=pi>-</span> <span class=na>header</span><span class=pi>:</span> <span class=s>Authorization</span>
  <span class=na>scheme</span><span class=pi>:</span> <span class=s>Bearer</span>
<span class=pi>-</span> <span class=na>query_parameter</span><span class=pi>:</span> <span class=s>access_token</span>
<span class=pi>-</span> <span class=na>body_parameter</span><span class=pi>:</span> <span class=s>access_token</span></code></pre></div></div><div class=paragraph><p>The available strategies are described in the following sections.</p></div><div class=sect2><h3 id=_cookie_strategy>Cookie Strategy</h3><div class=paragraph><p>This strategy can retrieve authentication data from a specific HTTP cookie. Following properties are supported:</p></div><div class=ulist><ul><li><p><strong><code>cookie</code></strong>: <em>string</em> (mandatory)</p><div class=paragraph><p>The name of the cookie to use.</p></div></li></ul></div><div class=exampleblock><div class=title>Example 2. Cookie Strategy usage</div><div class=content><div class=paragraph><p>Imagine you want Heimdall to verify an authentication session, which is represented by a specific cookie before the request hits your upstream service. If the client of your upstream application, which is case of a cookie would usually be a browser sends a cookie named "session", you can inform Heimdall to extract and use it by configuring this strategy as follows:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=yaml><span class=pi>-</span> <span class=na>cookie</span><span class=pi>:</span> <span class=s>my_session_cookie</span></code></pre></div></div></div></div></div><div class=sect2><h3 id=_header_strategy>Header Strategy</h3><div class=paragraph><p>This strategy can retrieve authentication data from a specific HTTP header. Following properties are supported:</p></div><div class=ulist><ul><li><p><strong><code>header</code></strong>: <em>string</em> (mandatory)</p><div class=paragraph><p>The name of the header to use.</p></div></li><li><p><strong><code>scheme</code></strong>: <em>string</em> (optional)</p><div class=paragraph><p>Scheme, which should be present in the header value. If specified, but not present in the header value, the authentication data cannot be retrieved, effectively making the affected authenticator feel not responsible for the request.</p></div></li></ul></div><div class=exampleblock><div class=title>Example 3. Header Strategy usage</div><div class=content><div class=paragraph><p>Imagine you want Heimdall to verify an access token used to protect your upstream service. If the client of your upstream application sends the access token in the HTTP <code>Authorization</code> header, you can inform Heimdall to extract it from there by configuring this strategy as follows:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=yaml><span class=pi>-</span> <span class=na>header</span><span class=pi>:</span> <span class=s>Authorization</span>
  <span class=na>scheme</span><span class=pi>:</span> <span class=s>Bearer</span></code></pre></div></div></div></div></div><div class=sect2><h3 id=_query_parameter_strategy>Query Parameter Strategy</h3><div class=ulist><ul><li><p><strong><code>query_parameter</code></strong>: <em>string</em> (mandatory)</p><div class=paragraph><p>The name of the query parameter to use.</p></div></li></ul></div><div class=exampleblock><div class=title>Example 4. Query Parameter Strategy usage</div><div class=content><div class=paragraph><p>Imagine you want Heimdall to verify an access token used to protect your upstream service. If the client of your upstream application sends the access token in the query parameter named "access_token", you can inform Heimdall to extract it from there by configuring this strategy as follows:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=yaml><span class=pi>-</span> <span class=na>query_parameter</span><span class=pi>:</span> <span class=s>access_token</span></code></pre></div></div></div></div></div><div class=sect2><h3 id=_body_parameter_strategy>Body Parameter Strategy</h3><div class=paragraph><p>The usage of this strategy is only possible when the request payload is either JSON or <code>application/x-www-form-urlencoded</code> encoded. The <code>Content-Type</code> of the request must also either be set to <code>application/x-www-form-urlencoded</code> or to a MIME type, which contains <code>json</code>.</p></div><div class=ulist><ul><li><p><strong><code>body_parameter</code></strong>: <em>string</em> (mandatory)</p><div class=paragraph><p>The name of the body parameter to use.</p></div></li></ul></div><div class=exampleblock><div class=title>Example 5. Body Parameter Strategy usage</div><div class=content><div class=paragraph><p>Imagine you want Heimdall to verify an access token used to protect your upstream service. If the client of your upstream application sends the access token in the body parameter named "access_token", you can inform Heimdall to extract it from there by configuring this strategy as follows:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=yaml><span class=pi>-</span> <span class=na>body_parameter</span><span class=pi>:</span> <span class=s>access_token</span></code></pre></div></div></div></div></div></div></div><div class=sect1><h2 id=_authentication_data_forward_strategy>Authentication Data Forward Strategy</h2><div class=sectionbody><div class=paragraph><p>Authentication data strategy defines the way how heimdall should forward the authentication data extracted from the request to the used identity management system.</p></div><div class=paragraph><p>An Authentication Data Forward Strategy configuration entry must contain the following two properties:</p></div><div class=ulist><ul><li><p><code>type</code> - The type of the strategy. Available types are described in the following sections.</p></li><li><p><code>config</code> - The strategy specific configuration.</p></li></ul></div><div class=sect2><h3 id=_body_forward_strategy>Body Forward Strategy</h3><div class=paragraph><p>This strategy can be used to embed the extracted authentication data into a body parameter of the request to the identity management system.</p></div><div class=paragraph><p><code>type</code> must be set to <code>body</code>. <code>config</code> supports the following properties:</p></div><div class=ulist><ul><li><p><strong><code>name</code></strong>: <em>string</em> (mandatory)</p><div class=paragraph><p>The name of the property for the authentication data.</p></div></li></ul></div><div class=exampleblock><div class=title>Example 6. Body strategy configuration</div><div class=content><div class=paragraph><p>The following snippet shows how to configure this strategy to send e.g. a token in a property named "idToken".</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=yaml><span class=na>type</span><span class=pi>:</span> <span class=s>body</span>
<span class=na>config</span><span class=pi>:</span>
  <span class=na>name</span><span class=pi>:</span> <span class=s>idToken</span></code></pre></div></div><div class=paragraph><p>Depending on the configured "Content-Type" header for the request (see <a href=#_endpoint><code>Endpoint</code></a> <code>headers</code>) the result might look like</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=text>idToken=&lt;whatever the token value is&gt;</code></pre></div></div><div class=paragraph><p>if the "Content-Type" header was set to <code>application/x-www-form-urlencoded</code>, or</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=json><span class=p>{</span><span class=w> </span><span class=nl>&#34;idToken&#34;</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;&lt;whatever the token value is&gt;&#34;</span><span class=w> </span><span class=p>}</span></code></pre></div></div><div class=paragraph><p>otherwise</p></div></div></div></div><div class=sect2><h3 id=_cookie_forward_strategy>Cookie Forward Strategy</h3><div class=paragraph><p>This strategy can be used to embed the extracted authentication data into a cookie of the request to the identity management system.</p></div><div class=paragraph><p><code>type</code> must be set to <code>cookie</code>. <code>config</code> supports the following properties:</p></div><div class=ulist><ul><li><p><strong><code>name</code></strong>: <em>string</em> (mandatory)</p><div class=paragraph><p>The name of the cookie for the authentication data.</p></div></li></ul></div><div class=exampleblock><div class=title>Example 7. Cookie strategy configuration</div><div class=content><div class=paragraph><p>The following snippet shows how to configure this strategy to send e.g. a token in a cookie named "it_token".</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=yaml><span class=na>type</span><span class=pi>:</span> <span class=s>cookie</span>
<span class=na>config</span><span class=pi>:</span>
  <span class=na>name</span><span class=pi>:</span> <span class=s>it_token</span></code></pre></div></div></div></div></div><div class=sect2><h3 id=_header_forward_strategy>Header Forward Strategy</h3><div class=paragraph><p>This strategy can be used to embed the extracted authentication data into a header of the request to the identity management system.</p></div><div class=paragraph><p><code>type</code> must be set to <code>header</code>. <code>config</code> supports the following properties:</p></div><div class=ulist><ul><li><p><strong><code>name</code></strong>: <em>string</em> (mandatory)</p><div class=paragraph><p>The name of the header for the authentication data.</p></div></li><li><p><strong><code>scheme</code></strong>: <em>string</em> (optional)</p><div class=paragraph><p>The scheme for the header added in front of the authentication data value.</p></div></li></ul></div><div class=exampleblock><div class=title>Example 8. Header strategy configuration</div><div class=content><div class=paragraph><p>The following snippet shows how to configure this strategy to send e.g. a token in a header named "X-ID-Token" with scheme "Bearer".</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=yaml><span class=na>type</span><span class=pi>:</span> <span class=s>header</span>
<span class=na>config</span><span class=pi>:</span>
  <span class=na>name</span><span class=pi>:</span> <span class=s>X-ID-Token</span>
  <span class=na>scheme</span><span class=pi>:</span> <span class=s>Bearer</span></code></pre></div></div></div></div></div><div class=sect2><h3 id=_query_forward_strategy>Query Forward Strategy</h3><div class=paragraph><p>This strategy can be used to embed the extracted authentication data into a query parameter of the request to the identity management system.</p></div><div class="admonitionblock warning"><table><tbody><tr><td class=icon><i class="fa icon-warning" title=Warning></i></td><td class=content>Using this strategy is discouraged, as it will expose the authentication data to access logs, metrics and tracing.</td></tr></tbody></table></div><div class=paragraph><p><code>type</code> must be set to <code>query</code>. <code>config</code> supports the following properties:</p></div><div class=ulist><ul><li><p><strong><code>name</code></strong>: <em>string</em> (mandatory)</p><div class=paragraph><p>The name of the query parameter for the authentication data.</p></div></li></ul></div><div class=exampleblock><div class=title>Example 9. Query strategy configuration</div><div class=content><div class=paragraph><p>The following snippet shows how to configure this strategy to send e.g. a token in a query named "token".</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=yaml><span class=na>type</span><span class=pi>:</span> <span class=s>query</span>
<span class=na>config</span><span class=pi>:</span>
  <span class=na>name</span><span class=pi>:</span> <span class=s>token</span></code></pre></div></div></div></div></div></div></div><div class=sect1><h2 id=_authentication_strategy>Authentication Strategy</h2><div class=sectionbody><div class=paragraph><p>Authentication strategy is kind of abstract type, so you have to define which specific type to use. Each type has its own configuration options.</p></div><div class=paragraph><p>An AuthStrategy configuration entry must contain the following two properties:</p></div><div class=ulist><ul><li><p><code>type</code> - The type of the strategy. Available types are described in the following sections.</p></li><li><p><code>config</code> - The strategy specific configuration.</p></li></ul></div><div class=paragraph><p>Available strategies are described in the following sections.</p></div><div class=sect2><h3 id=_api_key_strategy>API Key Strategy</h3><div class=paragraph><p>This strategy can be used if your endpoint expects a specific api key be sent in a header, a cookie or query.</p></div><div class=paragraph><p><code>type</code> must be set to <code>api_key</code>. <code>config</code> supports the following properties:</p></div><div class=ulist><ul><li><p><strong><code>in</code></strong>: <em>string</em> (mandatory)</p><div class=paragraph><p>Where to put the api key. Can be either <code>header</code>, <code>cookie</code>, or <code>query</code>.</p></div><div class="admonitionblock warning"><table><tbody><tr><td class=icon><i class="fa icon-warning" title=Warning></i></td><td class=content>Using <code>query</code> strategy will expose the api key to access logs and tracing.</td></tr></tbody></table></div></li><li><p><strong><code>name</code></strong>: <em>string</em> (mandatory)</p><div class=paragraph><p>The name of either the header or the cookie.</p></div></li><li><p><strong><code>value</code></strong>: <em>string</em> (mandatory)</p><div class=paragraph><p>The value of the api key.</p></div></li></ul></div><div class=exampleblock><div class=title>Example 10. API Key Strategy configuration</div><div class=content><div class=paragraph><p>The following snippet shows how to configure this strategy to send an api key in the <code>X-My-API-Key</code> HTTP header.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=yaml><span class=na>type</span><span class=pi>:</span> <span class=s>api_key</span>
<span class=na>config</span><span class=pi>:</span>
  <span class=na>in</span><span class=pi>:</span> <span class=s>header</span>
  <span class=na>name</span><span class=pi>:</span> <span class=s>X-My-API-Key</span>
  <span class=na>value</span><span class=pi>:</span> <span class=s>super-duper-secret-key</span></code></pre></div></div></div></div></div><div class=sect2><h3 id=_basic_auth_strategy>Basic Auth Strategy</h3><div class=paragraph><p>This strategy can be used if your endpoint is protected by HTTP basic authentication and expects the HTTP <code>Authorization</code> header with required values.</p></div><div class=paragraph><p><code>type</code> must be set to <code>basic_auth</code>. <code>config</code> supports the following properties:</p></div><div class=ulist><ul><li><p><strong><code>user</code></strong>: <em>string</em> (mandatory)</p><div class=paragraph><p>The user-id.</p></div></li><li><p><strong><code>password</code></strong>: <em>string</em> (mandatory)</p><div class=paragraph><p>The password.</p></div></li></ul></div><div class=exampleblock><div class=title>Example 11. Basic Auth Strategy configuration</div><div class=content><div class=paragraph><p>The following snippet shows how to configure this strategy with user set to "Alladin" and password set to "open sesame"</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=yaml><span class=na>type</span><span class=pi>:</span> <span class=s>basic_auth</span>
<span class=na>config</span><span class=pi>:</span>
  <span class=na>user</span><span class=pi>:</span> <span class=s>Alladin</span>
  <span class=na>password</span><span class=pi>:</span> <span class=s>open sesame</span></code></pre></div></div></div></div></div><div class=sect2><h3 id=_http_message_signatures>HTTP Message Signatures</h3><div class=paragraph><p>This strategy implements HTTP message signatures according to <a href=https://datatracker.ietf.org/doc/html/rfc9421>RFC 9421</a> to sign outbound requests.</p></div><div class=paragraph><p><code>type</code> must be set to <code>http_message_signatures</code>. <code>config</code> supports the following properties:</p></div><div class=ulist><ul><li><p><strong><code>ttl</code></strong>: <em><a href=#_duration>Duration</a></em> (optional)</p><div class=paragraph><p>The TTL of the resulting signature. Defaults to 1m. Responsible for setting <code>created</code> and <code>expires</code> parameters in the resulting signature.</p></div></li><li><p><strong><code>label</code></strong>: <em>string</em> (optional)</p><div class=paragraph><p>The label to use. Defaults to <code>sig</code>.</p></div></li><li><p><strong><code>components</code></strong>: <em>string array</em> (mandatory)</p><div class=paragraph><p>The components to be covered by the signature. While the RFC allows for signatures that do not cover any components, this is considered a security risk. When using the <code>"content-digest"</code> component, Heimdall will compute hash values of the request body using <code>sha-256</code> and <code>sha-512</code> algorithms. It will then add a <code>Content-Digest</code> header with these hash values to the request, and this header will be included in the signature calculation.</p></div></li><li><p><strong><code>signer</code></strong>: <em><a href=../../../docs/configuration/types/#_signer>Signer</a></em> (mandatory)</p><div class=paragraph><p>The configuration of the key material used for signature creation purposes, as well as the name used for the <code>tag</code> parameter in the resulting signature.</p></div></li></ul></div><div class=exampleblock><div class=title>Example 12. Strategy configuration</div><div class=content><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=yaml><span class=na>type</span><span class=pi>:</span> <span class=s>http_message_signatures</span>
<span class=na>config</span><span class=pi>:</span>
  <span class=na>ttl</span><span class=pi>:</span> <span class=s>2m</span>
  <span class=na>label</span><span class=pi>:</span> <span class=s>foo</span>
  <span class=na>components</span><span class=pi>:</span> <span class=pi>[</span><span class=s2>&#34;</span><span class=s>@method&#34;</span><span class=pi>,</span> <span class=s2>&#34;</span><span class=s>content-digest&#34;</span><span class=pi>,</span> <span class=s2>&#34;</span><span class=s>@authority&#34;</span><span class=pi>,</span> <span class=s2>&#34;</span><span class=s>x-my-fancy-header&#34;</span><span class=pi>]</span>
  <span class=na>signer</span><span class=pi>:</span>
    <span class=na>name</span><span class=pi>:</span> <span class=s>bar</span>
    <span class=na>key-store</span><span class=pi>:</span>
      <span class=na>path</span><span class=pi>:</span> <span class=s>/path/to/key.pem</span></code></pre></div></div></div></div></div><div class=sect2><h3 id=_oauth2_client_credentials_grant_flow_strategy>OAuth2 Client Credentials Grant Flow Strategy</h3><div class=paragraph><p>This strategy implements the <a href=https://datatracker.ietf.org/doc/html/rfc6749#section-4.4>OAuth2 Client Credentials Grant Flow</a> to obtain an access token expected by the endpoint. Heimdall caches the received access token.</p></div><div class=paragraph><p><code>type</code> must be set to <code>oauth2_client_credentials</code>. <code>config</code> supports the following properties:</p></div><div class=ulist><ul><li><p><strong><code>token_url</code></strong>: <em>string</em> (mandatory)</p><div class=paragraph><p>The token endpoint of the authorization server.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content>Usage of TLS is enforced as long as heimdall is not started with <code>--insecure-skip-egress-tls-enforcement</code> flag, which allows insecure communication to any of the configured services.</td></tr></tbody></table></div></li><li><p><strong><code>client_id</code></strong>: <em>string</em> (mandatory)</p><div class=paragraph><p>The client identifier for heimdall.</p></div></li><li><p><strong><code>client_secret</code></strong>: <em>string</em> (mandatory)</p><div class=paragraph><p>The client secret for heimdall.</p></div></li><li><p><strong><code>auth_method</code></strong>: <em>string</em> (optional)</p><div class=paragraph><p>The authentication method to be used according to <a href=https://www.rfc-editor.org/rfc/rfc6749#section-2.3.1>RFC 6749, Client Password</a>. Can be one of</p></div><div class=ulist><ul><li><p><code>basic_auth</code> (default if <code>auth_method</code> is not set): With that authentication method, the <code>"application/x-www-form-urlencoded"</code> encoded values of <code>client_id</code> and <code>client_secret</code> are sent to the authorization server via the <code>Authorization</code> header using the <code>Basic</code> scheme.</p></li><li><p><code>request_body</code>: With that authentication method the <code>client_id</code> and <code>client_secret</code> are sent in the request body together with the other parameters (e.g. <code>scopes</code>) defined by the flow.</p><div class="admonitionblock warning"><table><tbody><tr><td class=icon><i class="fa icon-warning" title=Warning></i></td><td class=content>Usage of <code>request_body</code> authentication method is not recommended and should be avoided.</td></tr></tbody></table></div></li></ul></div></li><li><p><strong><code>scopes</code></strong>: <em>string array</em> (optional)</p><div class=paragraph><p>The scopes required for the access token.</p></div></li><li><p><strong><code>cache_ttl</code></strong>: <em><a href=#_duration>Duration</a></em> (optional)</p><div class=paragraph><p>How long to cache the token received from the token endpoint. Defaults to the token expiration information from the token endpoint (the value of the <code>expires_in</code> field) if present. If the token expiration information is not present and <code>cache_ttl</code> is not configured, the received token is not cached. If the token expiration information is present in the response and <code>cache_ttl</code> is configured the shorter value is taken. If caching is enabled, the token is cached until 5 seconds before its expiration. To disable caching, set it to <code>0s</code>. The cache key calculation is based on the values of <code>token_url</code>, <code>client_id</code>, <code>client_secret</code> and the <code>scopes</code> properties.</p></div></li><li><p><strong><code>header</code></strong>: <em>object</em> (optional, overridable)</p><div class=paragraph><p>Defines the <code>name</code> and <code>scheme</code> to be used for the header. Defaults to <code>Authorization</code> with scheme <code>Bearer</code>. If defined, the <code>name</code> property must be set. If <code>scheme</code> is not defined, no scheme will be prepended to the resulting JWT.</p></div></li></ul></div><div class=exampleblock><div class=title>Example 13. Strategy configuration</div><div class=content><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=yaml><span class=na>type</span><span class=pi>:</span> <span class=s>oauth2_client_credentials</span>
<span class=na>config</span><span class=pi>:</span>
  <span class=na>header</span><span class=pi>:</span>
    <span class=na>name</span><span class=pi>:</span> <span class=s>X-My-Token</span>
  <span class=na>token_url</span><span class=pi>:</span> <span class=s>https://my-auth.provider/token</span>
  <span class=na>client_id</span><span class=pi>:</span> <span class=s>foo</span>
  <span class=na>client_secret</span><span class=pi>:</span> <span class=s>bar</span>
  <span class=na>auth_method</span><span class=pi>:</span> <span class=s>basic_auth</span>
  <span class=na>ttl</span><span class=pi>:</span> <span class=s>10m</span>
  <span class=na>scopes</span><span class=pi>:</span>
    <span class=pi>-</span> <span class=s>baz</span>
    <span class=pi>-</span> <span class=s>zap</span></code></pre></div></div></div></div></div></div></div><div class=sect1><h2 id=_authorization_expression>Authorization Expression</h2><div class=sectionbody><div class=paragraph><p>Authorization expressions define, as the name implies expressions for authorization purposes and have the following properties:</p></div><div class=ulist><ul><li><p><strong><code>expression</code></strong> <em>string</em> (mandatory)</p><div class=paragraph><p>The expression to execute.</p></div></li><li><p><strong><code>message</code></strong> <em>string</em> (optional)</p><div class=paragraph><p>The message to include into the error if the expression fails.</p></div></li></ul></div><div class=exampleblock><div class=title>Example 14. Example expression using <a href=https://github.com/google/cel-spec>CEL</a></div><div class=content><div class=paragraph><p>The expression below determine whether <code>attributes</code> property of a <code>subject</code> object (also shown below) has at least one key that starts with the <code>group</code> prefix, and ensure that all group-like keys have list values containing only strings that end with <code>@acme.co</code>.</p></div><div class=listingblock><div class=title>subject</div><div class=content><pre class="rouge highlight"><code data-lang=yaml><span class=na>id</span><span class=pi>:</span> <span class=s2>&#34;</span><span class=s>foobar&#34;</span>
<span class=na>attributes</span><span class=pi>:</span>
  <span class=na>group1</span><span class=pi>:</span> <span class=pi>[</span><span class=s2>&#34;</span><span class=s>admin@acme.co&#34;</span><span class=pi>,</span> <span class=s2>&#34;</span><span class=s>analyst@acme.co&#34;</span><span class=pi>]</span>
  <span class=na>labels</span><span class=pi>:</span> <span class=pi>[</span><span class=s2>&#34;</span><span class=s>metadata&#34;</span><span class=pi>,</span> <span class=s2>&#34;</span><span class=s>prod&#34;</span><span class=pi>,</span> <span class=s2>&#34;</span><span class=s>pii&#34;</span><span class=pi>]</span>
  <span class=na>groupN</span><span class=pi>:</span> <span class=pi>[</span><span class=s2>&#34;</span><span class=s>forever@acme.co&#34;</span><span class=pi>]</span></code></pre></div></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=yaml><span class=na>expression</span><span class=pi>:</span> <span class=pi>|</span>
  <span class=s>subject.attributes.exists(c, c.startsWith(&#39;group&#39;)) &amp;&amp;</span>
  <span class=s>subject.attributes</span>
      <span class=s>.filter(c, c.startsWith(&#39;group&#39;))</span>
      <span class=s>.all(c, subject.attributes[c]</span>
      <span class=s>.all(g, g.endsWith(&#39;@acme.co&#39;)))</span>
<span class=na>message</span><span class=pi>:</span> <span class=s>No groups ending with @acme.co present</span></code></pre></div></div></div></div></div></div><div class=sect1><h2 id=_bytesize>ByteSize</h2><div class=sectionbody><div class=paragraph><p>ByteSize is actually a string type, which adheres to the following pattern: <code>^[0-9]+(B|KB|MB)$</code></p></div><div class=paragraph><p>So with <code>10B</code> you can define the byte size of 10 bytes and with <code>2MB</code> you can say 2 megabytes.</p></div></div></div><div class=sect1><h2 id=_cors>CORS</h2><div class=sectionbody><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content>This functionality is only supported if heimdall is operated in proxy mode. In decision operation mode, this configuration is ignored.</td></tr></tbody></table></div><div class=paragraph><p><a href=https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS>CORS</a> (Cross-Origin Resource Sharing) headers can be added and configured by making use of this type. This functionality allows for advanced security features to quickly be set. If CORS headers are set, then heimdall does not pass preflight requests to its decision pipeline, instead the response will be generated and sent back to the client directly. Following properties are supported:</p></div><div class=ulist><ul><li><p><strong><code>allowed_origins</code></strong>: <em>string array</em> (optional)</p><div class=paragraph><p>List of origins that may access the resource. Defaults to all, if not set, but any of the other CORS options are configured.</p></div></li><li><p><strong><code>allowed_methods</code></strong>: <em>string array</em> (optional)</p><div class=paragraph><p>List of methods allowed when accessing the resource. This is used in response to a preflight request. Defaults to <code>GET</code>, <code>POST</code>, <code>HEAD</code>, <code>PUT</code>, <code>DELETE</code> and <code>PATCH</code> if not set, but any of the other CORS options are configured.</p></div></li><li><p><strong><code>allowed_headers</code></strong>: <em>string array</em> (optional)</p><div class=paragraph><p>List of request headers that can be used when making the actual request.</p></div></li><li><p><strong><code>exposed_headers</code></strong>: <em>string array</em> (optional)</p><div class=paragraph><p>"Allow-List" of headers that clients are allowed to access.</p></div></li><li><p><strong><code>allow_credentials</code></strong>: <em>boolean</em> (optional)</p><div class=paragraph><p>Indicates whether the response to the request can be exposed when the credentials flag is true. When used as part of a response to a preflight request, this indicates whether the actual request can be made using credentials. Defaults to <code>false</code> if not set, but any of the other CORS options are configured.</p></div></li><li><p><strong><code>max_age</code></strong>: <em><a href=#_duration>Duration</a></em> (optional)</p><div class=paragraph><p>Indicates how long the results of a preflight request can be cached. Defaults to 0 seconds if not set, but any of the other CORS options are configured.</p></div></li></ul></div><div class=exampleblock><div class=title>Example 15. Possible configuration</div><div class=content><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=yaml><span class=na>allowed_origins</span><span class=pi>:</span>
  <span class=pi>-</span> <span class=s>example.org</span>
<span class=na>allowed_methods</span><span class=pi>:</span>
  <span class=pi>-</span> <span class=s>HEAD</span>
  <span class=pi>-</span> <span class=s>PATCH</span>
<span class=na>allow_credentials</span><span class=pi>:</span> <span class=kc>true</span>
<span class=na>max_age</span><span class=pi>:</span> <span class=s>10s</span></code></pre></div></div></div></div></div></div><div class=sect1><h2 id=_duration>Duration</h2><div class=sectionbody><div class=paragraph><p>Duration is actually a string type, which adheres to the following pattern: <code>^[0-9]+(ns|us|ms|s|m|h)$</code></p></div><div class=paragraph><p>So with <code>10s</code> you can define the duration of 10 seconds and with <code>2h</code> you can say 2 hours.</p></div></div></div><div class=sect1><h2 id=_endpoint>Endpoint</h2><div class=sectionbody><div class=paragraph><p>The <code>Endpoint</code> type defines the properties required for communication with an endpoint.</p></div><div class=paragraph><p>If only the URL needs to be set, you can specify it as a string. If additional properties are required, the following options are available:</p></div><div class=ulist><ul><li><p><strong><code>url</code></strong> <em>string</em> (mandatory)</p><div class=paragraph><p>The URL of the endpoint. Depending on the mechanism, the URL can be templated.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=ulist><ul><li><p>If templating is used, the user info, scheme, and host parts of the URL cannot be templated. Attempts to do so will result in runtime errors.</p></li><li><p>TLS is enforced unless heimdall is started with the <code>--insecure-skip-egress-tls-enforcement</code> flag, which allows insecure communication with any configured service.</p></li></ul></div></td></tr></tbody></table></div></li><li><p><strong><code>method</code></strong> <em>string</em> (optional)</p><div class=paragraph><p>The HTTP method to use while communicating with the endpoint. If not set <code>POST</code> is used.</p></div></li><li><p><strong><code>retry</code></strong> <em><a href=#_retry>Retry</a></em> (optional)</p><div class=paragraph><p>What to do if the communication fails. If not configured, no retry attempts are done.</p></div></li><li><p><strong><code>auth</code></strong> <em><a href=#_authentication_strategy>Authentication Strategy</a></em> (optional)</p><div class=paragraph><p>Authentication strategy to apply, if the endpoint requires authentication.</p></div></li><li><p><strong><code>headers</code></strong> <em>map of strings</em> (optional)</p><div class=paragraph><p>HTTP headers to be sent to the endpoint.</p></div><div class="admonitionblock caution"><table><tbody><tr><td class=icon><i class="fa icon-caution" title=Caution></i></td><td class=content>These headers are not analyzed by heimdall and are just forwarded to the endpoint. E.g. if you configure the <code>Content-Encoding</code> to something like <code>gzip</code>, the service behind the used endpoint might fail to answer, as it would expect the body to be compressed.</td></tr></tbody></table></div></li><li><p><strong><code>http_cache</code></strong> <em><a href=#_http_cache>HTTP Cache</a></em> (optional)</p><div class=paragraph><p>Controls whether HTTP caching according to <a href=https://www.rfc-editor.org/rfc/rfc7234>RFC 7234</a> should be used.</p></div></li></ul></div><div class=exampleblock><div class=title>Example 16. Endpoint configuration as string</div><div class=content><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=text>https://foo.bar</code></pre></div></div></div></div><div class=exampleblock><div class=title>Example 17. Structured Endpoint configuration</div><div class=content><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=yaml><span class=na>url</span><span class=pi>:</span> <span class=s>https://foo.bar</span>
<span class=na>method</span><span class=pi>:</span> <span class=s>GET</span>
<span class=na>retry</span><span class=pi>:</span>
  <span class=na>give_up_after</span><span class=pi>:</span> <span class=s>5s</span>
  <span class=na>max_delay</span><span class=pi>:</span> <span class=s>1s</span>
<span class=na>auth</span><span class=pi>:</span>
  <span class=na>type</span><span class=pi>:</span> <span class=s>api_key</span>
  <span class=na>config</span><span class=pi>:</span>
    <span class=na>name</span><span class=pi>:</span> <span class=s>foo</span>
    <span class=na>value</span><span class=pi>:</span> <span class=s>bar</span>
    <span class=na>in</span><span class=pi>:</span> <span class=s>cookie</span>
<span class=na>headers</span><span class=pi>:</span>
  <span class=na>X-My-First-Header</span><span class=pi>:</span> <span class=s>foobar</span>
  <span class=na>X-My-Second-Header</span><span class=pi>:</span> <span class=s>barfoo</span>
<span class=na>http_cache</span><span class=pi>:</span>
  <span class=na>enabled</span><span class=pi>:</span> <span class=kc>true</span></code></pre></div></div></div></div></div></div><div class=sect1><h2 id=_errorstate_type>Error/State Type</h2><div class=sectionbody><div class=paragraph><p>Heimdall defines a couple of error/state types, which it uses to signal errors. Those, which are marked with (*) are available in CEL expressions. All can be used to define overrides for the HTTP response codes.</p></div><div class=paragraph><p>Following types are available:</p></div><div class=ulist><ul><li><p><code>accepted</code> - this is the only state type in this list and is used to signal, the matched decision pipeline has been executed successfully, so the request can be forwarded to the upstream service. The response of that type results by default in a <code>200 OK</code> response.</p></li><li><p><code>authentication_error</code> (*) - used if an authenticator failed to verify authentication data available in the request. E.g. an authenticator was configured to verify a JWT and the signature of it was invalid. If none of the authenticators used in a pipeline were able to authenticate the user, and the default error handler was used to handle such error, it will by default result in a <code>401 Unauthorized</code> response.</p></li><li><p><code>authorization_error</code> (*) - used if an authorizer failed to authorize the subject. E.g. an authorizer is configured to use an expression on the given subject and request context, but that expression returned with an error. Error of this type results by default in <code>403 Forbidden</code> response if the default error handler was used to handle such error.</p></li><li><p><code>communication_error</code> (*) - this error is used to signal a communication error while communicating to a remote system during the execution of the pipeline of the matched rule. Timeouts of DNSs errors result in such an error. Error of this type results by default in <code>502 Bad Gateway</code> HTTP code if handled by the default error handler.</p></li><li><p><code>internal_error</code> - used if heimdall run into an internal error condition while processing the request. E.g. something went wrong while unmarshalling a JSON object, or if there was a configuration error, which couldn’t be raised while loading a rule, etc. Results by default in <code>500 Internal Server Error</code> response to the caller.</p></li><li><p><code>no_rule_error</code> - this error is used to signal, there is no matching rule to handle the given request. Error of this type results by default in <code>404 Not Found</code> HTTP code.</p></li><li><p><code>precondition_error</code> (*) - used if the request does not contain required/expected data. E.g. if an authenticator could not find a cookie configured. Error of this type results by default in <code>400 Bad Request</code> HTTP code if handled by the default error handler.</p></li></ul></div></div></div><div class=sect1><h2 id=_http_cache>HTTP Cache</h2><div class=sectionbody><div class=paragraph><p>Controls whether HTTP caching according to <a href=https://www.rfc-editor.org/rfc/rfc7234>RFC 7234</a> should be used. Following properties are defined:</p></div><div class=ulist><ul><li><p><strong><code>enabled</code></strong> <em>boolean</em> (optional)</p><div class=paragraph><p>Defaults to <code>false</code> if not otherwise stated in the description of the configuration type, making use of the HTTP Cache settings. When set to <code>true</code>, heimdall will strictly comply with the HTTP caching rules defined in RFC 7234, caching responses only when allowed and reusing them only if they remain valid per the standard.</p></div></li><li><p><strong><code>cache_ttl</code></strong> <em><a href=#_duration>Duration</a></em> (optional)</p><div class=paragraph><p>Specifies how long heimdall should cache the response if it does not contain any explicit expiration time (no heuristic freshness lifetime is calculated). If this property is not set, heimdall considers such responses uncacheable. Unless specified otherwise in the configuration type description utilizing the HTTP Cache settings, the default value is <code>0s</code>.</p></div></li></ul></div></div></div><div class=sect1><h2 id=_key_store>Key Store</h2><div class=sectionbody><div class=paragraph><p>This type configures a key store holding keys and corresponding certificate chains. PKCS#1, as well as PKCS#8 encodings are supported for private keys.</p></div><div class=paragraph><p>While loading a key store following verifications are done:</p></div><div class="olist arabic"><ol class=arabic><li><p>Uniqueness of key ids and rejection of key stores which violate this condition (see also <a href=#_key_id_lookup>Key-Id Lookup</a>)</p></li><li><p>Correlation of keys and certificates to build a valid certificate chain for every given key if certificates are present. If the correlation fails, an error is raised and heimdall will refuse to start.</p></li><li><p>Certificate chain validation. If the chain is invalid, an error is raised and heimdall will refuse to start.</p></li></ol></div><div class=paragraph><p>Following configuration properties are available:</p></div><div class=ulist><ul><li><p><strong><code>path</code></strong>: <em>string</em> (mandatory)</p><div class=paragraph><p>The path to the PEM file with the cryptographic material. Watching for secrets rotation is supported.</p></div></li><li><p><strong><code>password</code></strong>: <em>string</em> (optional)</p><div class=paragraph><p>If the key material is protected with a password, this property can be set to decipher it. Password protection is only supported for PKCS#8 encoded keys</p></div><div class="admonitionblock caution"><table><tbody><tr><td class=icon><i class="fa icon-caution" title=Caution></i></td><td class=content>If the key store contains multiple keys and these keys are password protected, same password must be used for all of these.</td></tr></tbody></table></div></li></ul></div><div class=exampleblock><div class=title>Example 18. Example configuration</div><div class=content><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=yaml><span class=na>path</span><span class=pi>:</span> <span class=s>/path/to/keystore.pem</span>
<span class=na>password</span><span class=pi>:</span> <span class=s>VeryInsecure!</span></code></pre></div></div></div></div></div></div><div class=sect1><h2 id=_respond>Respond</h2><div class=sectionbody><div class=paragraph><p>This type enables instructing heimdall to preserve error information and provide it in the response body to the caller, as well as to use HTTP status codes deviating from those heimdall would usually use. The configuration, which can be done using this type affects only the behavior of the default error handler.</p></div><div class=paragraph><p>Following properties are supported:</p></div><div class=ulist><ul><li><p><strong><code>verbose</code></strong>: <em>boolean</em> (optional)</p><div class=paragraph><p>By making use of this property you can instruct heimdall to preserve error information and provide it in the response body to the caller. Defaults to <code>false</code>.</p></div><div class=paragraph><p>Heimdall supports MIME type negotiation. So, if the client sets the HTTP <code>Accept</code> header to e.g. <code>application/json</code>, and Heimdall run into an unhandled internal error condition, in addition to responding with <code>500 Internal Server Error</code>, it will render an error message, like shown below, if <code>verbose</code> has been set to <code>true</code>.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=json><span class=p>{</span><span class=w>
  </span><span class=nl>&#34;code&#34;</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;internal error&#34;</span><span class=p>,</span><span class=w>
  </span><span class=nl>&#34;message&#34;</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;whatever led to the error&#34;</span><span class=w>
</span><span class=p>}</span></code></pre></div></div><div class=paragraph><p>The <code>message</code> will however contain just high-level information, like "failed to parse something", but will not contain any stack traces.</p></div></li><li><p><strong><code>with</code></strong>: <em>ResponseOverride set</em> (optional)</p><div class=paragraph><p>This property enables mapping between response/error types used by heimdall and the corresponding HTTP status codes. Each entry must be from the list of the supported <a href=#_errorstate_type>Error/State Types</a> and contain exactly one property named <code>code</code>, which then defines the desired mapping.</p></div><div class=exampleblock><div class=title>Example 19. Making error responses verbose and changing the HTTP codes for some errors</div><div class=content><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=yaml><span class=na>verbose</span><span class=pi>:</span> <span class=kc>true</span>
<span class=na>with</span><span class=pi>:</span>
  <span class=na>authentication_error</span><span class=pi>:</span>
    <span class=na>code</span><span class=pi>:</span> <span class=m>404</span>
  <span class=na>authorization_error</span><span class=pi>:</span>
    <span class=na>code</span><span class=pi>:</span> <span class=s>404</span></code></pre></div></div></div></div></li></ul></div></div></div><div class=sect1><h2 id=_retry>Retry</h2><div class=sectionbody><div class=paragraph><p>Implements an exponential backoff strategy for endpoint communication. It increases the backoff exponentially by multiplying the <code>max_delay</code> with 2^(attempt count)</p></div><div class=ulist><ul><li><p><strong><code>give_up_after</code></strong>: <em><a href=#_duration>Duration</a></em> (optional)</p><div class=paragraph><p>Sets an upper bound on the maximum time to wait between two requests. Default to 0, which means no upper bound.</p></div></li><li><p><strong><code>max_delay</code></strong>: <em><a href=#_duration>Duration</a></em> (mandatory)</p><div class=paragraph><p>The initial backoff.</p></div></li></ul></div><div class=exampleblock><div class=title>Example 20. Retry configuration</div><div class=content><div class=paragraph><p>In this example the backoff will be 1, 2, 4, 8, 16, 32, 60, …​</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=yaml><span class=na>give_up_after</span><span class=pi>:</span> <span class=s>60s</span>
<span class=na>max_delay</span><span class=pi>:</span> <span class=s>1s</span></code></pre></div></div></div></div></div></div><div class=sect1><h2 id=_scopes_matcher>Scopes Matcher</h2><div class=sectionbody><div class=paragraph><p>Scopes matcher is a configuration type allowing configuration of different strategies to match required scopes. In its simplest shape it can be just an array of strings (implemented by the <a href=#_exact>Exact</a>) scope matcher. To cover many use cases, different strategies are available and described in the following sections.</p></div><div class=paragraph><p>Regardless of the strategy, each matcher can explicitly be configured and supports the following configuration properties:</p></div><div class=ulist><ul><li><p><code>matching_strategy</code> - the type of the mathing strategy.</p></li><li><p><code>values</code> - the list of scope patterns</p></li></ul></div><div class=sect2><h3 id=_exact>Exact</h3><div class=paragraph><p>This the simplest matcher and is automatically selected, if just an array of strings is configured as shown in the following snippet:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=yaml><span class=pi>-</span> <span class=s>foo</span>
<span class=pi>-</span> <span class=s>bar</span></code></pre></div></div><div class=paragraph><p>However, as written in the <a href=#_scopes_matcher>Scopes Matcher</a> section, it can also explicitly be selected by setting <code>matching_strategy</code> to <code>exact</code> and defining the required scopes in the <code>values</code> property.</p></div><div class=exampleblock><div class=title>Example 21. Essentially same configurations</div><div class=content><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=yaml><span class=na>matching_strategy</span><span class=pi>:</span> <span class=s>exact</span>
<span class=na>values</span><span class=pi>:</span>
  <span class=pi>-</span> <span class=s>foo</span>
  <span class=pi>-</span> <span class=s>bar</span></code></pre></div></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=yaml>  <span class=pi>-</span> <span class=s>foo</span>
  <span class=pi>-</span> <span class=s>bar</span></code></pre></div></div></div></div></div><div class=sect2><h3 id=_hierarchic>Hierarchic</h3><div class=paragraph><p>This matcher enables matching hierarchical scopes, which use <code>.</code> as separator. Imagine your system is organized that way, that it defines namespaces for different services like this:</p></div><div class=ulist><ul><li><p><code>my-service</code> being the top namespace</p></li><li><p><code>my-service.booking</code> - being the namespace of the booking service</p></li><li><p><code>my-service.orders</code> - being the namespace of the orders service</p></li><li><p><code>my-service.orders.partners</code> - being the namespace of the order service for partners and</p></li><li><p><code>my-service.orders.customers</code> - being the namespace of the order service for customers</p></li></ul></div><div class=paragraph><p>Basically you’ve established an identity for each of your services (this is comparable to how <a href=https://spiffe.io/docs/latest/spiffe-about/spiffe-concepts/#spiffe-id>SPIFFE IDs</a> are organized and also used for).</p></div><div class=paragraph><p>Now, imagine you use these namespaces as scope values to limit the usage of the issued tokens. In such situations the hierarchic scope matcher can become handy if you would like to assert any scope of the token must be in e.g. the <code>my-service</code> or the <code>my-service.orders</code> namespace.</p></div><div class=paragraph><p>This matcher can only be used by explicitly setting the <code>matching_strategy</code> to <code>hierarchic</code> and defining the required patterns in the <code>values</code> property.</p></div><div class=exampleblock><div class=title>Example 22. Matching of hierarchic scopes</div><div class=content><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=yaml><span class=na>matching_strategy</span><span class=pi>:</span> <span class=s>hierarchic</span>
<span class=na>values</span><span class=pi>:</span>
  <span class=pi>-</span> <span class=s>my-service</span></code></pre></div></div><div class=paragraph><p>This configuration will ensure all scopes withing the scope or scp claim are within the <code>my-service</code> namespace. So scope claim like</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=json><span class=p>{</span><span class=w>
  </span><span class=nl>&#34;scope&#34;</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;my-service.orders&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;my-service.orders.customers&#34;</span><span class=p>]</span><span class=w>
</span><span class=p>}</span></code></pre></div></div><div class=paragraph><p>would match, but</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=json><span class=p>{</span><span class=w>
  </span><span class=nl>&#34;scope&#34;</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;not-my-service&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;my-service.orders.customers&#34;</span><span class=p>]</span><span class=w>
</span><span class=p>}</span></code></pre></div></div><div class=paragraph><p>would not match.</p></div></div></div></div><div class=sect2><h3 id=_wildcard>Wildcard</h3><div class=paragraph><p>This matcher enables matching scopes using wildcards. It goes beyond the <a href=#_hierarchic>Hierarchic</a> scope matcher by enabling usage of wildcards.</p></div><div class=paragraph><p>This matcher can only be used by explicitly setting the <code>matching_strategy</code> to <code>wildcard</code> and defining the required patterns in the <code>values</code> property.</p></div></div></div></div><div class=sect1><h2 id=_session_lifespan>Session Lifespan</h2><div class=sectionbody><div class=paragraph><p>This configuration type enables the configuration of session lifespans, used for session validation for those authenticators, which act on non-standard protocols. Following properties are available.</p></div><div class=ulist><ul><li><p><strong><code>active</code></strong>: <em>string</em> (optional)</p><div class=paragraph><p>A <a href=https://github.com/tidwall/gjson/blob/master/SYNTAX.md>GJSON Path</a> pointing to the field describing the "active" status of the session in the corresponding JSON object. The actual value in that field should be convertable to a <code>bool</code> type. If not provided, or not found in the session object, the session is considered to be "active". "active" means it can be used and represent a valid session between the authentication system and the subject, the session has been issued to.</p></div></li><li><p><strong><code>issued_at</code></strong>: <em>string</em> (optional)</p><div class=paragraph><p>A <a href=https://github.com/tidwall/gjson/blob/master/SYNTAX.md>GJSON Path</a> pointing to the field in the corresponding JSON object, describing the time, when the session object has been issued. If not provided or not found, the issuance time is not considered during session validation.</p></div></li><li><p><strong><code>not_before</code></strong>: <em>string</em> (optional)</p><div class=paragraph><p>A <a href=https://github.com/tidwall/gjson/blob/master/SYNTAX.md>GJSON Path</a> pointing to the field in the corresponding JSON object describing the time, until which the session object is not allowed to be used. If not provided or not found, the corresponding time is not considered during session validation.</p></div></li><li><p><strong><code>not_after</code></strong>: <em>string</em> (optional)</p><div class=paragraph><p>A <a href=https://github.com/tidwall/gjson/blob/master/SYNTAX.md>GJSON Path</a> pointing to the field in the corresponding JSON object describing the time, after which the session object is not allowed to be used. If not provided or not found, the corresponding time is not considered during session validation.</p></div></li><li><p><strong><code>time_format</code></strong>: <em>string</em> (optional)</p><div class=paragraph><p>Since different authentication system use different representations for time strings, this property allows the definition of the <a href=https://pkg.go.dev/time#pkg-constants>time format/layout</a> used by the authentication system. Defaults to Unix Epoch time stamp.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content>You can use the following <a href=https://go.dev/play/p/VjtvWMmp-Ua>Go Playground</a> link to test your time format settings.</td></tr></tbody></table></div></li><li><p><strong><code>validity_leeway</code></strong>: <a href=#_duration>Duration</a> (optional)</p><div class=paragraph><p>Enables definition of an allowed time drift between the authentication system and heimdall for the validation of the session validity. Defaults to 0.</p></div></li></ul></div><div class=exampleblock><div class=title>Example 23. Making use of session information received from Ory’s Kratos</div><div class=content><div class=paragraph><p>A typical response from Kratos' <code>whoami</code> endpoint looks like follows (stripped to the most interesting parts):</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=json><span class=p>{</span><span class=w>
  </span><span class=nl>&#34;id&#34;</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;1338410d-c473-4503-a96a-53efa06e2531&#34;</span><span class=p>,</span><span class=w>
  </span><span class=nl>&#34;active&#34;</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=p>,</span><span class=w>
  </span><span class=nl>&#34;expires_at&#34;</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;2021-10-15T15:58:57.683338Z&#34;</span><span class=p>,</span><span class=w>
  </span><span class=nl>&#34;authenticated_at&#34;</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;2021-10-14T15:58:57.683338Z&#34;</span><span class=p>,</span><span class=w>
  </span><span class=nl>&#34;issued_at&#34;</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;2021-10-14T15:58:57.683338Z&#34;</span><span class=p>,</span><span class=w>
  </span><span class=nl>&#34;identity&#34;</span><span class=p>:</span><span class=w> </span><span class=p>{</span><span class=w>
    </span><span class=nl>&#34;id&#34;</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;9496bbd5-f426-473f-b087-c7df853f274a&#34;</span><span class=p>,</span><span class=w>
    </span><span class=err>...</span><span class=w>
  </span><span class=p>}</span><span class=w>
</span><span class=p>}</span></code></pre></div></div><div class=paragraph><p>To enable usage of these properties in Heimdall, you can configure the Session Lifespan as follows:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=yaml><span class=na>active</span><span class=pi>:</span> <span class=s>active</span>
<span class=na>issued_at</span><span class=pi>:</span> <span class=s>issued_at</span>
<span class=na>not_before</span><span class=pi>:</span> <span class=s>authenticated_at</span>
<span class=na>not_after</span><span class=pi>:</span> <span class=s>expires_at</span>
<span class=na>time_format</span><span class=pi>:</span> <span class=s2>&#34;</span><span class=s>2006-01-02T15:04:05.999999Z07&#34;</span>
<span class=na>validity_leeway</span><span class=pi>:</span> <span class=s>10s</span></code></pre></div></div></div></div><div class=exampleblock><div class=title>Example 24. Making use of session information received from a compliant OAuth2 authorization service</div><div class=content><div class=paragraph><p>A typical response from a token <code>introspection</code> endpoint looks like follows:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=json><span class=p>{</span><span class=w>
  </span><span class=nl>&#34;active&#34;</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=p>,</span><span class=w>
  </span><span class=nl>&#34;client_id&#34;</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;l238j323ds-23ij4&#34;</span><span class=p>,</span><span class=w>
  </span><span class=nl>&#34;username&#34;</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;jdoe&#34;</span><span class=p>,</span><span class=w>
  </span><span class=nl>&#34;scope&#34;</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;read write dolphin&#34;</span><span class=p>,</span><span class=w>
  </span><span class=nl>&#34;sub&#34;</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;Z5O3upPC88QrAjx00dis&#34;</span><span class=p>,</span><span class=w>
  </span><span class=nl>&#34;aud&#34;</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;https://protected.example.net/resource&#34;</span><span class=p>,</span><span class=w>
  </span><span class=nl>&#34;iss&#34;</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;https://server.example.com/&#34;</span><span class=p>,</span><span class=w>
  </span><span class=nl>&#34;exp&#34;</span><span class=p>:</span><span class=w> </span><span class=mi>1419356238</span><span class=p>,</span><span class=w>
  </span><span class=nl>&#34;iat&#34;</span><span class=p>:</span><span class=w> </span><span class=mi>1419350238</span><span class=p>,</span><span class=w>
  </span><span class=nl>&#34;extension_field&#34;</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;twenty-seven&#34;</span><span class=w>
 </span><span class=p>}</span></code></pre></div></div><div class=paragraph><p>To enable usage of these properties in Heimdall, you can configure the Session Lifespan as follows:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=yaml><span class=na>active</span><span class=pi>:</span> <span class=s>active</span>
<span class=na>issued_at</span><span class=pi>:</span> <span class=s>iat</span>
<span class=na>not_after</span><span class=pi>:</span> <span class=s>exp</span>
<span class=na>validity_leeway</span><span class=pi>:</span> <span class=s>10s</span></code></pre></div></div><div class=paragraph><p>As you see, there is no need to define the time format as the times values appearing in the responses from an introspection endpoint are Unix Epoch time stamps.</p></div></div></div></div></div><div class=sect1><h2 id=_signer>Signer</h2><div class=sectionbody><div class=paragraph><p>When heimdall is used to issue signed objects, like JWTs, to enable upstream services to rely on authentic information, it acts as an issuer of such objects and requires corresponding configuration.</p></div><div class=paragraph><p>Following properties are supported:</p></div><div class=ulist><ul><li><p><strong><code>name</code></strong>: <em>string</em> (optional)</p><div class=paragraph><p>The name used to specify the issuer. E.g. if a JWT is generated, this value is used to set the <code>iss</code> claim. If not set, the value <code>heimdall</code> is used.</p></div></li><li><p><strong><code>key_store</code></strong>: <em><a href=../../../docs/configuration/types/#_key_store>Key Store</a></em> (mandatory)</p><div class=paragraph><p>The key store containing the cryptographic material. At least one private key must be present.</p></div></li><li><p><strong><code>key_id</code></strong>: <em>string</em> (optional)</p><div class=paragraph><p>If the <code>key_store</code> contains multiple keys, this property can be used to specify the key to use (see also <a href=../../../docs/configuration/types/#_key_id_lookup>Key-Id Lookup</a>). If not specified, the first key is used. If specified, but there is no key for the given key id present, an error is raised and heimdall will refuse to start.</p></div></li></ul></div><div class=exampleblock><div class=title>Example 25. Possible configuration</div><div class=content><div class=paragraph><p>Imagine you have a PEM file located in <code>/opt/heimdall/keystore.pem</code> with the following contents:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=txt>-----BEGIN EC PRIVATE KEY-----
X-Key-ID: foo

MIGkAgEBBDBRLr783dIM5NHJnDDMRVBiFSF56xqHle5lZk1ZCyyow9wKZGuF4EWK
jRBISBkE3NSgBwYFK4EEACKhZANiAAQ+oGUOJpVjntIWuanYxpXe6oN5tKhzLhBX
GP1SOXiLhnPNnN2uZu9KwOoBzoZhr/Fxw+sziXmzHJwjluz78VOlFKyopxTfmxRZ
0qq3f/KHWdDtVvmTfT0O/ux9mg6mCJw=
-----END EC PRIVATE KEY-----
-----BEGIN CERTIFICATE-----
MIIByjCCAVGgAwIBAgIBATAKBggqhkjOPQQDAzAuMQswCQYDVQQGEwJFVTENMAsG
A1UEChMEVGVzdDEQMA4GA1UEAxMHVGVzdCBDQTAeFw0yMjA4MTUwOTE3MTFaFw0y
MjA4MTUxMDE3MTFaMDAxCzAJBgNVBAYTAkVVMQ0wCwYDVQQKEwRUZXN0MRIwEAYD
VQQDEwlUZXN0IEVFIDEwdjAQBgcqhkjOPQIBBgUrgQQAIgNiAAQ+oGUOJpVjntIW
uanYxpXe6oN5tKhzLhBXGP1SOXiLhnPNnN2uZu9KwOoBzoZhr/Fxw+sziXmzHJwj
luz78VOlFKyopxTfmxRZ0qq3f/KHWdDtVvmTfT0O/ux9mg6mCJyjQTA/MA4GA1Ud
DwEB/wQEAwIHgDAMBgNVHQ4EBQQDYmFyMB8GA1UdIwQYMBaAFLO77bgPgZMKz11D
BVDUXvtNGeBnMAoGCCqGSM49BAMDA2cAMGQCMFRlx9Bq0MuSh5pDhDTqRq/MnxxD
W7qZg15AXoNnLrR60vV9gHjzkp1UkcU9viRIuAIwU0BjwDncp9z1seqKh+/eJV3f
xstQe2rzUEptWLIiPFoOBWZuw9wJ/Hunjik3a9T/
-----END CERTIFICATE-----
-----BEGIN CERTIFICATE-----
MIIByjCCAVCgAwIBAgIBATAKBggqhkjOPQQDAzAuMQswCQYDVQQGEwJFVTENMAsG
A1UEChMEVGVzdDEQMA4GA1UEAxMHVGVzdCBDQTAeFw0yMjA4MTUwOTE3MTFaFw0y
MjA4MTYwOTE3MTFaMC4xCzAJBgNVBAYTAkVVMQ0wCwYDVQQKEwRUZXN0MRAwDgYD
VQQDEwdUZXN0IENBMHYwEAYHKoZIzj0CAQYFK4EEACIDYgAEf96tstMNdNoNfYjl
bGY6BvBFTsl9E3hpPnta7SJn6BqIYz6KEohDJ+8DXwUMVb5Ytr/QkEikg966HCY3
A9TFBUdAs01TV8f2KoAPRQVrh+ccSLLJyACENfZ5VbGSQ0wso0IwQDAOBgNVHQ8B
Af8EBAMCAQYwDwYDVR0TAQH/BAUwAwEB/zAdBgNVHQ4EFgQUs7vtuA+BkwrPXUMF
UNRe+00Z4GcwCgYIKoZIzj0EAwMDaAAwZQIxAMPgE/Z+1Dcj+lH7jioE16Hig0HQ
FC4qBx1UU05H05Gs23ECB1hzD2qXikVpaNyuDgIwbogEu42wIwpDa5xdJIZcIhmz
DIuPvEscUDjU3C+1GPxmACcRMPv9QVUEcBAvZkfn
-----END CERTIFICATE-----</code></pre></div></div><div class=paragraph><p>Then you can configure heimdall to use it like follows:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=yaml><span class=na>signer</span><span class=pi>:</span>
  <span class=na>name</span><span class=pi>:</span> <span class=s>foobar</span>
  <span class=na>key_store</span><span class=pi>:</span>
    <span class=na>path</span><span class=pi>:</span> <span class=s>/opt/heimdall/keystore.pem</span>
  <span class=na>key_id</span><span class=pi>:</span> <span class=s>foo</span></code></pre></div></div></div></div></div></div><div class=sect1><h2 id=_subject>Subject</h2><div class=sectionbody><div class=paragraph><p>This configuration type enables extraction of subject information from responses received by Heimdall from authentication services. Following properties are available.</p></div><div class=ulist><ul><li><p><strong><code>id</code></strong>: <em>string</em> (mandatory)</p><div class=paragraph><p>A <a href=https://github.com/tidwall/gjson/blob/master/SYNTAX.md>GJSON Path</a> pointing to the id of the subject in the JSON object.</p></div></li><li><p><strong><code>attributes</code></strong>: <em>string</em> (optional)</p><div class=paragraph><p>A <a href=https://github.com/tidwall/gjson/blob/master/SYNTAX.md>GJSON Path</a> pointing to the attributes of the subject in the JSON object. Defaults to <code>@this</code>.</p></div></li></ul></div><div class=exampleblock><div class=title>Example 26. Extracting subject id from an <a href=https://tools.ietf.org/html/rfc7662>OAuth2 Introspection</a> endpoint response.</div><div class=content><div class=paragraph><p>This example shows how to extract the subject id from an <a href=https://tools.ietf.org/html/rfc7662>OAuth2 Introspection</a> endpoint response and set the subject attributes to the entire response</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=yaml><span class=na>id</span><span class=pi>:</span> <span class=s>sub</span>
<span class=na>attributes</span><span class=pi>:</span> <span class=err>@</span><span class=s>this</span></code></pre></div></div><div class=paragraph><p>Setting <code>attributes</code> was actually not required, as <code>@this</code> would be set by default anyway.</p></div></div></div><div class=exampleblock><div class=title>Example 27. Extracting subject id from an <a href=https://www.ory.sh/docs/kratos/>Ory Kratos</a> "whoami" endpoint response</div><div class=content><div class=paragraph><p>This example shows how to extract the subject id from an <a href=https://www.ory.sh/docs/kratos/>Ory Kratos</a> "whoami" endpoint response and set the subject attributes to the entire response. <code>attributes</code> is not configured, so default is used.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=yaml><span class=na>id</span><span class=pi>:</span> <span class=s>identity.id</span></code></pre></div></div></div></div></div></div><div class=sect1><h2 id=_tls>TLS</h2><div class=sectionbody><div class=paragraph><p>Following are the supported TLS configuration properties:</p></div><div class=ulist><ul><li><p><strong><code>key_store</code></strong>: <em><a href=#_key_store>Key Store</a></em> (mandatory)</p><div class=paragraph><p>The key store containing the cryptographic material. At least one private key and the corresponding certificate must be present.</p></div></li><li><p><strong><code>key_id</code></strong>: <em>string</em> (optional)</p><div class=paragraph><p>If the <code>key_store</code> contains multiple keys, this property can be used to specify the key to use (see also <a href=#_key_id_lookup>Key-Id Lookup</a>). If not specified, the first key is used. If specified, but there is no key for the given key id present, an error is raised and heimdall will refuse to start.</p></div></li><li><p><strong><code>min_version</code></strong>: <em>string</em> (optional)</p><div class=paragraph><p>The minimal TLS version to support. Can be either <code>TLS1.2</code> or <code>TLS1.3</code>. Defaults to <code>TLS1.3</code>.</p></div></li><li><p><strong><code>cipher_suites</code></strong>: <em>string array</em> (optional)</p><div class=paragraph><p>Can be configured if <code>min_version</code> is set to <code>TLS1.2</code>. If <code>min_version</code> is set to <code>TLS1.3</code> the configured values are ignored. Only the following PFS cipher suites are supported:</p></div><div class=ulist><ul><li><p><code>TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA256</code></p></li><li><p><code>TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256</code></p></li><li><p><code>TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256</code></p></li><li><p><code>TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256</code></p></li><li><p><code>TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384</code></p></li><li><p><code>TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384</code></p></li><li><p><code>TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305_SHA256</code></p></li><li><p><code>TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305_SHA256</code></p></li></ul></div><div class=paragraph><p>Defaults to the last six cipher suites if <code>min_version</code> is set to <code>TLS1.2</code> and <code>cipher_suites</code> is not configured.</p></div></li></ul></div><div class=exampleblock><div class=title>Example 28. Example configuration</div><div class=content><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=yaml><span class=na>key_store</span><span class=pi>:</span>
  <span class=na>path</span><span class=pi>:</span> <span class=s>/path/to/keystore.pem</span>
  <span class=na>password</span><span class=pi>:</span> <span class=s>VeryInsecure!</span>
<span class=na>key_id</span><span class=pi>:</span> <span class=s>foobar</span>
<span class=na>min_version</span><span class=pi>:</span> <span class=s>TLS1.2</span>
<span class=na>cipher_suites</span><span class=pi>:</span>
  <span class=pi>-</span> <span class=s>TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384</span>
  <span class=pi>-</span> <span class=s>TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384</span></code></pre></div></div></div></div></div></div><div class=sect1><h2 id=_key_id_lookup>Key-Id Lookup</h2><div class=sectionbody><div class=paragraph><p>When heimdall loads a key store, following algorithm is used to get the key id for the key:</p></div><div class=ulist><ul><li><p>if the PEM entry with the private key has <code>X-Key-ID</code> header specified, this value is used as key id</p></li><li><p>Otherwise, if an X.509 certificate is present for the private key, and it has the <code>Subject Key Identifier</code> extension set, the hex representation of it is used as key id.</p></li><li><p>Otherwise, heimdall calculates the value for the <code>Subject Key Identifier</code> according to <a href=https://www.ietf.org/rfc/rfc3280.html#section-4.2.1.2>RFC 3280, Section 4.2.1.2</a> and uses hex representation of it as key id.</p></li></ul></div></div></div></linkable-headline-area></div><p class="text-end fst-italic fs-7 pb-3">Last updated on <span class=fw-bold>Jul 11, 2025</span></p><hr><div class="d-flex justify-content-between py-3"><a href=../../../docs/rules/providers/ class="fs-6 fw-bold text-dark link-secondary link-underline-opacity-0"><svg width="16" height="16" fill="currentcolor" class="bi bi-chevron-left" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M11.354 1.646a.5.5.0 010 .708L5.707 8l5.647 5.646a.5.5.0 01-.708.708l-6-6a.5.5.0 010-.708l6-6a.5.5.0 01.708.0z"/></svg>
Rule Providers
</a><a class="ms-auto fs-6 fw-bold text-dark link-secondary link-underline-opacity-0" href=../../../docs/configuration/reference/>Reference<svg width="16" height="16" fill="currentcolor" class="bi bi-chevron-right" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4.646 1.646a.5.5.0 01.708.0l6 6a.5.5.0 010 .708l-6 6a.5.5.0 01-.708-.708L10.293 8 4.646 2.354a.5.5.0 010-.708z"/></svg></a></div></div></main></div><footer class="footer py-4 py-md-5 px-4 px-md-3 mt-3"><div class=container><div class=row><div class="col-lg-3 mb-3"><p class=fs-5>Heimdall</p><ul class="list-unstyled small text-muted"><li class=mb-2>2022-2024 © Heimdall Project Authors. All rights reserved.</li><li class=mb-2><a href=https://github.com/dadrus/heimdall/blob/master/LICENSE>Apache 2.0 licensed</a></li></ul></div><div class="col-6 col-lg-2 offset-lg-1 mb-3"><h5>Links</h5><ul class=list-unstyled><li class=mb-2><a href=../../../>Home</a></li><li class=mb-2><a href=../../../docs/getting_started/discover_heimdall>Docs</a></li><li class=mb-2><a href=../../../guides/>Guides</a></li><li class=mb-2><a href=../../../openapi/>API</a></li></ul></div><div class="col-6 col-lg-2 mb-2"><h5>Guides</h5><ul class=list-unstyled><li class=mb-2><a href=../../../guides/proxies/>API Gateways & Proxies</a></li><li class=mb-2><a href=../../../guides/authz/>Authorization Services</a></li><li class=mb-2><a href=../../../guides/authn/>Authentication Protocols & Services</a></li></ul></div><div class="col-6 col-lg-2 mb-2"><h5>Community</h5><ul class=list-unstyled><li class=mb-2><a href=https://github.com/dadrus/heimdall>Github</a></li><li class=mb-2><a href=https://discord.gg/qQgg8xKuyb>Discord</a></li></ul></div></div></div></footer><script src=../../../js/main.js defer></script></body></html>