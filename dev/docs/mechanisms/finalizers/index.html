<!doctype html><html lang=en><head><title>Finalizers</title>
<meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="An open source Identity Aware Proxy and an Access Control Decision service for cloud native applications"><meta name=dc.relation content="https://dadrus.github.io/"><meta name=theme-color content="#1A94D2"><link rel=stylesheet href=../../../css/styles.min.css media=screen><link rel='shortcut icon' type=image/x-icon href=../../../favicon.ico></head><body><header class="navbar navbar-expand-md navbar-dark bg-dark sticky-top"><nav class="container-xxl flex-wrap flex-lg-nowrap px-0" aria-label="Main navigation"><button class="btn btn-outline-dark d-lg-none navbar-toggler border-0 shadow-none ps-3" type=button data-bs-toggle=offcanvas data-bs-target=#docsMenuContent aria-controls=docsMenuContent aria-expanded=false aria-label="Open docs menu"><svg width="36" height="36" fill="currentcolor" class="bi bi-list" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M2.5 12a.5.5.0 01.5-.5h10a.5.5.0 010 1H3a.5.5.0 01-.5-.5m0-4a.5.5.0 01.5-.5h10a.5.5.0 010 1H3A.5.5.0 012.5 8m0-4a.5.5.0 01.5-.5h10a.5.5.0 010 1H3A.5.5.0 012.5 4"/></svg></button><nav class="offcanvas offcanvas-start d-md-none text-bg-light" tabindex=-1 id=docsMenuContent aria-labelledby=docsMenuContentLabel><div class=offcanvas-header><h5 class=offcanvas-title id=docsMenuContentLabel>Browse docs</h5><button type=button class=btn-close data-bs-dismiss=offcanvas aria-label="Close docs menu"></button></div><div class="offcanvas-body docs-sidebar"><div class=docs-search-button><button type=button class="btn btn-outline-secondary mb-3 d-none d-md-block w-100 text-start" data-bs-toggle=modal data-bs-target=#docSearch aria-controls=docSearch aria-expanded=false aria-label="Open search">
<svg width="20" height="20" fill="currentcolor" class="bi bi-search me-2" viewBox="0 0 20 20"><path d="M11.742 10.344a6.5 6.5.0 10-1.397 1.398h-.001q.044.06.098.115l3.85 3.85a1 1 0 001.415-1.414l-3.85-3.85a1 1 0 00-.115-.1zM12 6.5a5.5 5.5.0 11-11 0 5.5 5.5.0 0111 0"/></svg>
<span>Quick search...</span></button></div><nav id=SideBarToc><ul><li><span>Getting Started</span><ul><li><a href=../../../docs/getting_started/discover_heimdall/>Discover heimdall</a></li><li><a href=../../../docs/getting_started/installation/>Install heimdall</a></li><li><a href=../../../docs/getting_started/protect_an_app/>Protect an Application</a></li></ul></li><li><span>Concepts</span><ul><li><a href=../../../docs/concepts/pipelines/>Pipelines</a></li><li><a href=../../../docs/concepts/mechanisms/>Mechanisms</a></li><li><a href=../../../docs/concepts/rules/>Rules</a></li><li><a href=../../../docs/concepts/provider/>Rule Provider</a></li><li><a href=../../../docs/concepts/operating_modes/>Operating Modes</a></li></ul></li><li><span>Operations</span><ul><li><a href=../../../docs/operations/configuration/>Configuration</a></li><li><a href=../../../docs/operations/cli/>CLI</a></li><li><a href=../../../docs/operations/observability/>Observability</a></li><li><a href=../../../docs/operations/cache/>Caching</a></li><li><a href=../../../docs/operations/security/>Security</a></li></ul></li><li><span>Services</span><ul><li><a href=../../../docs/services/main/>Main Service</a></li><li><a href=../../../docs/services/management/>Management Service</a></li></ul></li><li><span>Mechanisms</span><ul><li><a href=../../../docs/mechanisms/catalogue/>Catalogue</a></li><li><a href=../../../docs/mechanisms/evaluation_objects/>Objects, Templating & Co</a></li><li><a href=../../../docs/mechanisms/authenticators/>Authenticators</a></li><li><a href=../../../docs/mechanisms/authorizers/>Authorizers</a></li><li><a href=../../../docs/mechanisms/contextualizers/>Contextualizers</a></li><li><a class=active href=../../../docs/mechanisms/finalizers/>Finalizers</a></li><li><a href=../../../docs/mechanisms/error_handlers/>Error Handlers</a></li></ul></li><li><span>Rules</span><ul><li><a href=../../../docs/rules/regular_rule/>Regular Rule</a></li><li><a href=../../../docs/rules/default_rule/>Default Rule</a></li><li><a href=../../../docs/rules/rule_sets/>Rule Sets</a></li><li><a href=../../../docs/rules/providers/>Rule Providers</a></li></ul></li><li><span>Configuration Reference</span><ul><li><a href=../../../docs/configuration/types/>Type Definitions</a></li><li><a href=../../../docs/configuration/reference/>Reference</a></li></ul></li></ul></nav></div></nav><div class="d-flex align-items-center px-4"><a class="navbar-brand navbar-brand-highlight text-white me-0" href=../../../ style=font-weight:500;font-size:1.5rem>Heimdall</a><ul class="navbar-nav d-none d-md-flex ms-3"><li class=nav-item><a class='nav-link text-white' href=../../../docs/getting_started/discover_heimdall>Docs</a></li><li class=nav-item><a class='nav-link text-white' href=../../../guides/>Guides</a></li><li class=nav-item><a class='nav-link text-white' href=../../../openapi/>API</a></li></ul></div><div class=d-flex><button type=button class="btn btn-outline-dark navbar-toggler border-0 shadow-none" data-bs-toggle=modal data-bs-target=#docSearch aria-controls=docSearch aria-expanded=false aria-label="Open search">
<span class="bi bi-search"></span>
</button>
<button class="btn btn-outline-dark navbar-toggler border-0 shadow-none pe-3" type=button data-bs-toggle=offcanvas data-bs-target=#mainMenuContent aria-controls=mainMenuContent aria-expanded=false aria-label="Open main menu"><svg width="24" height="24" fill="currentcolor" class="bi bi-three-dots" viewBox="0 0 16 16"><path d="M3 9.5a1.5 1.5.0 110-3 1.5 1.5.0 010 3m5 0a1.5 1.5.0 110-3 1.5 1.5.0 010 3m5 0a1.5 1.5.0 110-3 1.5 1.5.0 010 3"/></svg></button><div class="offcanvas offcanvas-end text-bg-dark" tabindex=-1 id=mainMenuContent aria-labelledby=mainMenuContentLabel><div class=offcanvas-header><h5 class="offcanvas-title text-white" id=mainMenuContentLabel>Heimdall</h5><button type=button class="btn-close btn-close-white" data-bs-dismiss=offcanvas aria-label="Close main menu"></button></div><div class=offcanvas-body><ul class="navbar-nav flex-column d-md-none d-lg-none d-xl-none"><li class=nav-item><a class='nav-link text-white' href=../../../docs/getting_started/discover_heimdall>Docs</a></li><li class=nav-item><a class='nav-link text-white' href=../../../guides/>Guides</a></li><li class=nav-item><a class='nav-link text-white' href=../../../openapi/>API</a></li></ul><hr class="text-white-50 d-md-none"><ul class="navbar-nav flex-column ms-auto"><doc-version-select class="nav-item dropdown" version-file=/heimdall/data.json current-version=dev current-page=/docs/mechanisms/finalizers/><button class="btn btn-dark dropdown-toggle me-4" data-bs-toggle=dropdown aria-expanded=false>
dev</button></doc-version-select></ul><ul class="navbar-nav flex-column"><li class="nav-item mb-1 pe-4"><a class="nav-link text-white" style=align-self:center href=https://github.com/dadrus/heimdall><svg role="img" width="20" height="20" fill="currentcolor" class="bi bi-github text-white" viewBox="0 0 16 16"><title>GitHub</title><path d="M8 0C3.58.0.0 3.58.0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38.0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95.0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12.0.0.67-.21 2.2.82.64-.18 1.32-.27 2-.27s1.36.09 2 .27c1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15.0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48.0 1.07-.01 1.93-.01 2.2.0.21.15.46.55.38A8.012 8.012.0 0016 8c0-4.42-3.58-8-8-8z"/></svg>
<small class="ms-2 d-md-none">GitHub</small></a></li></ul></div></div></div></nav></header><div class=modal id=docSearch tabindex=-1 aria-labelledby=docSearchLabel aria-hidden=true><doc-search class="col-auto me-auto mw-75" index-file=/heimdall/dev/index.json path-prefix=/heimdall/dev><div class="modal-dialog modal-lg modal-dialog-scrollable"><div class=modal-content><div class="modal-header p-2"><div class=input-group><div class="input-group-text bg-body border-0 fs-4"><svg width="16" height="16" fill="currentcolor" class="bi bi-search text-secondary my-0" viewBox="0 0 16 16"><path d="M11.742 10.344a6.5 6.5.0 10-1.397 1.398h-.001q.044.06.098.115l3.85 3.85a1 1 0 001.415-1.414l-3.85-3.85a1 1 0 00-.115-.1zM12 6.5a5.5 5.5.0 11-11 0 5.5 5.5.0 0111 0"/></svg></div><input id=search-input class="form-control search-bar border-0" type=search placeholder="Search documentation " aria-label="Search docs..." autocomplete=off autofocus><div class="input-group-text bg-body border-0"><a class="btn input-group-text text-muted border p-1 bg-light-subtle fs-7 fw-bold font-monospace" data-bs-dismiss=modal aria-label=Close>ESC</a></div></div></div><div class=modal-body><div class=search-results><p class="text-center mt-5">No recent searches</p></div></div><div class=modal-footer></div></div></div></doc-search></div><div class="container-xxl docs-layout px-4"><aside class="d-none pe-3 docs-sidebar"><div class=docs-search-button><button type=button class="btn btn-outline-secondary mb-3 d-none d-md-block w-100 text-start" data-bs-toggle=modal data-bs-target=#docSearch aria-controls=docSearch aria-expanded=false aria-label="Open search">
<svg width="20" height="20" fill="currentcolor" class="bi bi-search me-2" viewBox="0 0 20 20"><path d="M11.742 10.344a6.5 6.5.0 10-1.397 1.398h-.001q.044.06.098.115l3.85 3.85a1 1 0 001.415-1.414l-3.85-3.85a1 1 0 00-.115-.1zM12 6.5a5.5 5.5.0 11-11 0 5.5 5.5.0 0111 0"/></svg>
<span>Quick search...</span></button></div><nav id=SideBarToc><ul><li><span>Getting Started</span><ul><li><a href=../../../docs/getting_started/discover_heimdall/>Discover heimdall</a></li><li><a href=../../../docs/getting_started/installation/>Install heimdall</a></li><li><a href=../../../docs/getting_started/protect_an_app/>Protect an Application</a></li></ul></li><li><span>Concepts</span><ul><li><a href=../../../docs/concepts/pipelines/>Pipelines</a></li><li><a href=../../../docs/concepts/mechanisms/>Mechanisms</a></li><li><a href=../../../docs/concepts/rules/>Rules</a></li><li><a href=../../../docs/concepts/provider/>Rule Provider</a></li><li><a href=../../../docs/concepts/operating_modes/>Operating Modes</a></li></ul></li><li><span>Operations</span><ul><li><a href=../../../docs/operations/configuration/>Configuration</a></li><li><a href=../../../docs/operations/cli/>CLI</a></li><li><a href=../../../docs/operations/observability/>Observability</a></li><li><a href=../../../docs/operations/cache/>Caching</a></li><li><a href=../../../docs/operations/security/>Security</a></li></ul></li><li><span>Services</span><ul><li><a href=../../../docs/services/main/>Main Service</a></li><li><a href=../../../docs/services/management/>Management Service</a></li></ul></li><li><span>Mechanisms</span><ul><li><a href=../../../docs/mechanisms/catalogue/>Catalogue</a></li><li><a href=../../../docs/mechanisms/evaluation_objects/>Objects, Templating & Co</a></li><li><a href=../../../docs/mechanisms/authenticators/>Authenticators</a></li><li><a href=../../../docs/mechanisms/authorizers/>Authorizers</a></li><li><a href=../../../docs/mechanisms/contextualizers/>Contextualizers</a></li><li><a class=active href=../../../docs/mechanisms/finalizers/>Finalizers</a></li><li><a href=../../../docs/mechanisms/error_handlers/>Error Handlers</a></li></ul></li><li><span>Rules</span><ul><li><a href=../../../docs/rules/regular_rule/>Regular Rule</a></li><li><a href=../../../docs/rules/default_rule/>Default Rule</a></li><li><a href=../../../docs/rules/rule_sets/>Rule Sets</a></li><li><a href=../../../docs/rules/providers/>Rule Providers</a></li></ul></li><li><span>Configuration Reference</span><ul><li><a href=../../../docs/configuration/types/>Type Definitions</a></li><li><a href=../../../docs/configuration/reference/>Reference</a></li></ul></li></ul></nav></aside><main class=docs-main><div class="d-md-none docs-location bg-body"><nav style="--bs-breadcrumb-divider:'>'" aria-label=breadcrumb><ol class="breadcrumb mb-0"><li class="breadcrumb-item fw-bold">Mechanisms</li><li class="breadcrumb-item active" aria-current=page>Finalizers</li></ol></nav></div><div class="docs-intro pt-3 pe-3"><h1>Finalizers</h1><p>Finalizers are the last steps executed in a rule pipeline and can e.g. create a special representation of the subject to be made available to the upstream service. This page describes the available finalizer types in detail.</p></div><aside class="text-muted docs-toc"><strong class="d-md-block h6 pb-2 my-2 ms-2 border-bottom d-none d-md-none d-lg-block">On this page</strong><div id=page-content-toc class="mt-1 mb-3 text-muted d-none d-md-none d-lg-block docs-toc-content"><nav id=TableOfContents><ul><li><a href=#_noop>Noop</a></li><li><a href=#_header>Header</a></li><li><a href=#_cookie>Cookie</a></li><li><a href=#_jwt>JWT</a></li><li><a href=#_oauth2_client_credentials>OAuth2 Client Credentials</a></li></ul></nav></div><button class="btn btn-outline-secondary text-decoration-none d-lg-none collapsed" type=button data-bs-toggle=collapse data-bs-target=#page-content-toc-collapsible aria-expanded=false aria-controls=page-content-toc-collapsible>
On this page<svg width="16" height="16" fill="currentcolor" class="bi bi-chevron-expand" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M3.646 9.146a.5.5.0 01.708.0L8 12.793l3.646-3.647a.5.5.0 01.708.708l-4 4a.5.5.0 01-.708.0l-4-4a.5.5.0 010-.708m0-2.292a.5.5.0 00.708.0L8 3.207l3.646 3.647a.5.5.0 00.708-.708l-4-4a.5.5.0 00-.708.0l-4 4a.5.5.0 000 .708"/></svg></button><div id=page-content-toc-collapsible class="mt-1 mb-3 text-muted d-lg-none collapse docs-toc-content"><div class="card card-body"><nav id=TableOfContents><ul><li><a href=#_noop>Noop</a></li><li><a href=#_header>Header</a></li><li><a href=#_cookie>Cookie</a></li><li><a href=#_jwt>JWT</a></li><li><a href=#_oauth2_client_credentials>OAuth2 Client Credentials</a></li></ul></nav></div></div></aside><div class="docs-content pe-3"><div data-bs-spy=scroll data-bs-target=#page-content-toc class=mt-3><linkable-headline-area><div class=paragraph><p>Some finalizers may support or require additional configuration. The corresponding properties are annotated with <code>mandatory</code>, respectively <code>optional</code> to denote configuration requirement, as well as with <code>overridable</code>, <code>not overridable</code> and <code>partially overridable</code> to indicate whether the property can be overridden in a rule pipeline.</p></div><div class=sect1><h2 id=_noop>Noop</h2><div class=sectionbody><div class=paragraph><p>As the name implies, this finalizer does nothing. This finalizer type also doesn’t have any configuration options.</p></div><div class=paragraph><p>To enable the usage of this finalizer, you have to set the <code>type</code> property to <code>noop</code>.</p></div><div class=exampleblock><div class=title>Example 1. Noop finalizer configuration</div><div class=content><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=yaml><span class=na>id</span><span class=pi>:</span> <span class=s>foo</span>
<span class=na>type</span><span class=pi>:</span> <span class=s>noop</span></code></pre></div></div></div></div></div></div><div class=sect1><h2 id=_header>Header</h2><div class=sectionbody><div class=paragraph><p>This finalizer enables transformation of a <a href=../../../docs/mechanisms/evaluation_objects/#_subject><code>Subject</code></a> and the <a href=../../../docs/mechanisms/evaluation_objects/#_outputs><code>Outputs</code></a> objects into HTTP headers. It can also be used to map information from the original <a href=../../../docs/mechanisms/evaluation_objects/#_request><code>Request</code></a> into headers expected by the upstream service.</p></div><div class=paragraph><p>To enable the usage of this finalizer, you have to set the <code>type</code> property to <code>header</code>.</p></div><div class=paragraph><p>Configuration using the <code>config</code> property is mandatory. Following properties are available:</p></div><div class=ulist><ul><li><p><strong><code>headers</code></strong>: <em>string map</em> (mandatory, overridable)</p><div class=paragraph><p>Enables configuration of arbitrary headers with any values build from available information (See also <a href=../../../docs/mechanisms/evaluation_objects/#_templating>Templating</a>).</p></div></li></ul></div><div class=paragraph><p>In cases where multiple values are required for a single header name (e.g., impersonation groups in Kubernetes), the <code>header</code> finalizer will split newline-separated values into separate headers.</p></div><div class=exampleblock><div class=title>Example 2. Header finalizer configuration</div><div class=content><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=yaml><span class=na>id</span><span class=pi>:</span> <span class=s>foo</span>
<span class=na>type</span><span class=pi>:</span> <span class=s>header</span>
<span class=na>config</span><span class=pi>:</span>
  <span class=na>headers</span><span class=pi>:</span>
    <span class=na>X-User-ID</span><span class=pi>:</span> <span class=s1>&#39;</span><span class=s>{{</span><span class=nv> </span><span class=s>quote</span><span class=nv> </span><span class=s>.Subject.ID</span><span class=nv> </span><span class=s>}}&#39;</span>
    <span class=na>X-User-Email</span><span class=pi>:</span> <span class=s1>&#39;</span><span class=s>{{</span><span class=nv> </span><span class=s>index</span><span class=nv> </span><span class=s>.Subject.Attributes</span><span class=nv> </span><span class=s>&#34;email&#34;</span><span class=nv> </span><span class=s>|</span><span class=nv> </span><span class=s>quote</span><span class=nv> </span><span class=s>}}&#39;</span>
    <span class=na>Host</span><span class=pi>:</span> <span class=s1>&#39;</span><span class=s>{{</span><span class=nv> </span><span class=s>.Request.Header</span><span class=nv> </span><span class=s>&#34;Host&#34;</span><span class=nv> </span><span class=s>|</span><span class=nv> </span><span class=s>quote</span><span class=nv>  </span><span class=s>}}&#39;</span>
    <span class=na>Impersonate-Group</span><span class=pi>:</span> <span class=pi>|</span>
      <span class=s>{{- range .Subject.Attributes.groups }}</span>
      <span class=s>{{ . }}</span>
      <span class=s>{{- end }}</span></code></pre></div></div></div></div></div></div><div class=sect1><h2 id=_cookie>Cookie</h2><div class=sectionbody><div class=paragraph><p>This finalizer enables transformation of a <a href=../../../docs/mechanisms/evaluation_objects/#_subject><code>Subject</code></a> and the <a href=../../../docs/mechanisms/evaluation_objects/#_outputs><code>Outputs</code></a> objects into cookies. It can also be used to map information from the original <a href=../../../docs/mechanisms/evaluation_objects/#_request><code>Request</code></a> into cookies expected by the upstream service.</p></div><div class=paragraph><p>To enable the usage of this finalizer, you have to set the <code>type</code> property to <code>cookie</code>.</p></div><div class=paragraph><p>Configuration using the <code>config</code> property is mandatory. Following properties are available:</p></div><div class=ulist><ul><li><p><strong><code>cookies</code></strong>: <em>string map</em> (mandatory, overridable)</p><div class=paragraph><p>Enables configuration of arbitrary cookies with any values build from available information (See also <a href=../../../docs/mechanisms/evaluation_objects/#_templating>Templating</a>).</p></div></li></ul></div><div class=exampleblock><div class=title>Example 3. Cookie finalizer configuration</div><div class=content><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=yaml><span class=na>id</span><span class=pi>:</span> <span class=s>foo</span>
<span class=na>type</span><span class=pi>:</span> <span class=s>cookies</span>
<span class=na>config</span><span class=pi>:</span>
  <span class=na>cookies</span><span class=pi>:</span>
    <span class=na>user_id_cookie</span><span class=pi>:</span> <span class=s1>&#39;</span><span class=s>{{</span><span class=nv> </span><span class=s>quote</span><span class=nv> </span><span class=s>.Subject.ID</span><span class=nv> </span><span class=s>}}&#39;</span>
    <span class=na>user_email_cookie</span><span class=pi>:</span> <span class=s1>&#39;</span><span class=s>{{</span><span class=nv> </span><span class=s>index</span><span class=nv> </span><span class=s>.Subject.Attributes</span><span class=nv> </span><span class=s>&#34;email&#34;</span><span class=nv> </span><span class=s>|</span><span class=nv> </span><span class=s>quote</span><span class=nv> </span><span class=s>}}&#39;</span></code></pre></div></div></div></div></div></div><div class=sect1><h2 id=_jwt>JWT</h2><div class=sectionbody><div class=paragraph><p>This finalizer enables transformation of the <a href=../../../docs/mechanisms/evaluation_objects/#_subject><code>Subject</code></a> and the <a href=../../../docs/mechanisms/evaluation_objects/#_outputs><code>Outputs</code></a> objects into custom claims within a <a href=https://www.rfc-editor.org/rfc/rfc7519>JWT</a>. The resulting token is then made available to your upstream service in either the HTTP <code>Authorization</code> header (using the <code>Bearer</code> scheme) or in a custom header. Your upstream service can verify the JWT’s signature using heimdall’s JWKS endpoint to retrieve the necessary public keys/certificates.</p></div><div class=paragraph><p>To enable this finalizer, set the <code>type</code> property to <code>jwt</code>.</p></div><div class=paragraph><p>Configuration using the <code>config</code> property is mandatory. The following properties are available:</p></div><div class=ulist><ul><li><p><strong><code>signer</code></strong>: <em><a href=../../../docs/configuration/types/#_signer>Signer</a></em> (mandatory, not overridable)</p><div class=paragraph><p>Defines the key material for signing the JWT, as well as the <code>iss</code> claim.</p></div></li><li><p><strong><code>claims</code></strong>: <em>string</em> (optional, overridable)</p><div class=paragraph><p>A <a href=../../../docs/mechanisms/evaluation_objects/#_templating>template</a> specifying custom claims for the JWT. The template can use <a href=../../../docs/mechanisms/evaluation_objects/#_values><code>Values</code></a>, <a href=../../../docs/mechanisms/evaluation_objects/#_outputs><code>Outputs</code></a>, and <a href=../../../docs/mechanisms/evaluation_objects/#_subject><code>Subject</code></a> objects.</p></div></li><li><p><strong><code>values</code></strong>: <em>map of strings</em> (optional, overridable)</p><div class=paragraph><p>A key-value map accessible as <a href=../../../docs/mechanisms/evaluation_objects/#_values><code>Values</code></a> in the template engine for rendering claims. Values in this map can also be templated with access to <a href=../../../docs/mechanisms/evaluation_objects/#_subject><code>Subject</code></a> and <a href=../../../docs/mechanisms/evaluation_objects/#_outputs><code>Outputs</code></a>.</p></div></li><li><p><strong><code>ttl</code></strong>: <em><a href=../../../docs/configuration/types/#_duration>Duration</a></em> (optional, overridable)</p><div class=paragraph><p>Defines the JWT’s validity period. Defaults to 5 minutes. Heimdall automatically sets the <code>iat</code> and <code>nbf</code> claims to the current system time, and <code>exp</code> is calculated based on the <code>ttl</code> value.</p></div></li><li><p><strong><code>header</code></strong>: <em>object</em> (optional, not overridable)</p><div class=paragraph><p>Specifies the HTTP header <code>name</code> and optional <code>scheme</code> for passing the JWT. Defaults to <code>Authorization</code> with scheme <code>Bearer</code>. If defined, <code>name</code> is required, and if <code>scheme</code> is omitted, the JWT is set as a raw value.</p></div></li></ul></div><div class=paragraph><p>The generated JWT is cached until 5 seconds before expiration. The cache key is computed based on the finalizer’s configuration, the <a href=../../../docs/mechanisms/evaluation_objects/#_subject><code>Subject</code></a>, and the <a href=../../../docs/mechanisms/evaluation_objects/#_outputs><code>Outputs</code></a> attributes.</p></div><div class=exampleblock><div class=title>Example 4. JWT finalizer configuration</div><div class=content><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=yaml><span class=na>id</span><span class=pi>:</span> <span class=s>jwt_finalizer</span>
<span class=na>type</span><span class=pi>:</span> <span class=s>jwt</span>
<span class=na>config</span><span class=pi>:</span>
  <span class=na>ttl</span><span class=pi>:</span> <span class=s>5m</span>
  <span class=na>header</span><span class=pi>:</span>
    <span class=na>name</span><span class=pi>:</span> <span class=s>X-Token</span>
  <span class=na>claims</span><span class=pi>:</span> <span class=pi>|</span>
    <span class=s>{</span>
      <span class=s>{{ $user_name := .Subject.Attributes.identity.user_name -}}</span>
      <span class=s>&#34;email&#34;: {{ quote .Subject.Attributes.identity.email }},</span>
      <span class=s>&#34;email_verified&#34;: {{ .Subject.Attributes.identity.email_verified }},</span>
      <span class=s>&#34;name&#34;: {{ if $user_name }}{{ quote $user_name }}{{ else }}{{ quote $email }}{{ end }},</span>
      <span class=s>&#34;extra&#34;: {{ .Values | toJson }}</span>
    <span class=s>}</span></code></pre></div></div><div class=paragraph><p>In a rule that references the <code>jwt_finalizer</code>, additional claims can be dynamically inserted into the <code>"extra"</code> claim without redefining <code>claims</code>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=yaml><span class=pi>-</span> <span class=na>id</span><span class=pi>:</span> <span class=s>some_rule</span>
  <span class=c1># Other rule properties</span>
  <span class=na>execute</span><span class=pi>:</span>
  <span class=pi>-</span> <span class=c1># Other mechanisms</span>
  <span class=pi>-</span> <span class=na>finalizer</span><span class=pi>:</span> <span class=s>jwt_finalizer</span>
    <span class=na>config</span><span class=pi>:</span>
      <span class=na>values</span><span class=pi>:</span>
        <span class=na>foo</span><span class=pi>:</span> <span class=s>bar</span>
        <span class=na>user_id</span><span class=pi>:</span> <span class=s1>&#39;</span><span class=s>{{</span><span class=nv> </span><span class=s>.Subject.ID</span><span class=nv> </span><span class=s>}}&#39;</span>
  <span class=pi>-</span> <span class=c1># Other mechanisms</span></code></pre></div></div></div></div></div></div><div class=sect1><h2 id=_oauth2_client_credentials>OAuth2 Client Credentials</h2><div class=sectionbody><div class=paragraph><p>This finalizer drives the <a href=https://www.rfc-editor.org/rfc/rfc6749#section-4.4>OAuth2 Client Credentials Grant</a> flow to obtain a token, which should be used for communication with the upstream service. By default, as long as not otherwise configured (see the options below), the obtained token is made available to your upstream service in the HTTP <code>Authorization</code> header with <code>Bearer</code> scheme set. Unlike the other finalizers, it does not have access to any objects created by the rule execution pipeline.</p></div><div class=paragraph><p>To enable the usage of this finalizer, you have to set the <code>type</code> property to <code>oauth2_client_credentials</code>.</p></div><div class=paragraph><p>Configuration using the <code>config</code> property is mandatory. Following properties are available:</p></div><div class=ulist><ul><li><p><strong><code>token_url</code></strong>: <em>string</em> (mandatory, not overridable)</p><div class=paragraph><p>The token endpoint of the authorization server.</p></div></li><li><p><strong><code>client_id</code></strong>: <em>string</em> (mandatory, not overridable)</p><div class=paragraph><p>The client identifier for heimdall.</p></div></li><li><p><strong><code>client_secret</code></strong>: <em>string</em> (mandatory, not overridable)</p><div class=paragraph><p>The client secret for heimdall.</p></div></li><li><p><strong><code>auth_method</code></strong>: <em>string</em> (optional, not overridable)</p><div class=paragraph><p>The authentication method to be used according to <a href=https://www.rfc-editor.org/rfc/rfc6749#section-2.3.1>RFC 6749, Client Password</a>. Can be one of</p></div><div class=ulist><ul><li><p><code>basic_auth</code> (default if <code>auth_method</code> is not set): With that authentication method, the <code>"application/x-www-form-urlencoded"</code> encoded values of <code>client_id</code> and <code>client_secret</code> are sent to the authorization server via the <code>Authorization</code> header using the <code>Basic</code> scheme.</p></li><li><p><code>request_body</code>: With that authentication method the <code>client_id</code> and <code>client_secret</code> are sent in the request body together with the other parameters (e.g. <code>scopes</code>) defined by the flow.</p><div class="admonitionblock warning"><table><tbody><tr><td class=icon><i class="fa icon-warning" title=Warning></i></td><td class=content>Usage of <code>request_body</code> authentication method is not recommended and should be avoided.</td></tr></tbody></table></div></li></ul></div></li><li><p><strong><code>scopes</code></strong>: <em>string array</em> (optional, overridable)</p><div class=paragraph><p>The scopes required for the access token.</p></div></li><li><p><strong><code>cache_ttl</code></strong>: <em><a href=../../../docs/configuration/types/#_duration>Duration</a></em> (optional, overridable)</p><div class=paragraph><p>How long to cache the token received from the token endpoint. Defaults to the token expiration information from the token endpoint (the value of the <code>expires_in</code> field) if present. If the token expiration information is not present and <code>cache_ttl</code> is not configured, the received token is not cached. If the token expiration information is present in the response and <code>cache_ttl</code> is configured the shorter value is taken. If caching is enabled, the token is cached until 5 seconds before its expiration. To disable caching, set it to <code>0s</code>. The cache key calculation is based on the entire <code>oauth2_client_credentials</code> configuration without considering the <code>header</code> property.</p></div></li><li><p><strong><code>header</code></strong>: <em>object</em> (optional, overridable)</p><div class=paragraph><p>Defines the <code>name</code> and <code>scheme</code> to be used for the header. Defaults to <code>Authorization</code> with scheme <code>Bearer</code>. If defined, the <code>name</code> property must be set. If <code>scheme</code> is not defined, no scheme will be prepended to the resulting JWT.</p></div></li></ul></div><div class=exampleblock><div class=title>Example 5. OAuth2 Client Credentials finalizer configuration</div><div class=content><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=yaml><span class=na>id</span><span class=pi>:</span> <span class=s>get_token</span>
<span class=na>type</span><span class=pi>:</span> <span class=s>oauth2_client_credentials</span>
<span class=na>config</span><span class=pi>:</span>
  <span class=na>cache_ttl</span><span class=pi>:</span> <span class=s>5m</span>
  <span class=na>header</span><span class=pi>:</span>
    <span class=na>name</span><span class=pi>:</span> <span class=s>X-Token</span>
    <span class=na>scheme</span><span class=pi>:</span> <span class=s>MyScheme</span>
  <span class=na>token_url</span><span class=pi>:</span> <span class=s>https://my-oauth-provider.com/token</span>
  <span class=na>client_id</span><span class=pi>:</span> <span class=s>my_client</span>
  <span class=na>client_secret</span><span class=pi>:</span> <span class=s>VerySecret!</span>
  <span class=na>auth_method</span><span class=pi>:</span> <span class=s>basic_auth</span>
  <span class=na>scopes</span><span class=pi>:</span>
    <span class=pi>-</span> <span class=s>foo</span>
    <span class=pi>-</span> <span class=s>bar</span></code></pre></div></div></div></div></div></div></linkable-headline-area></div><p class="text-end fst-italic fs-7 pb-3">Last updated on <span class=fw-bold>Mar 3, 2025</span></p><hr><div class="d-flex justify-content-between py-3"><a href=../../../docs/mechanisms/contextualizers/ class="fs-6 fw-bold text-dark link-secondary link-underline-opacity-0"><svg width="16" height="16" fill="currentcolor" class="bi bi-chevron-left" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M11.354 1.646a.5.5.0 010 .708L5.707 8l5.647 5.646a.5.5.0 01-.708.708l-6-6a.5.5.0 010-.708l6-6a.5.5.0 01.708.0z"/></svg>
Contextualizers
</a><a class="ms-auto fs-6 fw-bold text-dark link-secondary link-underline-opacity-0" href=../../../docs/mechanisms/error_handlers/>Error Handlers<svg width="16" height="16" fill="currentcolor" class="bi bi-chevron-right" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4.646 1.646a.5.5.0 01.708.0l6 6a.5.5.0 010 .708l-6 6a.5.5.0 01-.708-.708L10.293 8 4.646 2.354a.5.5.0 010-.708z"/></svg></a></div></div></main></div><footer class="footer py-4 py-md-5 px-4 px-md-3 mt-3"><div class=container><div class=row><div class="col-lg-3 mb-3"><p class=fs-5>Heimdall</p><ul class="list-unstyled small text-muted"><li class=mb-2>2022-2024 © Heimdall Project Authors. All rights reserved.</li><li class=mb-2><a href=https://github.com/dadrus/heimdall/blob/master/LICENSE>Apache 2.0 licensed</a></li></ul></div><div class="col-6 col-lg-2 offset-lg-1 mb-3"><h5>Links</h5><ul class=list-unstyled><li class=mb-2><a href=../../../>Home</a></li><li class=mb-2><a href=../../../docs/getting_started/discover_heimdall>Docs</a></li><li class=mb-2><a href=../../../guides/>Guides</a></li><li class=mb-2><a href=../../../openapi/>API</a></li></ul></div><div class="col-6 col-lg-2 mb-2"><h5>Guides</h5><ul class=list-unstyled><li class=mb-2><a href=../../../guides/proxies/>API Gateways & Proxies</a></li><li class=mb-2><a href=../../../guides/authz/>Authorization Services</a></li><li class=mb-2><a href=../../../guides/authn/>Authentication Protocols & Services</a></li></ul></div><div class="col-6 col-lg-2 mb-2"><h5>Community</h5><ul class=list-unstyled><li class=mb-2><a href=https://github.com/dadrus/heimdall>Github</a></li><li class=mb-2><a href=https://discord.gg/qQgg8xKuyb>Discord</a></li></ul></div></div></div></footer><script src=../../../js/main.js defer></script></body></html>