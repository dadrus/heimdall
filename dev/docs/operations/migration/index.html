<!doctype html><html lang=en><head><title>Upgrade & Migration</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="An open source Identity Aware Proxy and an Access Control Decision service for cloud native applications"><meta name=dc.relation content="https://dadrus.github.io/"><meta name=theme-color content="#1A94D2"><link rel=stylesheet href=../../../css/styles.min.css media=screen><link rel='shortcut icon' type=image/x-icon href=../../../favicon.ico></head><body><header class="navbar navbar-expand-md navbar-dark bg-dark sticky-top"><nav class="container-xxl flex-wrap flex-lg-nowrap px-0" aria-label="Main navigation"><button class="btn btn-outline-dark d-lg-none navbar-toggler border-0 shadow-none ps-3" type=button data-bs-toggle=offcanvas data-bs-target=#docsMenuContent aria-controls=docsMenuContent aria-expanded=false aria-label="Open docs menu">
<svg width="36" height="36" fill="currentColor" class="bi bi-list" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M2.5 12a.5.5.0 01.5-.5h10a.5.5.0 010 1H3a.5.5.0 01-.5-.5m0-4a.5.5.0 01.5-.5h10a.5.5.0 010 1H3A.5.5.0 012.5 8m0-4a.5.5.0 01.5-.5h10a.5.5.0 010 1H3A.5.5.0 012.5 4"/></svg></button><nav class="offcanvas offcanvas-start d-md-none text-bg-light" tabindex=-1 id=docsMenuContent aria-labelledby=docsMenuContentLabel><div class=offcanvas-header><h5 class=offcanvas-title id=docsMenuContentLabel>Browse docs</h5><button type=button class=btn-close data-bs-dismiss=offcanvas aria-label="Close docs menu"></button></div><div class="offcanvas-body docs-sidebar"><div class=docs-search-button><button type=button class="btn btn-outline-secondary mb-3 d-none d-md-block w-100 text-start" data-bs-toggle=modal data-bs-target=#docSearch aria-controls=docSearch aria-expanded=false aria-label="Open search">
<svg width="20" height="20" fill="currentColor" class="bi bi-search me-2" viewBox="0 0 20 20"><path d="M11.742 10.344a6.5 6.5.0 10-1.397 1.398h-.001q.044.06.098.115l3.85 3.85a1 1 0 001.415-1.414l-3.85-3.85a1 1 0 00-.115-.1zM12 6.5a5.5 5.5.0 11-11 0 5.5 5.5.0 0111 0"/></svg>
<span>Quick search...</span></button></div><nav id=SideBarToc><ul><li><span>Getting Started</span><ul><li><a href=../../../docs/getting_started/discover_heimdall/>Discover heimdall</a></li><li><a href=../../../docs/getting_started/installation/>Install heimdall</a></li><li><a href=../../../docs/getting_started/protect_an_app/>Protect an Application</a></li></ul></li><li><span>Concepts</span><ul><li><a href=../../../docs/concepts/pipelines/>Pipelines</a></li><li><a href=../../../docs/concepts/mechanisms/>Mechanisms</a></li><li><a href=../../../docs/concepts/rules/>Rules</a></li><li><a href=../../../docs/concepts/provider/>Rule Provider</a></li><li><a href=../../../docs/concepts/operating_modes/>Operating Modes</a></li></ul></li><li><span>Operations</span><ul><li><a href=../../../docs/operations/configuration/>Configuration</a></li><li><a href=../../../docs/operations/cli/>CLI</a></li><li><a href=../../../docs/operations/observability/>Observability</a></li><li><a href=../../../docs/operations/cache/>Caching</a></li><li><a href=../../../docs/operations/security/>Security</a></li><li><a class=active href=../../../docs/operations/migration/>Upgrade & Migration</a></li></ul></li><li><span>Services</span><ul><li><a href=../../../docs/services/main/>Main Service</a></li><li><a href=../../../docs/services/management/>Management Service</a></li></ul></li><li><span>Mechanisms</span><ul><li><a href=../../../docs/mechanisms/catalogue/>Catalogue</a></li><li><a href=../../../docs/mechanisms/evaluation_objects/>Objects, Templating & Co</a></li><li><a href=../../../docs/mechanisms/authenticators/>Authenticators</a></li><li><a href=../../../docs/mechanisms/authorizers/>Authorizers</a></li><li><a href=../../../docs/mechanisms/contextualizers/>Contextualizers</a></li><li><a href=../../../docs/mechanisms/finalizers/>Finalizers</a></li><li><a href=../../../docs/mechanisms/error_handlers/>Error Handlers</a></li></ul></li><li><span>Rules</span><ul><li><a href=../../../docs/rules/regular_rule/>Regular Rule</a></li><li><a href=../../../docs/rules/default_rule/>Default Rule</a></li><li><a href=../../../docs/rules/rule_sets/>Rule Sets</a></li><li><a href=../../../docs/rules/providers/>Rule Providers</a></li></ul></li><li><span>Configuration Reference</span><ul><li><a href=../../../docs/configuration/types/>Type Definitions</a></li><li><a href=../../../docs/configuration/reference/>Reference</a></li></ul></li></ul></nav></div></nav><div class="d-flex align-items-center px-4"><a class="navbar-brand navbar-brand-highlight text-white me-0" href=../../../ style=font-weight:500;font-size:1.5rem>Heimdall</a><ul class="navbar-nav d-none d-md-flex ms-3"><li class=nav-item><a class='nav-link text-white' href=../../../docs/getting_started/discover_heimdall>Docs</a></li><li class=nav-item><a class='nav-link text-white' href=../../../guides/>Guides</a></li><li class=nav-item><a class='nav-link text-white' href=../../../openapi/>API</a></li></ul></div><div class=d-flex><button type=button class="btn btn-outline-dark navbar-toggler border-0 shadow-none" data-bs-toggle=modal data-bs-target=#docSearch aria-controls=docSearch aria-expanded=false aria-label="Open search">
<span class="bi bi-search"></span>
</button>
<button class="btn btn-outline-dark navbar-toggler border-0 shadow-none pe-3" type=button data-bs-toggle=offcanvas data-bs-target=#mainMenuContent aria-controls=mainMenuContent aria-expanded=false aria-label="Open main menu">
<svg width="24" height="24" fill="currentColor" class="bi bi-three-dots" viewBox="0 0 16 16"><path d="M3 9.5a1.5 1.5.0 110-3 1.5 1.5.0 010 3m5 0a1.5 1.5.0 110-3 1.5 1.5.0 010 3m5 0a1.5 1.5.0 110-3 1.5 1.5.0 010 3"/></svg></button><div class="offcanvas offcanvas-end text-bg-dark" tabindex=-1 id=mainMenuContent aria-labelledby=mainMenuContentLabel><div class=offcanvas-header><h5 class="offcanvas-title text-white" id=mainMenuContentLabel>Heimdall</h5><button type=button class="btn-close btn-close-white" data-bs-dismiss=offcanvas aria-label="Close main menu"></button></div><div class=offcanvas-body><ul class="navbar-nav flex-column d-md-none d-lg-none d-xl-none"><li class=nav-item><a class='nav-link text-white' href=../../../docs/getting_started/discover_heimdall>Docs</a></li><li class=nav-item><a class='nav-link text-white' href=../../../guides/>Guides</a></li><li class=nav-item><a class='nav-link text-white' href=../../../openapi/>API</a></li></ul><hr class="text-white-50 d-md-none"><ul class="navbar-nav flex-column ms-auto"><doc-version-select class="nav-item dropdown" version-file=/heimdall/data.json current-version=dev current-page=/docs/operations/migration/><button class="btn btn-dark dropdown-toggle me-4" data-bs-toggle=dropdown aria-expanded=false>
dev</button></doc-version-select></ul><ul class="navbar-nav flex-column"><li class="nav-item mb-1 pe-4"><a class="nav-link text-white" style=align-self:center href=https://github.com/dadrus/heimdall><svg role="img" width="20" height="20" fill="currentColor" class="bi bi-github text-white" viewBox="0 0 16 16"><title>GitHub</title><path d="M8 0C3.58.0.0 3.58.0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38.0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95.0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12.0.0.67-.21 2.2.82.64-.18 1.32-.27 2-.27s1.36.09 2 .27c1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15.0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48.0 1.07-.01 1.93-.01 2.2.0.21.15.46.55.38A8.012 8.012.0 0016 8c0-4.42-3.58-8-8-8z"/></svg>
<small class="ms-2 d-md-none">GitHub</small></a></li></ul></div></div></div></nav></header><div class=modal id=docSearch tabindex=-1 aria-labelledby=docSearchLabel aria-hidden=true><doc-search class="col-auto me-auto mw-75" index-file=/heimdall/dev/index.json path-prefix=/heimdall/dev><div class="modal-dialog modal-lg modal-dialog-scrollable"><div class=modal-content><div class="modal-header p-2"><div class=input-group><div class="input-group-text bg-body border-0 fs-4"><svg width="16" height="16" fill="currentColor" class="bi bi-search text-secondary my-0" viewBox="0 0 16 16"><path d="M11.742 10.344a6.5 6.5.0 10-1.397 1.398h-.001q.044.06.098.115l3.85 3.85a1 1 0 001.415-1.414l-3.85-3.85a1 1 0 00-.115-.1zM12 6.5a5.5 5.5.0 11-11 0 5.5 5.5.0 0111 0"/></svg></div><input id=search-input class="form-control search-bar border-0" type=search placeholder="Search documentation " aria-label="Search docs..." autocomplete=off autofocus><div class="input-group-text bg-body border-0"><a class="btn input-group-text text-muted border p-1 bg-light-subtle fs-7 fw-bold font-monospace" data-bs-dismiss=modal aria-label=Close>ESC</a></div></div></div><div class=modal-body><div class=search-results><p class="text-center mt-5">No recent searches</p></div></div><div class=modal-footer></div></div></div></doc-search></div><div class="container-xxl docs-layout px-4"><aside class="d-none pe-3 docs-sidebar"><div class=docs-search-button><button type=button class="btn btn-outline-secondary mb-3 d-none d-md-block w-100 text-start" data-bs-toggle=modal data-bs-target=#docSearch aria-controls=docSearch aria-expanded=false aria-label="Open search">
<svg width="20" height="20" fill="currentColor" class="bi bi-search me-2" viewBox="0 0 20 20"><path d="M11.742 10.344a6.5 6.5.0 10-1.397 1.398h-.001q.044.06.098.115l3.85 3.85a1 1 0 001.415-1.414l-3.85-3.85a1 1 0 00-.115-.1zM12 6.5a5.5 5.5.0 11-11 0 5.5 5.5.0 0111 0"/></svg>
<span>Quick search...</span></button></div><nav id=SideBarToc><ul><li><span>Getting Started</span><ul><li><a href=../../../docs/getting_started/discover_heimdall/>Discover heimdall</a></li><li><a href=../../../docs/getting_started/installation/>Install heimdall</a></li><li><a href=../../../docs/getting_started/protect_an_app/>Protect an Application</a></li></ul></li><li><span>Concepts</span><ul><li><a href=../../../docs/concepts/pipelines/>Pipelines</a></li><li><a href=../../../docs/concepts/mechanisms/>Mechanisms</a></li><li><a href=../../../docs/concepts/rules/>Rules</a></li><li><a href=../../../docs/concepts/provider/>Rule Provider</a></li><li><a href=../../../docs/concepts/operating_modes/>Operating Modes</a></li></ul></li><li><span>Operations</span><ul><li><a href=../../../docs/operations/configuration/>Configuration</a></li><li><a href=../../../docs/operations/cli/>CLI</a></li><li><a href=../../../docs/operations/observability/>Observability</a></li><li><a href=../../../docs/operations/cache/>Caching</a></li><li><a href=../../../docs/operations/security/>Security</a></li><li><a class=active href=../../../docs/operations/migration/>Upgrade & Migration</a></li></ul></li><li><span>Services</span><ul><li><a href=../../../docs/services/main/>Main Service</a></li><li><a href=../../../docs/services/management/>Management Service</a></li></ul></li><li><span>Mechanisms</span><ul><li><a href=../../../docs/mechanisms/catalogue/>Catalogue</a></li><li><a href=../../../docs/mechanisms/evaluation_objects/>Objects, Templating & Co</a></li><li><a href=../../../docs/mechanisms/authenticators/>Authenticators</a></li><li><a href=../../../docs/mechanisms/authorizers/>Authorizers</a></li><li><a href=../../../docs/mechanisms/contextualizers/>Contextualizers</a></li><li><a href=../../../docs/mechanisms/finalizers/>Finalizers</a></li><li><a href=../../../docs/mechanisms/error_handlers/>Error Handlers</a></li></ul></li><li><span>Rules</span><ul><li><a href=../../../docs/rules/regular_rule/>Regular Rule</a></li><li><a href=../../../docs/rules/default_rule/>Default Rule</a></li><li><a href=../../../docs/rules/rule_sets/>Rule Sets</a></li><li><a href=../../../docs/rules/providers/>Rule Providers</a></li></ul></li><li><span>Configuration Reference</span><ul><li><a href=../../../docs/configuration/types/>Type Definitions</a></li><li><a href=../../../docs/configuration/reference/>Reference</a></li></ul></li></ul></nav></aside><main class=docs-main><div class="d-md-none docs-location bg-body"><nav style="--bs-breadcrumb-divider:'>'" aria-label=breadcrumb><ol class="breadcrumb mb-0"><li class="breadcrumb-item fw-bold">Operations</li><li class="breadcrumb-item active" aria-current=page>Upgrade & Migration</li></ol></nav></div><div class="docs-intro pt-3 pe-3"><h1>Upgrade & Migration</h1><p>Describes the upgrade and migration process for heimdall releases introducing breaking changes.</p></div><aside class="text-muted docs-toc"><strong class="d-md-block h6 pb-2 my-2 ms-2 border-bottom d-none d-md-none d-lg-block">On this page</strong><div id=page-content-toc class="mt-1 mb-3 text-muted d-none d-md-none d-lg-block docs-toc-content"><nav id=TableOfContents><ul><li><a href=#_upgrade_of_heimdall_in_kubernetes>Upgrade of heimdall in Kubernetes</a><ul><li><a href=#_multiple_heimdall_deployments_in_a_cluster>Multiple heimdall deployments in a cluster</a></li><li><a href=#_single_heimdall_deployment_in_a_cluster>Single heimdall deployment in a cluster</a></li><li><a href=#_ensuring_all_rulesets_are_stored_in_etcd_using_the_new_schema>Ensuring all RuleSets are stored in etcd using the new schema</a></li><li><a href=#_migration_process_for_releases_prior_to_v0_18_0>Migration process for releases prior to v0.18.0</a></li></ul></li><li><a href=#_upgrade_of_heimdall_configured_to_use_ruleset_files>Upgrade of heimdall configured to use RuleSet files</a></li></ul></nav></div><button class="btn btn-outline-secondary text-decoration-none d-lg-none collapsed" type=button data-bs-toggle=collapse data-bs-target=#page-content-toc-collapsible aria-expanded=false aria-controls=page-content-toc-collapsible>
On this page
<svg width="16" height="16" fill="currentColor" class="bi bi-chevron-expand" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M3.646 9.146a.5.5.0 01.708.0L8 12.793l3.646-3.647a.5.5.0 01.708.708l-4 4a.5.5.0 01-.708.0l-4-4a.5.5.0 010-.708m0-2.292a.5.5.0 00.708.0L8 3.207l3.646 3.647a.5.5.0 00.708-.708l-4-4a.5.5.0 00-.708.0l-4 4a.5.5.0 000 .708"/></svg></button><div id=page-content-toc-collapsible class="mt-1 mb-3 text-muted d-lg-none collapse docs-toc-content"><div class="card card-body"><nav id=TableOfContents><ul><li><a href=#_upgrade_of_heimdall_in_kubernetes>Upgrade of heimdall in Kubernetes</a><ul><li><a href=#_multiple_heimdall_deployments_in_a_cluster>Multiple heimdall deployments in a cluster</a></li><li><a href=#_single_heimdall_deployment_in_a_cluster>Single heimdall deployment in a cluster</a></li><li><a href=#_ensuring_all_rulesets_are_stored_in_etcd_using_the_new_schema>Ensuring all RuleSets are stored in etcd using the new schema</a></li><li><a href=#_migration_process_for_releases_prior_to_v0_18_0>Migration process for releases prior to v0.18.0</a></li></ul></li><li><a href=#_upgrade_of_heimdall_configured_to_use_ruleset_files>Upgrade of heimdall configured to use RuleSet files</a></li></ul></nav></div></div></aside><div class="docs-content pe-3"><div data-bs-spy=scroll data-bs-target=#page-content-toc class=mt-3><linkable-headline-area><div class=paragraph><p>Over time, heimdall’s configuration and <code>RuleSet</code> schemas evolve to introduce new capabilities or simplify existing structures. Whenever breaking changes are introduced, they are both announced in the corresponding release notes and described in detail.</p></div><div class=paragraph><p>If a breaking change affects the configuration schema, migration must be performed manually before starting the new heimdall version. The required steps are outlined in the pull requests introducing the change, which are also linked in the release notes.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content>If migration is skipped, Heimdall will fail to start and display errors indicating unknown or invalid configuration properties.</td></tr></tbody></table></div><div class=paragraph><p>If breaking changes affect the <code>RuleSet</code> schema, versions prior to v0.18.0 required the same manual migration procedure. Depending on the setup and number of rules, this could become cumbersome — particularly for Kubernetes deployments (See also <a href=#_migration_process_for_releases_prior_to_v0_18_0>Migration process for releases prior to v0.18.0</a> for details).</p></div><div class=paragraph><p>Starting with v0.18.0, this issue is addressed through:</p></div><div class=ulist><ul><li><p>A new <code>convert</code> CLI command that allows conversion of existing <code>RuleSet</code> definitions.</p></li><li><p>A conversion controller for Kubernetes, registered with the API server through the <code>RuleSet</code> CRD.</p></li></ul></div><div class=paragraph><p>The following sections describe both the legacy and the new automated upgrade and migration procedures for heimdall releases introducing breaking changes to existing <code>RuleSets</code>, for installations inside and outside Kubernetes.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content>The following upgrade and migration steps are described in an imperative way for the sake of clarity and to remain product-neutral. However, all steps can be easily adapted to declarative, GitOps-based workflows using tools such as Flux, ArgoCD, or similar.</td></tr></tbody></table></div><div class=sect1><h2 id=_upgrade_of_heimdall_in_kubernetes>Upgrade of heimdall in Kubernetes</h2><div class=sectionbody><div class=paragraph><p>The following procedures assume you have enabled the <a href=../../../docs/rules/providers/#_kubernetes><code>kubernetes</code></a> provider in your configuration and are using the CRD shipped with Heimdall. If you’re running heimdall in Kubernetes without relying on the <code>kubernetes</code> provider, head over to the <a href=#_upgrade_of_heimdall_configured_to_use_ruleset_files>Upgrade of heimdall configured to use RuleSet files</a> section.</p></div><div class="admonitionblock caution"><table><tbody><tr><td class=icon><i class="fa icon-caution" title=Caution></i></td><td class=content>The Kubernetes API server requires the communication to any webhooks over TLS. Therefore, the <code>kubernetes</code> provider must have the TLS related settings configured.</td></tr></tbody></table></div><div class=sect2><h3 id=_multiple_heimdall_deployments_in_a_cluster>Multiple heimdall deployments in a cluster</h3><div class=paragraph><p>If you have multiple heimdall deployments in your cluster, each responsible for a different set of <code>RuleSet</code> resources:</p></div><div class="olist arabic"><ol class=arabic><li><p>Install a new heimdall deployment in a new namespace, which will act as a conversion controller for the already deployed <code>RuleSet</code> resources in the cluster, and configure it to listen for some random <code>auth_class</code>. This way, this new instance will not load any <code>RuleSets</code>, only convert them to the required schema version:</p><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content>If you already did an upgrade by following these steps in the past, upgrade the existing conversion controller, instead of installing a new one. The procedure is the same in both cases.</td></tr></tbody></table></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=bash><span class=nv>$ </span>helm upgrade <span class=nt>--install</span> ruleset-upgrade &lt;chart-reference&gt;  <span class=se>\</span>
    <span class=nt>--set</span> crds.updateEnabled<span class=o>=</span><span class=nb>true</span> <span class=se>\</span>
    <span class=nt>--set</span> crds.storageVersion<span class=o>=</span>&lt;old-crd-schema&gt; <span class=se>\</span>
    <span class=nt>-n</span> &lt;namespace-controller-heimdall-should-be-installed-into&gt; <span class=se>\</span>
    <span class=nt>-f</span> &lt;path/to/your/values.yaml&gt; <span class=se>\</span>
    <span class=nt>-f</span> &lt;path/to/your/heimdall/config.yaml&gt; <span class=se>\</span>
    <span class=nt>--take-ownership</span></code></pre></div></div><div class=paragraph><p>The above snippet sets the release name for this new installation to <code>ruleset-upgrade</code>. You can use configuration from any of the existing heimdall deployments. The most important settings are:</p></div><div class=ulist><ul><li><p><code>crds.updateEnabled=true</code>, which instructs the Helm chart to render a new <code>RuleSet</code> CRD that includes both the new and the old <code>RuleSet</code> schema versions, and</p></li><li><p><code>crds.storageVersion=&lt;old-crd-schema></code>, which configures the old CRD schema (e.g., <code>v1alpha1</code>) — currently used by the heimdall deployments in the cluster — to be the storage schema. This ensures that the existing heimdall pods can still use the old schema version without requiring conversion.</p></li><li><p><code>--take-ownership</code>, which ensures Helm takes control of the CRD, which is necessary as it was not managed by Helm in the past.</p></li></ul></div></li><li><p>Upgrade each of your heimdall deployments with</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=bash><span class=nv>$ </span>helm upgrade <span class=nt>--install</span> &lt;your-release-name&gt; &lt;chart-reference&gt;  <span class=se>\</span>
    <span class=nt>-n</span> &lt;namespace-heimdall-is-installed-into&gt; <span class=se>\</span>
    <span class=nt>-f</span> &lt;path/to/your/values.yaml&gt; <span class=se>\</span>
    <span class=nt>-f</span> &lt;path/to/your/heimdall/config.yaml&gt;</code></pre></div></div><div class=paragraph><p>Once the new heimdall pods come up, they will start listing and watching for the new <code>RuleSet</code> schema (e.g., <code>v1beta1</code>). Thanks to the controller installed in step 1, the API server will ask it for the conversion and provide the converted versions to the new instances.</p></div></li><li><p>Once the upgrade is complete and no old heimdall pods are running, execute <code>helm upgrade</code> again for the deployment created to act as the conversion controller, but this time without specifying <code>crds.storageVersion</code>. This will reconfigure the CRD to use the new <code>RuleSet</code> schema version (e.g., <code>v1beta1</code>) as the new storage version:</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=bash><span class=nv>$ </span>helm upgrade <span class=nt>--install</span> ruleset-upgrade &lt;chart-reference&gt;  <span class=se>\</span>
    <span class=nt>--set</span> crds.updateEnabled<span class=o>=</span><span class=nb>true</span> <span class=se>\</span>
    <span class=nt>-n</span> &lt;namespace-controller-heimdall-is-installed-into&gt; <span class=se>\</span>
    <span class=nt>-f</span> &lt;path/to/your/values.yaml&gt; <span class=se>\</span>
    <span class=nt>-f</span> &lt;path/to/your/heimdall/config.yaml&gt;</code></pre></div></div><div class=paragraph><p>With the CRD reconfigured, any update to existing <code>RuleSet</code> resources or any new <code>RuleSet</code> resource added to the cluster will be converted and stored using the new schema version in etcd.</p></div></li></ol></div></div><div class=sect2><h3 id=_single_heimdall_deployment_in_a_cluster>Single heimdall deployment in a cluster</h3><div class=paragraph><p>If you have a single heimdall deployment in your cluster:</p></div><div class="olist arabic"><ol class=arabic><li><p>Upgrade it using the following settings:</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=bash><span class=nv>$ </span>helm upgrade <span class=nt>--install</span> &lt;your-release-name&gt; &lt;chart-reference&gt;  <span class=se>\</span>
    <span class=nt>--set</span> crds.updateEnabled<span class=o>=</span><span class=nb>true</span> <span class=se>\</span>
    <span class=nt>--set</span> crds.storageVersion<span class=o>=</span>&lt;old-crd-schema&gt; <span class=se>\</span>
    <span class=nt>-n</span> &lt;namespace-heimdall-is-installed-into&gt; <span class=se>\</span>
    <span class=nt>-f</span> &lt;path/to/your/values.yaml&gt; <span class=se>\</span>
    <span class=nt>-f</span> &lt;path/to/your/heimdall/config.yaml&gt; <span class=se>\</span>
    <span class=nt>--take-ownership</span></code></pre></div></div><div class=paragraph><p>The most important settings are:</p></div><div class=ulist><ul><li><p><code>crds.updateEnabled=true</code>, which instructs the Helm chart to render a new <code>RuleSet</code> CRD that includes both the new and old <code>RuleSet</code> schema versions, and</p></li><li><p><code>crds.storageVersion=&lt;old-crd-schema></code>, which configures the old CRD schema (e.g., <code>v1alpha1</code>) — currently used by the heimdall deployment in the cluster — to be the storage schema. This ensures that existing pods can still use the old schema version without conversion, even if the deployment scales up.</p></li><li><p><code>--take-ownership</code>, which ensures Helm takes control of the CRD, which is necessary as it was not managed by Helm in the past.</p></li></ul></div></li><li><p>Once the upgrade is complete and no old heimdall pods are running, execute <code>helm upgrade</code> again without specifying the <code>crds.storageVersion</code>. This reconfigures the CRD to use the new <code>RuleSet</code> schema version (e.g., <code>v1beta1</code>) as the new storage version:</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=bash><span class=nv>$ </span>helm upgrade <span class=nt>--install</span> &lt;your-release-name&gt; &lt;chart-reference&gt;  <span class=se>\</span>
    <span class=nt>--set</span> crds.updateEnabled<span class=o>=</span><span class=nb>true</span> <span class=se>\</span>
    <span class=nt>-n</span> &lt;namespace-heimdall-is-installed-into&gt; <span class=se>\</span>
    <span class=nt>-f</span> &lt;path/to/your/values.yaml&gt; <span class=se>\</span>
    <span class=nt>-f</span> &lt;path/to/your/heimdall/config.yaml&gt;</code></pre></div></div><div class=paragraph><p>With the CRD reconfigured, any update to existing <code>RuleSet</code> resources, or any new ones added, will now be stored in etcd using the new schema version.</p></div></li></ol></div></div><div class=sect2><h3 id=_ensuring_all_rulesets_are_stored_in_etcd_using_the_new_schema>Ensuring all RuleSets are stored in etcd using the new schema</h3><div class=paragraph><p>This step ensures that all <code>RuleSets</code> can still be converted and loaded by future heimdall versions, even if intermediate schema versions are deprecated.</p></div><div class=paragraph><p>The API server only uses the new storage version for resources in etcd on <strong>write</strong> operations — meaning when <code>RuleSets</code> are updated or new ones are added. Therefore, after upgrading to the newer heimdall version, it is required:</p></div><div class=ulist><ul><li><p>to convert the <code>RuleSets</code> already stored in etcd to use the new schema version, and</p></li><li><p>to store the converted <code>RuleSets</code> alongside the particular services to ensure frictionless upgrades in the future — especially when conversion between older versions (e.g., <code>v1alpha4</code> → <code>v1beta1</code>) is no longer supported.</p></li></ul></div><div class=paragraph><p>The latter can be achieved by reading the existing <code>RuleSets</code> from the cluster — the conversion happens automatically thanks to the conversion webhook.</p></div><div class=paragraph><p>To achieve the former, you can do the following:</p></div><div class="olist arabic"><ol class=arabic><li><p>Export all existing RuleSets with:</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=bash><span class=nv>$ </span>kubectl get <span class=nt>-A</span> rulesets.heimdall.dadrus.github.com <span class=nt>-o</span> yaml <span class=o>&gt;</span> allrulesets.yaml</code></pre></div></div><div class=paragraph><p>This returns a <code>List</code> resource containing all <code>RuleSets</code> across all namespaces. The API server will provide them in the converted version.</p></div></li><li><p>Re-apply them with:</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=bash><span class=nv>$ </span>kubectl apply <span class=nt>-f</span> allrulesets.yaml</code></pre></div></div><div class=paragraph><p>Since this is a write operation, the <code>RuleSets</code> will now be stored in the new schema format.</p></div></li></ol></div></div><div class=sect2><h3 id=_migration_process_for_releases_prior_to_v0_18_0>Migration process for releases prior to v0.18.0</h3><div class=paragraph><p>For heimdall releases older than v0.18.0, conversion between different <code>RuleSet</code> schema versions must be performed manually. The following procedure describes how to migrate to a newer version.</p></div><div class="olist arabic"><ol class=arabic><li><p>Export all existing <code>RuleSets</code> from the cluster</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=bash><span class=nv>$ </span>kubectl get <span class=nt>-A</span> rulesets.heimdall.dadrus.github.com <span class=nt>-o</span> yaml <span class=o>&gt;</span> allrulesets.yaml</code></pre></div></div><div class=paragraph><p>This returns a <code>List</code> resource containing all rule sets across all namespaces.</p></div></li><li><p>Migrate each <code>RuleSet</code> manually as described in each PR linked to the release notes.</p></li><li><p>Convert the migrated rule sets into file-based <code>RuleSets</code> and store them in a separate directory. The following script can help with that:</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=bash><span class=c>#!/usr/bin/env bash</span>

<span class=c># Converts all RuleSets from a Kubernetes export (a List resource) into individual file-based RuleSets.</span>
<span class=c>#</span>
<span class=c># The output files will be written to the specified directory, one file per RuleSet.</span>
<span class=c>#</span>
<span class=c># Usage:</span>
<span class=c>#   ./convert-k8s-rulesets.sh --ruleset-list &lt;path-to-exported-rulesets.yaml&gt; --out-dir &lt;output-directory&gt;</span>
<span class=c>#</span>
<span class=c># Example:</span>
<span class=c>#   ./convert-k8s-rulesets.sh --ruleset-list allrulesets.yaml --out-dir ./converted-rulesets</span>
<span class=c>#</span>
<span class=c># Options:</span>
<span class=c>#   --ruleset-list   Path to the YAML file containing the exported RuleSets (required)</span>
<span class=c>#   --out-dir        Directory to write the converted RuleSets to (required)</span>
<span class=c>#   -h, --help       Show this help message and exit</span>
<span class=c>#</span>
<span class=c># Requirements:</span>
<span class=c>#   - yq (https://github.com/kislyuk/yq) must be available in PATH. If not installed, you can install it with e.g. sudo apt install yq on Debian based Linux distributions.</span>
<span class=c>#</span>

<span class=nb>set</span> <span class=nt>-euo</span> pipefail

<span class=c># Print help text (only the leading comment block after the optional shebang)</span>
usage<span class=o>()</span> <span class=o>{</span>
  <span class=nb>awk</span> <span class=s1>&#39;
    # skip shebang on line 1 if present
    NR==1 { if ($0 ~ /^#!/) { next } }
    # while lines start with &#34;#&#34;, strip the &#34;# &#34; (or &#34;#&#34;) and print
    /^#/ {
      sub(/^#\s?/, &#34;&#34;)
      print
      started=1
      next
    }
    # once we have printed at least one comment block line, stop at first non-# line
    started==1 { exit }
  &#39;</span> <span class=s2>&#34;</span><span class=nv>$0</span><span class=s2>&#34;</span>
  <span class=nb>exit </span>0
<span class=o>}</span>

<span class=c># Default values</span>
<span class=nv>RULESET_LIST</span><span class=o>=</span><span class=s2>&#34;&#34;</span>
<span class=nv>OUT_DIR</span><span class=o>=</span><span class=s2>&#34;&#34;</span>

<span class=c># Parse arguments</span>
<span class=k>while</span> <span class=o>[[</span> <span class=nv>$# </span><span class=nt>-gt</span> 0 <span class=o>]]</span><span class=p>;</span> <span class=k>do
  case</span> <span class=s2>&#34;</span><span class=nv>$1</span><span class=s2>&#34;</span> <span class=k>in</span>
    <span class=nt>--ruleset-list</span><span class=p>)</span>
      <span class=nv>RULESET_LIST</span><span class=o>=</span><span class=s2>&#34;</span><span class=nv>$2</span><span class=s2>&#34;</span>
      <span class=nb>shift </span>2
      <span class=p>;;</span>
    <span class=nt>--out-dir</span><span class=p>)</span>
      <span class=nv>OUT_DIR</span><span class=o>=</span><span class=s2>&#34;</span><span class=nv>$2</span><span class=s2>&#34;</span>
      <span class=nb>shift </span>2
      <span class=p>;;</span>
    <span class=nt>-h</span><span class=p>|</span><span class=nt>--help</span><span class=p>)</span>
      usage
      <span class=p>;;</span>
    <span class=k>*</span><span class=p>)</span>
      <span class=nb>echo</span> <span class=s2>&#34;Unknown argument: </span><span class=nv>$1</span><span class=s2>&#34;</span>
      <span class=nb>echo</span> <span class=s2>&#34;Use --help for usage information.&#34;</span>
      <span class=nb>exit </span>1
      <span class=p>;;</span>
  <span class=k>esac</span>
<span class=k>done</span>

<span class=c># Validate required arguments</span>
<span class=k>if</span> <span class=o>[[</span> <span class=nt>-z</span> <span class=s2>&#34;</span><span class=k>${</span><span class=nv>RULESET_LIST</span><span class=k>}</span><span class=s2>&#34;</span> <span class=o>||</span> <span class=nt>-z</span> <span class=s2>&#34;</span><span class=k>${</span><span class=nv>OUT_DIR</span><span class=k>}</span><span class=s2>&#34;</span> <span class=o>]]</span><span class=p>;</span> <span class=k>then
  </span><span class=nb>echo</span> <span class=s2>&#34;Error: both --ruleset-list and --out-dir must be provided.&#34;</span>
  <span class=nb>echo</span> <span class=s2>&#34;Use --help for usage information.&#34;</span>
  <span class=nb>exit </span>1
<span class=k>fi

if</span> <span class=o>[[</span> <span class=o>!</span> <span class=nt>-f</span> <span class=s2>&#34;</span><span class=k>${</span><span class=nv>RULESET_LIST</span><span class=k>}</span><span class=s2>&#34;</span> <span class=o>]]</span><span class=p>;</span> <span class=k>then
  </span><span class=nb>echo</span> <span class=s2>&#34;Error: file &#39;</span><span class=k>${</span><span class=nv>RULESET_LIST</span><span class=k>}</span><span class=s2>&#39; not found.&#34;</span>
  <span class=nb>exit </span>1
<span class=k>fi

</span><span class=nb>mkdir</span> <span class=nt>-p</span> <span class=s2>&#34;</span><span class=k>${</span><span class=nv>OUT_DIR</span><span class=k>}</span><span class=s2>&#34;</span>

<span class=nb>echo</span> <span class=s2>&#34;Converting RuleSets from &#39;</span><span class=k>${</span><span class=nv>RULESET_LIST</span><span class=k>}</span><span class=s2>&#39; into &#39;</span><span class=k>${</span><span class=nv>OUT_DIR</span><span class=k>}</span><span class=s2>&#39;...&#34;</span>
<span class=nb>echo</span>

<span class=c># Extract each RuleSet and convert</span>
yq <span class=nt>-r</span> <span class=s1>&#39;.items[].metadata.name&#39;</span> <span class=s2>&#34;</span><span class=k>${</span><span class=nv>RULESET_LIST</span><span class=k>}</span><span class=s2>&#34;</span> | <span class=k>while </span><span class=nv>IFS</span><span class=o>=</span> <span class=nb>read</span> <span class=nt>-r</span> name<span class=p>;</span> <span class=k>do
  </span><span class=nv>file_name</span><span class=o>=</span><span class=si>$(</span><span class=nb>echo</span> <span class=s2>&#34;</span><span class=k>${</span><span class=nv>name</span><span class=k>}</span><span class=s2>&#34;</span> | <span class=nb>tr</span> <span class=s1>&#39;[:space:]&#39;</span> <span class=s1>&#39;_&#39;</span><span class=si>)</span>

  <span class=nv>version</span><span class=o>=</span><span class=si>$(</span>yq <span class=nt>-r</span> <span class=s1>&#39;.items[] | select(.metadata.name == &#34;&#39;</span><span class=k>${</span><span class=nv>name</span><span class=k>}</span><span class=s1>&#39;&#34;) | .apiVersion&#39;</span> <span class=s2>&#34;</span><span class=k>${</span><span class=nv>RULESET_LIST</span><span class=k>}</span><span class=s2>&#34;</span> | <span class=nb>sed</span> <span class=s1>&#39;s/.*v//&#39;</span><span class=si>)</span>

  <span class=nb>echo</span> <span class=s2>&#34;→ Converting RuleSet: </span><span class=k>${</span><span class=nv>name</span><span class=k>}</span><span class=s2> (schema </span><span class=k>${</span><span class=nv>version</span><span class=k>}</span><span class=s2>)&#34;</span>

  <span class=c># Extract matching object and format as YAML</span>
  yq <span class=nt>-r</span> <span class=s1>&#39;.items[] | select(.metadata.name == &#34;&#39;</span><span class=k>${</span><span class=nv>name</span><span class=k>}</span><span class=s1>&#39;&#34;)&#39;</span> <span class=s2>&#34;</span><span class=k>${</span><span class=nv>RULESET_LIST</span><span class=k>}</span><span class=s2>&#34;</span> <span class=se>\</span>
    | jq <span class=nt>-r</span> <span class=nt>--arg</span> version <span class=s2>&#34;</span><span class=k>${</span><span class=nv>version</span><span class=k>}</span><span class=s2>&#34;</span> <span class=s1>&#39;
      {
        version: $version,
        name: .metadata.name,
        rules: .spec.rules
      }
    &#39;</span> <span class=se>\</span>
    | yq <span class=nt>-y</span> <span class=s1>&#39;.&#39;</span> <span class=o>&gt;</span> <span class=s2>&#34;</span><span class=k>${</span><span class=nv>OUT_DIR</span><span class=k>}</span><span class=s2>/</span><span class=k>${</span><span class=nv>file_name</span><span class=k>}</span><span class=s2>.yaml&#34;</span>
<span class=k>done

</span><span class=nb>echo
echo</span> <span class=s2>&#34;Conversion complete. All RuleSets written to &#39;</span><span class=k>${</span><span class=nv>OUT_DIR</span><span class=k>}</span><span class=s2>&#39;.&#34;</span></code></pre></div></div></li><li><p>Disable the usage of the <code>kubernetes</code> provider in your heimdall configuration and configure the <code>file_system</code> provider instead, e.g.</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=yaml><span class=na>providers</span><span class=pi>:</span>
  <span class=na>file_system</span><span class=pi>:</span>
    <span class=na>src</span><span class=pi>:</span> <span class=s>/rules</span></code></pre></div></div></li><li><p>Create a <code>ConfigMap</code> listing the converted rulesets.</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=bash><span class=nv>$ </span>kubectl create configmap heimdall-rules <span class=se>\</span>
   <span class=nt>--from-file</span><span class=o>=</span>&lt;converted-rulesets-directory&gt; <span class=se>\</span>
   <span class=nt>-n</span> &lt;namespace-heimdall-is-installed-into&gt;</code></pre></div></div></li><li><p>Configure the chart to include a volume mount for the above <code>ConfigMap</code>:</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=yaml><span class=c1># your values file</span>
<span class=na>deployment</span><span class=pi>:</span>
  <span class=c1># other settings</span>
  <span class=na>volumes</span><span class=pi>:</span>
    <span class=c1># other volumes</span>
    <span class=pi>-</span> <span class=na>name</span><span class=pi>:</span> <span class=s>rules</span>
      <span class=na>configMap</span><span class=pi>:</span>
        <span class=na>name</span><span class=pi>:</span> <span class=s>heimdall-rules</span>
  <span class=na>volumeMounts</span><span class=pi>:</span>
    <span class=c1># other volume mounts</span>
    <span class=pi>-</span> <span class=na>name</span><span class=pi>:</span> <span class=s>rules</span>
      <span class=na>readOnly</span><span class=pi>:</span> <span class=kc>true</span>
      <span class=na>mountPath</span><span class=pi>:</span> <span class=s2>&#34;</span><span class=s>/rules&#34;</span></code></pre></div></div></li><li><p>Perform the upgrade of heimdall in the cluster</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=bash><span class=nv>$ </span>helm upgrade <span class=nt>--install</span> &lt;your-release-name&gt; &lt;chart-reference&gt;  <span class=se>\</span>
    <span class=nt>-n</span> &lt;namespace-heimdall-is-installed-into&gt; <span class=se>\</span>
    <span class=nt>-f</span> &lt;path/to/your/values.yaml&gt; <span class=se>\</span>
    <span class=nt>-f</span> &lt;path/to/your/heimdall/config.yaml&gt;</code></pre></div></div></li><li><p>When the new pods are up and running and all pods from the previous version are terminated, delete the old <code>RuleSet</code> CRD from the cluster and install the CRD from the new release.</p></li><li><p>Install the <code>RuleSets</code> exported in step 1 and migrated in step 2 into the cluster</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=bash><span class=nv>$ </span>kubectl apply <span class=nt>-f</span> allrulesets.yaml</code></pre></div></div></li><li><p>Update your heimdall configuration to use the <code>kubernetes</code> provider again and remove the volume and the volume mount added to your chart values file in step 6. Then, update the heimdall installation to use it:</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=bash><span class=nv>$ </span>helm upgrade <span class=nt>--install</span> &lt;your-release-name&gt; &lt;chart-reference&gt;  <span class=se>\</span>
    <span class=nt>-n</span> &lt;namespace-heimdall-is-installed-into&gt; <span class=se>\</span>
    <span class=nt>-f</span> &lt;path/to/your/values.yaml&gt; <span class=se>\</span>
    <span class=nt>-f</span> &lt;path/to/your/heimdall/config.yaml&gt;</code></pre></div></div></li><li><p>Finally, delete the <code>ConfigMap</code> from step 5 from the cluster.</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=bash><span class=nv>$ </span>kubectl delete configmap heimdall-rules <span class=nt>-n</span> &lt;namespace-heimdall-is-installed-into&gt;</code></pre></div></div></li></ol></div></div></div></div><div class=sect1><h2 id=_upgrade_of_heimdall_configured_to_use_ruleset_files>Upgrade of heimdall configured to use RuleSet files</h2><div class=sectionbody><div class=paragraph><p>To convert existing <code>RuleSet</code> files for use with the <code>cloudblob</code>, <code>http_endpoint</code>, or <code>file_system</code> providers, use the <code>convert</code> command to migrate existing rule sets to the new schema version before deploying them to your target environment.</p></div><div class=paragraph><p>Here’s an example script to automate this process:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=bash><span class=c>#!/usr/bin/env bash</span>

<span class=c># Convert all existing heimdall RuleSets in a directory to a new schema version.</span>
<span class=c># The converted RuleSets are written to the same directory with a configurable prefix.</span>
<span class=c># If the prefix is not set, it defaults to converted_.</span>
<span class=c>#</span>
<span class=c># Usage:</span>
<span class=c>#   ./convert-rulesets.sh --dir &lt;ruleset-dir&gt; --desired-version &lt;new-schema-version&gt; [--prefix &lt;prefix&gt;]</span>
<span class=c>#</span>
<span class=c># Example:</span>
<span class=c>#   ./convert-rulesets.sh --dir ./rulesets --desired-version 1beta1 --prefix upgraded_</span>
<span class=c>#</span>
<span class=c># Requirements:</span>
<span class=c>#   - Heimdall must be available in PATH.</span>
<span class=c>#</span>

<span class=nb>set</span> <span class=nt>-euo</span> pipefail

<span class=c># Default values</span>
<span class=nv>PREFIX</span><span class=o>=</span><span class=s2>&#34;converted_&#34;</span>

<span class=c># Print help text (only the leading comment block after the optional shebang)</span>
usage<span class=o>()</span> <span class=o>{</span>
  <span class=nb>awk</span> <span class=s1>&#39;
    # skip shebang on line 1 if present
    NR==1 { if ($0 ~ /^#!/) { next } }
    # while lines start with &#34;#&#34;, strip the &#34;# &#34; (or &#34;#&#34;) and print
    /^#/ {
      sub(/^#\s?/, &#34;&#34;)
      print
      started=1
      next
    }
    # once we have printed at least one comment block line, stop at first non-# line
    started==1 { exit }
  &#39;</span> <span class=s2>&#34;</span><span class=nv>$0</span><span class=s2>&#34;</span>
  <span class=nb>exit </span>0
<span class=o>}</span>

<span class=c># Parse arguments</span>
<span class=k>while</span> <span class=o>[[</span> <span class=nv>$# </span><span class=nt>-gt</span> 0 <span class=o>]]</span><span class=p>;</span> <span class=k>do
  case</span> <span class=s2>&#34;</span><span class=nv>$1</span><span class=s2>&#34;</span> <span class=k>in</span>
    <span class=nt>--dir</span><span class=p>)</span>
      <span class=nv>DIR</span><span class=o>=</span><span class=s2>&#34;</span><span class=nv>$2</span><span class=s2>&#34;</span>
      <span class=nb>shift </span>2
      <span class=p>;;</span>
    <span class=nt>--desired-version</span><span class=p>)</span>
      <span class=nv>NEW_VERSION</span><span class=o>=</span><span class=s2>&#34;</span><span class=nv>$2</span><span class=s2>&#34;</span>
      <span class=nb>shift </span>2
      <span class=p>;;</span>
    <span class=nt>--prefix</span><span class=p>)</span>
      <span class=nv>PREFIX</span><span class=o>=</span><span class=s2>&#34;</span><span class=nv>$2</span><span class=s2>&#34;</span>
      <span class=nb>shift </span>2
      <span class=p>;;</span>
    <span class=nt>-h</span><span class=p>|</span><span class=nt>--help</span><span class=p>)</span>
      usage
      <span class=p>;;</span>
    <span class=k>*</span><span class=p>)</span>
      <span class=nb>echo</span> <span class=s2>&#34;Unknown argument: </span><span class=nv>$1</span><span class=s2>&#34;</span>
      <span class=nb>echo</span> <span class=s2>&#34;Use --help for usage information.&#34;</span>
      <span class=nb>exit </span>1
      <span class=p>;;</span>
  <span class=k>esac</span>
<span class=k>done</span>

<span class=c># Validate required arguments</span>
<span class=k>if</span> <span class=o>[[</span> <span class=nt>-z</span> <span class=s2>&#34;</span><span class=k>${</span><span class=nv>DIR</span><span class=k>:-}</span><span class=s2>&#34;</span> <span class=o>||</span> <span class=nt>-z</span> <span class=s2>&#34;</span><span class=k>${</span><span class=nv>NEW_VERSION</span><span class=k>:-}</span><span class=s2>&#34;</span> <span class=o>]]</span><span class=p>;</span> <span class=k>then
  </span><span class=nb>echo</span> <span class=s2>&#34;Error: --dir and --desired-version are required.&#34;</span>
  <span class=nb>echo</span> <span class=s2>&#34;Usage: </span><span class=nv>$0</span><span class=s2> --dir &lt;ruleset-dir&gt; --desired-version &lt;new-schema-version&gt; [--prefix &lt;prefix&gt;]&#34;</span>
  <span class=nb>exit </span>1
<span class=k>fi

if</span> <span class=o>[[</span> <span class=o>!</span> <span class=nt>-d</span> <span class=s2>&#34;</span><span class=k>${</span><span class=nv>DIR</span><span class=k>}</span><span class=s2>&#34;</span> <span class=o>]]</span><span class=p>;</span> <span class=k>then
  </span><span class=nb>echo</span> <span class=s2>&#34;Error: Directory &#39;</span><span class=k>${</span><span class=nv>DIR</span><span class=k>}</span><span class=s2>&#39; does not exist.&#34;</span>
  <span class=nb>exit </span>1
<span class=k>fi

</span><span class=nb>echo</span> <span class=s2>&#34;Converting RuleSets in &#39;</span><span class=k>${</span><span class=nv>DIR</span><span class=k>}</span><span class=s2>&#39; to schema version &#39;</span><span class=k>${</span><span class=nv>NEW_VERSION</span><span class=k>}</span><span class=s2>&#39;...&#34;</span>
<span class=nb>echo</span> <span class=s2>&#34;Converted files will be written to the same directory with prefix &#39;</span><span class=k>${</span><span class=nv>PREFIX</span><span class=k>}</span><span class=s2>&#39;.&#34;</span>
<span class=nb>echo

</span><span class=k>for </span>file <span class=k>in</span> <span class=s2>&#34;</span><span class=k>${</span><span class=nv>DIR</span><span class=k>}</span><span class=s2>&#34;</span>/<span class=k>*</span><span class=p>;</span> <span class=k>do
  if</span> <span class=o>[[</span> <span class=nt>-f</span> <span class=s2>&#34;</span><span class=k>${</span><span class=nv>file</span><span class=k>}</span><span class=s2>&#34;</span> <span class=o>]]</span><span class=p>;</span> <span class=k>then
    </span><span class=nv>filename</span><span class=o>=</span><span class=si>$(</span><span class=nb>basename</span> <span class=s2>&#34;</span><span class=k>${</span><span class=nv>file</span><span class=k>}</span><span class=s2>&#34;</span><span class=si>)</span>
    <span class=nv>output_file</span><span class=o>=</span><span class=s2>&#34;</span><span class=k>${</span><span class=nv>DIR</span><span class=k>}</span><span class=s2>/</span><span class=k>${</span><span class=nv>PREFIX</span><span class=k>}${</span><span class=nv>filename</span><span class=k>}</span><span class=s2>&#34;</span>

    <span class=nb>echo</span> <span class=s2>&#34;→ Converting </span><span class=k>${</span><span class=nv>filename</span><span class=k>}</span><span class=s2> ...&#34;</span>
    heimdall convert ruleset <span class=nt>-d</span> <span class=s2>&#34;</span><span class=k>${</span><span class=nv>NEW_VERSION</span><span class=k>}</span><span class=s2>&#34;</span> <span class=nt>-o</span> <span class=s2>&#34;</span><span class=k>${</span><span class=nv>output_file</span><span class=k>}</span><span class=s2>&#34;</span> <span class=s2>&#34;</span><span class=k>${</span><span class=nv>file</span><span class=k>}</span><span class=s2>&#34;</span>
  <span class=k>fi
done

</span><span class=nb>echo
echo</span> <span class=s2>&#34;Conversion complete.&#34;</span></code></pre></div></div><div class=paragraph><p>The general procedure is as follows:</p></div><div class="olist arabic"><ol class=arabic><li><p>Convert the existing rule sets by using the <code>convert</code> command.</p></li><li><p>If you’re using the <code>cloudblob</code> or <code>http_endpoint</code> providers, deploy the converted rule sets to your cloud storage or to the server that delivers the <code>RuleSets</code> to the currently running Heimdall instances.</p><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content>Don’t overwrite the existing rule sets. Make sure you add a prefix to the converted <code>RuleSet</code> files. This ensures that old <code>RuleSets</code> can still be loaded by the existing heimdall instances, while the converted ones are ignored. The script above already handles this.</td></tr></tbody></table></div></li><li><p>Configure the new heimdall deployment to use the converted rule sets.</p></li><li><p>Deploy the new heimdall version.</p></li></ol></div><div class=paragraph><p>This approach ensures zero downtime by letting old heimdall instances continue using their existing rule sets while new instances switch to the converted versions.</p></div></div></div></linkable-headline-area></div><p class="text-end fst-italic fs-7 pb-3">Last updated on <span class=fw-bold>Oct 24, 2025</span></p><hr><div class="d-flex justify-content-between py-3"><a href=../../../docs/operations/security/ class="fs-6 fw-bold text-dark link-secondary link-underline-opacity-0"><svg width="16" height="16" fill="currentColor" class="bi bi-chevron-left" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M11.354 1.646a.5.5.0 010 .708L5.707 8l5.647 5.646a.5.5.0 01-.708.708l-6-6a.5.5.0 010-.708l6-6a.5.5.0 01.708.0z"/></svg>
Security
</a><a class="ms-auto fs-6 fw-bold text-dark link-secondary link-underline-opacity-0" href=../../../docs/services/main/>Main Service
<svg width="16" height="16" fill="currentColor" class="bi bi-chevron-right" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4.646 1.646a.5.5.0 01.708.0l6 6a.5.5.0 010 .708l-6 6a.5.5.0 01-.708-.708L10.293 8 4.646 2.354a.5.5.0 010-.708z"/></svg></a></div></div></main></div><footer class="footer py-4 py-md-5 px-4 px-md-3 mt-3"><div class=container><div class=row><div class="col-lg-3 mb-3"><p class=fs-5>Heimdall</p><ul class="list-unstyled small text-muted"><li class=mb-2>2022-2024 © Heimdall Project Authors. All rights reserved.</li><li class=mb-2><a href=https://github.com/dadrus/heimdall/blob/master/LICENSE>Apache 2.0 licensed</a></li></ul></div><div class="col-6 col-lg-2 offset-lg-1 mb-3"><h5>Links</h5><ul class=list-unstyled><li class=mb-2><a href=../../../>Home</a></li><li class=mb-2><a href=../../../docs/getting_started/discover_heimdall>Docs</a></li><li class=mb-2><a href=../../../guides/>Guides</a></li><li class=mb-2><a href=../../../openapi/>API</a></li></ul></div><div class="col-6 col-lg-2 mb-2"><h5>Guides</h5><ul class=list-unstyled><li class=mb-2><a href=../../../guides/proxies/>API Gateways & Proxies</a></li><li class=mb-2><a href=../../../guides/authz/>Authorization Services</a></li><li class=mb-2><a href=../../../guides/authn/>Authentication Protocols & Services</a></li></ul></div><div class="col-6 col-lg-2 mb-2"><h5>Community</h5><ul class=list-unstyled><li class=mb-2><a href=https://github.com/dadrus/heimdall>Github</a></li><li class=mb-2><a href=https://discord.gg/qQgg8xKuyb>Discord</a></li></ul></div></div></div></footer><script src=../../../js/main.js defer></script></body></html>