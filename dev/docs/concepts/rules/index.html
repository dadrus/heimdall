<!doctype html><html lang=en><head><title>Rules </title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="An open source Identity Aware Proxy and an Access Control Decision service for cloud native applications"><meta name=dc.relation content="https://dadrus.github.io/"><meta name=theme-color content="#1A94D2"><link rel=stylesheet href=../../../css/styles.min.css media=screen><link rel='shortcut icon' type=image/x-icon href=../../../favicon.ico></head><body><header class="navbar navbar-expand-md navbar-dark bg-dark sticky-top"><nav class="container-xxl flex-wrap flex-lg-nowrap px-0" aria-label="Main navigation"><button class="btn btn-outline-dark d-lg-none navbar-toggler border-0 shadow-none ps-3" type=button data-bs-toggle=offcanvas data-bs-target=#docsMenuContent aria-controls=docsMenuContent aria-expanded=false aria-label="Open docs menu"><svg width="36" height="36" fill="currentcolor" class="bi bi-list" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M2.5 12a.5.5.0 01.5-.5h10a.5.5.0 010 1H3a.5.5.0 01-.5-.5m0-4a.5.5.0 01.5-.5h10a.5.5.0 010 1H3A.5.5.0 012.5 8m0-4a.5.5.0 01.5-.5h10a.5.5.0 010 1H3A.5.5.0 012.5 4"/></svg></button><nav class="offcanvas offcanvas-start d-md-none text-bg-light" tabindex=-1 id=docsMenuContent aria-labelledby=docsMenuContentLabel><div class=offcanvas-header><h5 class=offcanvas-title id=docsMenuContentLabel>Browse docs</h5><button type=button class=btn-close data-bs-dismiss=offcanvas aria-label="Close docs menu"></button></div><div class="offcanvas-body docs-sidebar"><div class=docs-search-button><button type=button class="btn btn-outline-secondary mb-3 d-none d-md-block w-100 text-start" data-bs-toggle=modal data-bs-target=#docSearch aria-controls=docSearch aria-expanded=false aria-label="Open search">
<svg width="20" height="20" fill="currentcolor" class="bi bi-search me-2" viewBox="0 0 20 20"><path d="M11.742 10.344a6.5 6.5.0 10-1.397 1.398h-.001q.044.06.098.115l3.85 3.85a1 1 0 001.415-1.414l-3.85-3.85a1 1 0 00-.115-.1zM12 6.5a5.5 5.5.0 11-11 0 5.5 5.5.0 0111 0"/></svg>
<span>Quick search...</span></button></div><nav id=SideBarToc><ul><li><span>Getting Started</span><ul><li><a href=../../../docs/getting_started/discover_heimdall/>Discover heimdall</a></li><li><a href=../../../docs/getting_started/installation/>Install heimdall</a></li><li><a href=../../../docs/getting_started/protect_an_app/>Protect an Application</a></li></ul></li><li><span>Concepts</span><ul><li><a href=../../../docs/concepts/pipelines/>Pipelines</a></li><li><a href=../../../docs/concepts/mechanisms/>Mechanisms</a></li><li><a class=active href=../../../docs/concepts/rules/>Rules</a></li><li><a href=../../../docs/concepts/provider/>Rule Provider</a></li><li><a href=../../../docs/concepts/operating_modes/>Operating Modes</a></li></ul></li><li><span>Operations</span><ul><li><a href=../../../docs/operations/configuration/>Configuration</a></li><li><a href=../../../docs/operations/cli/>CLI</a></li><li><a href=../../../docs/operations/observability/>Observability</a></li><li><a href=../../../docs/operations/cache/>Caching</a></li><li><a href=../../../docs/operations/security/>Security</a></li></ul></li><li><span>Services</span><ul><li><a href=../../../docs/services/main/>Main Service</a></li><li><a href=../../../docs/services/management/>Management Service</a></li></ul></li><li><span>Mechanisms</span><ul><li><a href=../../../docs/mechanisms/catalogue/>Catalogue</a></li><li><a href=../../../docs/mechanisms/evaluation_objects/>Objects, Templating & Co</a></li><li><a href=../../../docs/mechanisms/authenticators/>Authenticators</a></li><li><a href=../../../docs/mechanisms/authorizers/>Authorizers</a></li><li><a href=../../../docs/mechanisms/contextualizers/>Contextualizers</a></li><li><a href=../../../docs/mechanisms/finalizers/>Finalizers</a></li><li><a href=../../../docs/mechanisms/error_handlers/>Error Handlers</a></li></ul></li><li><span>Rules</span><ul><li><a href=../../../docs/rules/regular_rule/>Regular Rule</a></li><li><a href=../../../docs/rules/default_rule/>Default Rule</a></li><li><a href=../../../docs/rules/rule_sets/>Rule Sets</a></li><li><a href=../../../docs/rules/providers/>Rule Providers</a></li></ul></li><li><span>Configuration Reference</span><ul><li><a href=../../../docs/configuration/types/>Type Definitions</a></li><li><a href=../../../docs/configuration/reference/>Reference</a></li></ul></li></ul></nav></div></nav><div class="d-flex align-items-center px-4"><a class="navbar-brand navbar-brand-highlight text-white me-0" href=../../../ style=font-weight:500;font-size:1.5rem>Heimdall</a><ul class="navbar-nav d-none d-md-flex ms-3"><li class=nav-item><a class='nav-link text-white' href=../../../docs/getting_started/discover_heimdall>Docs</a></li><li class=nav-item><a class='nav-link text-white' href=../../../guides/>Guides</a></li><li class=nav-item><a class='nav-link text-white' href=../../../openapi/>API</a></li></ul></div><div class=d-flex><button type=button class="btn btn-outline-dark navbar-toggler border-0 shadow-none" data-bs-toggle=modal data-bs-target=#docSearch aria-controls=docSearch aria-expanded=false aria-label="Open search">
<span class="bi bi-search"></span>
</button>
<button class="btn btn-outline-dark navbar-toggler border-0 shadow-none pe-3" type=button data-bs-toggle=offcanvas data-bs-target=#mainMenuContent aria-controls=mainMenuContent aria-expanded=false aria-label="Open main menu"><svg width="24" height="24" fill="currentcolor" class="bi bi-three-dots" viewBox="0 0 16 16"><path d="M3 9.5a1.5 1.5.0 110-3 1.5 1.5.0 010 3m5 0a1.5 1.5.0 110-3 1.5 1.5.0 010 3m5 0a1.5 1.5.0 110-3 1.5 1.5.0 010 3"/></svg></button><div class="offcanvas offcanvas-end text-bg-dark" tabindex=-1 id=mainMenuContent aria-labelledby=mainMenuContentLabel><div class=offcanvas-header><h5 class="offcanvas-title text-white" id=mainMenuContentLabel>Heimdall</h5><button type=button class="btn-close btn-close-white" data-bs-dismiss=offcanvas aria-label="Close main menu"></button></div><div class=offcanvas-body><ul class="navbar-nav flex-column d-md-none d-lg-none d-xl-none"><li class=nav-item><a class='nav-link text-white' href=../../../docs/getting_started/discover_heimdall>Docs</a></li><li class=nav-item><a class='nav-link text-white' href=../../../guides/>Guides</a></li><li class=nav-item><a class='nav-link text-white' href=../../../openapi/>API</a></li></ul><hr class="text-white-50 d-md-none"><ul class="navbar-nav flex-column ms-auto"><doc-version-select class="nav-item dropdown" version-file=/heimdall/data.json current-version=dev current-page=/docs/concepts/rules/><button class="btn btn-dark dropdown-toggle me-4" data-bs-toggle=dropdown aria-expanded=false>
dev</button></doc-version-select></ul><ul class="navbar-nav flex-column"><li class="nav-item mb-1 pe-4"><a class="nav-link text-white" style=align-self:center href=https://github.com/dadrus/heimdall><svg role="img" width="20" height="20" fill="currentcolor" class="bi bi-github text-white" viewBox="0 0 16 16"><title>GitHub</title><path d="M8 0C3.58.0.0 3.58.0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38.0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95.0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12.0.0.67-.21 2.2.82.64-.18 1.32-.27 2-.27s1.36.09 2 .27c1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15.0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48.0 1.07-.01 1.93-.01 2.2.0.21.15.46.55.38A8.012 8.012.0 0016 8c0-4.42-3.58-8-8-8z"/></svg>
<small class="ms-2 d-md-none">GitHub</small></a></li></ul></div></div></div></nav></header><div class=modal id=docSearch tabindex=-1 aria-labelledby=docSearchLabel aria-hidden=true><doc-search class="col-auto me-auto mw-75" index-file=/heimdall/dev/index.json path-prefix=/heimdall/dev><div class="modal-dialog modal-lg modal-dialog-scrollable"><div class=modal-content><div class="modal-header p-2"><div class=input-group><div class="input-group-text bg-body border-0 fs-4"><svg width="16" height="16" fill="currentcolor" class="bi bi-search text-secondary my-0" viewBox="0 0 16 16"><path d="M11.742 10.344a6.5 6.5.0 10-1.397 1.398h-.001q.044.06.098.115l3.85 3.85a1 1 0 001.415-1.414l-3.85-3.85a1 1 0 00-.115-.1zM12 6.5a5.5 5.5.0 11-11 0 5.5 5.5.0 0111 0"/></svg></div><input id=search-input class="form-control search-bar border-0" type=search placeholder="Search documentation " aria-label="Search docs..." autocomplete=off autofocus><div class="input-group-text bg-body border-0"><a class="btn input-group-text text-muted border p-1 bg-light-subtle fs-7 fw-bold font-monospace" data-bs-dismiss=modal aria-label=Close>ESC</a></div></div></div><div class=modal-body><div class=search-results><p class="text-center mt-5">No recent searches</p></div></div><div class=modal-footer></div></div></div></doc-search></div><div class="container-xxl docs-layout px-4"><aside class="d-none pe-3 docs-sidebar"><div class=docs-search-button><button type=button class="btn btn-outline-secondary mb-3 d-none d-md-block w-100 text-start" data-bs-toggle=modal data-bs-target=#docSearch aria-controls=docSearch aria-expanded=false aria-label="Open search">
<svg width="20" height="20" fill="currentcolor" class="bi bi-search me-2" viewBox="0 0 20 20"><path d="M11.742 10.344a6.5 6.5.0 10-1.397 1.398h-.001q.044.06.098.115l3.85 3.85a1 1 0 001.415-1.414l-3.85-3.85a1 1 0 00-.115-.1zM12 6.5a5.5 5.5.0 11-11 0 5.5 5.5.0 0111 0"/></svg>
<span>Quick search...</span></button></div><nav id=SideBarToc><ul><li><span>Getting Started</span><ul><li><a href=../../../docs/getting_started/discover_heimdall/>Discover heimdall</a></li><li><a href=../../../docs/getting_started/installation/>Install heimdall</a></li><li><a href=../../../docs/getting_started/protect_an_app/>Protect an Application</a></li></ul></li><li><span>Concepts</span><ul><li><a href=../../../docs/concepts/pipelines/>Pipelines</a></li><li><a href=../../../docs/concepts/mechanisms/>Mechanisms</a></li><li><a class=active href=../../../docs/concepts/rules/>Rules</a></li><li><a href=../../../docs/concepts/provider/>Rule Provider</a></li><li><a href=../../../docs/concepts/operating_modes/>Operating Modes</a></li></ul></li><li><span>Operations</span><ul><li><a href=../../../docs/operations/configuration/>Configuration</a></li><li><a href=../../../docs/operations/cli/>CLI</a></li><li><a href=../../../docs/operations/observability/>Observability</a></li><li><a href=../../../docs/operations/cache/>Caching</a></li><li><a href=../../../docs/operations/security/>Security</a></li></ul></li><li><span>Services</span><ul><li><a href=../../../docs/services/main/>Main Service</a></li><li><a href=../../../docs/services/management/>Management Service</a></li></ul></li><li><span>Mechanisms</span><ul><li><a href=../../../docs/mechanisms/catalogue/>Catalogue</a></li><li><a href=../../../docs/mechanisms/evaluation_objects/>Objects, Templating & Co</a></li><li><a href=../../../docs/mechanisms/authenticators/>Authenticators</a></li><li><a href=../../../docs/mechanisms/authorizers/>Authorizers</a></li><li><a href=../../../docs/mechanisms/contextualizers/>Contextualizers</a></li><li><a href=../../../docs/mechanisms/finalizers/>Finalizers</a></li><li><a href=../../../docs/mechanisms/error_handlers/>Error Handlers</a></li></ul></li><li><span>Rules</span><ul><li><a href=../../../docs/rules/regular_rule/>Regular Rule</a></li><li><a href=../../../docs/rules/default_rule/>Default Rule</a></li><li><a href=../../../docs/rules/rule_sets/>Rule Sets</a></li><li><a href=../../../docs/rules/providers/>Rule Providers</a></li></ul></li><li><span>Configuration Reference</span><ul><li><a href=../../../docs/configuration/types/>Type Definitions</a></li><li><a href=../../../docs/configuration/reference/>Reference</a></li></ul></li></ul></nav></aside><main class=docs-main><div class="d-md-none docs-location bg-body"><nav style="--bs-breadcrumb-divider:'>'" aria-label=breadcrumb><ol class="breadcrumb mb-0"><li class="breadcrumb-item fw-bold">Concepts</li><li class="breadcrumb-item active" aria-current=page>Rules</li></ol></nav></div><div class="docs-intro pt-3 pe-3"><h1>Rules</h1><p>Rules defines what should happen to particular requests and under which conditions. They assemble the authentication & authorization and error pipelines and bring previously configured mechanisms to life.</p></div><aside class="text-muted docs-toc"><strong class="d-md-block h6 pb-2 my-2 ms-2 border-bottom d-none d-md-none d-lg-block">On this page</strong><div id=page-content-toc class="mt-1 mb-3 text-muted d-none d-md-none d-lg-block docs-toc-content"><nav id=TableOfContents><ul><li><a href=#_rule_types>Rule Types</a></li><li><a href=#_memory_footprint>Memory Footprint</a></li><li><a href=#_execution_of_rules>Execution of Rules</a></li><li><a href=#_matching_of_rules>Matching of Rules</a></li><li><a href=#_default_rule_inheritance>Default Rule & Inheritance</a></li></ul></nav></div><button class="btn btn-outline-secondary text-decoration-none d-lg-none collapsed" type=button data-bs-toggle=collapse data-bs-target=#page-content-toc-collapsible aria-expanded=false aria-controls=page-content-toc-collapsible>
On this page<svg width="16" height="16" fill="currentcolor" class="bi bi-chevron-expand" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M3.646 9.146a.5.5.0 01.708.0L8 12.793l3.646-3.647a.5.5.0 01.708.708l-4 4a.5.5.0 01-.708.0l-4-4a.5.5.0 010-.708m0-2.292a.5.5.0 00.708.0L8 3.207l3.646 3.647a.5.5.0 00.708-.708l-4-4a.5.5.0 00-.708.0l-4 4a.5.5.0 000 .708"/></svg></button><div id=page-content-toc-collapsible class="mt-1 mb-3 text-muted d-lg-none collapse docs-toc-content"><div class="card card-body"><nav id=TableOfContents><ul><li><a href=#_rule_types>Rule Types</a></li><li><a href=#_memory_footprint>Memory Footprint</a></li><li><a href=#_execution_of_rules>Execution of Rules</a></li><li><a href=#_matching_of_rules>Matching of Rules</a></li><li><a href=#_default_rule_inheritance>Default Rule & Inheritance</a></li></ul></nav></div></div></aside><div class="docs-content pe-3"><div data-bs-spy=scroll data-bs-target=#page-content-toc class=mt-3><linkable-headline-area><div class=paragraph><p>You can compare the relation between mechanisms and rules to a relation between a catalogue at a car dealer and a real car, when you get it. So, mechanisms is what you can see and select in a catalogue (though, in case of heimdall you have to define that catalogue first) to compile your car and the rule is your car with real components and behavior. In that sense when you define a rule, you specify which mechanisms should it be built from and whether you would like some "tuning" to be applied to better suit your needs.</p></div><div class=sect1><h2 id=_rule_types>Rule Types</h2><div class=sectionbody><div class=paragraph><p>Heimdall supports two types of rules:</p></div><div class=ulist><ul><li><p>The <a href=../../../docs/rules/regular_rule/>upstream specific rule</a>, also called the regular rule. You can define as many regular rules, as required. These rules are dynamic by nature and can come and go together with the upstream service defining these.</p></li><li><p>The <a href=../../../docs/rules/regular_rule/>default rule</a>, which, if defined, is used by the regular rules to inherit their behavior and is also executed if no other rule matches.</p></li></ul></div></div></div><div class=sect1><h2 id=_memory_footprint>Memory Footprint</h2><div class=sectionbody><div class=paragraph><p>Even the first paragraphs compare mechanisms and the rules with a catalogue of car parts and a real car, things are a bit more complex in reality.</p></div><div class=paragraph><p>To minimize the memory footprint, heimdall instantiates all defined mechanisms on start up. And since all mechanisms are stateless, the following is happening at runtime, when the rule is loaded:</p></div><div class=ulist><ul><li><p>If a rule, respectively its pipeline just references a mechanism without providing additional configuration, the already instantiated mechanism is used.</p></li><li><p>Otherwise, if the pipeline overrides any parts of the default mechanism configuration, a shallow copy of the referenced mechanism instance (created at start up) is created, and only those parts, which differ are replaced with new objects, representing the pipeline specific configuration.</p></li></ul></div></div></div><div class=sect1><h2 id=_execution_of_rules>Execution of Rules</h2><div class=sectionbody><div class=paragraph><p>The diagram below sketches the logic executed by heimdall for each and every incoming request.</p></div><div class=imageblock><div class=content><img src=diag-ditaa-md5-95b0331829cfd516daf370f547944674.svg alt=Diagram width=820 height=546></div></div><div class="olist arabic"><ol class=arabic><li><p><strong>Any rule matching request?</strong> - This is the first step executed by heimdall in which it tries to find a <a href=#_matching_of_rules>matching rule</a>. If there is no matching rule, heimdall either falls back to the default rule if available, or the request is denied. Otherwise, the rule specific authentication & authorization pipeline is executed.</p></li><li><p><strong>Execute authentication & authorization pipeline</strong> - when a rule is matched, the mechanisms defined in its authentication & authorization pipeline are executed.</p></li><li><p><strong>Forward request, respectively respond to the API gateway</strong> - when the above steps succeed, heimdall, depending on the <a href=../../../docs/concepts/operating_modes/>operating mode</a>, responds with, respectively forwards whatever was defined in the pipeline (usually this is a set of HTTP headers). Otherwise</p></li><li><p><strong>Execute error pipeline</strong> is executed if any of the mechanisms, defined in the authentication & authorization pipeline fail. This again results in a response, this time however, based on the definition in the used error handler.</p></li></ol></div></div></div><div class=sect1><h2 id=_matching_of_rules>Matching of Rules</h2><div class=sectionbody><div class=paragraph><p>As written above, an <a href=../../../docs/rules/regular_rule/>upstream specific rule</a> is only executed when it matches an incoming request.</p></div><div class=paragraph><p>The actual matching happens via the requests URL path, which is guaranteed to happen with O(log(n)) time complexity and is based on the path expressions specified in the loaded rules. These expressions support usage of (named) wildcards to capture segments of the matched path. The implementation ensures, that more specific path expressions are matched first regardless of the placement of rules in a <a href=../../../docs/concepts/provider/#_rule_sets>rule set</a>.</p></div><div class=paragraph><p>Additional conditions, like the host, the HTTP method, or application of regular or glob expressions can also be taken into account, allowing different rules for the same path expressions. The information about the HTTP method, scheme, host, path and query is taken either from the request itself, or if present and allowed, from the <code>X-Forwarded-Proto</code>, <code>X-Forwarded-Host</code>, <code>X-Forwarded-Uri</code> and <code>X-Forwarded-Method</code> headers of the incoming request.</p></div><div class=paragraph><p>There is also an option to have backtracking to a rule with a less specific path expression, if the actual specific path is matched, but the above said additional conditions are not satisfied.</p></div></div></div><div class=sect1><h2 id=_default_rule_inheritance>Default Rule & Inheritance</h2><div class=sectionbody><div class=paragraph><p>The <a href=#_rule_types>Rule Types</a> section tells, that a default rule can be used as a base to inherit behavior for the regular rule.</p></div><div class=paragraph><p>In principle, there is a need to differentiate two things:</p></div><div class=ulist><ul><li><p>the defined rule, which is what you define</p></li><li><p>the effective rule, which is what is executed at runtime</p></li></ul></div><div class=paragraph><p>This is comparable to the polymorphism concept in programming languages. So, how does it work?</p></div><div class=paragraph><p>Imagine, the concept of a rule is e.g. an interface written in Java defining the following methods:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=java><span class=kd>public</span> <span class=kd>interface</span> <span class=nc>Rule</span> <span class=o>{</span>
  <span class=kd>public</span> <span class=kt>void</span> <span class=nf>executeAuthenticationStage</span><span class=o>(</span><span class=n>req</span> <span class=nc>Request</span><span class=o>)</span>
  <span class=kd>public</span> <span class=kt>void</span> <span class=nf>executeAuthorizationStage</span><span class=o>(</span><span class=n>req</span> <span class=nc>Request</span><span class=o>)</span>
  <span class=kd>public</span> <span class=kt>void</span> <span class=nf>executeFinalizationStage</span><span class=o>(</span><span class=n>req</span> <span class=nc>Request</span><span class=o>)</span>
  <span class=kd>public</span> <span class=kt>void</span> <span class=nf>handleError</span><span class=o>(</span><span class=n>req</span> <span class=nc>Request</span><span class=o>)</span>
<span class=o>}</span></code></pre></div></div><div class=paragraph><p>And the logic described in <a href=#_execution_of_rules>Execution of Rules</a> is implemented similar to what is shown in the snippet below</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=java><span class=nc>Rule</span> <span class=n>rule</span> <span class=o>=</span> <span class=n>findMatchingRule</span><span class=o>(</span><span class=n>req</span><span class=o>)</span>
<span class=k>if</span> <span class=o>(</span><span class=n>rule</span> <span class=o>==</span> <span class=kc>null</span><span class=o>)</span> <span class=o>{</span>
  <span class=k>throw</span> <span class=k>new</span> <span class=nf>NotFoundError</span><span class=o>()</span>
<span class=o>}</span>

<span class=k>try</span> <span class=o>{</span>
  <span class=c1>// execution of the authentication &amp; authorization pipeline</span>
  <span class=n>rule</span><span class=o>.</span><span class=na>executeAuthenticationStage</span><span class=o>(</span><span class=n>req</span><span class=o>)</span>
  <span class=n>rule</span><span class=o>.</span><span class=na>executeAuthorizationStage</span><span class=o>(</span><span class=n>req</span><span class=o>)</span>
  <span class=n>rule</span><span class=o>.</span><span class=na>executeFinalizationStage</span><span class=o>(</span><span class=n>req</span><span class=o>)</span>

  <span class=c1>// further logic related to response creation</span>
<span class=o>}</span> <span class=k>catch</span><span class=o>(</span><span class=nc>Exception</span> <span class=n>e</span><span class=o>)</span> <span class=o>{</span>
  <span class=c1>// execution of the error pipeline</span>
  <span class=n>rule</span><span class=o>.</span><span class=na>handleError</span><span class=o>(</span><span class=n>req</span><span class=o>)</span>

  <span class=c1>// further logic related to response creation</span>
<span class=o>}</span></code></pre></div></div><div class=paragraph><p>with <code>findMatchingRule</code> returning a specific instance of a class implementing our <code>Rule</code> interface matching the request.</p></div><div class=paragraph><p>Since there is some default behavior in place, like error handling, if the error pipeline is empty, and some stages of the authentication & authorization pipeline is optional, internally, there is some kind of base rule in place, all other rules inherit from. So something like shown in the snippet below.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=java><span class=kd>public</span> <span class=kd>abstract</span> <span class=kd>class</span> <span class=nc>BaseRule</span> <span class=kd>implements</span> <span class=nc>Rule</span> <span class=o>{</span>
  <span class=kd>public</span> <span class=kd>abstract</span> <span class=kt>void</span> <span class=nf>executeAuthenticationStage</span><span class=o>(</span><span class=n>req</span> <span class=nc>Request</span><span class=o>)</span>
  <span class=kd>public</span> <span class=kt>void</span> <span class=nf>executeAuthorizationStage</span><span class=o>(</span><span class=n>req</span> <span class=nc>Request</span><span class=o>)</span> <span class=o>{}</span>
  <span class=kd>public</span> <span class=kt>void</span> <span class=nf>executeFinalizationStage</span><span class=o>(</span><span class=n>req</span> <span class=nc>Request</span><span class=o>)</span> <span class=o>{}</span>
  <span class=kd>public</span> <span class=kt>void</span> <span class=nf>handleError</span><span class=o>(</span><span class=n>req</span> <span class=nc>Request</span><span class=o>)</span> <span class=o>{</span> <span class=n>handlerErrorDefault</span><span class=o>(</span><span class=n>req</span><span class=o>)</span> <span class=o>}</span>
<span class=o>}</span></code></pre></div></div><div class=paragraph><p>If there is no default rule configured, an upstream specific rule can then be considered as a class inheriting from that <code>BaseRule</code> and must implement at least the <code>executeAuthenticationStage</code> method, similar to what is shown below</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=java><span class=kd>public</span> <span class=kd>class</span> <span class=nc>MySpecificRule</span> <span class=kd>extends</span> <span class=nc>BaseRule</span> <span class=o>{</span>
  <span class=kd>public</span> <span class=kt>void</span> <span class=nf>executeAuthenticationStage</span><span class=o>(</span><span class=n>req</span> <span class=nc>Request</span><span class=o>)</span> <span class=o>{</span> <span class=o>...</span> <span class=o>}</span>
<span class=o>}</span></code></pre></div></div><div class=paragraph><p>If however, there is a default rule configured, on one hand, it can be considered as yet another class deriving from our <code>BaseClass</code>. So, something like</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=java><span class=kd>public</span> <span class=kd>class</span> <span class=nc>DefaultRule</span> <span class=kd>extends</span> <span class=nc>BaseRule</span> <span class=o>{</span>
  <span class=kd>public</span> <span class=kt>void</span> <span class=nf>executeAuthenticationStage</span><span class=o>(</span><span class=n>req</span> <span class=nc>Request</span><span class=o>)</span> <span class=o>{</span> <span class=o>...</span> <span class=o>}</span>
  <span class=kd>public</span> <span class=kt>void</span> <span class=nf>executeAuthorizationStage</span><span class=o>(</span><span class=n>req</span> <span class=nc>Request</span><span class=o>)</span> <span class=o>{</span> <span class=o>...</span> <span class=o>}</span>
  <span class=kd>public</span> <span class=kt>void</span> <span class=nf>executeFinalizationStage</span><span class=o>(</span><span class=n>req</span> <span class=nc>Request</span><span class=o>)</span> <span class=o>{</span> <span class=o>...</span> <span class=o>}</span>
  <span class=kd>public</span> <span class=kt>void</span> <span class=nf>handleError</span><span class=o>(</span><span class=n>req</span> <span class=nc>Request</span><span class=o>)</span> <span class=o>{</span> <span class=o>...</span> <span class=o>}</span>
<span class=o>}</span></code></pre></div></div><div class=paragraph><p>with at least the aforesaid <code>executeAuthenticationStage</code> method being implemented, as this is also required for the regular rule.</p></div><div class=paragraph><p>On the other hand, the definition of a regular, respectively upstream specific rule is then not a class deriving from the <code>BaseRule</code>, but from the <code>DefaultRule</code>. That way, upstream specific rules are only required, if the behavior of the default rule would not fit the given requirements of a particular service, respectively endpoint. So, if e.g. a rule requires only the authentication stage to be different from the default rule, you would only specify the required authentication mechanisms. That would result in something like shown in the snippet below.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=java><span class=kd>public</span> <span class=kd>class</span> <span class=nc>SpecificRule</span> <span class=kd>extends</span> <span class=nc>DefaultRule</span> <span class=o>{</span>
  <span class=kd>public</span> <span class=kt>void</span> <span class=nf>executeAuthenticationStage</span><span class=o>(</span><span class=n>req</span> <span class=nc>Request</span><span class=o>)</span> <span class=o>{</span> <span class=o>...</span> <span class=o>}</span>
<span class=o>}</span></code></pre></div></div><div class=paragraph><p>And if there is a need to have the authorization stage deviating from the default rule, you would only specify the required authorization and contextualization mechanisms, resulting in something like</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=java><span class=kd>public</span> <span class=kd>class</span> <span class=nc>SpecificRule</span> <span class=kd>extends</span> <span class=nc>DefaultRule</span> <span class=o>{</span>
  <span class=kd>public</span> <span class=kt>void</span> <span class=nf>executeAuthorizationStage</span><span class=o>(</span><span class=n>req</span> <span class=nc>Request</span><span class=o>)</span> <span class=o>{</span> <span class=o>...</span> <span class=o>}</span>
<span class=o>}</span></code></pre></div></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content>You cannot override a single mechanism of a particular stage. As soon as you define a single mechanism in a pipeline, belonging to the one or the other stage, the entire stage is overridden.</td></tr></tbody></table></div></div></div></linkable-headline-area></div><p class="text-end fst-italic fs-7 pb-3">Last updated on <span class=fw-bold>Feb 19, 2025</span></p><hr><div class="d-flex justify-content-between py-3"><a href=../../../docs/concepts/mechanisms/ class="fs-6 fw-bold text-dark link-secondary link-underline-opacity-0"><svg width="16" height="16" fill="currentcolor" class="bi bi-chevron-left" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M11.354 1.646a.5.5.0 010 .708L5.707 8l5.647 5.646a.5.5.0 01-.708.708l-6-6a.5.5.0 010-.708l6-6a.5.5.0 01.708.0z"/></svg>
Mechanisms
</a><a class="ms-auto fs-6 fw-bold text-dark link-secondary link-underline-opacity-0" href=../../../docs/concepts/provider/>Rule Provider<svg width="16" height="16" fill="currentcolor" class="bi bi-chevron-right" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4.646 1.646a.5.5.0 01.708.0l6 6a.5.5.0 010 .708l-6 6a.5.5.0 01-.708-.708L10.293 8 4.646 2.354a.5.5.0 010-.708z"/></svg></a></div></div></main></div><footer class="footer py-4 py-md-5 px-4 px-md-3 mt-3"><div class=container><div class=row><div class="col-lg-3 mb-3"><p class=fs-5>Heimdall</p><ul class="list-unstyled small text-muted"><li class=mb-2>2022-2024 © Heimdall Project Authors. All rights reserved.</li><li class=mb-2><a href=https://github.com/dadrus/heimdall/blob/master/LICENSE>Apache 2.0 licensed</a></li></ul></div><div class="col-6 col-lg-2 offset-lg-1 mb-3"><h5>Links</h5><ul class=list-unstyled><li class=mb-2><a href=../../../>Home</a></li><li class=mb-2><a href=../../../docs/getting_started/discover_heimdall>Docs</a></li><li class=mb-2><a href=../../../guides/>Guides</a></li><li class=mb-2><a href=../../../openapi/>API</a></li></ul></div><div class="col-6 col-lg-2 mb-2"><h5>Guides</h5><ul class=list-unstyled><li class=mb-2><a href=../../../guides/proxies/>API Gateways & Proxies</a></li><li class=mb-2><a href=../../../guides/authz/>Authorization Services</a></li><li class=mb-2><a href=../../../guides/authn/>Authentication Protocols & Services</a></li></ul></div><div class="col-6 col-lg-2 mb-2"><h5>Community</h5><ul class=list-unstyled><li class=mb-2><a href=https://github.com/dadrus/heimdall>Github</a></li><li class=mb-2><a href=https://discord.gg/qQgg8xKuyb>Discord</a></li></ul></div></div></div></footer><script src=../../../js/main.js defer></script></body></html>