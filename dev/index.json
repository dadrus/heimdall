[{"categories":null,"content":" What is heimdall? Heimdall is a cloud native identity aware proxy and access control decision service inspired by the Zero Trust idea. It brings together authentication and authorization systems and can be thought as an orchestrator for these in front of your services, allowing however completely retaining control even without the need for any type of maintenance in your own code.\nYou can use it\nintegrated into available proxies and API gateways, allowing implementation of Edge-level Authorization Architectures, or\nstand alone as an authentication \u0026amp; authorization proxy\nBoth approaches can help you scaling and securing you services by transparently adding security capabilities and secure defaults related to authentication and authorization.\nIf you want to know more about Edge-level Authorization Architecture, the Blog post from Netflix is a highly recommended read Typical challenges A typical (monolithic) system, or named it service, has not only to deal with the actual business logic, but also with authentication and authorization requirements (among other non-functional requirements) as depicted in the figure below.\nFigure 1. A typical monolithic system What do we have here?\nTo cover authentication requirements, that service will make use of some identity management system to verify the request authentication status.\nThe existing authorization requirements will most probably result in if else statements in code. Even such approaches are straight forward and easy to implement on the first sight, these are not easy to maintain and have many drawbacks (e.g. testing of particular use cases), and it becomes even more challenging when entering microservices.\nHow does it look then if we have microservices?\nNot every microservice will hold the entire information required for authorization purposes.\nSo, there will be a need to communicate to other services to get the required contextual information about the authenticated subject to be able to take the required authorization decision.\nThe management and maintenance of the authorization requirements will become even more challenging, as the implementation of these will usually be scattered across many services.\nTo overcome these dependencies, organizations either start pushing that contextual information into the identity management system, making it a god system with all resulting negative effects, or start using special purpose authorization systems, allowing managing the corresponding authorization policies outside the code.\nEven that approach reduces dependencies between the services and also the time to market, it introduces a new dependency, which all, or almost all services must make use of. And, most probably, the authorization system will also need to somehow retrieve contextual information for authorization policy evaluation purposes.\nAnd we just started to scratch the top of the iceberg. What if our system, comprised from these microservices is implemented in different languages? Even there are many libraries and also frameworks addressing authentication challenges, usually we just want to make the lives of our developers easier by providing components, which work the same way for each and every language. So the setup depicted above, well become similar to the one depicted below.\nFigure 2. Typical microservice deployment scenario Here, a new authentication proxy, typically deployed as a sidecar with each microservice (sometimes also as a central proxy), is introduced taking over the responsibility for the existing authentication challenges and unifying the corresponding implementation. But there are still many drawbacks and limitations, like those addressed by the following questions\nWhat if there is a need to have multiple identity management systems, e.g. one for the customers and one for accessing administrative or backoffice related functionality of the system?\nWhat if there is a need to migrate from one authentication or authorization system to another?\nWhat if there is a need to open the existing APIs?\nWhat if there is a need to support multiple different clients, like browsers, like mobile apps, IoT devices, etc?\nWhat if the business decides to change the existing authorization requirements, like introduction of a new subscription model, or alike, which would require additional information about our user, resulting in yet another dependency to some further service?\nWhat if depending on the client, we need completely different authentication strategies or even protocols, like OAuth2 or OpenID Connect in one case, mTLS in another case and cookie based approach and yet another case?\nHow to ensure, that our microservice code does not implement shortcuts and thus does not compromise the security of the entire system? (And there are diverse options achieving that)\n…​\nThis is by far not an exhaustive list. But the main question related to it is what does all of that mean in sense of coordination-, implementation efforts and time-to-market?\nHeimdall to the Rescue This is exactly where heimdall can step in and help you to address these challenges, reduce the complexity of your code, free resources, increase your time to market and make your system more secure.\nIf you let heimdall care about most of the existing authentication and authorization challenges, our new setup would then look as depicted below.\nFigure 3. Heimdall based deployment scenario This way you let heimdall orchestrate existing authentication and authorization systems and also provide the information about the authenticated and authorized subjects to your microservice in a unified format completely independent of the used authentication strategy or protocol.\nThere is however still the need to perform some type of authorization logic in your microservice code. Especially if we talk about read requests (most probably you want to provide different representation of the requested resource based on the authorization status). But it is much simpler, and it gives you much more freedom compared to all previous approaches.\nBTW, you don’t necessary need to replace proxies, gateways, ingress controller, or alike currently in place in your infrastructure with heimdall. You can easily integrate heimdall with them to achieve the functionality depicted above.\nHow it works Heimdall intercepts all your application related HTTP(s) traffic, allowing a broad set of identity and application aware authentication and authorization features based on the rules you specify and deploy together with your particular service. These rules let heimdall route each request through a service or even endpoint specific authentication and authorization pipeline as depicted in diagram below.\nFigure 4. Authentication \u0026amp; Authorization Pipeline This pipeline ensures that, according to the needs of the particular backend service endpoint,\neach request is authenticated (so, you know who the subject of the request is) by making use of the available identity management systems,\nthe required contextual information about the subject is available (like e.g. current location based on IP, roles or groups membership information, etc.) by retrieving it from any possible API, so that\nthe subject can be and is authorized by your authorization system, or even directly by heimdall and\nthe information about the subject is transformed into a format, required by the backend service. So that despite the used authentication or authorization system or protocol, the subject information is always provided in the same stable representation to your microservice.\nNext Steps Take a look and experiment\nThe Protect an Application chapter describes two setups, allowing getting your hands \u0026#34;dirty\u0026#34; and familiarizing with the concepts implemented by heimdall.\nJoin the community\nChat interactively in our Discord and ask your questions :)\nLearn the concepts\nThere is an entire section which describes the concepts, users should understand. Start with Pipelines, which deals with the \u0026#34;Client Request Journey\u0026#34; depicted above in great detail and work you through until the Operating Modes, which will reveal you the possible integration options.\nCheck the guides\nMany guides have been written to support you in you endeavour with heimdall, including working examples, which you can find on GitHub. There are also many examples in particular chapters.\nImplement your requirements and bring heimdall to production\nInstall heimdall into your \u0026#34;playground\u0026#34; environment, implement rules by making use of mechanisms reflecting your requirements, secure your setup and bring it to production.\n","description":"This page gives an overview about heimdall, the challenges it addresses and how it does so. In addition, you can find some recommendations on where to look next.","html_content":"\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_what_is_heimdall\"\u003eWhat is heimdall?\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eHeimdall is a cloud native identity aware proxy and access control decision service inspired by the Zero Trust idea. It brings together authentication and authorization systems and can be thought as an orchestrator for these in front of your services, allowing however completely retaining control even without the need for any type of maintenance in your own code.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eYou can use it\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eintegrated into available proxies and API gateways, allowing implementation of Edge-level Authorization Architectures, or\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003estand alone as an authentication \u0026amp; authorization proxy\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eBoth approaches can help you scaling and securing you services by transparently adding security capabilities and secure defaults related to authentication and authorization.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"admonitionblock note\"\u003e\n\u003ctable\u003e\n\u003ctbody\u003e\u003ctr\u003e\n\u003ctd class=\"icon\"\u003e\n\u003ci class=\"fa icon-note\" title=\"Note\"\u003e\u003c/i\u003e\n\u003c/td\u003e\n\u003ctd class=\"content\"\u003e\nIf you want to know more about Edge-level Authorization Architecture, the \u003ca href=\"https://netflixtechblog.com/edge-authentication-and-token-agnostic-identity-propagation-514e47e0b602\"\u003eBlog post\u003c/a\u003e from Netflix is a highly recommended read\n\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_typical_challenges\"\u003eTypical challenges\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eA typical (monolithic) system, or named it service, has not only to deal with the actual business logic, but also with authentication and authorization requirements (among other non-functional requirements) as depicted in the figure below.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"imageblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cimg src=\"diag-ditaa-md5-d2f5c648e6dd3a2376f4fc340284540c.svg\" alt=\"Diagram\" width=\"920\" height=\"518\"/\u003e\n\u003c/div\u003e\n\u003cdiv class=\"title\"\u003eFigure 1. A typical monolithic system\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eWhat do we have here?\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eTo cover authentication requirements, that service will make use of some identity management system to verify the request authentication status.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eThe existing authorization requirements will most probably result in if else statements in code. Even such approaches are straight forward and easy to implement on the first sight, these are not easy to maintain and have many drawbacks (e.g. testing of particular use cases), and it becomes even more challenging when entering microservices.\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eHow does it look then if we have microservices?\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eNot every microservice will hold the entire information required for authorization purposes.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eSo, there will be a need to communicate to other services to get the required contextual information about the authenticated subject to be able to take the required authorization decision.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eThe management and maintenance of the authorization requirements will become even more challenging, as the implementation of these will usually be scattered across many services.\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eTo overcome these dependencies, organizations either start pushing that contextual information into the identity management system, making it a god system with all resulting negative effects, or start using special purpose authorization systems, allowing managing the corresponding authorization policies outside the code.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eEven that approach reduces dependencies between the services and also the time to market, it introduces a new dependency, which all, or almost all services must make use of. And, most probably, the authorization system will also need to somehow retrieve contextual information for authorization policy evaluation purposes.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eAnd we just started to scratch the top of the iceberg. What if our system, comprised from these microservices is implemented in different languages? Even there are many libraries and also frameworks addressing authentication challenges, usually we just want to make the lives of our developers easier by providing components, which work the same way for each and every language. So the setup depicted above, well become similar to the one depicted below.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv id=\"_fig_typical_deployment_scenario\" class=\"imageblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cimg src=\"diag-ditaa-md5-2ad275416d51525f3aa30125819e84af.svg\" alt=\"Diagram\" width=\"1150\" height=\"518\"/\u003e\n\u003c/div\u003e\n\u003cdiv class=\"title\"\u003eFigure 2. Typical microservice deployment scenario\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eHere, a new authentication proxy, typically deployed as a sidecar with each microservice (sometimes also as a central proxy), is introduced taking over the responsibility for the existing authentication challenges and unifying the corresponding implementation. But there are still many drawbacks and limitations, like those addressed by the following questions\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eWhat if there is a need to have multiple identity management systems, e.g. one for the customers and one for accessing administrative or backoffice related functionality of the system?\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eWhat if there is a need to migrate from one authentication or authorization system to another?\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eWhat if there is a need to open the existing APIs?\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eWhat if there is a need to support multiple different clients, like browsers, like mobile apps, IoT devices, etc?\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eWhat if the business decides to change the existing authorization requirements, like introduction of a new subscription model, or alike, which would require additional information about our user, resulting in yet another dependency to some further service?\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eWhat if depending on the client, we need completely different authentication strategies or even protocols, like OAuth2 or OpenID Connect in one case, mTLS in another case and cookie based approach and yet another case?\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eHow to ensure, that our microservice code does not implement shortcuts and thus does not compromise the security of the entire system? (And there are diverse options achieving that)\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e…​\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThis is by far not an exhaustive list. But the main question related to it is what does all of that mean in sense of coordination-, implementation efforts and time-to-market?\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_heimdall_to_the_rescue\"\u003eHeimdall to the Rescue\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThis is exactly where heimdall can step in and help you to address these challenges, reduce the complexity of your code, free resources, increase your time to market and make your system more secure.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eIf you let heimdall care about most of the existing authentication and authorization challenges, our new setup would then look as depicted below.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"imageblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cimg src=\"diag-ditaa-md5-3bcdc8fa896af7ae13650b8d7e6cf707.svg\" alt=\"Diagram\" width=\"890\" height=\"532\"/\u003e\n\u003c/div\u003e\n\u003cdiv class=\"title\"\u003eFigure 3. Heimdall based deployment scenario\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThis way you let heimdall orchestrate existing authentication and authorization systems and also provide the information about the authenticated and authorized subjects to your microservice in a unified format completely independent of the used authentication strategy or protocol.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThere is however still the need to perform some type of authorization logic in your microservice code. Especially if we talk about read requests (most probably you want to provide different representation of the requested resource based on the authorization status). But it is much simpler, and it gives you much more freedom compared to all previous approaches.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eBTW, you don’t necessary need to replace proxies, gateways, ingress controller, or alike currently in place in your infrastructure with heimdall. You can easily integrate heimdall with them to achieve the functionality depicted above.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_how_it_works\"\u003eHow it works\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eHeimdall intercepts all your application related HTTP(s) traffic, allowing a broad set of identity and application aware authentication and authorization features based on the rules you specify and deploy together with your particular service. These rules let heimdall route each request through a service or even endpoint specific authentication and authorization pipeline as depicted in diagram below.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv id=\"_fig_heimdall_request_pipeline\" class=\"imageblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cimg src=\"diag-ditaa-md5-92616c018b7cc4e879c86947d2cf5d7c.svg\" alt=\"Diagram\" width=\"1290\" height=\"294\"/\u003e\n\u003c/div\u003e\n\u003cdiv class=\"title\"\u003eFigure 4. Authentication \u0026amp; Authorization Pipeline\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThis pipeline ensures that, according to the needs of the particular backend service endpoint,\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"olist arabic\"\u003e\n\u003col class=\"arabic\"\u003e\n\u003cli\u003e\n\u003cp\u003eeach request is authenticated (so, you know who the subject of the request is) by making use of the available identity management systems,\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003ethe required contextual information about the subject is available (like e.g. current location based on IP, roles or groups membership information, etc.) by retrieving it from any possible API, so that\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003ethe subject can be and is authorized by your authorization system, or even directly by heimdall and\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003ethe information about the subject is transformed into a format, required by the backend service. So that despite the used authentication or authorization system or protocol, the subject information is always provided in the same stable representation to your microservice.\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_next_steps\"\u003eNext Steps\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eTake a look and experiment\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe \u003ca href=\"/docs/getting_started/protect_an_app/\"\u003eProtect an Application\u003c/a\u003e chapter describes two setups, allowing getting your hands \u0026#34;dirty\u0026#34; and familiarizing with the concepts implemented by heimdall.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eJoin the community\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eChat interactively in our \u003ca href=\"https://discord.gg/qQgg8xKuyb\"\u003eDiscord\u003c/a\u003e and ask your questions :)\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eLearn the concepts\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThere is an entire section which describes the concepts, users should understand. Start with \u003ca href=\"/docs/concepts/pipelines/\"\u003ePipelines\u003c/a\u003e, which deals with the \u0026#34;Client Request Journey\u0026#34; depicted above in great detail and work you through until the \u003ca href=\"/docs/concepts/operating_modes/\"\u003eOperating Modes\u003c/a\u003e, which will reveal you the possible integration options.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eCheck the guides\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eMany \u003ca href=\"/guides/\"\u003eguides\u003c/a\u003e have been written to support you in you endeavour with heimdall, including working examples, which you can find on \u003ca href=\"https://github.com/dadrus/heimdall/tree/main/examples\"\u003eGitHub\u003c/a\u003e. There are also many examples in particular chapters.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eImplement your requirements and bring heimdall to production\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e\u003ca href=\"/docs/getting_started/installation/\"\u003eInstall\u003c/a\u003e heimdall into your \u0026#34;playground\u0026#34; environment, implement \u003ca href=\"/docs/rules/regular_rule/\"\u003erules\u003c/a\u003e by making use of \u003ca href=\"/docs/mechanisms/catalogue/\"\u003emechanisms\u003c/a\u003e reflecting your requirements, \u003ca href=\"/docs/operations/security/\"\u003esecure\u003c/a\u003e your setup and bring it to production.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n","sections":["Getting Started"],"tags":null,"title":"Discover heimdall","url":"/docs/getting_started/discover_heimdall/"},{"categories":null,"content":" Source Code You can always build a copy of heimdall by following the following instructions for your OS/environment.\nPrerequisites git\nThe Go programming language \u0026gt;= 1.25\nDownload Retrieve the latest copy of heimdall source code by cloning the git repository\n$ git clone git@github.com:dadrus/heimdall.git Build with go Build using a single line with go build\n$ CGO_ENABLED=0 go build -trimpath -ldflags=\u0026#34;-buildid= -w -s -X github.com/dadrus/heimdall/version.Version==my-custom-build\u0026#34; The flags are set by intention. Using -trimpath and -buildid= as part of the -ldflags argument ensures the build is reproducible (See also Reproducible Builds). Other flags remove unused symbols and debug information.\nBinary Prebuild binaries are available with every released version on GitHub, as well as for every merged PR to the main branch. The version of the latter is set to the git SHA1. Supported operating systems/architectures are:\ndarwin/amd64\ndarwin/arm64\nlinux/amd64\nlinux/arm64\nlinux/armv6\nlinux/armv7\nwindows/amd64\nFor Linux and Darwin the binaries are archived with tar.gz and for Windows with zip. All archives are signed (see also Verifying Heimdall Binaries and Container Images section on how to verify the signatures).\nDownload Retrieve the desired released version of heimdall binary for your operating system/architecture\nARCH=[your arch] OS=[your os] VERSION=[desired version] curl -L https://github.com/dadrus/heimdall/releases/download/${VERSION}/heimdall-${VERSION}-${OS}-${ARCH}.tar.gz \\ | tar -z -x Container Image Heimdall utilizes a minimal container multi-arch image which you can find on DockerHub, or on GHCR. As with Binary releases, heimdall can be pulled in several flavors. These are however currently limited to the Linux OS. Supported architectures are:\namd64\narm64\narm/v7\nAll container images are rootless - so heimdall will always run as a non-root user within the container. Since Heimdall does not have any dependencies, the images are distroless as well and contain only the binary of heimdall and the settings related to the OS user and group permissions, heimdall is running with.\nAs with the binary distribution, all container images are signed (see also Verifying Heimdall Binaries and Container Images section on how to verify the signatures).\nPrerequisites Docker, Podman, or other container runtime of your choice (examples are however using docker).\nPull Image The steps below will pull the images from DockerHub. If you want to pull them from GHCR, specify the ghcr.io registry in front of the repository.\nFollowing tag patterns exist:\nx.y.z[-\u0026lt;prerelease-identifier\u0026gt;] - will pull a specific tagged release.\n$ docker pull dadrus/heimdall:0.13.0-alpha \u0026amp;\u0026amp; docker run dadrus/heimdall:0.13.0-alpha --version heimdall version v0.13.0-alpha latest - will pull the most recent tagged release.\n$ docker pull dadrus/heimdall:latest \u0026amp;\u0026amp; docker run dadrus/heimdall:latest --version heimdall version v0.13.0-alpha Helm Chart Heimdall can be installed via a Helm chart with a few simple steps, depending on if you are deploying for the first time, or upgrading from an existing installation.\nPrerequisites A Kubernetes version \u0026gt;= 1.19 or \u0026gt;= 1.23 if you would like to use HPA\nHelm 3.0+\nAdding the Helm Repository The heimdall Helm Chart is published at https://dadrus.github.io/heimdall/charts. You can add this repo with the following command:\n$ helm repo add dadrus https://dadrus.github.io/heimdall/charts $ helm repo update Installing the Chart This chart expects a heimdall configuration file with authentication, authorization and so on mechanisms, required for your particular setup, which can be passed by using the -f heimdall.yaml flag during the installation.\nIf you need to override the name of the heimdall resources such as the deployment or services, the traditional nameOverride and fullnameOverride properties are supported.\nBy default, heimdall requires custom resource definitions (CRDs) installed in the cluster. The Helm client will install it for you.\nTo install the chart with the release name my-release (my-release is the name that you choose) and configure heimdall to operate in decision mode:\n$ helm install my-release -f heimdall.yaml dadrus/heimdall If you need proxy mode, install it with:\n$ helm install my-release -f heimdall.yaml --set operationMode=proxy dadrus/heimdall For more advanced configuration and details about helm values, please see the helm chart.\nPost-Install Steps Integration with Ingress After having installed heimdall, you have to integrate it with your ingress controller. For decision mode that means setting corresponding annotations on Ingress resources to let the traffic first be verified by heimdall before it is forwarded to the upstream services by the Ingress Controller.\nMetrics Collection Since heimdall is able to exposes a comprehensive set of Prometheus style metrics (See Metrics for details), you can, assuming you are running a Prometheus Operator in your cluster, create the following PodMonitor resource to enable metrics collection.\napiVersion: monitoring.coreos.com/v1 kind: PodMonitor metadata: name: heimdall-pod-monitor labels: release: prometheus app.kubernetes.io/instance: my-release app.kubernetes.io/name: heimdall app.kubernetes.io/part-of: heimdall spec: selector: matchLabels: app.kubernetes.io/instance: my-release app.kubernetes.io/name: heimdall podMetricsEndpoints: - path: /metrics port: http-metrics scheme: http interval: 30s jobLabel: heimdall-pod-monitor namespaceSelector: matchNames: - default The definition of the PodMonitor above assumes, you’ve installed heimdall in the default namespace as shown in the Installing the Chart section. If this is not the case, you need to adjust the metadata property by adding the corresponding namespace information, as well as the namespaceSelector.\nIf your Prometheus deployment is not done through the operator, you don’t need to do anything, as the chart already sets the relevant annotations: prometheus.io/scrape, prometheus.io/path and prometheus.io/port.\n","description":"Heimdall is shipped in multiple formats and architectures to suit a variety of deployment patterns. The following chapters describe the available installation options.","html_content":"\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_source_code\"\u003eSource Code\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eYou can always build a copy of heimdall by following the following instructions for your OS/environment.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_prerequisites\"\u003ePrerequisites\u003c/h3\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ca href=\"https://git-scm.com/\"\u003egit\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eThe \u003ca href=\"https://go.dev/dl/\"\u003eGo\u003c/a\u003e programming language \u0026gt;= 1.25\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_download\"\u003eDownload\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eRetrieve the latest copy of heimdall source code by cloning the git repository\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"bash\"\u003e\u003cspan class=\"nv\"\u003e$ \u003c/span\u003egit clone git@github.com:dadrus/heimdall.git\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_build_with_go\"\u003eBuild with go\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eBuild using a single line with \u003ccode\u003ego build\u003c/code\u003e\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"bash\"\u003e\u003cspan class=\"nv\"\u003e$ CGO_ENABLED\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e0 go build \u003cspan class=\"nt\"\u003e-trimpath\u003c/span\u003e \u003cspan class=\"nt\"\u003e-ldflags\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;-buildid= -w -s -X github.com/dadrus/heimdall/version.Version==my-custom-build\u0026#34;\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe flags are set by intention. Using \u003ccode\u003e-trimpath\u003c/code\u003e and \u003ccode\u003e-buildid=\u003c/code\u003e as part of the \u003ccode\u003e-ldflags\u003c/code\u003e argument ensures the build is reproducible (See also \u003ca href=\"https://reproducible-builds.org/\"\u003eReproducible Builds\u003c/a\u003e). Other flags remove unused symbols and debug information.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_binary\"\u003eBinary\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003ePrebuild binaries are available with every released version on \u003ca href=\"https://github.com/dadrus/heimdall/releases/latest\"\u003eGitHub\u003c/a\u003e, as well as for every merged PR to the main branch. The version of the latter is set to the git SHA1. Supported operating systems/architectures are:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003edarwin/amd64\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003edarwin/arm64\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003elinux/amd64\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003elinux/arm64\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003elinux/armv6\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003elinux/armv7\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003ewindows/amd64\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eFor Linux and Darwin the binaries are archived with tar.gz and for Windows with zip. All archives are signed (see also \u003ca href=\"/docs/operations/security/#_verifying_heimdall_binaries_and_container_images\"\u003eVerifying Heimdall Binaries and Container Images\u003c/a\u003e section on how to verify the signatures).\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_download_2\"\u003eDownload\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eRetrieve the desired released version of heimdall binary for your operating system/architecture\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"bash\"\u003e\u003cspan class=\"nv\"\u003eARCH\u003c/span\u003e\u003cspan class=\"o\"\u003e=[\u003c/span\u003eyour \u003cspan class=\"nb\"\u003earch\u003c/span\u003e\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n\u003cspan class=\"nv\"\u003eOS\u003c/span\u003e\u003cspan class=\"o\"\u003e=[\u003c/span\u003eyour os]\n\u003cspan class=\"nv\"\u003eVERSION\u003c/span\u003e\u003cspan class=\"o\"\u003e=[\u003c/span\u003edesired version]\ncurl \u003cspan class=\"nt\"\u003e-L\u003c/span\u003e https://github.com/dadrus/heimdall/releases/download/\u003cspan class=\"k\"\u003e${\u003c/span\u003e\u003cspan class=\"nv\"\u003eVERSION\u003c/span\u003e\u003cspan class=\"k\"\u003e}\u003c/span\u003e/heimdall-\u003cspan class=\"k\"\u003e${\u003c/span\u003e\u003cspan class=\"nv\"\u003eVERSION\u003c/span\u003e\u003cspan class=\"k\"\u003e}\u003c/span\u003e-\u003cspan class=\"k\"\u003e${\u003c/span\u003e\u003cspan class=\"nv\"\u003eOS\u003c/span\u003e\u003cspan class=\"k\"\u003e}\u003c/span\u003e-\u003cspan class=\"k\"\u003e${\u003c/span\u003e\u003cspan class=\"nv\"\u003eARCH\u003c/span\u003e\u003cspan class=\"k\"\u003e}\u003c/span\u003e.tar.gz \u003cspan class=\"se\"\u003e\\\u003c/span\u003e\n    | \u003cspan class=\"nb\"\u003etar\u003c/span\u003e \u003cspan class=\"nt\"\u003e-z\u003c/span\u003e \u003cspan class=\"nt\"\u003e-x\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_container_image\"\u003eContainer Image\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eHeimdall utilizes a minimal container multi-arch image which you can find on \u003ca href=\"https://hub.docker.com/r/dadrus/heimdall\"\u003eDockerHub\u003c/a\u003e, or on \u003ca href=\"https://github.com/users/dadrus/packages?repo_name=heimdall\"\u003eGHCR\u003c/a\u003e. As with \u003ca href=\"#_binary\"\u003eBinary\u003c/a\u003e releases, heimdall can be pulled in several flavors. These are however currently limited to the Linux OS. Supported architectures are:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003eamd64\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003earm64\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003earm/v7\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eAll container images are rootless - so heimdall will always run as a non-root user within the container. Since Heimdall does not have any dependencies, the images are distroless as well and contain only the binary of heimdall and the settings related to the OS user and group permissions, heimdall is running with.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eAs with the binary distribution, all container images are signed (see also \u003ca href=\"/docs/operations/security/#_verifying_heimdall_binaries_and_container_images\"\u003eVerifying Heimdall Binaries and Container Images\u003c/a\u003e section on how to verify the signatures).\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_prerequisites_2\"\u003ePrerequisites\u003c/h3\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ca href=\"https://docs.docker.com/install/\"\u003eDocker\u003c/a\u003e, \u003ca href=\"https://podman.io/\"\u003ePodman\u003c/a\u003e, or other container runtime of your choice (examples are however using docker).\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_pull_image\"\u003ePull Image\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe steps below will pull the images from \u003ca href=\"https://hub.docker.com/r/dadrus/heimdall\"\u003eDockerHub\u003c/a\u003e. If you want to pull them from \u003ca href=\"https://github.com/users/dadrus/packages?repo_name=heimdall\"\u003eGHCR\u003c/a\u003e, specify the \u003ccode\u003eghcr.io\u003c/code\u003e registry in front of the repository.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eFollowing tag patterns exist:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003ex.y.z[-\u0026lt;prerelease-identifier\u0026gt;]\u003c/code\u003e - will pull a specific tagged release.\u003c/p\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"bash\"\u003e\u003cspan class=\"nv\"\u003e$ \u003c/span\u003edocker pull dadrus/heimdall:0.13.0-alpha \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e docker run dadrus/heimdall:0.13.0-alpha \u003cspan class=\"nt\"\u003e--version\u003c/span\u003e\nheimdall version v0.13.0-alpha\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003elatest\u003c/code\u003e - will pull the most recent tagged release.\u003c/p\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"bash\"\u003e\u003cspan class=\"nv\"\u003e$ \u003c/span\u003edocker pull dadrus/heimdall:latest \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e docker run dadrus/heimdall:latest \u003cspan class=\"nt\"\u003e--version\u003c/span\u003e\nheimdall version v0.13.0-alpha\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_helm_chart\"\u003eHelm Chart\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eHeimdall can be installed via a Helm chart with a few simple steps, depending on if you are deploying for the first time, or upgrading from an existing installation.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_prerequisites_3\"\u003ePrerequisites\u003c/h3\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eA Kubernetes version \u0026gt;= 1.19 or \u0026gt;= 1.23 if you would like to use HPA\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ca href=\"https://helm.sh/docs/intro/install/\"\u003eHelm\u003c/a\u003e 3.0+\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_adding_the_helm_repository\"\u003eAdding the Helm Repository\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe heimdall Helm Chart is published at \u003ccode\u003ehttps://dadrus.github.io/heimdall/charts\u003c/code\u003e. You can add this repo with the following command:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"bash\"\u003e\u003cspan class=\"nv\"\u003e$ \u003c/span\u003ehelm repo add dadrus https://dadrus.github.io/heimdall/charts\n\u003cspan class=\"nv\"\u003e$ \u003c/span\u003ehelm repo update\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_installing_the_chart\"\u003eInstalling the Chart\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThis chart expects a \u003ca href=\"/docs/operations/configuration/#_configuration_file\"\u003eheimdall configuration file\u003c/a\u003e with authentication, authorization and so on mechanisms, required for your particular setup, which can be passed by using the \u003ccode\u003e-f heimdall.yaml\u003c/code\u003e flag during the installation.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eIf you need to override the name of the heimdall resources such as the deployment or services, the traditional \u003ccode\u003enameOverride\u003c/code\u003e and \u003ccode\u003efullnameOverride\u003c/code\u003e properties are supported.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eBy default, heimdall requires custom resource definitions (CRDs) installed in the cluster. The Helm client will install it for you.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eTo install the chart with the release name \u003ccode\u003emy-release\u003c/code\u003e (\u003ccode\u003emy-release\u003c/code\u003e is the name that you choose) and configure heimdall to operate in decision mode:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"bash\"\u003e\u003cspan class=\"nv\"\u003e$ \u003c/span\u003ehelm \u003cspan class=\"nb\"\u003einstall \u003c/span\u003emy-release \u003cspan class=\"nt\"\u003e-f\u003c/span\u003e heimdall.yaml dadrus/heimdall\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eIf you need proxy mode, install it with:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"bash\"\u003e\u003cspan class=\"nv\"\u003e$ \u003c/span\u003ehelm \u003cspan class=\"nb\"\u003einstall \u003c/span\u003emy-release \u003cspan class=\"nt\"\u003e-f\u003c/span\u003e heimdall.yaml \u003cspan class=\"nt\"\u003e--set\u003c/span\u003e \u003cspan class=\"nv\"\u003eoperationMode\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eproxy dadrus/heimdall\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eFor more advanced configuration and details about helm values, \u003ca href=\"https://github.com/dadrus/heimdall/tree/main/charts/heimdall\"\u003eplease see the helm chart\u003c/a\u003e.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_post_install_steps\"\u003ePost-Install Steps\u003c/h3\u003e\n\u003cdiv class=\"sect3\"\u003e\n\u003ch4 id=\"_integration_with_ingress\"\u003eIntegration with Ingress\u003c/h4\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eAfter having installed heimdall, you have to integrate it with your ingress controller. For decision mode that means setting corresponding annotations on Ingress resources to let the traffic first be verified by heimdall before it is forwarded to the upstream services by the Ingress Controller.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect3\"\u003e\n\u003ch4 id=\"_metrics_collection\"\u003eMetrics Collection\u003c/h4\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eSince heimdall is able to exposes a comprehensive set of Prometheus style metrics (See \u003ca href=\"/docs/operations/observability/#_metrics\"\u003eMetrics\u003c/a\u003e for details), you can, assuming you are running a \u003ca href=\"https://github.com/prometheus-operator/prometheus-operator\"\u003ePrometheus Operator\u003c/a\u003e in your cluster, create the following \u003ccode\u003ePodMonitor\u003c/code\u003e resource to enable metrics collection.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"yaml\"\u003e\u003cspan class=\"na\"\u003eapiVersion\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003emonitoring.coreos.com/v1\u003c/span\u003e\n\u003cspan class=\"na\"\u003ekind\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ePodMonitor\u003c/span\u003e\n\u003cspan class=\"na\"\u003emetadata\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"na\"\u003ename\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eheimdall-pod-monitor\u003c/span\u003e\n  \u003cspan class=\"na\"\u003elabels\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"na\"\u003erelease\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eprometheus\u003c/span\u003e\n    \u003cspan class=\"na\"\u003eapp.kubernetes.io/instance\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003emy-release\u003c/span\u003e\n    \u003cspan class=\"na\"\u003eapp.kubernetes.io/name\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eheimdall\u003c/span\u003e\n    \u003cspan class=\"na\"\u003eapp.kubernetes.io/part-of\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eheimdall\u003c/span\u003e\n\u003cspan class=\"na\"\u003espec\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eselector\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"na\"\u003ematchLabels\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"na\"\u003eapp.kubernetes.io/instance\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003emy-release\u003c/span\u003e\n      \u003cspan class=\"na\"\u003eapp.kubernetes.io/name\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eheimdall\u003c/span\u003e\n  \u003cspan class=\"na\"\u003epodMetricsEndpoints\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003epath\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e/metrics\u003c/span\u003e\n      \u003cspan class=\"na\"\u003eport\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ehttp-metrics\u003c/span\u003e\n      \u003cspan class=\"na\"\u003escheme\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ehttp\u003c/span\u003e\n      \u003cspan class=\"na\"\u003einterval\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e30s\u003c/span\u003e\n  \u003cspan class=\"na\"\u003ejobLabel\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eheimdall-pod-monitor\u003c/span\u003e\n  \u003cspan class=\"na\"\u003enamespaceSelector\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"na\"\u003ematchNames\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003edefault\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe definition of the \u003ccode\u003ePodMonitor\u003c/code\u003e above assumes, you’ve installed heimdall in the default namespace as shown in the \u003ca href=\"#_installing_the_chart\"\u003eInstalling the Chart\u003c/a\u003e section. If this is not the case, you need to adjust the \u003ccode\u003emetadata\u003c/code\u003e property by adding the corresponding \u003ccode\u003enamespace\u003c/code\u003e information, as well as the \u003ccode\u003enamespaceSelector\u003c/code\u003e.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eIf your Prometheus deployment is not done through the operator, you don’t need to do anything, as the chart already sets the relevant annotations: \u003ccode\u003eprometheus.io/scrape\u003c/code\u003e, \u003ccode\u003eprometheus.io/path\u003c/code\u003e and \u003ccode\u003eprometheus.io/port\u003c/code\u003e.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n","sections":["Getting Started"],"tags":null,"title":"Install heimdall","url":"/docs/getting_started/installation/"},{"categories":null,"content":" Overview In this guide we’re going to configure two setups, both protecting a service which exposes a couple of endpoints:\nThe /public endpoint is as the name implies public. Every request to it should be forwarded as is.\nThe /user endpoint should only be accessible to users with the role user.\nThe /admin endpoint should only be accessible to users with the role admin and\nthe /private endpoint, as well as any other potentially exposed endpoint should not be accessible at all. So all requests should be rejected.\nFor authentication purposes, we’re going to use JWTs, containing the respective role. The authorization will happen with the help of Open Policy Agent (OPA).\nIn both setups, we’re going to create minimal but complete environments using docker compose with\ntraefik as an edge proxy,\ncontainous/whoami (that service just echoes back everything it receives) which mimics our service exposing the abovesaid endpoints,\nan NGINX server serving the public key for the verification purposes of the JWTs mentioned above (it just mimics the JWKS endpoint typically exposed by an OIDC provider),\nOPA, which evaluates the above said authorization policy and\nheimdall, orchestrating everything to implement the above said requirements.\nThis and similar quickstarts, demonstrating other (integration) options are also available on GitHub. Prerequisites To be able to follow this guide, you’ll need the following tools installed locally:\nDocker,\ndocker-compose, and\na text editor of your choice.\nConfigure Heimdall can be configured via environment variables, as well as using a configuration file. For simplicity reasons, we’ll use a configuration file here. So create a config file named heimdall-config.yaml with the following contents:\nlog: (1) level: debug tracing: enabled: false metrics: enabled: false serve: (2) decision: trusted_proxies: - 0.0.0.0/0 mechanisms: (3) authenticators: - id: deny_all (4) type: unauthorized - id: anon (5) type: anonymous - id: jwt_auth (6) type: jwt config: jwks_endpoint: http://idp:8080/.well-known/jwks assertions: issuers: - demo_issuer authorizers: - id: opa (7) type: remote config: endpoint: http://opa:8181/v1/data/{{ .Values.policy }} payload: \u0026#34;{}\u0026#34; expressions: - expression: | Payload.result == true finalizers: - id: create_jwt (8) type: jwt - id: noop (9) type: noop default_rule: (10) methods: - GET - POST execute: - authenticator: deny_all - finalizer: create_jwt providers: file_system: (11) src: /etc/heimdall/rules.yaml watch: true 1 Since heimdall emits logs on error level by default, and we would like to see what is going on, we are setting the log level to debug. This way, we’ll see not only the results of a particular rule execution (which is what you would see if we set the log level to info), but also what is going in a rule. In addition, we disable tracing and metrics collection as these are pulled by default to an OTEL agent to avoid error statements related to unavailability of the agent. You can find more information about available observability options in the Observability chapter. 2 This configuration instructs heimdall to trust X-Forwarded-* headers from any sources. We need it here for integration purposes with Traefik, which uses these headers while forwarding requests to heimdall and which IP depends on your local docker configuration. Never do this in production and use allowed IPs instead! Please take also a look at the documentation of trusted_proxies property and Security Considerations for more details. 3 Here we define our catalogue of mechanisms to be used in upstream service specific rules. In this case we define authenticators, authorizer and finalizers 4 These two lines define the unauthorized authenticator named deny_all. It rejects all requests. 5 These two lines define the anonymous authenticator named anon. It allows any request passing through and creates a subject with ID set to anonymous. You can find more information about the subject and other objects here. 6 This and the following lines define and configure the jwt authenticator named jwt_auth. With the given configuration it will check whether a request contains an Authorization header with a bearer token in JWT format and validate it using key material fetched from the JWKS endpoint. It will reject all requests without a valid JWT or create a subject with ID set to the value of the sub claim from the token and add also add all claims as key-value map to subject’s Attribute property. 7 Here we define and configure a remote authorizer named opa. Please note, how we allow overriding of particular settings, which application you’ll find below, when we define the rules. 8 The following two lines define the jwt finalizer. Without any configuration, as used here, it will create a jwt out of the subject object with standard claims and set the sub claim to the value of subject’s ID. The key material used for signature creation purpose will be generated on start up. This is fine for our demo purpose. For real scenarios you should definitely define it. 9 These two lines conclude the definition of our mechanisms catalogue and define the noop finalizer, which as the type implies, does nothing. 10 With the above catalogue in place, we can now define a default rule, which will kick in if no other rule matches the request. In addition, it acts as a base for the definition of regular (upstream service specific) rules. In this case it allows only HTTP GET and POST requests and defines a secure default authentication \u0026amp; authorization pipeline, which refuses any request by making use of the deny_all authenticator, and if the regular rule overrides that authenticator, will create a JWT thanks to the used jwt finalizer. 11 The last few lines of the configure the file_system provider, which allows loading of regular rules from the file system. Btw. the provider is configured to watch for changes. So you can modify the rules, we’re going to create, while playing around. Now, create a rule file named upstream-rules.yaml, which will implement the authentication and authorization requirements of our service, and copy the following contents to it:\nversion: \u0026#34;1alpha3\u0026#34; rules: - id: demo:public (1) match: url: http://\u0026lt;**\u0026gt;/public forward_to: host: upstream:8081 execute: - authenticator: anon - finalizer: noop - id: demo:protected (2) match: url: http://\u0026lt;**\u0026gt;/\u0026lt;{user,admin}\u0026gt; forward_to: host: upstream:8081 execute: - authenticator: jwt_auth - authorizer: opa config: values: policy: demo/can_access payload: | { \u0026#34;input\u0026#34;: { \u0026#34;role\u0026#34;: {{ quote .Subject.Attributes.role }}, \u0026#34;path\u0026#34;: {{ quote .Request.URL.Path }} } } 1 This rule matches our /public endpoint and forwards the request to our upstream service. It doesn’t perform any kind of request verification or transformation. 2 This rule matches the /user and the /admin endpoints and performs the required authentication as well as authorization steps. Please note, that we don’t define any finalizer in the pipeline of the second rule. Since we have a default rule with a finalizer configured, it is reused here. There is no need for other rules as well as our default rule will block requests to any other endpoints. Having everything related to heimdall configuration, let us now create a policy, OPA is going to use. So, create a file named policy.rego with the following contents.\npackage demo default can_access = false (1) can_access { split(input.path, \u0026#34;/\u0026#34;)[1] == input.role } (2) Here, we say, our policy can_access is located in the demo package. The policy itself is pretty simple and evaluates only to true or false.\n1 Per default, the can_access policy evaluates to false. 2 And it evaluates only to true, if the last path fragment of the request is equal to the user’s role. Let us now configure NGINX to expose a static endpoint serving a JWKS document under the .well-known path, so heimdall is able to verify the JWTs, we’re going to use. Create a file named idp.nginx with the following content:\nworker_processes 1; user nginx; pid /var/run/nginx.pid; events { worker_connections 1024; } http { keepalive_timeout 65; server { listen 8080; location /.well-known/jwks { default_type application/json; root /var/www/nginx; try_files /jwks.json =404; } } } In addition, create a file named jwks.json with the public key required to verify the tokens we’re going to use.\n{ \u0026#34;keys\u0026#34;: [{ \u0026#34;use\u0026#34;:\u0026#34;sig\u0026#34;, \u0026#34;kty\u0026#34;:\u0026#34;EC\u0026#34;, \u0026#34;kid\u0026#34;:\u0026#34;key-1\u0026#34;, \u0026#34;crv\u0026#34;:\u0026#34;P-256\u0026#34;, \u0026#34;alg\u0026#34;:\u0026#34;ES256\u0026#34;, \u0026#34;x\u0026#34;:\u0026#34;cv6F6SgBSNWMZKdApZXSuPD6QPtvQyMpk-iRfZxT-vo\u0026#34;, \u0026#34;y\u0026#34;:\u0026#34;C1r3OClUvyDgmDQdvxMdB-ucmZ28b8s4uM4Yg-0BZZ4\u0026#34; }] } We will add it to the above referenced /var/www/nginx folder, when we define our setup environments.\nTime to configure the environment to play with. If you want to run heimdall as proxy, create or copy the following docker-compose.yaml file and modify it to include the correct paths to your heimdall-config.yaml, upstream-rules.yaml, policy.rego, idp.nginx and the jwks.json files from above:\nversion: \u0026#39;3.7\u0026#39; services: heimdall: (1) image: dadrus/heimdall:latest ports: - \u0026#34;9090:4455\u0026#34; volumes: - ./heimdall-config.yaml:/etc/heimdall/config.yaml:ro - ./upstream-rules.yaml:/etc/heimdall/rules.yaml:ro command: -c /etc/heimdall/config.yaml serve proxy upstream: (2) image: containous/whoami:latest command: - --port=8081 idp: (3) image: nginx:1.25.4 volumes: - ./idp.nginx:/etc/nginx/nginx.conf:ro - ./jwks.json:/var/www/nginx/jwks.json:ro opa: (4) image: openpolicyagent/opa:0.62.1 command: run --server /etc/opa/policies volumes: - ./policy.rego:/etc/opa/policies/policy.rego:ro 1 These lines configure heimdall to use our config and rule file and to run in proxy operation mode. 2 Here, we configure the \u0026#34;upstream\u0026#34; service. As already written above, it is a very simple service, which just echoes back everything it receives. 3 This is our NGINX, which mimics an IDP system and exposes an JWKS endpoint with our key material. 4 And these lines configure our OPA instance to use our authorization policy Alternatively, if you would like to implement EAA with heimdall, create or copy the following docker-compose-eaa.yaml file and modify it to include the correct paths to the heimdall-config.yaml, upstream-rules.yaml, policy.rego, idp.nginx and the jwks.json files from above as well:\nversion: \u0026#34;3\u0026#34; services: proxy: (1) image: traefik:2.11.0 ports: - \u0026#34;9090:9090\u0026#34; command: \u0026gt; --providers.docker=true --providers.docker.exposedbydefault=false --entryPoints.http.address=\u0026#34;:9090\u0026#34; --accesslog --api=true --api.insecure=true volumes: - \u0026#34;/var/run/docker.sock:/var/run/docker.sock:ro\u0026#34; labels: - traefik.enable=true - traefik.http.routers.traefik_http.service=api@internal - traefik.http.routers.traefik_http.entrypoints=http - traefik.http.middlewares.heimdall.forwardauth.address=http://heimdall:4456 (2) - traefik.http.middlewares.heimdall.forwardauth.authResponseHeaders=Authorization heimdall: (3) image: dadrus/heimdall:latest volumes: - ./heimdall-config.yaml:/etc/heimdall/config.yaml:ro - ./upstream-rules.yaml:/etc/heimdall/rules.yaml:ro command: -c /etc/heimdall/config.yaml serve decision upstream: (4) image: containous/whoami:latest command: - --port=8081 labels: - traefik.enable=true - traefik.http.services.whoami.loadbalancer.server.port=8081 - traefik.http.routers.whoami.rule=PathPrefix(\u0026#34;/\u0026#34;) - traefik.http.routers.whoami.middlewares=heimdall idp: (5) image: nginx:1.25.4 volumes: - ./idp.nginx:/etc/nginx/nginx.conf:ro - ./jwks.json:/var/www/nginx/jwks.json:ro opa: (6) image: openpolicyagent/opa:0.62.1 command: run --server /etc/opa/policies volumes: - ./policy.rego:/etc/opa/policies/policy.rego:ro 1 These lines configure Traefik, which is used to dispatch the incoming requests and also forward all of them to heimdall before routing to the target service. We’re using the ForwardAuth middleware here, which requires an additional configuration on the route level. 2 Here we configure Trafik to forward the requests to heimdall 3 These lines configure heimdall to use our config and rule file and to run in decision operation mode. 4 Here, we configure the \u0026#34;upstream\u0026#34; service. As already written above, it is a very simple service, which just echoes back everything it receives. As also written above, we need to provide some route level configuration here to have the requests forwarded to heimdall. We could however also have a global configuration (which we decided not to do to avoid yet another configuration file). 5 This is our NGINX, which mimics an IDP system and exposes an JWKS endpoint with our key material. 6 And these lines configure our OPA instance to use our authorization policy Start Environment Open your terminal and start the services in the directory, the above docker-compose.yaml file is located in with\n$ docker-compose up Consume the API Roll up your sleeves. We’re going to play with our setup now. Open a new terminal window and put it nearby the terminal, you started the environment in. This way you’ll see what is going on in the environment when you use it.\nLet’s try the /public endpoint first\n$ curl 127.0.0.1:9090/public You should see an output similar to the one shown below\nHostname: 94e60bba8498 IP: 127.0.0.1 IP: 172.19.0.3 RemoteAddr: 172.19.0.4:53980 GET /public HTTP/1.1 Host: upstream:8081 User-Agent: curl/8.2.1 Accept: */* Accept-Encoding: gzip Forwarded: for=172.19.0.1;host=127.0.0.1:9090;proto=http That was obviously expected as we’ve sent a request to our public endpoint.\nLet’s try some other endpoints:\n$ curl -v 127.0.0.1:9090/admin The -v flag has be added to the curl command by intention. Without it, we’ll not see any output. With it, we’ll see the response shown below\n* processing: 127.0.0.1:9090/admin * Trying 127.0.0.1:9090... * Connected to 127.0.0.1 (127.0.0.1) port 9090 \u0026gt; GET /admin HTTP/1.1 \u0026gt; Host: 127.0.0.1:9090 \u0026gt; User-Agent: curl/8.2.1 \u0026gt; Accept: */* \u0026gt; \u0026lt; HTTP/1.1 401 Unauthorized \u0026lt; Date: Wed, 06 Mar 2024 16:14:05 GMT \u0026lt; Content-Length: 0 \u0026lt; * Connection #0 to host 127.0.0.1 left intact That is, unauthorized. Requests to any other endpoint, but /public will result in the same output.\nLet us now use a proper JWT, which will allow us to send requests to either the /admin or the /user endpoint. Below, you’ll find a new request using curl to our /admin endpoint again. This time however, it contains an Authorization header with a bearer token in it which should allow us getting access. Try it out.\n$ curl -H \u0026#34;Authorization: Bearer eyJhbGciOiJFUzI1NiIsImtpZCI6ImtleS0xIiwidHlwIjoiSldUIn0.eyJleHAiOjIwMjUxMDA3NTEsImlhdCI6MTcwOTc0MDc1MSwiaXNzIjoiZGVtb19pc3N1ZXIiLCJqdGkiOiI0NjExZDM5Yy00MzI1LTRhMWYtYjdkOC1iMmYxMTE3NDEyYzAiLCJuYmYiOjE3MDk3NDA3NTEsInJvbGUiOiJhZG1pbiIsInN1YiI6IjEifQ.mZZ_UqC8RVzEKBPZbPs4eP-MkXLK22Q27ZJ34UwJiioFdaYXqYJ4ZsatP0TbpKeNyF83mkrrCGL_pWLFTho7Gg\u0026#34; 127.0.0.1:9090/admin We can now access the endpoint and see the following output\nHostname: 94e60bba8498 IP: 127.0.0.1 IP: 172.19.0.2 RemoteAddr: 172.19.0.4:43688 GET /admin HTTP/1.1 Host: upstream:8081 User-Agent: curl/8.2.1 Accept: */* Accept-Encoding: gzip Authorization: Bearer eyJhbGciOiJFUzM4NCIsImtpZCI6IjEzNTQxODg3NGFiNzQwN2I3ZWQ0MmU5MmM4NWIzY2ZkNDJmZDk5NDgiLCJ0eXAiOiJKV1QifQ.eyJleHAiOjE3MDk3NDI2NzYsImlhdCI6MTcwOTc0MjM3NiwiaXNzIjoiaGVpbWRhbGwiLCJqdGkiOiJhYTZkZDE1MC0yMzhiLTQ2YWEtOTIzMi00MDRjMWNiMGM4ZDMiLCJuYmYiOjE3MDk3NDIzNzYsInN1YiI6IjEifQ.84QF4F7-WKSAV4KcC2Z_7SG4VkiEXg0fUu1hLS-zKR8-SfpM3XVphLz3QVg4aDXe4AxiNIfqyA5rE9ZEFnYAlFfWOIt2R7i0PZh2gf1PBOQMj6cMLbDSUw_YZ9x1XWcf Forwarded: for=172.19.0.1;host=127.0.0.1:9090;proto=http Take a closer look at the JWT echoed by our service, e.g. by making use of https://jwt.io. It has been issued by heimdall and is not the token you’ve sent using curl.\nGuess what would happen, when we try the same request, but to the /user endpoint? You’re right, it will be refused due to the wrong role. Let us then use another JWT. Try the request shown below. It contains a token which should give us access.\n$ curl -H \u0026#34;Authorization: Bearer eyJhbGciOiJFUzI1NiIsImtpZCI6ImtleS0xIiwidHlwIjoiSldUIn0.eyJleHAiOjIwMjUxMDA3NTEsImlhdCI6MTcwOTc0MDc1MSwiaXNzIjoiZGVtb19pc3N1ZXIiLCJqdGkiOiIzZmFmNDkxOS0wZjUwLTQ3NGItOGExMy0yOTYzMjEzNThlOTMiLCJuYmYiOjE3MDk3NDA3NTEsInJvbGUiOiJ1c2VyIiwic3ViIjoiMiJ9.W5xCpwsFShS0RpOtrm9vrV2dN6K8pRr5gQnt0kluzLE6oNWFzf7Oot-0YLCPa64Z3XPd7cfGcBiSjrzKZSAj4g\u0026#34; 127.0.0.1:9090/user Was successful, right? We omitted the output for brevity reasons. This guide is already long enough.\nTry to send requests to the /private endpoint using any of the tokens from above. Yep. Useless. Heimdall will not let us through.\nCleanup Just stop the environment with CTRL-C and delete the created files. If you started docker compose in the background, tear the environment down with\n$ docker-compose down ","description":"This simple quickstart guide walks you through the steps required to protect an application with heimdall. Here, you'll learn how you can make use of heimdall as an authentication \u0026 authorization proxy in front of your application and also how you could implement Edge-level Authorization Architecture (EAA) with heimdall's help.","html_content":"\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_overview\"\u003eOverview\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eIn this guide we’re going to configure two setups, both protecting a service which exposes a couple of endpoints:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eThe \u003ccode\u003e/public\u003c/code\u003e endpoint is as the name implies public. Every request to it should be forwarded as is.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eThe \u003ccode\u003e/user\u003c/code\u003e endpoint should only be accessible to users with the role \u003ccode\u003euser\u003c/code\u003e.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eThe \u003ccode\u003e/admin\u003c/code\u003e endpoint should only be accessible to users with the role \u003ccode\u003eadmin\u003c/code\u003e and\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003ethe \u003ccode\u003e/private\u003c/code\u003e endpoint, as well as any other potentially exposed endpoint should not be accessible at all. So all requests should be rejected.\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eFor authentication purposes, we’re going to use JWTs, containing the respective role. The authorization will happen with the help of Open Policy Agent (OPA).\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eIn both setups, we’re going to create minimal but complete environments using docker compose with\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ca href=\"https://doc.traefik.io/traefik/\"\u003etraefik\u003c/a\u003e as an edge proxy,\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ca href=\"https://hub.docker.com/r/containous/whoami/\"\u003econtainous/whoami\u003c/a\u003e (that service just echoes back everything it receives) which mimics our service exposing the abovesaid endpoints,\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003ean \u003ca href=\"https://nginx.org/en/\"\u003eNGINX\u003c/a\u003e server serving the public key for the verification purposes of the JWTs mentioned above (it just mimics the JWKS endpoint typically exposed by an OIDC provider),\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ca href=\"https://www.openpolicyagent.org/\"\u003eOPA\u003c/a\u003e, which evaluates the above said authorization policy and\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eheimdall, orchestrating everything to implement the above said requirements.\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"admonitionblock note\"\u003e\n\u003ctable\u003e\n\u003ctbody\u003e\u003ctr\u003e\n\u003ctd class=\"icon\"\u003e\n\u003ci class=\"fa icon-note\" title=\"Note\"\u003e\u003c/i\u003e\n\u003c/td\u003e\n\u003ctd class=\"content\"\u003e\nThis and similar quickstarts, demonstrating other (integration) options are also available on \u003ca href=\"https://github.com/dadrus/heimdall/tree/main/examples/docker-compose/quickstarts\"\u003eGitHub\u003c/a\u003e.\n\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_prerequisites\"\u003ePrerequisites\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eTo be able to follow this guide, you’ll need the following tools installed locally:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ca href=\"https://docs.docker.com/install/\"\u003eDocker\u003c/a\u003e,\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ca href=\"https://docs.docker.com/compose/install/\"\u003edocker-compose\u003c/a\u003e, and\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003ea text editor of your choice.\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_configure\"\u003eConfigure\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"olist arabic\"\u003e\n\u003col class=\"arabic\"\u003e\n\u003cli\u003e\n\u003cp\u003eHeimdall can be configured via environment variables, as well as using a configuration file. For simplicity reasons, we’ll use a configuration file here. So create a config file named \u003ccode\u003eheimdall-config.yaml\u003c/code\u003e with the following contents:\u003c/p\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"yaml\"\u003e\u003cspan class=\"na\"\u003elog\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003ci class=\"conum\" data-value=\"1\"\u003e\u003c/i\u003e\u003cb\u003e(1)\u003c/b\u003e\n  \u003cspan class=\"na\"\u003elevel\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003edebug\u003c/span\u003e\n\n\u003cspan class=\"na\"\u003etracing\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eenabled\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003efalse\u003c/span\u003e\n\n\u003cspan class=\"na\"\u003emetrics\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eenabled\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003efalse\u003c/span\u003e\n\n\u003cspan class=\"na\"\u003eserve\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003ci class=\"conum\" data-value=\"2\"\u003e\u003c/i\u003e\u003cb\u003e(2)\u003c/b\u003e\n  \u003cspan class=\"na\"\u003edecision\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"na\"\u003etrusted_proxies\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003e0.0.0.0/0\u003c/span\u003e\n\n\u003cspan class=\"na\"\u003emechanisms\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003ci class=\"conum\" data-value=\"3\"\u003e\u003c/i\u003e\u003cb\u003e(3)\u003c/b\u003e\n  \u003cspan class=\"na\"\u003eauthenticators\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eid\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003edeny_all\u003c/span\u003e \u003ci class=\"conum\" data-value=\"4\"\u003e\u003c/i\u003e\u003cb\u003e(4)\u003c/b\u003e\n      \u003cspan class=\"na\"\u003etype\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eunauthorized\u003c/span\u003e\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eid\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eanon\u003c/span\u003e \u003ci class=\"conum\" data-value=\"5\"\u003e\u003c/i\u003e\u003cb\u003e(5)\u003c/b\u003e\n      \u003cspan class=\"na\"\u003etype\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eanonymous\u003c/span\u003e\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eid\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ejwt_auth\u003c/span\u003e \u003ci class=\"conum\" data-value=\"6\"\u003e\u003c/i\u003e\u003cb\u003e(6)\u003c/b\u003e\n      \u003cspan class=\"na\"\u003etype\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ejwt\u003c/span\u003e\n      \u003cspan class=\"na\"\u003econfig\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"na\"\u003ejwks_endpoint\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ehttp://idp:8080/.well-known/jwks\u003c/span\u003e\n        \u003cspan class=\"na\"\u003eassertions\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n          \u003cspan class=\"na\"\u003eissuers\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003edemo_issuer\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eauthorizers\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eid\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eopa\u003c/span\u003e \u003ci class=\"conum\" data-value=\"7\"\u003e\u003c/i\u003e\u003cb\u003e(7)\u003c/b\u003e\n      \u003cspan class=\"na\"\u003etype\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eremote\u003c/span\u003e\n      \u003cspan class=\"na\"\u003econfig\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"na\"\u003eendpoint\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ehttp://opa:8181/v1/data/{{ .Values.policy }}\u003c/span\u003e\n        \u003cspan class=\"na\"\u003epayload\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"s\"\u003e{}\u0026#34;\u003c/span\u003e\n        \u003cspan class=\"na\"\u003eexpressions\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n          \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eexpression\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"pi\"\u003e|\u003c/span\u003e\n              \u003cspan class=\"s\"\u003ePayload.result == true\u003c/span\u003e\n  \u003cspan class=\"na\"\u003efinalizers\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eid\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ecreate_jwt\u003c/span\u003e \u003ci class=\"conum\" data-value=\"8\"\u003e\u003c/i\u003e\u003cb\u003e(8)\u003c/b\u003e\n      \u003cspan class=\"na\"\u003etype\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ejwt\u003c/span\u003e\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eid\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003enoop\u003c/span\u003e \u003ci class=\"conum\" data-value=\"9\"\u003e\u003c/i\u003e\u003cb\u003e(9)\u003c/b\u003e\n      \u003cspan class=\"na\"\u003etype\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003enoop\u003c/span\u003e\n\n\u003cspan class=\"na\"\u003edefault_rule\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003ci class=\"conum\" data-value=\"10\"\u003e\u003c/i\u003e\u003cb\u003e(10)\u003c/b\u003e\n  \u003cspan class=\"na\"\u003emethods\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003eGET\u003c/span\u003e\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003ePOST\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eexecute\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eauthenticator\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003edeny_all\u003c/span\u003e\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003efinalizer\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ecreate_jwt\u003c/span\u003e\n\n\u003cspan class=\"na\"\u003eproviders\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"na\"\u003efile_system\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003ci class=\"conum\" data-value=\"11\"\u003e\u003c/i\u003e\u003cb\u003e(11)\u003c/b\u003e\n    \u003cspan class=\"na\"\u003esrc\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e/etc/heimdall/rules.yaml\u003c/span\u003e\n    \u003cspan class=\"na\"\u003ewatch\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"colist arabic\"\u003e\n\u003ctable\u003e\n\u003ctbody\u003e\u003ctr\u003e\n\u003ctd\u003e\u003ci class=\"conum\" data-value=\"1\"\u003e\u003c/i\u003e\u003cb\u003e1\u003c/b\u003e\u003c/td\u003e\n\u003ctd\u003eSince heimdall emits logs on \u003ccode\u003eerror\u003c/code\u003e level by default, and we would like to see what is going on, we are setting the log level to \u003ccode\u003edebug\u003c/code\u003e. This way, we’ll see not only the results of a particular rule execution (which is what you would see if we set the log level to \u003ccode\u003einfo\u003c/code\u003e), but also what is going in a rule. In addition, we disable tracing and metrics collection as these are pulled by default to an OTEL agent to avoid error statements related to unavailability of the agent. You can find more information about available observability options in the \u003ca href=\"/docs/operations/observability/#_logging\"\u003eObservability\u003c/a\u003e chapter.\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003ci class=\"conum\" data-value=\"2\"\u003e\u003c/i\u003e\u003cb\u003e2\u003c/b\u003e\u003c/td\u003e\n\u003ctd\u003eThis configuration instructs heimdall to trust \u003ccode\u003eX-Forwarded-*\u003c/code\u003e headers from any sources. We need it here for integration purposes with Traefik, which uses these headers while forwarding requests to heimdall and which IP depends on your local docker configuration. Never do this in production and use allowed IPs instead! Please take also a look at the documentation of \u003ca href=\"/docs/services/decision/#_trusted_proxies\"\u003etrusted_proxies\u003c/a\u003e property and \u003ca href=\"/docs/operations/security/#_http_header_security_considerations\"\u003eSecurity Considerations\u003c/a\u003e for more details.\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003ci class=\"conum\" data-value=\"3\"\u003e\u003c/i\u003e\u003cb\u003e3\u003c/b\u003e\u003c/td\u003e\n\u003ctd\u003eHere we define our \u003ca href=\"/docs/mechanisms/catalogue/\"\u003ecatalogue of mechanisms\u003c/a\u003e to be used in \u003ca href=\"/docs/rules/regular_rule/\"\u003eupstream service specific rules\u003c/a\u003e. In this case we define authenticators, authorizer and finalizers\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003ci class=\"conum\" data-value=\"4\"\u003e\u003c/i\u003e\u003cb\u003e4\u003c/b\u003e\u003c/td\u003e\n\u003ctd\u003eThese two lines define the \u003ccode\u003e\u003ca href=\"/docs/mechanisms/authenticators/#_unauthorized\"\u003eunauthorized\u003c/a\u003e\u003c/code\u003e authenticator named \u003ccode\u003edeny_all\u003c/code\u003e. It rejects all requests.\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003ci class=\"conum\" data-value=\"5\"\u003e\u003c/i\u003e\u003cb\u003e5\u003c/b\u003e\u003c/td\u003e\n\u003ctd\u003eThese two lines define the \u003ccode\u003e\u003ca href=\"/docs/mechanisms/authenticators/#_anonymous\"\u003eanonymous\u003c/a\u003e\u003c/code\u003e authenticator named \u003ccode\u003eanon\u003c/code\u003e. It allows any request passing through and creates a subject with ID set to \u003ccode\u003eanonymous\u003c/code\u003e. You can find more information about the subject and other objects \u003ca href=\"/docs/mechanisms/evaluation_objects/#_subject\"\u003ehere\u003c/a\u003e.\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003ci class=\"conum\" data-value=\"6\"\u003e\u003c/i\u003e\u003cb\u003e6\u003c/b\u003e\u003c/td\u003e\n\u003ctd\u003eThis and the following lines define and configure the \u003ccode\u003e\u003ca href=\"/docs/mechanisms/authenticators/#_jwt\"\u003ejwt\u003c/a\u003e\u003c/code\u003e authenticator named \u003ccode\u003ejwt_auth\u003c/code\u003e. With the given configuration it will check whether a request contains an \u003ccode\u003eAuthorization\u003c/code\u003e header with a bearer token in JWT format and validate it using key material fetched from the JWKS endpoint. It will reject all requests without a valid JWT or create a subject with ID set to the value of the \u003ccode\u003esub\u003c/code\u003e claim from the token and add also add all claims as key-value map to subject’s Attribute property.\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003ci class=\"conum\" data-value=\"7\"\u003e\u003c/i\u003e\u003cb\u003e7\u003c/b\u003e\u003c/td\u003e\n\u003ctd\u003eHere we define and configure a \u003ccode\u003e\u003ca href=\"/docs/mechanisms/authorizers/#_remote\"\u003eremote\u003c/a\u003e\u003c/code\u003e authorizer named \u003ccode\u003eopa\u003c/code\u003e. Please note, how we allow overriding of particular settings, which application you’ll find below, when we define the rules.\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003ci class=\"conum\" data-value=\"8\"\u003e\u003c/i\u003e\u003cb\u003e8\u003c/b\u003e\u003c/td\u003e\n\u003ctd\u003eThe following two lines define the \u003ccode\u003e\u003ca href=\"/docs/mechanisms/finalizers/#_jwt\"\u003ejwt\u003c/a\u003e\u003c/code\u003e finalizer. Without any configuration, as used here, it will create a jwt out of the subject object with standard claims and set the \u003ccode\u003esub\u003c/code\u003e claim to the value of subject’s ID. The key material used for signature creation purpose will be generated on start up. This is fine for our demo purpose. For real scenarios you should definitely \u003ca href=\"/docs/operations/security/#_signatures\"\u003edefine it\u003c/a\u003e.\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003ci class=\"conum\" data-value=\"9\"\u003e\u003c/i\u003e\u003cb\u003e9\u003c/b\u003e\u003c/td\u003e\n\u003ctd\u003eThese two lines conclude the definition of our mechanisms catalogue and define the \u003ccode\u003e\u003ca href=\"/docs/mechanisms/finalizers/#_noop\"\u003enoop\u003c/a\u003e\u003c/code\u003e finalizer, which as the type implies, does nothing.\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003ci class=\"conum\" data-value=\"10\"\u003e\u003c/i\u003e\u003cb\u003e10\u003c/b\u003e\u003c/td\u003e\n\u003ctd\u003eWith the above catalogue in place, we can now define a \u003ca href=\"/docs/rules/default_rule/\"\u003edefault rule\u003c/a\u003e, which will kick in if no other rule matches the request. In addition, it acts as a \u003ca href=\"/docs/concepts/rules/#_default_rule_inheritance\"\u003ebase\u003c/a\u003e for the definition of regular (upstream service specific) rules. In this case it allows only HTTP GET and POST requests and defines a secure default \u003ca href=\"/docs/concepts/pipelines/#_authentication_authorization_pipeline\"\u003eauthentication \u0026amp; authorization pipeline\u003c/a\u003e, which refuses any request by making use of the \u003ccode\u003edeny_all\u003c/code\u003e authenticator, and if the regular rule overrides that authenticator, will create a JWT thanks to the used \u003ccode\u003ejwt\u003c/code\u003e finalizer.\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003ci class=\"conum\" data-value=\"11\"\u003e\u003c/i\u003e\u003cb\u003e11\u003c/b\u003e\u003c/td\u003e\n\u003ctd\u003eThe last few lines of the configure the \u003ca href=\"/docs/rules/providers/#_filesystem\"\u003e\u003ccode\u003efile_system\u003c/code\u003e\u003c/a\u003e provider, which allows loading of regular rules from the file system. Btw. the provider is configured to watch for changes. So you can modify the rules, we’re going to create, while playing around.\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eNow, create a rule file named \u003ccode\u003eupstream-rules.yaml\u003c/code\u003e, which will implement the authentication and authorization requirements of our service, and copy the following contents to it:\u003c/p\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"yaml\"\u003e\u003cspan class=\"na\"\u003eversion\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"s\"\u003e1alpha3\u0026#34;\u003c/span\u003e\n\u003cspan class=\"na\"\u003erules\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n\u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eid\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003edemo:public\u003c/span\u003e  \u003ci class=\"conum\" data-value=\"1\"\u003e\u003c/i\u003e\u003cb\u003e(1)\u003c/b\u003e\n  \u003cspan class=\"na\"\u003ematch\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"na\"\u003eurl\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ehttp://\u0026lt;**\u0026gt;/public\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eforward_to\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"na\"\u003ehost\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eupstream:8081\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eexecute\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eauthenticator\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eanon\u003c/span\u003e\n  \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003efinalizer\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003enoop\u003c/span\u003e\n\n\u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eid\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003edemo:protected\u003c/span\u003e  \u003ci class=\"conum\" data-value=\"2\"\u003e\u003c/i\u003e\u003cb\u003e(2)\u003c/b\u003e\n  \u003cspan class=\"na\"\u003ematch\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"na\"\u003eurl\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ehttp://\u0026lt;**\u0026gt;/\u0026lt;{user,admin}\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eforward_to\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"na\"\u003ehost\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eupstream:8081\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eexecute\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eauthenticator\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ejwt_auth\u003c/span\u003e\n  \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eauthorizer\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eopa\u003c/span\u003e\n    \u003cspan class=\"na\"\u003econfig\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"na\"\u003evalues\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"na\"\u003epolicy\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003edemo/can_access\u003c/span\u003e\n      \u003cspan class=\"na\"\u003epayload\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"pi\"\u003e|\u003c/span\u003e\n        \u003cspan class=\"s\"\u003e{\u003c/span\u003e\n          \u003cspan class=\"s\"\u003e\u0026#34;input\u0026#34;: {\u003c/span\u003e\n            \u003cspan class=\"s\"\u003e\u0026#34;role\u0026#34;: {{ quote .Subject.Attributes.role }},\u003c/span\u003e\n            \u003cspan class=\"s\"\u003e\u0026#34;path\u0026#34;: {{ quote .Request.URL.Path }}\u003c/span\u003e\n          \u003cspan class=\"s\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"s\"\u003e}\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"colist arabic\"\u003e\n\u003ctable\u003e\n\u003ctbody\u003e\u003ctr\u003e\n\u003ctd\u003e\u003ci class=\"conum\" data-value=\"1\"\u003e\u003c/i\u003e\u003cb\u003e1\u003c/b\u003e\u003c/td\u003e\n\u003ctd\u003eThis rule matches our \u003ccode\u003e/public\u003c/code\u003e endpoint and forwards the request to our upstream service. It doesn’t perform any kind of request verification or transformation.\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003ci class=\"conum\" data-value=\"2\"\u003e\u003c/i\u003e\u003cb\u003e2\u003c/b\u003e\u003c/td\u003e\n\u003ctd\u003eThis rule matches the \u003ccode\u003e/user\u003c/code\u003e and the \u003ccode\u003e/admin\u003c/code\u003e endpoints and performs the required authentication as well as authorization steps.\n\u003cdiv class=\"admonitionblock note\"\u003e\n\u003ctable\u003e\n\u003ctbody\u003e\u003ctr\u003e\n\u003ctd class=\"icon\"\u003e\n\u003ci class=\"fa icon-note\" title=\"Note\"\u003e\u003c/i\u003e\n\u003c/td\u003e\n\u003ctd class=\"content\"\u003e\nPlease note, that we don’t define any finalizer in the pipeline of the second rule. Since we have a default rule with a finalizer configured, it is reused here. There is no need for other rules as well as our default rule will block requests to any other endpoints.\n\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\u003c/table\u003e\n\u003c/div\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eHaving everything related to heimdall configuration, let us now create a policy, OPA is going to use. So, create a file named \u003ccode\u003epolicy.rego\u003c/code\u003e with the following contents.\u003c/p\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"rego\"\u003e\u003cspan class=\"ow\"\u003epackage\u003c/span\u003e \u003cspan class=\"n\"\u003edemo\u003c/span\u003e\n\n\u003cspan class=\"ow\"\u003edefault\u003c/span\u003e \u003cspan class=\"n\"\u003ecan_access\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kc\"\u003efalse\u003c/span\u003e \u003ci class=\"conum\" data-value=\"1\"\u003e\u003c/i\u003e\u003cb\u003e(1)\u003c/b\u003e\n\n\u003cspan class=\"n\"\u003ecan_access\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003esplit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003einput\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;/\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e)[\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003einput\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003erole\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003ci class=\"conum\" data-value=\"2\"\u003e\u003c/i\u003e\u003cb\u003e(2)\u003c/b\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eHere, we say, our policy \u003ccode\u003ecan_access\u003c/code\u003e is located in the \u003ccode\u003edemo\u003c/code\u003e package. The policy itself is pretty simple and evaluates only to true or false.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"colist arabic\"\u003e\n\u003ctable\u003e\n\u003ctbody\u003e\u003ctr\u003e\n\u003ctd\u003e\u003ci class=\"conum\" data-value=\"1\"\u003e\u003c/i\u003e\u003cb\u003e1\u003c/b\u003e\u003c/td\u003e\n\u003ctd\u003ePer default, the \u003ccode\u003ecan_access\u003c/code\u003e policy evaluates to false.\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003ci class=\"conum\" data-value=\"2\"\u003e\u003c/i\u003e\u003cb\u003e2\u003c/b\u003e\u003c/td\u003e\n\u003ctd\u003eAnd it evaluates only to true, if the last path fragment of the request is equal to the user’s role.\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eLet us now configure NGINX to expose a static endpoint serving a JWKS document under the \u003ccode\u003e.well-known\u003c/code\u003e path, so heimdall is able to verify the JWTs, we’re going to use. Create a file named \u003ccode\u003eidp.nginx\u003c/code\u003e with the following content:\u003c/p\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"bash\"\u003eworker_processes  1\u003cspan class=\"p\"\u003e;\u003c/span\u003e\nuser       nginx\u003cspan class=\"p\"\u003e;\u003c/span\u003e\npid        /var/run/nginx.pid\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\nevents \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n  worker_connections  1024\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\nhttp \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n    keepalive_timeout  65\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    server \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n        listen 8080\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n        location /.well-known/jwks \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n            default_type  application/json\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            root /var/www/nginx\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            try_files /jwks.json \u003cspan class=\"o\"\u003e=\u003c/span\u003e404\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"o\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003cspan class=\"o\"\u003e}\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eIn addition, create a file named \u003ccode\u003ejwks.json\u003c/code\u003e with the public key required to verify the tokens we’re going to use.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"json\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"w\"\u003e\n  \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;keys\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e[{\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;use\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;sig\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;kty\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;EC\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;kid\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;key-1\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;crv\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;P-256\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;alg\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;ES256\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;x\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;cv6F6SgBSNWMZKdApZXSuPD6QPtvQyMpk-iRfZxT-vo\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;y\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;C1r3OClUvyDgmDQdvxMdB-ucmZ28b8s4uM4Yg-0BZZ4\u0026#34;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n  \u003c/span\u003e\u003cspan class=\"p\"\u003e}]\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eWe will add it to the above referenced \u003ccode\u003e/var/www/nginx\u003c/code\u003e folder, when we define our setup environments.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eTime to configure the environment to play with. If you want to run \u003cstrong\u003eheimdall as proxy\u003c/strong\u003e, create or copy the following \u003ccode\u003edocker-compose.yaml\u003c/code\u003e file and modify it to include the correct paths to your \u003ccode\u003eheimdall-config.yaml\u003c/code\u003e, \u003ccode\u003eupstream-rules.yaml\u003c/code\u003e, \u003ccode\u003epolicy.rego\u003c/code\u003e, \u003ccode\u003eidp.nginx\u003c/code\u003e and the \u003ccode\u003ejwks.json\u003c/code\u003e files from above:\u003c/p\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"yaml\"\u003e\u003cspan class=\"na\"\u003eversion\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"s\"\u003e3.7\u0026#39;\u003c/span\u003e\n\n\u003cspan class=\"na\"\u003eservices\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eheimdall\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003ci class=\"conum\" data-value=\"1\"\u003e\u003c/i\u003e\u003cb\u003e(1)\u003c/b\u003e\n    \u003cspan class=\"na\"\u003eimage\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003edadrus/heimdall:latest\u003c/span\u003e\n    \u003cspan class=\"na\"\u003eports\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"s\"\u003e9090:4455\u0026#34;\u003c/span\u003e\n    \u003cspan class=\"na\"\u003evolumes\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003e./heimdall-config.yaml:/etc/heimdall/config.yaml:ro\u003c/span\u003e\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003e./upstream-rules.yaml:/etc/heimdall/rules.yaml:ro\u003c/span\u003e\n    \u003cspan class=\"na\"\u003ecommand\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e-c /etc/heimdall/config.yaml serve proxy\u003c/span\u003e\n\n  \u003cspan class=\"na\"\u003eupstream\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003ci class=\"conum\" data-value=\"2\"\u003e\u003c/i\u003e\u003cb\u003e(2)\u003c/b\u003e\n    \u003cspan class=\"na\"\u003eimage\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003econtainous/whoami:latest\u003c/span\u003e\n    \u003cspan class=\"na\"\u003ecommand\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003e--port=8081\u003c/span\u003e\n\n  \u003cspan class=\"na\"\u003eidp\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003ci class=\"conum\" data-value=\"3\"\u003e\u003c/i\u003e\u003cb\u003e(3)\u003c/b\u003e\n    \u003cspan class=\"na\"\u003eimage\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003enginx:1.25.4\u003c/span\u003e\n    \u003cspan class=\"na\"\u003evolumes\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003e./idp.nginx:/etc/nginx/nginx.conf:ro\u003c/span\u003e\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003e./jwks.json:/var/www/nginx/jwks.json:ro\u003c/span\u003e\n\n  \u003cspan class=\"na\"\u003eopa\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003ci class=\"conum\" data-value=\"4\"\u003e\u003c/i\u003e\u003cb\u003e(4)\u003c/b\u003e\n    \u003cspan class=\"na\"\u003eimage\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eopenpolicyagent/opa:0.62.1\u003c/span\u003e\n    \u003cspan class=\"na\"\u003ecommand\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003erun --server /etc/opa/policies\u003c/span\u003e\n    \u003cspan class=\"na\"\u003evolumes\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003e./policy.rego:/etc/opa/policies/policy.rego:ro\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"colist arabic\"\u003e\n\u003ctable\u003e\n\u003ctbody\u003e\u003ctr\u003e\n\u003ctd\u003e\u003ci class=\"conum\" data-value=\"1\"\u003e\u003c/i\u003e\u003cb\u003e1\u003c/b\u003e\u003c/td\u003e\n\u003ctd\u003eThese lines configure heimdall to use our config and rule file and to run in proxy operation mode.\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003ci class=\"conum\" data-value=\"2\"\u003e\u003c/i\u003e\u003cb\u003e2\u003c/b\u003e\u003c/td\u003e\n\u003ctd\u003eHere, we configure the \u0026#34;upstream\u0026#34; service. As already written above, it is a very simple service, which just echoes back everything it receives.\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003ci class=\"conum\" data-value=\"3\"\u003e\u003c/i\u003e\u003cb\u003e3\u003c/b\u003e\u003c/td\u003e\n\u003ctd\u003eThis is our NGINX, which mimics an IDP system and exposes an JWKS endpoint with our key material.\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003ci class=\"conum\" data-value=\"4\"\u003e\u003c/i\u003e\u003cb\u003e4\u003c/b\u003e\u003c/td\u003e\n\u003ctd\u003eAnd these lines configure our OPA instance to use our authorization policy\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eAlternatively, if you would like to implement \u003cstrong\u003eEAA with heimdall\u003c/strong\u003e, create or copy the following \u003ccode\u003edocker-compose-eaa.yaml\u003c/code\u003e file and modify it to include the correct paths to the \u003ccode\u003eheimdall-config.yaml\u003c/code\u003e, \u003ccode\u003eupstream-rules.yaml\u003c/code\u003e, \u003ccode\u003epolicy.rego\u003c/code\u003e, \u003ccode\u003eidp.nginx\u003c/code\u003e and the \u003ccode\u003ejwks.json\u003c/code\u003e files from above as well:\u003c/p\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"yaml\"\u003e\u003cspan class=\"na\"\u003eversion\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"s\"\u003e3\u0026#34;\u003c/span\u003e\n\n\u003cspan class=\"na\"\u003eservices\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eproxy\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003ci class=\"conum\" data-value=\"1\"\u003e\u003c/i\u003e\u003cb\u003e(1)\u003c/b\u003e\n    \u003cspan class=\"na\"\u003eimage\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003etraefik:2.11.0\u003c/span\u003e\n    \u003cspan class=\"na\"\u003eports\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"s\"\u003e9090:9090\u0026#34;\u003c/span\u003e\n    \u003cspan class=\"na\"\u003ecommand\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"pi\"\u003e\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"s\"\u003e--providers.docker=true\u003c/span\u003e\n      \u003cspan class=\"s\"\u003e--providers.docker.exposedbydefault=false\u003c/span\u003e\n      \u003cspan class=\"s\"\u003e--entryPoints.http.address=\u0026#34;:9090\u0026#34;\u003c/span\u003e\n      \u003cspan class=\"s\"\u003e--accesslog --api=true --api.insecure=true\u003c/span\u003e\n    \u003cspan class=\"na\"\u003evolumes\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"s\"\u003e/var/run/docker.sock:/var/run/docker.sock:ro\u0026#34;\u003c/span\u003e\n    \u003cspan class=\"na\"\u003elabels\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003etraefik.enable=true\u003c/span\u003e\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003etraefik.http.routers.traefik_http.service=api@internal\u003c/span\u003e\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003etraefik.http.routers.traefik_http.entrypoints=http\u003c/span\u003e\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003etraefik.http.middlewares.heimdall.forwardauth.address=http://heimdall:4456\u003c/span\u003e  \u003ci class=\"conum\" data-value=\"2\"\u003e\u003c/i\u003e\u003cb\u003e(2)\u003c/b\u003e\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003etraefik.http.middlewares.heimdall.forwardauth.authResponseHeaders=Authorization\u003c/span\u003e\n\n  \u003cspan class=\"na\"\u003eheimdall\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e  \u003ci class=\"conum\" data-value=\"3\"\u003e\u003c/i\u003e\u003cb\u003e(3)\u003c/b\u003e\n    \u003cspan class=\"na\"\u003eimage\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003edadrus/heimdall:latest\u003c/span\u003e\n    \u003cspan class=\"na\"\u003evolumes\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003e./heimdall-config.yaml:/etc/heimdall/config.yaml:ro\u003c/span\u003e\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003e./upstream-rules.yaml:/etc/heimdall/rules.yaml:ro\u003c/span\u003e\n    \u003cspan class=\"na\"\u003ecommand\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e-c /etc/heimdall/config.yaml serve decision\u003c/span\u003e\n\n  \u003cspan class=\"na\"\u003eupstream\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e  \u003ci class=\"conum\" data-value=\"4\"\u003e\u003c/i\u003e\u003cb\u003e(4)\u003c/b\u003e\n    \u003cspan class=\"na\"\u003eimage\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003econtainous/whoami:latest\u003c/span\u003e\n    \u003cspan class=\"na\"\u003ecommand\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003e--port=8081\u003c/span\u003e\n    \u003cspan class=\"na\"\u003elabels\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003etraefik.enable=true\u003c/span\u003e\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003etraefik.http.services.whoami.loadbalancer.server.port=8081\u003c/span\u003e\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003etraefik.http.routers.whoami.rule=PathPrefix(\u0026#34;/\u0026#34;)\u003c/span\u003e\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003etraefik.http.routers.whoami.middlewares=heimdall\u003c/span\u003e\n\n  \u003cspan class=\"na\"\u003eidp\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003ci class=\"conum\" data-value=\"5\"\u003e\u003c/i\u003e\u003cb\u003e(5)\u003c/b\u003e\n    \u003cspan class=\"na\"\u003eimage\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003enginx:1.25.4\u003c/span\u003e\n    \u003cspan class=\"na\"\u003evolumes\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003e./idp.nginx:/etc/nginx/nginx.conf:ro\u003c/span\u003e\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003e./jwks.json:/var/www/nginx/jwks.json:ro\u003c/span\u003e\n\n  \u003cspan class=\"na\"\u003eopa\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003ci class=\"conum\" data-value=\"6\"\u003e\u003c/i\u003e\u003cb\u003e(6)\u003c/b\u003e\n    \u003cspan class=\"na\"\u003eimage\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eopenpolicyagent/opa:0.62.1\u003c/span\u003e\n    \u003cspan class=\"na\"\u003ecommand\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003erun --server /etc/opa/policies\u003c/span\u003e\n    \u003cspan class=\"na\"\u003evolumes\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003e./policy.rego:/etc/opa/policies/policy.rego:ro\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"colist arabic\"\u003e\n\u003ctable\u003e\n\u003ctbody\u003e\u003ctr\u003e\n\u003ctd\u003e\u003ci class=\"conum\" data-value=\"1\"\u003e\u003c/i\u003e\u003cb\u003e1\u003c/b\u003e\u003c/td\u003e\n\u003ctd\u003eThese lines configure Traefik, which is used to dispatch the incoming requests and also forward all of them to heimdall before routing to the target service. We’re using the ForwardAuth middleware here, which requires an additional configuration on the route level.\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003ci class=\"conum\" data-value=\"2\"\u003e\u003c/i\u003e\u003cb\u003e2\u003c/b\u003e\u003c/td\u003e\n\u003ctd\u003eHere we configure Trafik to forward the requests to heimdall\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003ci class=\"conum\" data-value=\"3\"\u003e\u003c/i\u003e\u003cb\u003e3\u003c/b\u003e\u003c/td\u003e\n\u003ctd\u003eThese lines configure heimdall to use our config and rule file and to run in decision operation mode.\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003ci class=\"conum\" data-value=\"4\"\u003e\u003c/i\u003e\u003cb\u003e4\u003c/b\u003e\u003c/td\u003e\n\u003ctd\u003eHere, we configure the \u0026#34;upstream\u0026#34; service. As already written above, it is a very simple service, which just echoes back everything it receives. As also written above, we need to provide some route level configuration here to have the requests forwarded to heimdall. We could however also have a global configuration (which we decided not to do to avoid yet another configuration file).\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003ci class=\"conum\" data-value=\"5\"\u003e\u003c/i\u003e\u003cb\u003e5\u003c/b\u003e\u003c/td\u003e\n\u003ctd\u003eThis is our NGINX, which mimics an IDP system and exposes an JWKS endpoint with our key material.\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003ci class=\"conum\" data-value=\"6\"\u003e\u003c/i\u003e\u003cb\u003e6\u003c/b\u003e\u003c/td\u003e\n\u003ctd\u003eAnd these lines configure our OPA instance to use our authorization policy\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_start_environment\"\u003eStart Environment\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eOpen your terminal and start the services in the directory, the above \u003ccode\u003edocker-compose.yaml\u003c/code\u003e file is located in with\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"bash\"\u003e\u003cspan class=\"nv\"\u003e$ \u003c/span\u003edocker-compose up\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_consume_the_api\"\u003eConsume the API\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eRoll up your sleeves. We’re going to play with our setup now. Open a new terminal window and put it nearby the terminal, you started the environment in. This way you’ll see what is going on in the environment when you use it.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"olist arabic\"\u003e\n\u003col class=\"arabic\"\u003e\n\u003cli\u003e\n\u003cp\u003eLet’s try the \u003ccode\u003e/public\u003c/code\u003e endpoint first\u003c/p\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"bash\"\u003e\u003cspan class=\"nv\"\u003e$ \u003c/span\u003ecurl 127.0.0.1:9090/public\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eYou should see an output similar to the one shown below\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"bash\"\u003eHostname: 94e60bba8498\nIP: 127.0.0.1\nIP: 172.19.0.3\nRemoteAddr: 172.19.0.4:53980\nGET /public HTTP/1.1\nHost: upstream:8081\nUser-Agent: curl/8.2.1\nAccept: \u003cspan class=\"k\"\u003e*\u003c/span\u003e/\u003cspan class=\"k\"\u003e*\u003c/span\u003e\nAccept-Encoding: \u003cspan class=\"nb\"\u003egzip\n\u003c/span\u003eForwarded: \u003cspan class=\"k\"\u003efor\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e172.19.0.1\u003cspan class=\"p\"\u003e;\u003c/span\u003e\u003cspan class=\"nv\"\u003ehost\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e127.0.0.1:9090\u003cspan class=\"p\"\u003e;\u003c/span\u003e\u003cspan class=\"nv\"\u003eproto\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003ehttp\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThat was obviously expected as we’ve sent a request to our public endpoint.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eLet’s try some other endpoints:\u003c/p\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"bash\"\u003e\u003cspan class=\"nv\"\u003e$ \u003c/span\u003ecurl \u003cspan class=\"nt\"\u003e-v\u003c/span\u003e 127.0.0.1:9090/admin\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe \u003ccode\u003e-v\u003c/code\u003e flag has be added to the curl command by intention. Without it, we’ll not see any output. With it, we’ll see the response shown below\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"bash\"\u003e\u003cspan class=\"k\"\u003e*\u003c/span\u003e processing: 127.0.0.1:9090/admin\n\u003cspan class=\"k\"\u003e*\u003c/span\u003e   Trying 127.0.0.1:9090...\n\u003cspan class=\"k\"\u003e*\u003c/span\u003e Connected to 127.0.0.1 \u003cspan class=\"o\"\u003e(\u003c/span\u003e127.0.0.1\u003cspan class=\"o\"\u003e)\u003c/span\u003e port 9090\n\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e GET /admin HTTP/1.1\n\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e Host: 127.0.0.1:9090\n\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e User-Agent: curl/8.2.1\n\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e Accept: \u003cspan class=\"k\"\u003e*\u003c/span\u003e/\u003cspan class=\"k\"\u003e*\u003c/span\u003e\n\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n\u0026lt; HTTP/1.1 401 Unauthorized\n\u0026lt; Date: Wed, 06 Mar 2024 16:14:05 GMT\n\u0026lt; Content-Length: 0\n\u0026lt;\n\u003cspan class=\"k\"\u003e*\u003c/span\u003e Connection \u003cspan class=\"c\"\u003e#0 to host 127.0.0.1 left intact\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThat is, unauthorized. Requests to any other endpoint, but \u003ccode\u003e/public\u003c/code\u003e will result in the same output.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eLet us now use a proper JWT, which will allow us to send requests to either the \u003ccode\u003e/admin\u003c/code\u003e or the \u003ccode\u003e/user\u003c/code\u003e endpoint. Below, you’ll find a new request using curl to our \u003ccode\u003e/admin\u003c/code\u003e endpoint again. This time however, it contains an \u003ccode\u003eAuthorization\u003c/code\u003e header with a bearer token in it which should allow us getting access. Try it out.\u003c/p\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"bash\"\u003e\u003cspan class=\"nv\"\u003e$ \u003c/span\u003ecurl \u003cspan class=\"nt\"\u003e-H\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Authorization: Bearer eyJhbGciOiJFUzI1NiIsImtpZCI6ImtleS0xIiwidHlwIjoiSldUIn0.eyJleHAiOjIwMjUxMDA3NTEsImlhdCI6MTcwOTc0MDc1MSwiaXNzIjoiZGVtb19pc3N1ZXIiLCJqdGkiOiI0NjExZDM5Yy00MzI1LTRhMWYtYjdkOC1iMmYxMTE3NDEyYzAiLCJuYmYiOjE3MDk3NDA3NTEsInJvbGUiOiJhZG1pbiIsInN1YiI6IjEifQ.mZZ_UqC8RVzEKBPZbPs4eP-MkXLK22Q27ZJ34UwJiioFdaYXqYJ4ZsatP0TbpKeNyF83mkrrCGL_pWLFTho7Gg\u0026#34;\u003c/span\u003e 127.0.0.1:9090/admin\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eWe can now access the endpoint and see the following output\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"bash\"\u003eHostname: 94e60bba8498\nIP: 127.0.0.1\nIP: 172.19.0.2\nRemoteAddr: 172.19.0.4:43688\nGET /admin HTTP/1.1\nHost: upstream:8081\nUser-Agent: curl/8.2.1\nAccept: \u003cspan class=\"k\"\u003e*\u003c/span\u003e/\u003cspan class=\"k\"\u003e*\u003c/span\u003e\nAccept-Encoding: \u003cspan class=\"nb\"\u003egzip\n\u003c/span\u003eAuthorization: Bearer eyJhbGciOiJFUzM4NCIsImtpZCI6IjEzNTQxODg3NGFiNzQwN2I3ZWQ0MmU5MmM4NWIzY2ZkNDJmZDk5NDgiLCJ0eXAiOiJKV1QifQ.eyJleHAiOjE3MDk3NDI2NzYsImlhdCI6MTcwOTc0MjM3NiwiaXNzIjoiaGVpbWRhbGwiLCJqdGkiOiJhYTZkZDE1MC0yMzhiLTQ2YWEtOTIzMi00MDRjMWNiMGM4ZDMiLCJuYmYiOjE3MDk3NDIzNzYsInN1YiI6IjEifQ.84QF4F7-WKSAV4KcC2Z_7SG4VkiEXg0fUu1hLS-zKR8-SfpM3XVphLz3QVg4aDXe4AxiNIfqyA5rE9ZEFnYAlFfWOIt2R7i0PZh2gf1PBOQMj6cMLbDSUw_YZ9x1XWcf\nForwarded: \u003cspan class=\"k\"\u003efor\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e172.19.0.1\u003cspan class=\"p\"\u003e;\u003c/span\u003e\u003cspan class=\"nv\"\u003ehost\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e127.0.0.1:9090\u003cspan class=\"p\"\u003e;\u003c/span\u003e\u003cspan class=\"nv\"\u003eproto\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003ehttp\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eTake a closer look at the JWT echoed by our service, e.g. by making use of \u003ca href=\"https://jwt.io\" class=\"bare\"\u003ehttps://jwt.io\u003c/a\u003e. It has been issued by heimdall and is not the token you’ve sent using curl.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eGuess what would happen, when we try the same request, but to the \u003ccode\u003e/user\u003c/code\u003e endpoint? You’re right, it will be refused due to the wrong role. Let us then use another JWT. Try the request shown below. It contains a token which should give us access.\u003c/p\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"bash\"\u003e\u003cspan class=\"nv\"\u003e$ \u003c/span\u003ecurl \u003cspan class=\"nt\"\u003e-H\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Authorization: Bearer eyJhbGciOiJFUzI1NiIsImtpZCI6ImtleS0xIiwidHlwIjoiSldUIn0.eyJleHAiOjIwMjUxMDA3NTEsImlhdCI6MTcwOTc0MDc1MSwiaXNzIjoiZGVtb19pc3N1ZXIiLCJqdGkiOiIzZmFmNDkxOS0wZjUwLTQ3NGItOGExMy0yOTYzMjEzNThlOTMiLCJuYmYiOjE3MDk3NDA3NTEsInJvbGUiOiJ1c2VyIiwic3ViIjoiMiJ9.W5xCpwsFShS0RpOtrm9vrV2dN6K8pRr5gQnt0kluzLE6oNWFzf7Oot-0YLCPa64Z3XPd7cfGcBiSjrzKZSAj4g\u0026#34;\u003c/span\u003e 127.0.0.1:9090/user\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eWas successful, right? We omitted the output for brevity reasons. This guide is already long enough.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eTry to send requests to the \u003ccode\u003e/private\u003c/code\u003e endpoint using any of the tokens from above. Yep. Useless. Heimdall will not let us through.\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_cleanup\"\u003eCleanup\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eJust stop the environment with \u003ccode\u003eCTRL-C\u003c/code\u003e and delete the created files. If you started docker compose in the background, tear the environment down with\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"bash\"\u003e\u003cspan class=\"nv\"\u003e$ \u003c/span\u003edocker-compose down\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n","sections":["Getting Started"],"tags":null,"title":"Protect an Application","url":"/docs/getting_started/protect_an_app/"},{"categories":null,"content":" Contour is an ingress controller for Kubernetes, implementing a control plane for Envoy edge and a service proxy.\nPrerequisites Integration with Contour requires heimdall being operated in Decision Operation Mode exposing Envoy’s external authorization GRPC protocol.\nBeing security first ingress controller, Contour enforces TLS for communication between Envoy and any external authorization service. For that reason, heimdall must be configured with an appropriate key material and certificate. Same is actually also true for the http route definition of the actual upstream service. The only exception is when configuring Contour using heimdall as a global external auth service.\nGeneral Configuration The official External Authorization Guide from Contour describes the required steps in great detail. While following it, please make attention to the following details specific to heimdall as described below.\nIf you use cert-manager, ensure the feature gate AdditionalCertificateOutputFormats is set to true. This lets cert-manager creating secrets with a property named tls-combined.pem, combining both the key and the certificate in one object, as also typically provided by any other CA and expected by heimdall.\nWhen you configure the Certificate resource to let cert-manager issue a TLS certificate for heimdall, configure the additionalOutputFormats property with the type CombinedPEM to make use of the aforesaid feature gate and have the tls-combined.pem property set in the resulting secret. Here a small snippet showing the relevant parts:\napiVersion: cert-manager.io/v1 kind: Certificate spec: # ... additionalOutputFormats: - type: CombinedPEM # ... If TLS is enabled, which, as said above, is required for integration with Contour, by default heimdall is configured to support TLS v1.3 only. However, it looks like Contour does not configure Envoy to support TLS v1.3 so that the communication with heimdall happens via TLS v1.2 and below. For that reason you have to configure the decision service of heimdall to TLS v1.2 being the minimum supported version. Otherwise, Envoy will not be able communicating with heimdall, resulting in 403 responses for any request. The following snippet shows the relevant parts in the heimdall configuration file:\n# ... serve: decision: tls: # important! see explanations above min_version: TLS1.2 key_store: # path to the pem file with key and certificates path: /certs/tls-combined.pem # ... Ensure heimdall is started in Decision Operation Mode exposing Envoy’s external authorization GRPC protocol (achieved by passing the --envoy-grpc flag while starting heimdall) and the required secret with the TLS key material is available to the heimdall container. The following snippet shows the relevant values configuration if you use helm for installing/updating heimdall:\nextraArgs: - --envoy-grpc deployment: volumes: - name: tls-cert-volume secret: secretName: \u0026lt;name of the corresponding secret\u0026gt; volumeMounts: - name: tls-cert-volume readOnly: true mountPath: /certs Define an ExtensionService as described in the referenced Contour guide for heimdall and also shown below\napiVersion: projectcontour.io/v1alpha1 kind: ExtensionService metadata: namespace: \u0026lt;namespace in which heimdall is installed\u0026gt; name: heimdall-ext-service spec: protocol: h2 services: - name: heimdall port: 4456 The ExtensionService resource definition tells Contour to program Envoy with an upstream cluster directing traffic to heimdall. That way, as also described in the Envoy Integration Guide, Envoy will delegate authentication and authorization to heimdall. If heimdall answers with a 200 OK HTTP code, Envoy grants access and forwards the original request to the upstream service. Otherwise, the response from heimdall is treated as an error and is returned to the client.\nGlobal Configuration A global configuration allows you to setup a single external authorization configuration for all your virtual hosts (HTTP and HTTPS). The only thing you have to do is to reference the ExtensionService, defined above in your Contour config. This is achieved with the following snippet:\nglobalExtAuth: extensionService: \u0026lt;namespace in which heimdall is installed\u0026gt;/\u0026lt;name of the extention service\u0026gt; failOpen: false responseTimeout: 1s You can now define your Ingress Rules. When using HTTPProxy resources instead, Contour allows overriding or disabling of the external auth service on the route level for HTTPs routes.\nRoute-based Configuration The only way to have route based external auth service configuration in Contour, is the usage of HTTPProxy resource instead of the regular Ingress rules, allowing referencing the ExtensionService. Here an example:\napiVersion: projectcontour.io/v1 kind: HTTPProxy metadata: name: echo-app namespace: quickstarts labels: app.kubernetes.io/name: echo-app spec: virtualhost: fqdn: echo-app.local tls: secretName: echo-app authorization: (1) extensionRef: namespace: heimdall name: heimdall-ext-service routes: - conditions: - prefix: / services: - name: echo-app port: 8080 1 Reference to the ExtensionService. Additional Resources Checkout the examples on GitHub for a working demo.\n","description":"This guide explains how to integrate heimdall with Contour, an open source, high performance ingress controller for Kubernetes.","html_content":"\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e\u003ca href=\"https://projectcontour.io/\"\u003eContour\u003c/a\u003e is an ingress controller for Kubernetes, implementing a control plane for \u003ca href=\"https://www.envoyproxy.io/\"\u003eEnvoy\u003c/a\u003e edge and a service proxy.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_prerequisites\"\u003ePrerequisites\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eIntegration with Contour requires heimdall being operated in \u003ca href=\"/docs/concepts/operating_modes/#_decision_mode\"\u003eDecision Operation Mode\u003c/a\u003e exposing Envoy’s external authorization \u003ca href=\"https://www.envoyproxy.io/docs/envoy/latest/api-v3/service/auth/v3/external_auth.proto\"\u003eGRPC protocol\u003c/a\u003e.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eBeing security first ingress controller, Contour enforces TLS for communication between Envoy and any external authorization service. For that reason, heimdall must be configured with an appropriate key material and certificate. Same is actually also true for the http route definition of the actual upstream service. The only exception is when configuring Contour using heimdall as a global external auth service.\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_general_configuration\"\u003eGeneral Configuration\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe official \u003ca href=\"https://projectcontour.io/docs/main/guides/external-authorization/\"\u003eExternal Authorization Guide\u003c/a\u003e from Contour describes the required steps in great detail. While following it, please make attention to the following details specific to heimdall as described below.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eIf you use \u003ca href=\"https://cert-manager.io/\"\u003ecert-manager\u003c/a\u003e, ensure the feature gate \u003ccode\u003eAdditionalCertificateOutputFormats\u003c/code\u003e is set to \u003ccode\u003etrue\u003c/code\u003e. This lets cert-manager creating secrets with a property named \u003ccode\u003etls-combined.pem\u003c/code\u003e, combining both the key and the certificate in one object, as also typically provided by any other CA and expected by heimdall.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eWhen you configure the \u003ccode\u003eCertificate\u003c/code\u003e resource to let cert-manager issue a TLS certificate for heimdall, configure the \u003ccode\u003eadditionalOutputFormats\u003c/code\u003e property with the type \u003ccode\u003eCombinedPEM\u003c/code\u003e to make use of the aforesaid feature gate and have the \u003ccode\u003etls-combined.pem\u003c/code\u003e property set in the resulting secret. Here a small snippet showing the relevant parts:\u003c/p\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"yaml\"\u003e\u003cspan class=\"na\"\u003eapiVersion\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ecert-manager.io/v1\u003c/span\u003e\n\u003cspan class=\"na\"\u003ekind\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eCertificate\u003c/span\u003e\n\u003cspan class=\"na\"\u003espec\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"c1\"\u003e# ...\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eadditionalOutputFormats\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003etype\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eCombinedPEM\u003c/span\u003e\n  \u003cspan class=\"c1\"\u003e# ...\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eIf TLS is enabled, which, as said above, is required for integration with Contour, by default heimdall is configured to support TLS v1.3 only. However, it looks like Contour does not configure Envoy to support TLS v1.3 so that the communication with heimdall happens via TLS v1.2 and below. For that reason you have to configure the decision service of heimdall to TLS v1.2 being the minimum supported version. Otherwise, Envoy will not be able communicating with heimdall, resulting in \u003ccode\u003e403\u003c/code\u003e responses for any request. The following snippet shows the relevant parts in the heimdall configuration file:\u003c/p\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"yaml\"\u003e\u003cspan class=\"c1\"\u003e# ...\u003c/span\u003e\n\u003cspan class=\"na\"\u003eserve\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"na\"\u003edecision\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"na\"\u003etls\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"c1\"\u003e# important! see explanations above\u003c/span\u003e\n      \u003cspan class=\"na\"\u003emin_version\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eTLS1.2\u003c/span\u003e\n      \u003cspan class=\"na\"\u003ekey_store\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e# path to the pem file with key and certificates\u003c/span\u003e\n        \u003cspan class=\"na\"\u003epath\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e/certs/tls-combined.pem\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e# ...\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eEnsure heimdall is started in \u003ca href=\"/docs/concepts/operating_modes/#_decision_mode\"\u003eDecision Operation Mode\u003c/a\u003e exposing Envoy’s external authorization \u003ca href=\"https://www.envoyproxy.io/docs/envoy/latest/api-v3/service/auth/v3/external_auth.proto\"\u003eGRPC protocol\u003c/a\u003e (achieved by passing the \u003ccode\u003e--envoy-grpc\u003c/code\u003e flag while starting heimdall) and the required secret with the TLS key material is available to the heimdall container. The following snippet shows the relevant values configuration if you use helm for installing/updating heimdall:\u003c/p\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"yaml\"\u003e\u003cspan class=\"na\"\u003eextraArgs\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003e--envoy-grpc\u003c/span\u003e\n\u003cspan class=\"na\"\u003edeployment\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"na\"\u003evolumes\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003ename\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003etls-cert-volume\u003c/span\u003e\n    \u003cspan class=\"na\"\u003esecret\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"na\"\u003esecretName\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026lt;name of the corresponding secret\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"na\"\u003evolumeMounts\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003ename\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003etls-cert-volume\u003c/span\u003e\n    \u003cspan class=\"na\"\u003ereadOnly\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\n    \u003cspan class=\"na\"\u003emountPath\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e/certs\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eDefine an \u003ca href=\"https://projectcontour.io/docs/1.25/config/api/#projectcontour.io/v1alpha1.ExtensionService\"\u003e\u003ccode\u003eExtensionService\u003c/code\u003e\u003c/a\u003e as described in the referenced Contour guide for heimdall and also shown below\u003c/p\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"yaml\"\u003e\u003cspan class=\"na\"\u003eapiVersion\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eprojectcontour.io/v1alpha1\u003c/span\u003e\n\u003cspan class=\"na\"\u003ekind\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eExtensionService\u003c/span\u003e\n\u003cspan class=\"na\"\u003emetadata\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"na\"\u003enamespace\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026lt;namespace in which heimdall is installed\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"na\"\u003ename\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eheimdall-ext-service\u003c/span\u003e\n\u003cspan class=\"na\"\u003espec\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eprotocol\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eh2\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eservices\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003ename\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eheimdall\u003c/span\u003e\n      \u003cspan class=\"na\"\u003eport\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e4456\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe \u003ccode\u003eExtensionService\u003c/code\u003e resource definition tells Contour to program Envoy with an upstream cluster directing traffic to heimdall. That way, as also described in the \u003ca href=\"/guides/proxies/envoy/\"\u003eEnvoy Integration Guide\u003c/a\u003e, Envoy will delegate authentication and authorization to heimdall. If heimdall answers with a \u003ccode\u003e200 OK\u003c/code\u003e HTTP code, Envoy grants access and forwards the original request to the upstream service. Otherwise, the response from heimdall is treated as an error and is returned to the client.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_global_configuration\"\u003eGlobal Configuration\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eA global configuration allows you to setup a single external authorization configuration for all your virtual hosts (HTTP and HTTPS). The only thing you have to do is to reference the \u003ccode\u003eExtensionService\u003c/code\u003e, defined above in your Contour config. This is achieved with the following snippet:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"yaml\"\u003e\u003cspan class=\"na\"\u003eglobalExtAuth\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eextensionService\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026lt;namespace in which heimdall is installed\u0026gt;/\u0026lt;name of the extention service\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"na\"\u003efailOpen\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003efalse\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eresponseTimeout\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e1s\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eYou can now define your \u003ca href=\"https://kubernetes.io/docs/concepts/services-networking/ingress/#the-ingress-resource\"\u003eIngress Rules\u003c/a\u003e. When using \u003ca href=\"https://projectcontour.io/docs/1.25/config/api/#projectcontour.io/v1.HTTPProxy\"\u003e\u003ccode\u003eHTTPProxy\u003c/code\u003e\u003c/a\u003e resources instead, Contour allows overriding or disabling of the external auth service on the route level for HTTPs routes.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_route_based_configuration\"\u003eRoute-based Configuration\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe only way to have route based external auth service configuration in Contour, is the usage of \u003ca href=\"https://projectcontour.io/docs/1.25/config/api/#projectcontour.io/v1.HTTPProxy\"\u003e\u003ccode\u003eHTTPProxy\u003c/code\u003e\u003c/a\u003e resource instead of the regular Ingress rules, allowing referencing the \u003ccode\u003eExtensionService\u003c/code\u003e. Here an example:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"yaml\"\u003e\u003cspan class=\"na\"\u003eapiVersion\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eprojectcontour.io/v1\u003c/span\u003e\n\u003cspan class=\"na\"\u003ekind\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eHTTPProxy\u003c/span\u003e\n\u003cspan class=\"na\"\u003emetadata\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"na\"\u003ename\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eecho-app\u003c/span\u003e\n  \u003cspan class=\"na\"\u003enamespace\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003equickstarts\u003c/span\u003e\n  \u003cspan class=\"na\"\u003elabels\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"na\"\u003eapp.kubernetes.io/name\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eecho-app\u003c/span\u003e\n\u003cspan class=\"na\"\u003espec\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"na\"\u003evirtualhost\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"na\"\u003efqdn\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eecho-app.local\u003c/span\u003e\n    \u003cspan class=\"na\"\u003etls\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"na\"\u003esecretName\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eecho-app\u003c/span\u003e\n    \u003cspan class=\"na\"\u003eauthorization\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003ci class=\"conum\" data-value=\"1\"\u003e\u003c/i\u003e\u003cb\u003e(1)\u003c/b\u003e\n      \u003cspan class=\"na\"\u003eextensionRef\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"na\"\u003enamespace\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eheimdall\u003c/span\u003e\n        \u003cspan class=\"na\"\u003ename\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eheimdall-ext-service\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eroutes\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003econditions\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eprefix\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e/\u003c/span\u003e\n      \u003cspan class=\"na\"\u003eservices\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003ename\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eecho-app\u003c/span\u003e\n          \u003cspan class=\"na\"\u003eport\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e8080\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"colist arabic\"\u003e\n\u003ctable\u003e\n\u003ctbody\u003e\u003ctr\u003e\n\u003ctd\u003e\u003ci class=\"conum\" data-value=\"1\"\u003e\u003c/i\u003e\u003cb\u003e1\u003c/b\u003e\u003c/td\u003e\n\u003ctd\u003eReference to the \u003ccode\u003eExtensionService\u003c/code\u003e.\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_additional_resources\"\u003eAdditional Resources\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eCheckout the examples on \u003ca href=\"https://github.com/dadrus/heimdall/tree/main/examples\"\u003eGitHub\u003c/a\u003e for a working demo.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n","sections":["Guides","API Gateways \u0026 Proxies"],"tags":null,"title":"Contour Integration","url":"/guides/proxies/contour/"},{"categories":null,"content":" Overview Pipelines are specified in rules and are used to authenticate and authorize the particular requests, as well as to handle encountered errors.\nAs described in the Discover heimdall chapter and also shown in the diagram below, central aspects of heimdall are upstream specific pipelines, which allow you orchestrating different services to authenticate, enrich and authorize incoming HTTP requests, transform the resulting subject information into a format, or obtain credentials required for the communication with the particular upstream services.\nFigure 1. Authentication \u0026amp; Authorization Pipeline Authentication \u0026amp; Authorization Pipeline Even the figure above shows four steps, these are actually organized in three stages as depicted in the diagram below. Each of these stages is assembled by as many mechanisms (which represent the actual steps), as required to fulfill the corresponding requirements.\nFigure 2. Pipeline Stages Authentication Stage: In that stage you can use any amount of authentication mechanisms, to let heimdall communicate with the actual authentication systems. This can be getting information about the authenticated subject of the request, getting key material to verify the authentication information provided in the request, or perform some other activities related to authentication. This stage is mandatory, which means, at least one authentication mechanism must be specified. If multiple are specified, the subsequent ones are only executed if the previous either fail or were not responsible for the authentication data available with the request.\nAuthorization Stage: In that stage you can make use of any amount of contextualization and authorization mechanisms in any order to fulfill your authorization requirements. Here, you let heimdall communicate with other systems to collect contextual information required for authorization purposes (like e.g. getting the country for the IP, the request came from, retrieving subscription status of your customer, etc), and to perform the actual authorization, e.g. by talking to an Open Policy Agent, OpenFGA, any other type of authorization system, or even let heimdall perform the required checks locally. That stage is optional and is only executed after the successful execution of the authentication stage. The mechanisms specified in it are executed in order of their definition.\nFinalization Stage: In that stage, you can use any amount of finalization mechanisms to complete the pipeline execution and allows you transforming the information collected about the subject in the previous stages into a format expected or required by your upstream service, or even driving specific protocols, e.g. to obtain a token required by the upstream service. That stage is optional and is only executed after the successful execution of the previous stage. The mechanisms specified in it are executed in order of their definition.\nStages are implicit. That is, a pipeline is just a list of mechanisms to be executed in the specified order. That means, all authentication mechanisms must be specified before any contextualization, authorization or finalization mechanisms are specified, with all finalization mechanisms required to be specified at the end. Violation of that rule will let heimdall refuse loading of the particular rule. Error Pipeline Obviously, a mechanism used in the previously described Authentication \u0026amp; Authorization Pipeline may fail. That will result in the execution of the error pipeline, which is basically a list of error handler mechanisms, ranging from a simple error response to the client (which sent the request) to sophisticated ones supporting complex logic and redirects. Mechanisms in this pipeline define conditions under which they are executed. The first mechanism, which condition evaluates to true is executed and other are ignored. If conditions of all mechanisms fail, the default error handler is executed (see also below).\nThe error pipeline is optional. If no error handlers are defined, heimdall will just response with an HTTP response code based on the error raised in the authentication \u0026amp; authorization pipeline.\n","description":"Pipelines let you orchestrate existing authentication and authorization systems via mechanisms.","html_content":"\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_overview\"\u003eOverview\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003ePipelines are specified in \u003ca href=\"/docs/concepts/rules/\"\u003erules\u003c/a\u003e and are used to authenticate and authorize the particular requests, as well as to handle encountered errors.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eAs described in the \u003ca href=\"/docs/getting_started/discover_heimdall/\"\u003eDiscover heimdall\u003c/a\u003e chapter and also shown in the diagram below, central aspects of heimdall are upstream specific pipelines, which allow you orchestrating different services to authenticate, enrich and authorize incoming HTTP requests, transform the resulting subject information into a format, or obtain credentials required for the communication with the particular upstream services.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv id=\"_fig_heimdall_request_pipeline\" class=\"imageblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cimg src=\"diag-ditaa-md5-92616c018b7cc4e879c86947d2cf5d7c.svg\" alt=\"Diagram\" width=\"1290\" height=\"294\"/\u003e\n\u003c/div\u003e\n\u003cdiv class=\"title\"\u003eFigure 1. Authentication \u0026amp; Authorization Pipeline\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_authentication_authorization_pipeline\"\u003eAuthentication \u0026amp; Authorization Pipeline\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eEven the figure above shows four steps, these are actually organized in three stages as depicted in the diagram below. Each of these stages is assembled by as many \u003ca href=\"/docs/concepts/mechanisms/\"\u003emechanisms\u003c/a\u003e (which represent the actual steps), as required to fulfill the corresponding requirements.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"imageblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cimg src=\"diag-ditaa-md5-f2a2cc62dbb0fff1aea173b6d0a9aba7.svg\" alt=\"Diagram\" width=\"1340\" height=\"490\"/\u003e\n\u003c/div\u003e\n\u003cdiv class=\"title\"\u003eFigure 2. Pipeline Stages\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eAuthentication Stage:\u003c/strong\u003e In that stage you can use any amount of \u003ca href=\"/docs/mechanisms/authenticators/\"\u003eauthentication\u003c/a\u003e mechanisms, to let heimdall communicate with the actual authentication systems. This can be getting information about the authenticated subject of the request, getting key material to verify the authentication information provided in the request, or perform some other activities related to authentication. This stage is mandatory, which means, at least one authentication mechanism must be specified. If multiple are specified, the subsequent ones are only executed if the previous either fail or were not responsible for the authentication data available with the request.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eAuthorization Stage:\u003c/strong\u003e In that stage you can make use of any amount of \u003ca href=\"/docs/mechanisms/contextualizers/\"\u003econtextualization\u003c/a\u003e and \u003ca href=\"/docs/mechanisms/authorizers/\"\u003eauthorization\u003c/a\u003e mechanisms in any order to fulfill your authorization requirements. Here, you let heimdall communicate with other systems to collect contextual information required for authorization purposes (like e.g. getting the country for the IP, the request came from, retrieving subscription status of your customer, etc), and to perform the actual authorization, e.g. by talking to an Open Policy Agent, OpenFGA, any other type of authorization system, or even let heimdall perform the required checks locally. That stage is optional and is only executed after the successful execution of the authentication stage. The mechanisms specified in it are executed in order of their definition.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eFinalization Stage:\u003c/strong\u003e In that stage, you can use any amount of \u003ca href=\"/docs/mechanisms/finalizers/\"\u003efinalization\u003c/a\u003e mechanisms to complete the pipeline execution and allows you transforming the information collected about the subject in the previous stages into a format expected or required by your upstream service, or even driving specific protocols, e.g. to obtain a token required by the upstream service. That stage is optional and is only executed after the successful execution of the previous stage. The mechanisms specified in it are executed in order of their definition.\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"admonitionblock note\"\u003e\n\u003ctable\u003e\n\u003ctbody\u003e\u003ctr\u003e\n\u003ctd class=\"icon\"\u003e\n\u003ci class=\"fa icon-note\" title=\"Note\"\u003e\u003c/i\u003e\n\u003c/td\u003e\n\u003ctd class=\"content\"\u003e\nStages are implicit. That is, a pipeline is just a list of mechanisms to be executed in the specified order. That means, all \u003ca href=\"/docs/mechanisms/authenticators/\"\u003eauthentication\u003c/a\u003e mechanisms must be specified before any \u003ca href=\"/docs/mechanisms/contextualizers/\"\u003econtextualization\u003c/a\u003e, \u003ca href=\"/docs/mechanisms/authorizers/\"\u003eauthorization\u003c/a\u003e or \u003ca href=\"/docs/mechanisms/finalizers/\"\u003efinalization\u003c/a\u003e mechanisms are specified, with all \u003ca href=\"/docs/mechanisms/finalizers/\"\u003efinalization\u003c/a\u003e mechanisms required to be specified at the end. Violation of that rule will let heimdall refuse loading of the particular rule.\n\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_error_pipeline\"\u003eError Pipeline\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eObviously, a \u003ca href=\"/docs/concepts/mechanisms/\"\u003emechanism\u003c/a\u003e used in the previously described \u003ca href=\"#_authentication_authorization_pipeline\"\u003eAuthentication \u0026amp; Authorization Pipeline\u003c/a\u003e may fail. That will result in the execution of the error pipeline, which is basically a list of \u003ca href=\"/docs/mechanisms/error_handlers/\"\u003eerror handler\u003c/a\u003e mechanisms, ranging from a simple error response to the client (which sent the request) to sophisticated ones supporting complex logic and redirects. Mechanisms in this pipeline define conditions under which they are executed. The first mechanism, which condition evaluates to true is executed and other are ignored. If conditions of all mechanisms fail, the default error handler is executed (see also below).\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe error pipeline is optional. If no error handlers are defined, heimdall will just response with an HTTP response code based on the error raised in the authentication \u0026amp; authorization pipeline.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n","sections":["Concepts"],"tags":null,"title":"Pipelines","url":"/docs/concepts/pipelines/"},{"categories":null,"content":" Emissary-Ingress is an Envoy-powered open source, high performance ingress controller and API Gateway for Kubernetes from Ambassador Labs. Integration happens by letting Emissary-Ingress delegating authentication and authorization to heimdall. If heimdall answers with a 2XX code, the ingress controller will grant access and forwards the original request to the upstream service. Otherwise, the response from heimdall is returned to the client.\nPrerequisites Integration with Emissary-Ingress requires heimdall being operated in Decision Operation Mode.\nGlobal Configuration Integration with Emissary-Ingress can be achieved either\nby creating an AuthService resource for heimdall, or\nby creating an External Filter if you’re using the commercial Ambassador Edge Stack.\nIn both cases the underlying Envoy proxy will be configured to delegate authentication and authorization of all incoming requests for all routes to heimdall. The code snippet below shows the corresponding AuthService resource which configures Emissary Ingress to let Envoy communicate over the GRPC protocol with heimdall.\napiVersion: getambassador.io/v3alpha1 kind: AuthService metadata: name: heimdall namespace: heimdall spec: auth_service: \u0026#34;https://\u0026lt;heimdall service name\u0026gt;.\u0026lt;namespace\u0026gt;.svc.cluster.local:\u0026lt;decision port\u0026gt;\u0026#34; (1) proto: grpc protocol_version: v3 (2) 1 Configures the controller to use heimdall’s decision service endpoint with \u0026lt;heimdall service name\u0026gt;, \u0026lt;namespace\u0026gt; and \u0026lt;decision port\u0026gt; depending on your configuration. If heimdall is not operated in the same namespace as the ingress controller, it is important to configure the full DNS, otherwise Envoy will not be able to resolve the IP of heimdall. 2 Sets the used Envoy’s ExtAuth GRPC protocol version to v3, as this is the only version supported by heimdall. If not set, Emissary will default to v2. The integration option shown above requires usage of the --envoy-grpc flag when starting heimdall. Unlike e.g. Contour, Emissary-Ingress allows however the usage of both, the Envoy’s external authorization GRPC protocol (used here), and the plain HTTP protocol. Route-Level configuration The single available configuration option on route level only supports disabling of request forwarding. That can be achieved by configuring a Mapping resource and setting bypass_auth to true (see also Bypass authentication).\nAdditional Resources Checkout the examples on GitHub for a working demo.\n","description":"This guide explains how to integrate heimdall with Emissary-Ingress Controller.","html_content":"\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e\u003ca href=\"https://www.getambassador.io/products/api-gateway\"\u003eEmissary-Ingress\u003c/a\u003e is an Envoy-powered open source, high performance ingress controller and API Gateway for Kubernetes from \u003ca href=\"https://www.getambassador.io/\"\u003eAmbassador Labs\u003c/a\u003e. Integration happens by letting Emissary-Ingress delegating authentication and authorization to heimdall. If heimdall answers with a 2XX code, the ingress controller will grant access and forwards the original request to the upstream service. Otherwise, the response from heimdall is returned to the client.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_prerequisites\"\u003ePrerequisites\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eIntegration with Emissary-Ingress requires heimdall being operated in \u003ca href=\"/docs/concepts/operating_modes/#_decision_mode\"\u003eDecision Operation Mode\u003c/a\u003e.\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_global_configuration\"\u003eGlobal Configuration\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eIntegration with Emissary-Ingress can be achieved either\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eby creating an \u003ca href=\"https://www.getambassador.io/docs/emissary/latest/topics/running/services/auth-service\"\u003e\u003ccode\u003eAuthService\u003c/code\u003e\u003c/a\u003e resource for heimdall, or\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eby creating an \u003ca href=\"https://www.getambassador.io/docs/edge-stack/latest/topics/using/filters/external\"\u003eExternal Filter\u003c/a\u003e if you’re using the commercial \u003ca href=\"https://www.getambassador.io/docs/edge-stack\"\u003eAmbassador Edge Stack\u003c/a\u003e.\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eIn both cases the underlying Envoy proxy will be configured to delegate authentication and authorization of all incoming requests for all routes to heimdall. The code snippet below shows the corresponding \u003ccode\u003eAuthService\u003c/code\u003e resource which configures Emissary Ingress to let Envoy communicate over the GRPC protocol with heimdall.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"yaml\"\u003e\u003cspan class=\"na\"\u003eapiVersion\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003egetambassador.io/v3alpha1\u003c/span\u003e\n\u003cspan class=\"na\"\u003ekind\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eAuthService\u003c/span\u003e\n\u003cspan class=\"na\"\u003emetadata\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"na\"\u003ename\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eheimdall\u003c/span\u003e\n  \u003cspan class=\"na\"\u003enamespace\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eheimdall\u003c/span\u003e\n\u003cspan class=\"na\"\u003espec\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eauth_service\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"s\"\u003ehttps://\u0026lt;heimdall\u003c/span\u003e\u003cspan class=\"nv\"\u003e \u003c/span\u003e\u003cspan class=\"s\"\u003eservice\u003c/span\u003e\u003cspan class=\"nv\"\u003e \u003c/span\u003e\u003cspan class=\"s\"\u003ename\u0026gt;.\u0026lt;namespace\u0026gt;.svc.cluster.local:\u0026lt;decision\u003c/span\u003e\u003cspan class=\"nv\"\u003e \u003c/span\u003e\u003cspan class=\"s\"\u003eport\u0026gt;\u0026#34;\u003c/span\u003e \u003ci class=\"conum\" data-value=\"1\"\u003e\u003c/i\u003e\u003cb\u003e(1)\u003c/b\u003e\n  \u003cspan class=\"na\"\u003eproto\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003egrpc\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eprotocol_version\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ev3\u003c/span\u003e \u003ci class=\"conum\" data-value=\"2\"\u003e\u003c/i\u003e\u003cb\u003e(2)\u003c/b\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"colist arabic\"\u003e\n\u003ctable\u003e\n\u003ctbody\u003e\u003ctr\u003e\n\u003ctd\u003e\u003ci class=\"conum\" data-value=\"1\"\u003e\u003c/i\u003e\u003cb\u003e1\u003c/b\u003e\u003c/td\u003e\n\u003ctd\u003eConfigures the controller to use heimdall’s decision service endpoint with \u003ccode\u003e\u0026lt;heimdall service name\u0026gt;\u003c/code\u003e, \u003ccode\u003e\u0026lt;namespace\u0026gt;\u003c/code\u003e and \u003ccode\u003e\u0026lt;decision port\u0026gt;\u003c/code\u003e depending on your configuration. If heimdall is not operated in the same namespace as the ingress controller, it is important to configure the full DNS, otherwise Envoy will not be able to resolve the IP of heimdall.\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003ci class=\"conum\" data-value=\"2\"\u003e\u003c/i\u003e\u003cb\u003e2\u003c/b\u003e\u003c/td\u003e\n\u003ctd\u003eSets the used Envoy’s ExtAuth GRPC protocol version to v3, as this is the only version supported by heimdall. If not set, Emissary will default to v2.\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003cdiv class=\"admonitionblock note\"\u003e\n\u003ctable\u003e\n\u003ctbody\u003e\u003ctr\u003e\n\u003ctd class=\"icon\"\u003e\n\u003ci class=\"fa icon-note\" title=\"Note\"\u003e\u003c/i\u003e\n\u003c/td\u003e\n\u003ctd class=\"content\"\u003e\nThe integration option shown above requires usage of the \u003ccode\u003e--envoy-grpc\u003c/code\u003e flag when starting heimdall. Unlike e.g. Contour, Emissary-Ingress allows however the usage of both, the \u003ca href=\"https://www.envoyproxy.io/docs/envoy/latest/api-v3/service/auth/v3/external_auth.proto\"\u003eEnvoy’s external authorization GRPC\u003c/a\u003e protocol (used here), and the plain HTTP protocol.\n\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_route_level_configuration\"\u003eRoute-Level configuration\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe single available configuration option on route level only supports disabling of request forwarding. That can be achieved by configuring a \u003ca href=\"https://www.getambassador.io/docs/edge-stack/latest/topics/using/intro-mappings#introduction-to-the-mapping-resource\"\u003e\u003ccode\u003eMapping\u003c/code\u003e\u003c/a\u003e resource and setting \u003ccode\u003ebypass_auth\u003c/code\u003e to \u003ccode\u003etrue\u003c/code\u003e (see also \u003ca href=\"https://www.getambassador.io/docs/edge-stack/latest/topics/using/authservice#bypass-authentication\"\u003eBypass authentication\u003c/a\u003e).\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_additional_resources\"\u003eAdditional Resources\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eCheckout the examples on \u003ca href=\"https://github.com/dadrus/heimdall/tree/main/examples\"\u003eGitHub\u003c/a\u003e for a working demo.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n","sections":["Guides","API Gateways \u0026 Proxies"],"tags":null,"title":"Emissary Ingress Integration","url":"/guides/proxies/emissary/"},{"categories":null,"content":" Mechanism Categories All supported mechanisms fall into the following five categories, each implementing different mechanisms types (addressing different protocols or scenarios):\nAuthenticators, which inspect HTTP requests for presence of authentication objects, like e.g. the presence of a specific cookie. If such objects exist, authenticators verify the related authentication status and obtain information about the corresponding subject. A subject, could be a user who tries to use particular functionality of the upstream service, a machine (if you have machine-2-machine interaction), or something different. Authenticators ensure the subject is authenticated and the information available about it is valid.\nAuthorizers, which ensure that the subject obtained via an authenticator has the required permissions to submit the given HTTP request and thus to execute the corresponding logic in the upstream service. E.g. a specific endpoint of the upstream service might only be accessible to a \u0026#34;user\u0026#34; from the \u0026#34;admin\u0026#34; group, or to an HTTP request if a specific HTTP header is set.\nContextualizers, which enrich the information about the subject obtained via an authenticator with further contextual information, required either by the upstream service itself or an authorizer. This can be handy if the actual authentication system doesn’t have all information about the subject (which is usually the case in microservice architectures), or if dynamic information about the subject, like the current location based on the IP address, is required.\nFinalizers, which, as the name implies, finalize the execution of the pipeline and enrich the request with data such as subject information or authentication tokens required by the upstream service. The available options range from doing nothing, adding a simple header over a structured JWT, to driving specific protocols, e.g. to obtain a token required by the upstream service.\nError Handlers, which are responsible for execution of logic if any of the mechanisms described above fail. These range from a simple error response to the client, which sent the request, to sophisticated ones, supporting complex logic and redirects.\nAll mechanisms are stateless. Even some of them support caching, the corresponding data is not stored on the mechanisms level. An in-memory key-value store is used instead. Mechanisms Catalogue Those mechanisms, which should be available for usage in rules, must be defined/configured first. That suits the following purposes:\nMechanisms are per se generic and must be configured for usage in particular use cases.\nThat configuration provides useful default behavior addressing your particular requirements, like which identity management system to use, etc.\nOnly those mechanisms, which are defined can be used in rules. With other words, if you do not define any mechanism, you cannot define any rule.\nThat makes the definition of rules also very simple - just reference the required mechanisms and \u0026#34;tune\u0026#34; the configuration, specified in the catalogue only if required. Not everything can be tuned though.\nIt also provides secure defaults. E.g. that way you can ensure heimdall communicates only to those systems, you allowed.\n","description":"Mechanisms are the building blocks for rule specific pipelines and define the required behavior for these.","html_content":"\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_mechanism_categories\"\u003eMechanism Categories\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eAll supported mechanisms fall into the following five categories, each implementing different mechanisms types (addressing different protocols or scenarios):\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ca href=\"/docs/mechanisms/authenticators/\"\u003eAuthenticators\u003c/a\u003e, which inspect HTTP requests for presence of authentication objects, like e.g. the presence of a specific cookie. If such objects exist, authenticators verify the related authentication status and obtain information about the corresponding subject. A subject, could be a user who tries to use particular functionality of the upstream service, a machine (if you have machine-2-machine interaction), or something different. Authenticators ensure the subject is authenticated and the information available about it is valid.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ca href=\"/docs/mechanisms/authorizers/\"\u003eAuthorizers\u003c/a\u003e, which ensure that the subject obtained via an authenticator has the required permissions to submit the given HTTP request and thus to execute the corresponding logic in the upstream service. E.g. a specific endpoint of the upstream service might only be accessible to a \u0026#34;user\u0026#34; from the \u0026#34;admin\u0026#34; group, or to an HTTP request if a specific HTTP header is set.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ca href=\"/docs/mechanisms/contextualizers/\"\u003eContextualizers\u003c/a\u003e, which enrich the information about the subject obtained via an authenticator with further contextual information, required either by the upstream service itself or an authorizer. This can be handy if the actual authentication system doesn’t have all information about the subject (which is usually the case in microservice architectures), or if dynamic information about the subject, like the current location based on the IP address, is required.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ca href=\"/docs/mechanisms/finalizers/\"\u003eFinalizers\u003c/a\u003e, which, as the name implies, finalize the execution of the pipeline and enrich the request with data such as subject information or authentication tokens required by the upstream service. The available options range from doing nothing, adding a simple header over a structured JWT, to driving specific protocols, e.g. to obtain a token required by the upstream service.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ca href=\"/docs/mechanisms/error_handlers/\"\u003eError Handlers\u003c/a\u003e, which are responsible for execution of logic if any of the mechanisms described above fail. These range from a simple error response to the client, which sent the request, to sophisticated ones, supporting complex logic and redirects.\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"admonitionblock note\"\u003e\n\u003ctable\u003e\n\u003ctbody\u003e\u003ctr\u003e\n\u003ctd class=\"icon\"\u003e\n\u003ci class=\"fa icon-note\" title=\"Note\"\u003e\u003c/i\u003e\n\u003c/td\u003e\n\u003ctd class=\"content\"\u003e\nAll mechanisms are stateless. Even some of them support caching, the corresponding data is not stored on the mechanisms level. An in-memory key-value store is used instead.\n\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_mechanisms_catalogue\"\u003eMechanisms Catalogue\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThose mechanisms, which should be available for usage in rules, must be defined/configured first. That suits the following purposes:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eMechanisms are per se generic and must be configured for usage in particular use cases.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eThat configuration provides useful default behavior addressing your particular requirements, like which identity management system to use, etc.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eOnly those mechanisms, which are defined can be used in rules. With other words, if you do not define any mechanism, you cannot define any rule.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eThat makes the definition of rules also very simple - just reference the required mechanisms and \u0026#34;tune\u0026#34; the configuration, specified in the catalogue only if required. Not everything can be tuned though.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eIt also provides secure defaults. E.g. that way you can ensure heimdall communicates only to those systems, you allowed.\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n","sections":["Concepts"],"tags":null,"title":"Mechanisms ","url":"/docs/concepts/mechanisms/"},{"categories":null,"content":" Envoy is a high performance distributed proxy designed for single services and applications, as well as a communication bus and “universal data plane” designed for large microservice “service mesh” architectures. When operating heimdall in Decision Operation Mode, integration with Envoy can be achieved by making use of an External Authorization filter. In such setup, Envoy delegates authentication and authorization to heimdall. If heimdall answers with a 200 OK HTTP code, Envoy grants access and forwards the original request to the upstream service. Otherwise, the response from heimdall is treated as an error and is returned to the client.\nTo achieve this, configure Envoy\nto have heimdall instances referenced in a cluster\nFollowing snippet provides an example on how to create a cluster instance referencing heimdall. It assumes, you have just one heimdall instance deployed, which is also available via heimdall DNS name.\nclusters: # other cluster entries - name: ext-authz type: strict_dns load_assignment: cluster_name: ext-authz endpoints: - lb_endpoints: - endpoint: address: socket_address: address: heimdall port_value: 4456 # other cluster entries If you want to integrate via Envoy’s grpc_service (see below), the cluster entry from above must have http2_protocol_options configured, as otherwise envoy will use HTTP 1 for GRPC communication, which is actually not allowed by GRPC (only HTTP 2 is supported). Here is an updated snipped:\nclusters: # other cluster entries - name: ext-authz type: strict_dns typed_extension_protocol_options: envoy.extensions.upstreams.http.v3.HttpProtocolOptions: \u0026#34;@type\u0026#34;: type.googleapis.com/envoy.extensions.upstreams.http.v3.HttpProtocolOptions explicit_http_config: http2_protocol_options: {} load_assignment: cluster_name: ext-authz endpoints: - lb_endpoints: - endpoint: address: socket_address: address: heimdall port_value: 4456 # other cluster entries to include an External Authorization HTTP filter in the definition of the HTTP connection manager and depending on the used configuration, either configure the http_service and let it contain the required header name(s), heimdall sets in the HTTP responses (depends on your Contextualizers and Finalizers configuration), or configure the grpc_service.\nThe following snipped shows, how an External Authorization can be defined using http_service to let Envoy communicating with heimdall by making use of the previously defined cluster (see snippet from above) as well as forwarding all request headers to heimdall and to let it forward headers, set by heimdall in its responses (here the Authorization header) to the upstream services.\nhttp_filters: # other http filter - name: envoy.filters.http.ext_authz typed_config: \u0026#34;@type\u0026#34;: type.googleapis.com/envoy.extensions.filters.http.ext_authz.v3.ExtAuthz transport_api_version: V3 http_service: server_uri: uri: heimdall:4456 cluster: ext-authz timeout: 0.25s authorization_request: allowed_headers: patterns: - safe_regex: google_re2: {} regex: \u0026#34;.*\u0026#34; authorization_response: allowed_upstream_headers: patterns: - exact: authorization # other http filter The following snipped shows, how an External Authorization can be defined using grpc_service to let Envoy communicating with heimdall by making use of the previously defined cluster (see snippet from above). In that configuration envoy by default forwards all request header to heimdall and also forwards headers, set by heimdall in its responses to the upstream services.\nhttp_filters: # other http filter - name: envoy.filters.http.ext_authz typed_config: \u0026#34;@type\u0026#34;: type.googleapis.com/envoy.extensions.filters.http.ext_authz.v3.ExtAuthz transport_api_version: V3 grpc_service: envoy_grpc: cluster_name: ext-authz # other http filter Envoy does not set X-Forwarded-* headers, as long as the envoy.filters.http.dynamic_forward_proxy is not configured. In such cases matching of URLs happens based on those URLs, used by Envoy while communicating with heimdall. That means your rules should ignore the scheme and host parts, respectively use the values specific for heimdall and not of the domain. Please follow Security Considerations if your rules rely on any of the X-Forwarded-* headers, and you integrate heimdall with envoy using http_service.\nIf you integrate heimdall with envoy via grpc_service, spoofing of the aforesaid headers is not possible.\nDemo Setup The Envoy configuration file shown below can be used to create a fully working setup based on the quickstart described in Protect an Application and set up to implement Edge-level Authorization Architecture. Just update the docker-compose.yaml file used in that guide and replace the entry for proxy service, with the one shown below. You can also remove all labels configurations, as these will have no effect.\n# docker-compose.yaml services: proxy: image: envoyproxy/envoy:v1.24.1 volumes: - ./envoy.yaml:/envoy.yaml:ro ports: - 9090:9090 command: -c /envoy.yaml # other services from the guide # envoy.yaml static_resources: listeners: - name: listener_0 address: socket_address: address: 0.0.0.0 port_value: 9090 filter_chains: - filters: - name: envoy.filters.network.http_connection_manager typed_config: \u0026#34;@type\u0026#34;: type.googleapis.com/envoy.extensions.filters.network.http_connection_manager.v3.HttpConnectionManager stat_prefix: edge http_filters: - name: envoy.filters.http.ext_authz typed_config: \u0026#34;@type\u0026#34;: type.googleapis.com/envoy.extensions.filters.http.ext_authz.v3.ExtAuthz transport_api_version: V3 http_service: server_uri: uri: heimdall:4456 cluster: ext-authz timeout: 0.25s authorization_request: allowed_headers: patterns: - safe_regex: google_re2: {} regex: \u0026#34;.*\u0026#34; authorization_response: allowed_upstream_headers: patterns: - exact: authorization - name: envoy.filters.http.router typed_config: \u0026#34;@type\u0026#34;: type.googleapis.com/envoy.extensions.filters.http.router.v3.Router route_config: virtual_hosts: - name: direct_response_service domains: [\u0026#34;*\u0026#34;] routes: - match: prefix: \u0026#34;/\u0026#34; route: cluster: services clusters: - name: ext-authz type: strict_dns load_assignment: cluster_name: ext-authz endpoints: - lb_endpoints: - endpoint: address: socket_address: address: heimdall port_value: 4456 - name: services connect_timeout: 5s type: strict_dns dns_lookup_family: V4_ONLY load_assignment: cluster_name: services endpoints: - lb_endpoints: - endpoint: address: socket_address: address: upstream port_value: 80 After starting the docker compose environment, you can run the curl commands shown in the referenced guide. This time however against envoy by using port 9090. E.g. $ curl -v 127.0.0.1:9090/anonymous. By the way, this setup is also available on GitHub.\n","description":"Explains how to integrate heimdall with Envoy, a high performance distributed proxy.","html_content":"\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e\u003ca href=\"https://www.envoyproxy.io/\"\u003eEnvoy\u003c/a\u003e is a high performance distributed proxy designed for single services and applications, as well as a communication bus and “universal data plane” designed for large microservice “service mesh” architectures. When operating heimdall in \u003ca href=\"/docs/concepts/operating_modes/#_decision_mode\"\u003eDecision Operation Mode\u003c/a\u003e, integration with Envoy can be achieved by making use of an \u003ca href=\"https://www.envoyproxy.io/docs/envoy/latest/api-v3/extensions/filters/http/ext_authz/v3/ext_authz.proto.html\"\u003eExternal Authorization\u003c/a\u003e filter. In such setup, Envoy delegates authentication and authorization to heimdall. If heimdall answers with a \u003ccode\u003e200 OK\u003c/code\u003e HTTP code, Envoy grants access and forwards the original request to the upstream service. Otherwise, the response from heimdall is treated as an error and is returned to the client.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eTo achieve this, configure Envoy\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eto have heimdall instances referenced in a \u003ccode\u003ecluster\u003c/code\u003e\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eFollowing snippet provides an example on how to create a \u003ccode\u003ecluster\u003c/code\u003e instance referencing heimdall. It assumes, you have just one heimdall instance deployed, which is also available via \u003ccode\u003eheimdall\u003c/code\u003e DNS name.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"yaml\"\u003e\u003cspan class=\"na\"\u003eclusters\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"c1\"\u003e# other cluster entries\u003c/span\u003e\n  \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003ename\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eext-authz\u003c/span\u003e\n    \u003cspan class=\"na\"\u003etype\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003estrict_dns\u003c/span\u003e\n    \u003cspan class=\"na\"\u003eload_assignment\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"na\"\u003ecluster_name\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eext-authz\u003c/span\u003e\n      \u003cspan class=\"na\"\u003eendpoints\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003elb_endpoints\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eendpoint\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n                \u003cspan class=\"na\"\u003eaddress\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n                  \u003cspan class=\"na\"\u003esocket_address\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n                    \u003cspan class=\"na\"\u003eaddress\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eheimdall\u003c/span\u003e\n                    \u003cspan class=\"na\"\u003eport_value\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"m\"\u003e4456\u003c/span\u003e\n  \u003cspan class=\"c1\"\u003e# other cluster entries\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eIf you want to integrate via Envoy’s \u003ccode\u003egrpc_service\u003c/code\u003e (see below), the cluster entry from above must have \u003ccode\u003ehttp2_protocol_options\u003c/code\u003e configured, as otherwise envoy will use HTTP 1 for GRPC communication, which is actually not allowed by GRPC (only HTTP 2 is supported). Here is an updated snipped:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"yaml\"\u003e\u003cspan class=\"na\"\u003eclusters\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"c1\"\u003e# other cluster entries\u003c/span\u003e\n  \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003ename\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eext-authz\u003c/span\u003e\n    \u003cspan class=\"na\"\u003etype\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003estrict_dns\u003c/span\u003e\n    \u003cspan class=\"na\"\u003etyped_extension_protocol_options\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"na\"\u003eenvoy.extensions.upstreams.http.v3.HttpProtocolOptions\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"s\"\u003e@type\u0026#34;\u003c/span\u003e\u003cspan class=\"err\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003etype.googleapis.com/envoy.extensions.upstreams.http.v3.HttpProtocolOptions\u003c/span\u003e\n        \u003cspan class=\"s\"\u003eexplicit_http_config\u003c/span\u003e\u003cspan class=\"err\"\u003e:\u003c/span\u003e\n          \u003cspan class=\"na\"\u003ehttp2_protocol_options\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"pi\"\u003e{}\u003c/span\u003e\n    \u003cspan class=\"na\"\u003eload_assignment\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"na\"\u003ecluster_name\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eext-authz\u003c/span\u003e\n      \u003cspan class=\"na\"\u003eendpoints\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003elb_endpoints\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eendpoint\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n                \u003cspan class=\"na\"\u003eaddress\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n                  \u003cspan class=\"na\"\u003esocket_address\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n                    \u003cspan class=\"na\"\u003eaddress\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eheimdall\u003c/span\u003e\n                    \u003cspan class=\"na\"\u003eport_value\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"m\"\u003e4456\u003c/span\u003e\n  \u003cspan class=\"c1\"\u003e# other cluster entries\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eto include an \u003ca href=\"https://www.envoyproxy.io/docs/envoy/latest/api-v3/extensions/filters/http/ext_authz/v3/ext_authz.proto.html\"\u003eExternal Authorization\u003c/a\u003e HTTP filter in the definition of the HTTP connection manager and depending on the used configuration, either configure the \u003ccode\u003ehttp_service\u003c/code\u003e and let it contain the required header name(s), heimdall sets in the HTTP responses (depends on your \u003ca href=\"/docs/mechanisms/contextualizers/\"\u003eContextualizers\u003c/a\u003e and \u003ca href=\"/docs/mechanisms/finalizers/\"\u003eFinalizers\u003c/a\u003e configuration), or configure the \u003ccode\u003egrpc_service\u003c/code\u003e.\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe following snipped shows, how an \u003ca href=\"https://www.envoyproxy.io/docs/envoy/latest/api-v3/extensions/filters/http/ext_authz/v3/ext_authz.proto.html\"\u003eExternal Authorization\u003c/a\u003e can be defined using \u003ccode\u003ehttp_service\u003c/code\u003e to let Envoy communicating with heimdall by making use of the previously defined \u003ccode\u003ecluster\u003c/code\u003e (see snippet from above) as well as forwarding all request headers to heimdall and to let it forward headers, set by heimdall in its responses (here the \u003ccode\u003eAuthorization\u003c/code\u003e header) to the upstream services.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"yaml\"\u003e\u003cspan class=\"na\"\u003ehttp_filters\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"c1\"\u003e# other http filter\u003c/span\u003e\n  \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003ename\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eenvoy.filters.http.ext_authz\u003c/span\u003e\n    \u003cspan class=\"na\"\u003etyped_config\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"s\"\u003e@type\u0026#34;\u003c/span\u003e\u003cspan class=\"err\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003etype.googleapis.com/envoy.extensions.filters.http.ext_authz.v3.ExtAuthz\u003c/span\u003e\n      \u003cspan class=\"s\"\u003etransport_api_version\u003c/span\u003e\u003cspan class=\"err\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eV3\u003c/span\u003e\n      \u003cspan class=\"s\"\u003ehttp_service\u003c/span\u003e\u003cspan class=\"err\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"na\"\u003eserver_uri\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n          \u003cspan class=\"na\"\u003euri\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eheimdall:4456\u003c/span\u003e\n          \u003cspan class=\"na\"\u003ecluster\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eext-authz\u003c/span\u003e\n          \u003cspan class=\"na\"\u003etimeout\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e0.25s\u003c/span\u003e\n        \u003cspan class=\"na\"\u003eauthorization_request\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n          \u003cspan class=\"na\"\u003eallowed_headers\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"na\"\u003epatterns\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n              \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003esafe_regex\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n                  \u003cspan class=\"na\"\u003egoogle_re2\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"pi\"\u003e{}\u003c/span\u003e\n                  \u003cspan class=\"na\"\u003eregex\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"s\"\u003e.*\u0026#34;\u003c/span\u003e\n        \u003cspan class=\"na\"\u003eauthorization_response\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n          \u003cspan class=\"na\"\u003eallowed_upstream_headers\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"na\"\u003epatterns\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n              \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eexact\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eauthorization\u003c/span\u003e\n  \u003cspan class=\"c1\"\u003e# other http filter\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe following snipped shows, how an \u003ca href=\"https://www.envoyproxy.io/docs/envoy/latest/api-v3/extensions/filters/http/ext_authz/v3/ext_authz.proto.html\"\u003eExternal Authorization\u003c/a\u003e can be defined using \u003ccode\u003egrpc_service\u003c/code\u003e to let Envoy communicating with heimdall by making use of the previously defined \u003ccode\u003ecluster\u003c/code\u003e (see snippet from above). In that configuration envoy by default forwards all request header to heimdall and also forwards headers, set by heimdall in its responses to the upstream services.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"yaml\"\u003e\u003cspan class=\"na\"\u003ehttp_filters\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"c1\"\u003e# other http filter\u003c/span\u003e\n  \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003ename\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eenvoy.filters.http.ext_authz\u003c/span\u003e\n    \u003cspan class=\"na\"\u003etyped_config\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"s\"\u003e@type\u0026#34;\u003c/span\u003e\u003cspan class=\"err\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003etype.googleapis.com/envoy.extensions.filters.http.ext_authz.v3.ExtAuthz\u003c/span\u003e\n      \u003cspan class=\"s\"\u003etransport_api_version\u003c/span\u003e\u003cspan class=\"err\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eV3\u003c/span\u003e\n      \u003cspan class=\"s\"\u003egrpc_service\u003c/span\u003e\u003cspan class=\"err\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"na\"\u003eenvoy_grpc\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n          \u003cspan class=\"na\"\u003ecluster_name\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eext-authz\u003c/span\u003e\n  \u003cspan class=\"c1\"\u003e# other http filter\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"admonitionblock note\"\u003e\n\u003ctable\u003e\n\u003ctbody\u003e\u003ctr\u003e\n\u003ctd class=\"icon\"\u003e\n\u003ci class=\"fa icon-note\" title=\"Note\"\u003e\u003c/i\u003e\n\u003c/td\u003e\n\u003ctd class=\"content\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eEnvoy does not set \u003ccode\u003eX-Forwarded-*\u003c/code\u003e headers, as long as the \u003ccode\u003eenvoy.filters.http.dynamic_forward_proxy\u003c/code\u003e is not configured. In such cases matching of URLs happens based on those URLs, used by Envoy while communicating with heimdall. That means your rules should ignore the scheme and host parts, respectively use the values specific for heimdall and not of the domain. Please follow \u003ca href=\"/docs/operations/security/#_http_headers_security_considerations\"\u003eSecurity Considerations\u003c/a\u003e if your rules rely on any of the \u003ccode\u003eX-Forwarded-*\u003c/code\u003e headers, and you integrate heimdall with envoy using \u003ccode\u003ehttp_service\u003c/code\u003e.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eIf you integrate heimdall with envoy via \u003ccode\u003egrpc_service\u003c/code\u003e, spoofing of the aforesaid headers is not possible.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_demo_setup\"\u003eDemo Setup\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe Envoy configuration file shown below can be used to create a fully working setup based on the quickstart described in \u003ca href=\"/docs/getting_started/protect_an_app/\"\u003eProtect an Application\u003c/a\u003e and set up to implement Edge-level Authorization Architecture. Just update the \u003ccode\u003edocker-compose.yaml\u003c/code\u003e file used in that guide and replace the entry for \u003ccode\u003eproxy\u003c/code\u003e service, with the one shown below. You can also remove all \u003ccode\u003elabels\u003c/code\u003e configurations, as these will have no effect.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"yaml\"\u003e\u003cspan class=\"c1\"\u003e# docker-compose.yaml\u003c/span\u003e\n\n\u003cspan class=\"na\"\u003eservices\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eproxy\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"na\"\u003eimage\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eenvoyproxy/envoy:v1.24.1\u003c/span\u003e\n    \u003cspan class=\"na\"\u003evolumes\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003e./envoy.yaml:/envoy.yaml:ro\u003c/span\u003e\n    \u003cspan class=\"na\"\u003eports\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003e9090:9090\u003c/span\u003e\n    \u003cspan class=\"na\"\u003ecommand\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e-c /envoy.yaml\u003c/span\u003e\n\n  \u003cspan class=\"c1\"\u003e# other services from the guide\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"yaml\"\u003e\u003cspan class=\"c1\"\u003e# envoy.yaml\u003c/span\u003e\n\n\u003cspan class=\"na\"\u003estatic_resources\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"na\"\u003elisteners\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003ename\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003elistener_0\u003c/span\u003e\n      \u003cspan class=\"na\"\u003eaddress\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"na\"\u003esocket_address\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n          \u003cspan class=\"na\"\u003eaddress\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e0.0.0.0\u003c/span\u003e\n          \u003cspan class=\"na\"\u003eport_value\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"m\"\u003e9090\u003c/span\u003e\n      \u003cspan class=\"na\"\u003efilter_chains\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003efilters\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n          \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003ename\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eenvoy.filters.network.http_connection_manager\u003c/span\u003e\n            \u003cspan class=\"na\"\u003etyped_config\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n              \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"s\"\u003e@type\u0026#34;\u003c/span\u003e\u003cspan class=\"err\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003etype.googleapis.com/envoy.extensions.filters.network.http_connection_manager.v3.HttpConnectionManager\u003c/span\u003e\n              \u003cspan class=\"s\"\u003estat_prefix\u003c/span\u003e\u003cspan class=\"err\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eedge\u003c/span\u003e\n              \u003cspan class=\"s\"\u003ehttp_filters\u003c/span\u003e\u003cspan class=\"err\"\u003e:\u003c/span\u003e\n                \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003ename\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eenvoy.filters.http.ext_authz\u003c/span\u003e\n                  \u003cspan class=\"na\"\u003etyped_config\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n                    \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"s\"\u003e@type\u0026#34;\u003c/span\u003e\u003cspan class=\"err\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003etype.googleapis.com/envoy.extensions.filters.http.ext_authz.v3.ExtAuthz\u003c/span\u003e\n                    \u003cspan class=\"s\"\u003etransport_api_version\u003c/span\u003e\u003cspan class=\"err\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eV3\u003c/span\u003e\n                    \u003cspan class=\"s\"\u003ehttp_service\u003c/span\u003e\u003cspan class=\"err\"\u003e:\u003c/span\u003e\n                      \u003cspan class=\"na\"\u003eserver_uri\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n                        \u003cspan class=\"na\"\u003euri\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eheimdall:4456\u003c/span\u003e\n                        \u003cspan class=\"na\"\u003ecluster\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eext-authz\u003c/span\u003e\n                        \u003cspan class=\"na\"\u003etimeout\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e0.25s\u003c/span\u003e\n                      \u003cspan class=\"na\"\u003eauthorization_request\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n                        \u003cspan class=\"na\"\u003eallowed_headers\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n                          \u003cspan class=\"na\"\u003epatterns\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n                            \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003esafe_regex\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n                                \u003cspan class=\"na\"\u003egoogle_re2\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"pi\"\u003e{}\u003c/span\u003e\n                                \u003cspan class=\"na\"\u003eregex\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"s\"\u003e.*\u0026#34;\u003c/span\u003e\n                      \u003cspan class=\"na\"\u003eauthorization_response\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n                        \u003cspan class=\"na\"\u003eallowed_upstream_headers\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n                          \u003cspan class=\"na\"\u003epatterns\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n                            \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eexact\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eauthorization\u003c/span\u003e\n                \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003ename\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eenvoy.filters.http.router\u003c/span\u003e\n                  \u003cspan class=\"na\"\u003etyped_config\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n                    \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"s\"\u003e@type\u0026#34;\u003c/span\u003e\u003cspan class=\"err\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003etype.googleapis.com/envoy.extensions.filters.http.router.v3.Router\u003c/span\u003e\n              \u003cspan class=\"na\"\u003eroute_config\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n                \u003cspan class=\"na\"\u003evirtual_hosts\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n                  \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003ename\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003edirect_response_service\u003c/span\u003e\n                    \u003cspan class=\"na\"\u003edomains\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"pi\"\u003e[\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"s\"\u003e*\u0026#34;\u003c/span\u003e\u003cspan class=\"pi\"\u003e]\u003c/span\u003e\n                    \u003cspan class=\"na\"\u003eroutes\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n                      \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003ematch\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n                          \u003cspan class=\"na\"\u003eprefix\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"s\"\u003e/\u0026#34;\u003c/span\u003e\n                        \u003cspan class=\"na\"\u003eroute\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n                          \u003cspan class=\"na\"\u003ecluster\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eservices\u003c/span\u003e\n\n  \u003cspan class=\"na\"\u003eclusters\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003ename\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eext-authz\u003c/span\u003e\n      \u003cspan class=\"na\"\u003etype\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003estrict_dns\u003c/span\u003e\n      \u003cspan class=\"na\"\u003eload_assignment\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"na\"\u003ecluster_name\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eext-authz\u003c/span\u003e\n        \u003cspan class=\"na\"\u003eendpoints\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n          \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003elb_endpoints\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n              \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eendpoint\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n                  \u003cspan class=\"na\"\u003eaddress\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n                    \u003cspan class=\"na\"\u003esocket_address\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n                      \u003cspan class=\"na\"\u003eaddress\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eheimdall\u003c/span\u003e\n                      \u003cspan class=\"na\"\u003eport_value\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"m\"\u003e4456\u003c/span\u003e\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003ename\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eservices\u003c/span\u003e\n      \u003cspan class=\"na\"\u003econnect_timeout\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e5s\u003c/span\u003e\n      \u003cspan class=\"na\"\u003etype\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003estrict_dns\u003c/span\u003e\n      \u003cspan class=\"na\"\u003edns_lookup_family\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eV4_ONLY\u003c/span\u003e\n      \u003cspan class=\"na\"\u003eload_assignment\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"na\"\u003ecluster_name\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eservices\u003c/span\u003e\n        \u003cspan class=\"na\"\u003eendpoints\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n          \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003elb_endpoints\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n              \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eendpoint\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n                  \u003cspan class=\"na\"\u003eaddress\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n                    \u003cspan class=\"na\"\u003esocket_address\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n                      \u003cspan class=\"na\"\u003eaddress\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eupstream\u003c/span\u003e\n                      \u003cspan class=\"na\"\u003eport_value\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e80\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eAfter starting the docker compose environment, you can run the curl commands shown in the referenced guide. This time however against envoy by using port 9090. E.g. \u003ccode\u003e$ curl -v 127.0.0.1:9090/anonymous\u003c/code\u003e. By the way, this setup is also available on \u003ca href=\"https://github.com/dadrus/heimdall/tree/main/examples\"\u003eGitHub\u003c/a\u003e.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n","sections":["Guides","API Gateways \u0026 Proxies"],"tags":null,"title":"Envoy Integration","url":"/guides/proxies/envoy/"},{"categories":null,"content":" You can compare the relation between mechanisms and rules to a relation between a catalogue at a car dealer and a real car, when you get it. So, mechanisms is what you can see and select in a catalogue (though, in case of heimdall you have to define that catalogue first) to compile your car and the rule is your car with real components and behaviour. In that sense when you define a rule, you specify which mechanisms should it be built from and whether you would like some \u0026#34;tuning\u0026#34; to be applied to better suit your needs.\nRule Types Heimdall supports two types of rules:\nThe upstream specific rule, also called the regular rule. You can define as many regular rules, as required. These rules are dynamic by nature and can come and go together with the upstream service defining these.\nThe default rule, which, if defined, is used by the regular rules to inherit their behaviour and is also executed if no other rule matches.\nMemory Footprint Even the first paragraphs compare mechanisms and the rules with a catalogue of car parts and a real car, things are a bit more complex in reality.\nTo minimize the memory footprint, heimdall instanciates all defined mechanisms on start up. And since all mechanisms are stateless, following is happening at runtime, when the rule is loaded:\nIf a rule, respectively its pipeline just references a mechanism without providing additional configuration, the already instantiated mechanism is used.\nOtherwise, if the pipeline overrides any parts of the default mechanism configuration, a shallow copy of the referenced mechanism instance (created at start up) is created, and only those parts, which differ are replaced with new objects, representing the pipeline specific configuration.\nExecution of Rules The diagram below sketches the logic executed by heimdall for each and every incoming request.\nAny rule matching url? - This is the first step executed by heimdall in which it tries to find a rule matching the request url. The information about the scheme, host, path and query is taken either from the URL itself, or if present and allowed, from the X-Forwarded-Proto, X-Forwarded-Host, or X-Forwarded-Uri headers of the incoming request. The request is denied if there is no matching rule, respectively no default rule. Otherwise, the rule specific pipeline is executed. When heimdall is evaluating the rules against the request url it takes the first matching one.\nMethod allowed? - As soon as a rule matching the request is found (which might also be the default rule if specified and there was no regular rule matching the request), a check is done whether the used HTTP method is allowed or not. The information about the HTTP method is either taken from the request itself or, if present and allowed, from the X-Forwarded-Method header.\nExecute authentication \u0026amp; authorization pipeline - when the above steps succeed, the mechanisms defined in this pipeline are executed.\nForward request, respectively respond to the API gateway - when the above steps succeed, heimdall, depending on the operating mode, responds with, respectively forwards whatever was defined in the pipeline (usually this is a set of HTTP headers). Otherwise\nExecute error pipeline is executed if any of the mechanisms, defined in the authentiction \u0026amp; authorization pipeline fail. This again results in a response, this time however, based on the definition in the used error handler.\nDefault Rule \u0026amp; Inheritance The Rule Types section tells, that a default rule can be used as a base to inherit behavior for the regular rule.\nIn principle, there is a need to differentiate two things:\nthe defined rule, which is what you define\nthe effective rule, which is what is executed at runtime\nThis is comparable to the polymorphism concept in programming languages. So, how does it work?\nImagine, the concept of a rule is e.g. an interface written in Java defining the following methods:\npublic interface Rule { public boolean checkMethods(methods []String) public void executeAuthenticationStage(req Request) public void executeAuthorizationStage(req Request) public void executeFinalizationStage(req Request) public void handleError(req Request) } And the logic described in Execution of Rules is implemented similar to what is shown in the snippet below\nRule rule = findMatchingRule(req) if (!rule.checkMethods(req)) { throw new MethodNotAllowedError() } try { // execution of the authentication \u0026amp; authorization pipeline rule.executeAuthenticationStage(req) rule.executeAuthorizationStage(req) rule.executeFinalizationStage(req) // further logic related to response creation } catch(Exception e) { // execution of the error pipeline rule.handleError(req) // further logic related to response creation } with findMatchingRule returning a specific instance of a class implementing our Rule interface matching the request.\nSince there is some default behaviour in place, like error handling, if the error pipeline is empty, and some stages of the authentication \u0026amp; authorization pipeline is optional, internally, there is some kind of base rule in place, all other rules inherit from. So something like shown in the snippet below.\npublic abstract class BaseRule implements Rule { public abstract boolean checkMethods(methods []String) public abstract void executeAuthenticationStage(req Request) public void executeAuthorizationStage(req Request) {} public void executeFinalizationStage(req Request) {} public void handleError(req Request) { handlerErrorDefault(req) } } If there is no default rule configured, an upstream specific rule can then be considered as a class inheriting from that BaseRule and must implement at least the two checkMethods and executeAuthenticationStage methods, similar to what is shown below\npublic class MySpecificRule extends BaseRule { public boolean checkMethods(methods []String) { ... } public void executeAuthenticationStage(req Request) { ... } } If however, there is a default rule configured, on one hand, it can be considered as yet another class deriving from our BaseClass. So, something like\npublic class DefaultRule extends BaseRule { public boolean checkMethods(methods []String) { ... } public void executeAuthenticationStage(req Request) { ... } public void executeAuthorizationStage(req Request) { ... } public void executeFinalizationStage(req Request) { ... } public void handleError(req Request) { ... } } with at least the aforesaid two checkMethods and executeAuthenticationStage methods being implemented as this is also required for the regular rule.\nOn the other hand, the definition of a regular, respectively upstream specific rule is then not a class deriving from the BaseRule, but from the DefaultRule. That way, upstream specific rules are only required, if the behavior of the default rule would not fit the given requirements of a particular service, respectively endpoint. So, if e.g. a rule requires only the authentication stage to be different from the default rule, you would only specify the required authentication mechanisms. That would result in something like shown in the snippet below.\npublic class SpecificRule extends DefaultRule { public void executeAuthenticationStage(req Request) { ... } } And if there is a need to have the authorization stage deviating from the default rule, you would only specify the required authorization and contextualization mechanisms, resulting in something like\npublic class SpecificRule extends DefaultRule { public void executeAuthorizationStage(req Request) { ... } } You cannot override a single mechanism of a particular stage. As soon as you define a single mechanism in a pipeline, belonging to the one or the other stage, the entire stage is overridden. ","description":"Rules defines what should happen to particular requests and under which conditions. They assemble the authentication \u0026 authorization and error pipelines and bring previously configured mechanisms to life.","html_content":"\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eYou can compare the relation between mechanisms and rules to a relation between a catalogue at a car dealer and a real car, when you get it. So, mechanisms is what you can see and select in a catalogue (though, in case of heimdall you have to define that catalogue first) to compile your car and the rule is your car with real components and behaviour. In that sense when you define a rule, you specify which mechanisms should it be built from and whether you would like some \u0026#34;tuning\u0026#34; to be applied to better suit your needs.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_rule_types\"\u003eRule Types\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eHeimdall supports two types of rules:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eThe \u003ca href=\"/docs/rules/regular_rule/\"\u003eupstream specific rule\u003c/a\u003e, also called the regular rule. You can define as many regular rules, as required. These rules are dynamic by nature and can come and go together with the upstream service defining these.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eThe \u003ca href=\"/docs/rules/regular_rule/\"\u003edefault rule\u003c/a\u003e, which, if defined, is used by the regular rules to inherit their behaviour and is also executed if no other rule matches.\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_memory_footprint\"\u003eMemory Footprint\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eEven the first paragraphs compare mechanisms and the rules with a catalogue of car parts and a real car, things are a bit more complex in reality.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eTo minimize the memory footprint, heimdall instanciates all defined mechanisms on start up. And since all mechanisms are stateless, following is happening at runtime, when the rule is loaded:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eIf a rule, respectively its pipeline just references a mechanism without providing additional configuration, the already instantiated mechanism is used.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eOtherwise, if the pipeline overrides any parts of the default mechanism configuration, a shallow copy of the referenced mechanism instance (created at start up) is created, and only those parts, which differ are replaced with new objects, representing the pipeline specific configuration.\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_execution_of_rules\"\u003eExecution of Rules\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe diagram below sketches the logic executed by heimdall for each and every incoming request.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"imageblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cimg src=\"diag-mermaid-md5-f28e9c0a6e35d943083199cd08d0e812.svg\" alt=\"Diagram\" width=\"70%\" height=\"999\"/\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"olist arabic\"\u003e\n\u003col class=\"arabic\"\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eAny rule matching url?\u003c/strong\u003e - This is the first step executed by heimdall in which it tries to find a rule matching the request url. The information about the scheme, host, path and query is taken either from the URL itself, or if present and allowed, from the \u003ccode\u003eX-Forwarded-Proto\u003c/code\u003e, \u003ccode\u003eX-Forwarded-Host\u003c/code\u003e, or \u003ccode\u003eX-Forwarded-Uri\u003c/code\u003e headers of the incoming request. The request is denied if there is no matching rule, respectively no default rule. Otherwise, the rule specific pipeline is executed. When heimdall is evaluating the rules against the request url it takes the first matching one.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eMethod allowed?\u003c/strong\u003e - As soon as a rule matching the request is found (which might also be the default rule if specified and there was no regular rule matching the request), a check is done whether the used HTTP method is allowed or not. The information about the HTTP method is either taken from the request itself or, if present and allowed, from the \u003ccode\u003eX-Forwarded-Method\u003c/code\u003e header.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eExecute authentication \u0026amp; authorization pipeline\u003c/strong\u003e - when the above steps succeed, the mechanisms defined in this pipeline are executed.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eForward request, respectively respond to the API gateway\u003c/strong\u003e - when the above steps succeed, heimdall, depending on the \u003ca href=\"/docs/concepts/operating_modes/\"\u003eoperating mode\u003c/a\u003e, responds with, respectively forwards whatever was defined in the pipeline (usually this is a set of HTTP headers). Otherwise\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eExecute error pipeline\u003c/strong\u003e is executed if any of the mechanisms, defined in the authentiction \u0026amp; authorization pipeline fail. This again results in a response, this time however, based on the definition in the used error handler.\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_default_rule_inheritance\"\u003eDefault Rule \u0026amp; Inheritance\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe \u003ca href=\"#_rule_types\"\u003eRule Types\u003c/a\u003e section tells, that a default rule can be used as a base to inherit behavior for the regular rule.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eIn principle, there is a need to differentiate two things:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003ethe defined rule, which is what you define\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003ethe effective rule, which is what is executed at runtime\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThis is comparable to the polymorphism concept in programming languages. So, how does it work?\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eImagine, the concept of a rule is e.g. an interface written in Java defining the following methods:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"java\"\u003e\u003cspan class=\"kd\"\u003epublic\u003c/span\u003e \u003cspan class=\"kd\"\u003einterface\u003c/span\u003e \u003cspan class=\"nc\"\u003eRule\u003c/span\u003e \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003eboolean\u003c/span\u003e \u003cspan class=\"nf\"\u003echeckMethods\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emethods\u003c/span\u003e \u003cspan class=\"o\"\u003e[]\u003c/span\u003e\u003cspan class=\"nc\"\u003eString\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eexecuteAuthenticationStage\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ereq\u003c/span\u003e \u003cspan class=\"nc\"\u003eRequest\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eexecuteAuthorizationStage\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ereq\u003c/span\u003e \u003cspan class=\"nc\"\u003eRequest\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eexecuteFinalizationStage\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ereq\u003c/span\u003e \u003cspan class=\"nc\"\u003eRequest\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003ehandleError\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ereq\u003c/span\u003e \u003cspan class=\"nc\"\u003eRequest\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003cspan class=\"o\"\u003e}\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eAnd the logic described in \u003ca href=\"#_execution_of_rules\"\u003eExecution of Rules\u003c/a\u003e is implemented similar to what is shown in the snippet below\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"java\"\u003e\u003cspan class=\"nc\"\u003eRule\u003c/span\u003e \u003cspan class=\"n\"\u003erule\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003efindMatchingRule\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ereq\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"o\"\u003e(!\u003c/span\u003e\u003cspan class=\"n\"\u003erule\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003echeckMethods\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ereq\u003c/span\u003e\u003cspan class=\"o\"\u003e))\u003c/span\u003e \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"k\"\u003ethrow\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eMethodNotAllowedError\u003c/span\u003e\u003cspan class=\"o\"\u003e()\u003c/span\u003e\n\u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003etry\u003c/span\u003e \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"c1\"\u003e// execution of the authentication \u0026amp; authorization pipeline\u003c/span\u003e\n  \u003cspan class=\"n\"\u003erule\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003eexecuteAuthenticationStage\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ereq\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"n\"\u003erule\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003eexecuteAuthorizationStage\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ereq\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"n\"\u003erule\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003eexecuteFinalizationStage\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ereq\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\n  \u003cspan class=\"c1\"\u003e// further logic related to response creation\u003c/span\u003e\n\u003cspan class=\"o\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003ecatch\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"nc\"\u003eException\u003c/span\u003e \u003cspan class=\"n\"\u003ee\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"c1\"\u003e// execution of the error pipeline\u003c/span\u003e\n  \u003cspan class=\"n\"\u003erule\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003ehandleError\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ereq\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\n  \u003cspan class=\"c1\"\u003e// further logic related to response creation\u003c/span\u003e\n\u003cspan class=\"o\"\u003e}\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003ewith \u003ccode\u003efindMatchingRule\u003c/code\u003e returning a specific instance of a class implementing our \u003ccode\u003eRule\u003c/code\u003e interface matching the request.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eSince there is some default behaviour in place, like error handling, if the error pipeline is empty, and some stages of the authentication \u0026amp; authorization pipeline is optional, internally, there is some kind of base rule in place, all other rules inherit from. So something like shown in the snippet below.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"java\"\u003e\u003cspan class=\"kd\"\u003epublic\u003c/span\u003e \u003cspan class=\"kd\"\u003eabstract\u003c/span\u003e \u003cspan class=\"kd\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eBaseRule\u003c/span\u003e \u003cspan class=\"kd\"\u003eimplements\u003c/span\u003e \u003cspan class=\"nc\"\u003eRule\u003c/span\u003e \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003epublic\u003c/span\u003e \u003cspan class=\"kd\"\u003eabstract\u003c/span\u003e \u003cspan class=\"kt\"\u003eboolean\u003c/span\u003e \u003cspan class=\"nf\"\u003echeckMethods\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emethods\u003c/span\u003e \u003cspan class=\"o\"\u003e[]\u003c/span\u003e\u003cspan class=\"nc\"\u003eString\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003epublic\u003c/span\u003e \u003cspan class=\"kd\"\u003eabstract\u003c/span\u003e \u003cspan class=\"kt\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eexecuteAuthenticationStage\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ereq\u003c/span\u003e \u003cspan class=\"nc\"\u003eRequest\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eexecuteAuthorizationStage\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ereq\u003c/span\u003e \u003cspan class=\"nc\"\u003eRequest\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e{}\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eexecuteFinalizationStage\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ereq\u003c/span\u003e \u003cspan class=\"nc\"\u003eRequest\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e{}\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003ehandleError\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ereq\u003c/span\u003e \u003cspan class=\"nc\"\u003eRequest\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003ehandlerErrorDefault\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ereq\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003cspan class=\"o\"\u003e}\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eIf there is no default rule configured, an upstream specific rule can then be considered as a class inheriting from that \u003ccode\u003eBaseRule\u003c/code\u003e and must implement at least the two \u003ccode\u003echeckMethods\u003c/code\u003e and \u003ccode\u003eexecuteAuthenticationStage\u003c/code\u003e methods, similar to what is shown below\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"java\"\u003e\u003cspan class=\"kd\"\u003epublic\u003c/span\u003e \u003cspan class=\"kd\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eMySpecificRule\u003c/span\u003e \u003cspan class=\"kd\"\u003eextends\u003c/span\u003e \u003cspan class=\"nc\"\u003eBaseRule\u003c/span\u003e \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003eboolean\u003c/span\u003e \u003cspan class=\"nf\"\u003echeckMethods\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emethods\u003c/span\u003e \u003cspan class=\"o\"\u003e[]\u003c/span\u003e\u003cspan class=\"nc\"\u003eString\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e{\u003c/span\u003e \u003cspan class=\"o\"\u003e...\u003c/span\u003e \u003cspan class=\"o\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eexecuteAuthenticationStage\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ereq\u003c/span\u003e \u003cspan class=\"nc\"\u003eRequest\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e{\u003c/span\u003e \u003cspan class=\"o\"\u003e...\u003c/span\u003e \u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003cspan class=\"o\"\u003e}\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eIf however, there is a default rule configured, on one hand, it can be considered as yet another class deriving from our \u003ccode\u003eBaseClass\u003c/code\u003e. So, something like\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"java\"\u003e\u003cspan class=\"kd\"\u003epublic\u003c/span\u003e \u003cspan class=\"kd\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eDefaultRule\u003c/span\u003e \u003cspan class=\"kd\"\u003eextends\u003c/span\u003e \u003cspan class=\"nc\"\u003eBaseRule\u003c/span\u003e \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003eboolean\u003c/span\u003e \u003cspan class=\"nf\"\u003echeckMethods\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emethods\u003c/span\u003e \u003cspan class=\"o\"\u003e[]\u003c/span\u003e\u003cspan class=\"nc\"\u003eString\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e{\u003c/span\u003e \u003cspan class=\"o\"\u003e...\u003c/span\u003e \u003cspan class=\"o\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eexecuteAuthenticationStage\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ereq\u003c/span\u003e \u003cspan class=\"nc\"\u003eRequest\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e{\u003c/span\u003e \u003cspan class=\"o\"\u003e...\u003c/span\u003e \u003cspan class=\"o\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eexecuteAuthorizationStage\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ereq\u003c/span\u003e \u003cspan class=\"nc\"\u003eRequest\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e{\u003c/span\u003e \u003cspan class=\"o\"\u003e...\u003c/span\u003e \u003cspan class=\"o\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eexecuteFinalizationStage\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ereq\u003c/span\u003e \u003cspan class=\"nc\"\u003eRequest\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e{\u003c/span\u003e \u003cspan class=\"o\"\u003e...\u003c/span\u003e \u003cspan class=\"o\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003ehandleError\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ereq\u003c/span\u003e \u003cspan class=\"nc\"\u003eRequest\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e{\u003c/span\u003e \u003cspan class=\"o\"\u003e...\u003c/span\u003e \u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003cspan class=\"o\"\u003e}\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003ewith at least the aforesaid two \u003ccode\u003echeckMethods\u003c/code\u003e and \u003ccode\u003eexecuteAuthenticationStage\u003c/code\u003e methods being implemented as this is also required for the regular rule.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eOn the other hand, the definition of a regular, respectively upstream specific rule is then not a class deriving from the \u003ccode\u003eBaseRule\u003c/code\u003e, but from the \u003ccode\u003eDefaultRule\u003c/code\u003e. That way, upstream specific rules are only required, if the behavior of the default rule would not fit the given requirements of a particular service, respectively endpoint. So, if e.g. a rule requires only the authentication stage to be different from the default rule, you would only specify the required authentication mechanisms. That  would result in something like shown in the snippet below.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"java\"\u003e\u003cspan class=\"kd\"\u003epublic\u003c/span\u003e \u003cspan class=\"kd\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eSpecificRule\u003c/span\u003e \u003cspan class=\"kd\"\u003eextends\u003c/span\u003e \u003cspan class=\"nc\"\u003eDefaultRule\u003c/span\u003e \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eexecuteAuthenticationStage\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ereq\u003c/span\u003e \u003cspan class=\"nc\"\u003eRequest\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e{\u003c/span\u003e \u003cspan class=\"o\"\u003e...\u003c/span\u003e \u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003cspan class=\"o\"\u003e}\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eAnd if there is a need to have the authorization stage deviating from the default rule, you would only specify the required authorization and contextualization mechanisms, resulting in something like\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"java\"\u003e\u003cspan class=\"kd\"\u003epublic\u003c/span\u003e \u003cspan class=\"kd\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eSpecificRule\u003c/span\u003e \u003cspan class=\"kd\"\u003eextends\u003c/span\u003e \u003cspan class=\"nc\"\u003eDefaultRule\u003c/span\u003e \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eexecuteAuthorizationStage\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ereq\u003c/span\u003e \u003cspan class=\"nc\"\u003eRequest\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e{\u003c/span\u003e \u003cspan class=\"o\"\u003e...\u003c/span\u003e \u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003cspan class=\"o\"\u003e}\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"admonitionblock note\"\u003e\n\u003ctable\u003e\n\u003ctbody\u003e\u003ctr\u003e\n\u003ctd class=\"icon\"\u003e\n\u003ci class=\"fa icon-note\" title=\"Note\"\u003e\u003c/i\u003e\n\u003c/td\u003e\n\u003ctd class=\"content\"\u003e\nYou cannot override a single mechanism of a particular stage. As soon as you define a single mechanism in a pipeline, belonging to the one or the other stage, the entire stage is overridden.\n\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n","sections":["Concepts"],"tags":null,"title":"Rules ","url":"/docs/concepts/rules/"},{"categories":null,"content":" HAProxy (High Availability Proxy) is a popular open source, fast, and reliable solution providing load balancer and reverse proxy features for TCP- and HTTP-based applications, capable handling heavy load traffic and rerouting requests seamlessly across multiple workloads (e.g. web, application, database).\nHAProxy is highly extensible thanks to Lua scripting support. For that reason the vanilla HAProxy does not implement any means of external authorization support and requires custom Lua code to achieve integration with heimdall.\nThe HAProxy Ingress Controller has the required integration options however in place. That way, delegation of authentication and authorization to heimdall operated in Decision Mode is easily possible using the Ingress rule annotations, which you can see below. Alternatively, configuring the HAProxy Ingress Controller globally to perform the aforesaid delegation to heimdall is possible as well. With that global configuration you can implement secure defaults for all your workloads.\nIf heimdall answers with a 2XX code, HAProxy grants access and forwards the original request to the upstream service. Otherwise, the response from heimdall is returned to the client.\nThis integration requires proper configuration of trusted_proxies. Example 1. Ingress annotations haproxy-ingress.github.io/auth-url: \u0026#34;https://\u0026lt;heimdall service name\u0026gt;.\u0026lt;namespace\u0026gt;.svc.cluster.local:\u0026lt;decision port\u0026gt;\u0026#34; (1) haproxy-ingress.github.io/auth-headers-succeed: \u0026#34;authorization\u0026#34; (2) haproxy-ingress.github.io/headers: | (3) X-Forwarded-Uri: %[baseq] X-Forwarded-Method: %[method] X-Forwarded-Host: %[req.hdr(host)] 1 Configures the controller to use heimdall’s decision service endpoint with \u0026lt;heimdall service name\u0026gt;, \u0026lt;namespace\u0026gt; and \u0026lt;decision port\u0026gt; depending on your configuration. 2 Let HAProxy forward the Authorization header set by heimdall to the upstream service upon successful response. This configuration depends on your Contextualizers and Finalizers configuration. There is currently a limitation in HAProxy Ingress Controller regarding the case-insensitivity for headers. Since heimdall returns the header in lower-case, it is important to set the names of the required to be forwarded headers in lower case as well. 3 Configures the required headers to pass the information about the used HTTP scheme, host and port, request path and used query parameters to be forwarded to heimdall. X-Forwarded-Proto is not used, as it is already set by HAProxy by default. Checkout the examples on GitHub for a working demo.\n","description":"Explains how to integrate heimdall with HAProxy, a popular open source, fast, and reliable solution providing load balancer and reverse proxy features.","html_content":"\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e\u003ca href=\"https://www.haproxy.com/\"\u003eHAProxy\u003c/a\u003e (High Availability Proxy) is a popular open source, fast, and reliable solution providing load balancer and reverse proxy features for TCP- and HTTP-based applications, capable handling heavy load traffic and rerouting requests seamlessly across multiple workloads (e.g. web, application, database).\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eHAProxy is highly extensible thanks to Lua scripting support. For that reason the vanilla HAProxy does not implement any means of external authorization support and requires custom Lua code to achieve integration with heimdall.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe \u003ca href=\"https://haproxy-ingress.github.io/\"\u003eHAProxy Ingress Controller\u003c/a\u003e has the required \u003ca href=\"https://haproxy-ingress.github.io/docs/configuration/keys/#auth-external\"\u003eintegration options\u003c/a\u003e however in place. That way, delegation of authentication and authorization to heimdall operated in \u003ca href=\"/docs/concepts/operating_modes/#_decision_mode\"\u003eDecision Mode\u003c/a\u003e is easily possible using the Ingress rule annotations, which you can see below. Alternatively, configuring the HAProxy Ingress Controller \u003ca href=\"https://haproxy-ingress.github.io/docs/configuration/keys/#configmap\"\u003eglobally\u003c/a\u003e to perform the aforesaid delegation to heimdall is possible as well. With that global configuration you can implement secure defaults for all your workloads.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eIf heimdall answers with a 2XX code, HAProxy grants access and forwards the original request to the upstream service. Otherwise, the response from heimdall is returned to the client.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"admonitionblock note\"\u003e\n\u003ctable\u003e\n\u003ctbody\u003e\u003ctr\u003e\n\u003ctd class=\"icon\"\u003e\n\u003ci class=\"fa icon-note\" title=\"Note\"\u003e\u003c/i\u003e\n\u003c/td\u003e\n\u003ctd class=\"content\"\u003e\nThis integration requires proper configuration of \u003ccode\u003etrusted_proxies\u003c/code\u003e.\n\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003cdiv class=\"exampleblock\"\u003e\n\u003cdiv class=\"title\"\u003eExample 1. Ingress annotations\u003c/div\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"yaml\"\u003e\u003cspan class=\"na\"\u003ehaproxy-ingress.github.io/auth-url\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"s\"\u003ehttps://\u0026lt;heimdall\u003c/span\u003e\u003cspan class=\"nv\"\u003e \u003c/span\u003e\u003cspan class=\"s\"\u003eservice\u003c/span\u003e\u003cspan class=\"nv\"\u003e \u003c/span\u003e\u003cspan class=\"s\"\u003ename\u0026gt;.\u0026lt;namespace\u0026gt;.svc.cluster.local:\u0026lt;decision\u003c/span\u003e\u003cspan class=\"nv\"\u003e \u003c/span\u003e\u003cspan class=\"s\"\u003eport\u0026gt;\u0026#34;\u003c/span\u003e \u003ci class=\"conum\" data-value=\"1\"\u003e\u003c/i\u003e\u003cb\u003e(1)\u003c/b\u003e\n\u003cspan class=\"na\"\u003ehaproxy-ingress.github.io/auth-headers-succeed\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"s\"\u003eauthorization\u0026#34;\u003c/span\u003e \u003ci class=\"conum\" data-value=\"2\"\u003e\u003c/i\u003e\u003cb\u003e(2)\u003c/b\u003e\n\u003cspan class=\"na\"\u003ehaproxy-ingress.github.io/headers\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"pi\"\u003e|\u003c/span\u003e \u003ci class=\"conum\" data-value=\"3\"\u003e\u003c/i\u003e\u003cb\u003e(3)\u003c/b\u003e\n  \u003cspan class=\"s\"\u003eX-Forwarded-Uri: %[baseq]\u003c/span\u003e\n  \u003cspan class=\"s\"\u003eX-Forwarded-Method: %[method]\u003c/span\u003e\n  \u003cspan class=\"s\"\u003eX-Forwarded-Host: %[req.hdr(host)]\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"colist arabic\"\u003e\n\u003ctable\u003e\n\u003ctbody\u003e\u003ctr\u003e\n\u003ctd\u003e\u003ci class=\"conum\" data-value=\"1\"\u003e\u003c/i\u003e\u003cb\u003e1\u003c/b\u003e\u003c/td\u003e\n\u003ctd\u003eConfigures the controller to use heimdall’s decision service endpoint with \u003ccode\u003e\u0026lt;heimdall service name\u0026gt;\u003c/code\u003e, \u003ccode\u003e\u0026lt;namespace\u0026gt;\u003c/code\u003e and \u003ccode\u003e\u0026lt;decision port\u0026gt;\u003c/code\u003e depending on your configuration.\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003ci class=\"conum\" data-value=\"2\"\u003e\u003c/i\u003e\u003cb\u003e2\u003c/b\u003e\u003c/td\u003e\n\u003ctd\u003eLet HAProxy forward the \u003ccode\u003eAuthorization\u003c/code\u003e header set by heimdall to the upstream service upon successful response. This configuration depends on\nyour \u003ca href=\"/docs/mechanisms/contextualizers/\"\u003eContextualizers\u003c/a\u003e and \u003ca href=\"/docs/mechanisms/finalizers/\"\u003eFinalizers\u003c/a\u003e configuration.\n\u003cdiv class=\"admonitionblock note\"\u003e\n\u003ctable\u003e\n\u003ctbody\u003e\u003ctr\u003e\n\u003ctd class=\"icon\"\u003e\n\u003ci class=\"fa icon-note\" title=\"Note\"\u003e\u003c/i\u003e\n\u003c/td\u003e\n\u003ctd class=\"content\"\u003e\nThere is currently a limitation in HAProxy Ingress Controller regarding the case-insensitivity for headers. Since heimdall returns the header in lower-case, it is important to set the names of the required to be forwarded headers in lower case as well.\n\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\u003c/table\u003e\n\u003c/div\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003ci class=\"conum\" data-value=\"3\"\u003e\u003c/i\u003e\u003cb\u003e3\u003c/b\u003e\u003c/td\u003e\n\u003ctd\u003eConfigures the required headers to pass the information about the used HTTP scheme, host and port, request path and used query parameters to be forwarded to heimdall. \u003ccode\u003eX-Forwarded-Proto\u003c/code\u003e is not used, as it is already set by HAProxy by default.\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eCheckout the examples on \u003ca href=\"https://github.com/dadrus/heimdall/tree/main/examples\"\u003eGitHub\u003c/a\u003e for a working demo.\u003c/p\u003e\n\u003c/div\u003e\n","sections":["Guides","API Gateways \u0026 Proxies"],"tags":null,"title":"HAProxy Integration","url":"/guides/proxies/haproxy/"},{"categories":null,"content":" Rules Sets Regular, respectively upstream specific rules must somehow be organized, versioned and also loaded. So, there must be some structure allowing all of that. That structure is defined by the so-called rule sets.\nA rule set can be considered to be just a file containing a list of rules and some additional meta information, like format version, name of the rule set and alike. Rule sets do also allow ordering of rules, e.g. with most specific matching expressions first allowing simpler matching expressions.\nThe actual format of the rule set is provider specific.\nProvider Types While all providers are different in the sense that they support different sources to load rule sets from, respectively monitor them, most of the providers use the same rule set format.\nThe following table gives an overview about existing providers\nProvider Rule Set Format Short Description File-System\nYAML or JSON\nLoads rule set files from the local file system\nHTTP Endpoint\nYAML or JSON\nLoads rule sets from an HTTP(s) endpoint\nCloud Blob\nYAML or JSON\nLoads rule sets from cloud blobs, like AWS S3, Google Cloud Storage, Azure Cloud Storage and alike.\nKubernetes\nCustom Resource\nLoads rule sets made available to a kubernetes cluster as customer resources.\n","description":"When rules define the behavior in sense of the desired authentication and authorization aspects, then the providers are those entities, which manage the lifecycle of these. That are the providers, which load, reload or remove rules when new rules appears, changes are detected, or rules are deleted.","html_content":"\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_rules_sets\"\u003eRules Sets\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eRegular, respectively upstream specific rules must somehow be organized, versioned and also loaded. So, there must be some structure allowing all of that. That structure is defined by the so-called rule sets.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eA rule set can be considered to be just a file containing a list of rules and some additional meta information, like format version, name of the rule set and alike. Rule sets do also allow ordering of rules, e.g. with most specific matching expressions first allowing simpler matching expressions.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe actual format of the rule set is provider specific.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_provider_types\"\u003eProvider Types\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eWhile all providers are different in the sense that they support different sources to load rule sets from, respectively monitor them, most of the providers use the same rule set format.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe following table gives an overview about existing providers\u003c/p\u003e\n\u003c/div\u003e\n\u003ctable class=\"tableblock frame-all grid-all stretch\"\u003e\n\u003ccolgroup\u003e\n\u003ccol style=\"width: 22.2222%;\"/\u003e\n\u003ccol style=\"width: 22.2222%;\"/\u003e\n\u003ccol style=\"width: 55.5556%;\"/\u003e\n\u003c/colgroup\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth class=\"tableblock halign-left valign-top\"\u003e\u003cstrong\u003eProvider\u003c/strong\u003e\u003c/th\u003e\n\u003cth class=\"tableblock halign-left valign-top\"\u003e\u003cstrong\u003eRule Set Format\u003c/strong\u003e\u003c/th\u003e\n\u003cth class=\"tableblock halign-left valign-top\"\u003e\u003cstrong\u003eShort Description\u003c/strong\u003e\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd class=\"tableblock halign-left valign-top\"\u003e\u003cp class=\"tableblock\"\u003e\u003ca href=\"/docs/rules/providers/#_filesystem\"\u003eFile-System\u003c/a\u003e\u003c/p\u003e\u003c/td\u003e\n\u003ctd class=\"tableblock halign-left valign-top\"\u003e\u003cp class=\"tableblock\"\u003eYAML or JSON\u003c/p\u003e\u003c/td\u003e\n\u003ctd class=\"tableblock halign-left valign-top\"\u003e\u003cp class=\"tableblock\"\u003eLoads rule set files from the local file system\u003c/p\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd class=\"tableblock halign-left valign-top\"\u003e\u003cp class=\"tableblock\"\u003e\u003ca href=\"/docs/rules/providers/#_http_endpoint\"\u003eHTTP Endpoint\u003c/a\u003e\u003c/p\u003e\u003c/td\u003e\n\u003ctd class=\"tableblock halign-left valign-top\"\u003e\u003cp class=\"tableblock\"\u003eYAML or JSON\u003c/p\u003e\u003c/td\u003e\n\u003ctd class=\"tableblock halign-left valign-top\"\u003e\u003cp class=\"tableblock\"\u003eLoads rule sets from an HTTP(s) endpoint\u003c/p\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd class=\"tableblock halign-left valign-top\"\u003e\u003cp class=\"tableblock\"\u003e\u003ca href=\"/docs/rules/providers/#_cloud_blob\"\u003eCloud Blob\u003c/a\u003e\u003c/p\u003e\u003c/td\u003e\n\u003ctd class=\"tableblock halign-left valign-top\"\u003e\u003cp class=\"tableblock\"\u003eYAML or JSON\u003c/p\u003e\u003c/td\u003e\n\u003ctd class=\"tableblock halign-left valign-top\"\u003e\u003cp class=\"tableblock\"\u003eLoads rule sets from cloud blobs, like AWS S3, Google Cloud Storage, Azure Cloud Storage and alike.\u003c/p\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd class=\"tableblock halign-left valign-top\"\u003e\u003cp class=\"tableblock\"\u003e\u003ca href=\"/docs/rules/providers/#_kubernetes\"\u003eKubernetes\u003c/a\u003e\u003c/p\u003e\u003c/td\u003e\n\u003ctd class=\"tableblock halign-left valign-top\"\u003e\u003cp class=\"tableblock\"\u003eCustom Resource\u003c/p\u003e\u003c/td\u003e\n\u003ctd class=\"tableblock halign-left valign-top\"\u003e\u003cp class=\"tableblock\"\u003eLoads rule sets made available to a kubernetes cluster as customer resources.\u003c/p\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n","sections":["Concepts"],"tags":null,"title":"Rule Provider","url":"/docs/concepts/provider/"},{"categories":null,"content":" Decision Mode In this mode you can integrate heimdall with existing reverse proxies, or API gateways (like Kong, NGNIX, Envoy, Traefik and much more)\nFigure 1. Decision Deployment In this mode heimdall can be integrated with most probably all modern API gateways and reverse proxies as a so-called \u0026#34;authentication middleware\u0026#34;. Here the reverse proxy, respectively API gateway integrating with heimdall, will forward requests to heimdall by making use of its decision service endpoint for authentication and authorization purposes. As in the Reverse Proxy mode, heimdall will check if these requests match and satisfy the conditions defined in the available rules. If not, heimdall returns an error to its client (here API gateway/reverse proxy). If the rule execution was successful, it also responds to the API gateway/reverse proxy with 200 OK (can be overridden if required) and sets headers/cookies, specified in the matched rule, which are then forwarded to the upstream service.\nStarting heimdall in this mode happens via the serve decision command. Head over to the description of CLI as well as to decision service configuration options for more details.\nExample 1. Decision Service Example Imagine following request hits heimdall (sent to it by an API gateway)\nGET /my-service/api HTTP/1.1 Host: heimdall:4455 X-Forwarded-Host: my-backend-service Some payload And there is a rule, which allows anonymous requests and sets a header with subject id set to anonymous like this\nid: rule:my-service:anonymous-api-access match: url: http://my-backend-service/my-service/api methods: - GET execute: - authenticator: anonymous-authn - finalizer: id-header Then heimdall will respond with:\nHTTP/1.1 200 OK X-User-ID: anonymous Proxy Mode In this operation mode you can use heimdall as a reverse proxy in front of your upstream API or web server.\nFigure 2. Proxy Deployment In this mode heimdall forwards requests to the upstream service if these satisfy the conditions defined in matched rules. Otherwise, heimdall returns an error to the client. If the execution of the rule was successful, it also forwards additional headers, specified in the rule to the upstream service.\nStarting heimdall in this mode happens via the serve proxy command. Head over to the description of CLI as well as to proxy service configuration options for more details.\nExample 2. Reverse Proxy Example Imagine following request hits heimdall\nGET /my-service/api HTTP/1.1 Host: heimdall:4455 Some payload And there is a rule, which allows anonymous requests and sets a header with subject id set to anonymous like this\nid: rule:my-service:anonymous-api-access match: url: \u0026lt;**\u0026gt;/my-service/api forward_to: host: my-backend-service:8888 methods: - GET execute: - authenticator: anonymous-authn - finalizer: id-header Then the request will be forwarded as follows:\nGET /my-service/api HTTP/1.1 Host: my-backend-service:8888 X-User-ID: anonymous Some payload ","description":"To support different deployment scenarios, heimdall supports two operating modes.","html_content":"\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_decision_mode\"\u003eDecision Mode\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eIn this mode you can integrate heimdall with existing reverse proxies, or API gateways (like \u003ca href=\"https://konghq.com/\"\u003eKong\u003c/a\u003e, \u003ca href=\"https://nginx.org\"\u003eNGNIX\u003c/a\u003e, \u003ca href=\"https://www.envoyproxy.io/\"\u003eEnvoy\u003c/a\u003e, \u003ca href=\"https://traefik.io/\"\u003eTraefik\u003c/a\u003e and much more)\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv id=\"_fig_heimdall_decision_deployment\" class=\"imageblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cimg src=\"diag-ditaa-md5-6aa79a33899aaf938fd0bdc4e82460e2.svg\" alt=\"Diagram\" width=\"1020\" height=\"490\"/\u003e\n\u003c/div\u003e\n\u003cdiv class=\"title\"\u003eFigure 1. Decision Deployment\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eIn this mode heimdall can be integrated with most probably all modern API gateways and reverse proxies as a so-called \u0026#34;authentication middleware\u0026#34;. Here the reverse proxy, respectively API gateway integrating with heimdall, will forward requests to heimdall by making use of its decision service endpoint for authentication and authorization purposes. As in the \u003ca href=\"#_proxy_mode\"\u003eReverse Proxy\u003c/a\u003e mode, heimdall will check if these requests match and satisfy the conditions defined in the available rules. If not, heimdall returns an error to its client (here API gateway/reverse proxy). If the rule execution was successful, it also responds to the API gateway/reverse proxy with \u003ccode\u003e200 OK\u003c/code\u003e (can be overridden if required) and sets headers/cookies, specified in the matched rule, which are then forwarded to the upstream service.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eStarting heimdall in this mode happens via the \u003ccode\u003eserve decision\u003c/code\u003e command. Head over to the description of \u003ca href=\"/docs/operations/cli/\"\u003eCLI\u003c/a\u003e as well as to \u003ca href=\"/docs/services/decision/\"\u003edecision service configuration options\u003c/a\u003e for more details.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"exampleblock\"\u003e\n\u003cdiv class=\"title\"\u003eExample 1. Decision Service Example\u003c/div\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eImagine following request hits heimdall (sent to it by an API gateway)\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"bash\"\u003eGET /my-service/api HTTP/1.1\nHost: heimdall:4455\nX-Forwarded-Host: my-backend-service\n\nSome payload\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eAnd there is a rule, which allows anonymous requests and sets a header with subject id set to \u003ccode\u003eanonymous\u003c/code\u003e like this\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"yaml\"\u003e\u003cspan class=\"na\"\u003eid\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003erule:my-service:anonymous-api-access\u003c/span\u003e\n\u003cspan class=\"na\"\u003ematch\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eurl\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ehttp://my-backend-service/my-service/api\u003c/span\u003e\n\u003cspan class=\"na\"\u003emethods\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003eGET\u003c/span\u003e\n\u003cspan class=\"na\"\u003eexecute\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eauthenticator\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eanonymous-authn\u003c/span\u003e\n  \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003efinalizer\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eid-header\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThen heimdall will respond with:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"bash\"\u003eHTTP/1.1 200 OK\nX-User-ID: anonymous\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_proxy_mode\"\u003eProxy Mode\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eIn this operation mode you can use heimdall as a reverse proxy in front of your upstream API or web server.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv id=\"_fig_heimdall_proxy_deployment\" class=\"imageblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cimg src=\"diag-ditaa-md5-bd38a9b34b3de344495c4271ed4b394a.svg\" alt=\"Diagram\" width=\"980\" height=\"308\"/\u003e\n\u003c/div\u003e\n\u003cdiv class=\"title\"\u003eFigure 2. Proxy Deployment\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eIn this mode heimdall forwards requests to the upstream service if these satisfy the conditions defined in matched rules. Otherwise, heimdall returns an error to the client. If the execution of the rule was successful, it also forwards additional headers, specified in the rule to the upstream service.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eStarting heimdall in this mode happens via the \u003ccode\u003eserve proxy\u003c/code\u003e command. Head over to the description of \u003ca href=\"/docs/operations/cli/\"\u003eCLI\u003c/a\u003e as well as to \u003ca href=\"/docs/services/proxy/\"\u003eproxy service configuration options\u003c/a\u003e for more details.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"exampleblock\"\u003e\n\u003cdiv class=\"title\"\u003eExample 2. Reverse Proxy Example\u003c/div\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eImagine following request hits heimdall\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"bash\"\u003eGET /my-service/api HTTP/1.1\nHost: heimdall:4455\n\nSome payload\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eAnd there is a rule, which allows anonymous requests and sets a header with subject id set to \u003ccode\u003eanonymous\u003c/code\u003e like this\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"yaml\"\u003e\u003cspan class=\"na\"\u003eid\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003erule:my-service:anonymous-api-access\u003c/span\u003e\n\u003cspan class=\"na\"\u003ematch\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eurl\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026lt;**\u0026gt;/my-service/api\u003c/span\u003e\n\u003cspan class=\"na\"\u003eforward_to\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"na\"\u003ehost\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003emy-backend-service:8888\u003c/span\u003e\n\u003cspan class=\"na\"\u003emethods\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003eGET\u003c/span\u003e\n\u003cspan class=\"na\"\u003eexecute\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eauthenticator\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eanonymous-authn\u003c/span\u003e\n  \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003efinalizer\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eid-header\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThen the request will be forwarded as follows:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"bash\"\u003eGET /my-service/api HTTP/1.1\nHost: my-backend-service:8888\nX-User-ID: anonymous\n\nSome payload\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n","sections":["Concepts"],"tags":null,"title":"Operating Modes","url":"/docs/concepts/operating_modes/"},{"categories":null,"content":" NGINX is an HTTP and reverse proxy server which became famous as one of the fastest web servers out there, heimdall can be integrated with by making use of the ngx_http_auth_request_module. In such setup, NGINX delegates authentication and authorization to heimdall. If heimdall answers with a 2XX code, NGINX grants access and forwards the original request to the upstream service. If heimdall returns 401 or 403, the access is denied with the corresponding error code. Any other response code returned by heimdall is considered an error.\nPrerequisites Integration with NGINX requires heimdall being operated in Decision Operation Mode exposing its HTTP(s) endpoint.\nLimitations NGINX ngx_http_auth_request_module responsible for communication with external authentication \u0026amp; authorization services, like heimdall, has a few limitations. As written above, it only supports 200, 401 and 403 response codes. That means:\nYou’ll not be able to drive redirects from heimdall, as 3xx error codes will result in 500 error returned by NGINX. You can partially overcome that limitation by letting heimdall respond with a 401 or 403 error code and mapping that to a redirect in NGINX itself, e.g. like shown below. This definitely not DRY and will not allow you using multiple identity provider if you need to\n# nginx.conf ... # if the ext auth server, like heimdall returns `401 not authorized` # then forward the request to the error401 block error_page 401 = @error401; location @error401 { # redirect to the IdP for login return 302 https://your-idp-service/login; # you usually want your IdP to redirect back upon successful authentication # typically, you can achieve that by adding such query parameters like # return_to set to the value of the current request } If there is no matching rule on heimdall side, heimdall responds with 404 Not Found, which, as said above will be treated by NGINX as error. To avoid such situations, you can define a default rule, which is anyway recommended to have secure defaults\nIf a heimdall rule is matched, but is configured to not allow a particular HTTP method, 405 Method Not Allowed response code is returned. That will result in 500 returned by NGINX due to the reasons written above. To overcome that, you can configure heimdall to respond with another HTTP response code using the respond property on the level of the decision service configuration.\nVanilla NGINX Since NGINX is highly configurable and heimdall supports different integration options, you can use any of the configuration examples given below. All of these enable heimdall to build the URL of the protected backend server for rule matching purposes.\nIn most cases you must configure heimdall to trust your NGINX instances by setting trusted_proxies for the Decision, respectively Proxy service. Exceptions are described in the sections below.\nForward only the path and query information With this method you don’t set any headers. That means, you cannot rely on the used HTTP scheme, or the host and port in your rules. Here NGINX uses the same HTTP method, used in the original request to it and add the path and query to the path/query URL used for communication with heimdall. That integration method does not require the configuration of trusted_proxies in heimdall.\n# nginx.conf ... location / { auth_request /_auth; (1) auth_request_set $auth_cookie $upstream_http_set_cookie; (2) add_header Set-Cookie $auth_cookie; auth_request_set $authHeader0 $upstream_http_authorization; (3) proxy_set_header \u0026#39;Authorization\u0026#39; $authHeader0; # mitigate HTTPoxy Vulnerability # https://www.nginx.com/blog/mitigating-the-httpoxy-vulnerability-with-nginx/ proxy_set_header Proxy \u0026#34;\u0026#34;; ... } location = /_auth { (4) internal; access_log off; proxy_method $request_method; (5) proxy_pass http://heimdall:4456$request_uri; (6) proxy_pass_request_body off; (7) proxy_set_header Content-Length \u0026#34;\u0026#34;; proxy_set_header Host $http_host; (8) } 1 Configures NGINX to forward every request to the internal /_auth endpoint (this is where the actual heimdall integration happens - see below). 2 When the response from heimdall returns, this and the next line set the Cookies set by heimdall in the response (whether you need this depends on your Contextualizers and Finalizers configuration) 3 When the response from heimdall returns, this and the next line set the Authorization header set by heimdall in the response (which header to set depends again on your Contextualizers and Finalizers configuration) 4 This is where the \u0026#34;magic\u0026#34; happens 5 Configure NGINX to use the HTTP method used by its client. Without this setting the implementation of proxy_path will use the HTTP GET method. 6 Configures NGINX to pass the request to heimdall and sets the request path and queries from the original request 7 Disables sending of the request body. If your heimdall rules make use of the body, you should set this to on and remove the next line. 8 Lets the NGINX setting the Host header, so it is accessible to heimdall. Forward all information in X-Forwarded-* headers With this method you set the X-Forwarded-Method, X-Forwarded-Proto, X-Forwarded-Host and X-Forwarded-Uri to let heimdall know the host, respectively domain url and the used HTTP method.\nCompared to the previous integration option, the configuration only differs in the definition of the internal /_auth endpoint. So, the example configuration is limited to that part only.\nProper configuration of trusted_proxies is mandatory if using this option. # nginx.conf ... location = /_auth { internal; proxy_pass http://heimdall:4456; (1) proxy_pass_request_body off; proxy_set_header Content-Length \u0026#34;\u0026#34;; proxy_set_header X-Forwarded-Method $request_method; (2) proxy_set_header X-Forwarded-Proto $scheme; (3) proxy_set_header X-Forwarded-Host $http_host; (4) proxy_set_header X-Forwarded-Uri $request_uri; (5) proxy_set_header X-Forwarded-For $remote_addr; } 1 Configures NGINX to pass the request to heimdall. 2 Let NGINX forward the used HTTP method to heimdall. 3 Let NGINX forward the used HTTP scheme to heimdall. 4 Let NGINX forward the used host to heimdall. 5 Let NGINX forward the used path and query parameter to heimdall. NGINX Ingress Controller Even one can configure an external auth server globally with vanilla NGINX, there is no way to achieve that with the NGINX Ingress Controller. Only route based configuration/integration is possible.\nUsing X-Forwarded-* headers To integrate heimdall with the NGINX Ingress Controller you can make use of the nginx.ingress.kubernetes.io/auth-url, nginx.ingress.kubernetes.io/auth-response-headers and the nginx.ingress.kubernetes.io/auth-snippet annotation as shown in the example below. This will result in an NGINX configuration corresponding to the integration option, described in the Forward all information in X-Forwarded-* headers section.\nThe configuration used in the example below requires proper configuration of trusted_proxies. nginx.ingress.kubernetes.io/auth-url: \u0026#34;http://\u0026lt;heimdall service name\u0026gt;.\u0026lt;namespace\u0026gt;.svc.cluster.local:\u0026lt;decision port\u0026gt;\u0026#34; (1) nginx.ingress.kubernetes.io/auth-response-headers: Authorization (2) nginx.ingress.kubernetes.io/auth-snippet: | (3) proxy_set_header X-Forwarded-Method $request_method; proxy_set_header X-Forwarded-Proto $scheme; proxy_set_header X-Forwarded-Host $http_host; proxy_set_header X-Forwarded-Uri $request_uri; # other annotations required 1 Configures the controller to use heimdall’s decision service endpoint with \u0026lt;heimdall service name\u0026gt;, \u0026lt;namespace\u0026gt; and \u0026lt;decision port\u0026gt; depending on your configuration. 2 Let NGINX forward the Authorization header set by heimdall to the upstream service upon successful response. This configuration depends on your Contextualizers and Finalizers configuration. If not configured, NGINX will only react on Set-Cookie headers in responses from heimdall by default. 3 Configures the required headers to pass the information about the used HTTP scheme, host and port, request path and used query parameters to be forwarded to heimdall. Without that, heimdall will not be able extracting relevant information from the NGINX request as it does not support NGINX proprietary X-Original-Method and X-Original-Uri used by it for the same purposes. Alternative Configuration Alternatively, if you don’t want configuring trusted_proxies and do not rely on the used HTTP scheme, host and port in your rules, you can also use the nginx.ingress.kubernetes.io/configuration-snippet and nginx.ingress.kubernetes.io/server-snippet annotations and use the configuration shown below.\nThis example is an exact copy of the configuration used in the very first integration option described above.\nnginx.ingress.kubernetes.io/configuration-snippet: | auth_request /_auth; auth_request_set $auth_cookie $upstream_http_set_cookie; add_header Set-Cookie $auth_cookie; auth_request_set $auth_header $upstream_http_authorization; proxy_set_header \u0026#39;Authorization\u0026#39; $auth_header; proxy_set_header Proxy \u0026#34;\u0026#34;; nginx.ingress.kubernetes.io/server-snippet: | location = /_auth { internal; access_log off; proxy_method $request_method; proxy_pass http://\u0026lt;heimdall service name\u0026gt;.\u0026lt;namespace\u0026gt;.svc.cluster.local:\u0026lt;decision port\u0026gt;$request_uri; proxy_pass_request_body off; proxy_set_header Content-Length \u0026#34;\u0026#34;; proxy_set_header Host $http_host; } # other annotations required Additional Resources Checkout the examples on GitHub for a working demo.\n","description":"This guide explains how to integrate heimdall with NGINX as well as with the NGINX Ingress Controller.","html_content":"\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e\u003ca href=\"https://nginx.org/\"\u003eNGINX\u003c/a\u003e is an HTTP and reverse proxy server which became famous as one of the fastest web servers out there, heimdall can be integrated with by making use of the \u003ca href=\"https://nginx.org/en/docs/http/ngx_http_auth_request_module.html\"\u003engx_http_auth_request_module\u003c/a\u003e. In such setup, NGINX delegates authentication and authorization to heimdall. If heimdall answers with a 2XX code, NGINX grants access and forwards the original request to the upstream service. If heimdall returns 401 or 403, the access is denied with the corresponding error code. Any other response code returned by heimdall is considered an error.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_prerequisites\"\u003ePrerequisites\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eIntegration with NGINX requires heimdall being operated in \u003ca href=\"/docs/concepts/operating_modes/#_decision_mode\"\u003eDecision Operation Mode\u003c/a\u003e exposing its HTTP(s) endpoint.\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_limitations\"\u003eLimitations\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eNGINX \u003ca href=\"https://nginx.org/en/docs/http/ngx_http_auth_request_module.html\"\u003engx_http_auth_request_module\u003c/a\u003e responsible for communication with external authentication \u0026amp; authorization services, like heimdall, has a few limitations. As written above, it only supports 200, 401 and 403 response codes. That means:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eYou’ll not be able to drive redirects from heimdall, as 3xx error codes will result in 500 error returned by NGINX. You can partially overcome that limitation by letting heimdall respond with a 401 or 403 error code and mapping that to a redirect in NGINX itself, e.g. like shown below. This definitely not DRY and will not allow you using multiple identity provider if you need to\u003c/p\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"nginx\"\u003e\u003cspan class=\"c1\"\u003e# nginx.conf\u003c/span\u003e\n\u003cspan class=\"k\"\u003e...\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e# if the ext auth server, like heimdall returns `401 not authorized`\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e# then forward the request to the error401 block\u003c/span\u003e\n\u003cspan class=\"s\"\u003eerror_page\u003c/span\u003e \u003cspan class=\"mi\"\u003e401\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e@error401\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003elocation\u003c/span\u003e \u003cspan class=\"s\"\u003e@error401\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"c1\"\u003e# redirect to the IdP for login\u003c/span\u003e\n  \u003cspan class=\"kn\"\u003ereturn\u003c/span\u003e \u003cspan class=\"mi\"\u003e302\u003c/span\u003e \u003cspan class=\"s\"\u003ehttps://your-idp-service/login\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"c1\"\u003e# you usually want your IdP to redirect back upon successful authentication\u003c/span\u003e\n  \u003cspan class=\"c1\"\u003e# typically, you can achieve that by adding such query parameters like\u003c/span\u003e\n  \u003cspan class=\"c1\"\u003e# return_to set to the value of the current request\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eIf there is no matching rule on heimdall side, heimdall responds with \u003ccode\u003e404 Not Found\u003c/code\u003e, which, as said above will be treated by NGINX as error. To avoid such situations, you can define a \u003ca href=\"/docs/rules/default_rule/\"\u003edefault rule\u003c/a\u003e, which is anyway recommended to have secure defaults\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eIf a heimdall rule is matched, but is configured to not allow a particular HTTP method, \u003ccode\u003e405 Method Not Allowed\u003c/code\u003e response code is returned. That will result in \u003ccode\u003e500\u003c/code\u003e returned by NGINX due to the reasons written above. To overcome that, you can configure heimdall to respond with another HTTP response code using the \u003ccode\u003erespond\u003c/code\u003e property on the level of the \u003ca href=\"/docs/services/decision/\"\u003edecision service\u003c/a\u003e configuration.\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_vanilla_nginx\"\u003eVanilla NGINX\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eSince NGINX is highly configurable and heimdall supports different integration options, you can use any of the configuration examples given below. All of these enable heimdall to build the URL of the protected backend server for rule matching purposes.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eIn most cases you must configure heimdall to trust your NGINX instances by setting \u003ca href=\"/docs/services/decision/#_trusted_proxies\"\u003e\u003ccode\u003etrusted_proxies\u003c/code\u003e\u003c/a\u003e for the Decision, respectively Proxy service. Exceptions are described in the sections below.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_first_option\"\u003eForward only the path and query information\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eWith this method you don’t set any headers. That means, you cannot rely on the used HTTP scheme, or the host and port in your rules. Here NGINX uses the same HTTP method, used in the original request to it and add the path and query to the path/query URL used for communication with heimdall. That integration method does not require the configuration of \u003ccode\u003etrusted_proxies\u003c/code\u003e in heimdall.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"nginx\"\u003e\u003cspan class=\"c1\"\u003e# nginx.conf\u003c/span\u003e\n\u003cspan class=\"k\"\u003e...\u003c/span\u003e\n\n\u003cspan class=\"s\"\u003elocation\u003c/span\u003e \u003cspan class=\"n\"\u003e/\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"kn\"\u003eauth_request\u003c/span\u003e             \u003cspan class=\"n\"\u003e/_auth\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e  \u003ci class=\"conum\" data-value=\"1\"\u003e\u003c/i\u003e\u003cb\u003e(1)\u003c/b\u003e\n  \u003cspan class=\"kn\"\u003eauth_request_set\u003c/span\u003e         \u003cspan class=\"nv\"\u003e$auth_cookie\u003c/span\u003e \u003cspan class=\"nv\"\u003e$upstream_http_set_cookie\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e  \u003ci class=\"conum\" data-value=\"2\"\u003e\u003c/i\u003e\u003cb\u003e(2)\u003c/b\u003e\n  \u003cspan class=\"kn\"\u003eadd_header\u003c/span\u003e               \u003cspan class=\"s\"\u003eSet-Cookie\u003c/span\u003e \u003cspan class=\"nv\"\u003e$auth_cookie\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"kn\"\u003eauth_request_set\u003c/span\u003e         \u003cspan class=\"nv\"\u003e$authHeader0\u003c/span\u003e \u003cspan class=\"nv\"\u003e$upstream_http_authorization\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e  \u003ci class=\"conum\" data-value=\"3\"\u003e\u003c/i\u003e\u003cb\u003e(3)\u003c/b\u003e\n  \u003cspan class=\"kn\"\u003eproxy_set_header\u003c/span\u003e         \u003cspan class=\"s\"\u003e\u0026#39;Authorization\u0026#39;\u003c/span\u003e \u003cspan class=\"nv\"\u003e$authHeader0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"c1\"\u003e# mitigate HTTPoxy Vulnerability\u003c/span\u003e\n  \u003cspan class=\"c1\"\u003e# https://www.nginx.com/blog/mitigating-the-httpoxy-vulnerability-with-nginx/\u003c/span\u003e\n  \u003cspan class=\"kn\"\u003eproxy_set_header\u003c/span\u003e \u003cspan class=\"s\"\u003eProxy\u003c/span\u003e   \u003cspan class=\"s\"\u003e\u0026#34;\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"kn\"\u003e...\u003c/span\u003e\n\u003cspan class=\"err\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"s\"\u003elocation\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003e/_auth\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e  \u003ci class=\"conum\" data-value=\"4\"\u003e\u003c/i\u003e\u003cb\u003e(4)\u003c/b\u003e\n  \u003cspan class=\"kn\"\u003einternal\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"kn\"\u003eaccess_log\u003c/span\u003e               \u003cspan class=\"no\"\u003eoff\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"kn\"\u003eproxy_method\u003c/span\u003e             \u003cspan class=\"nv\"\u003e$request_method\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003ci class=\"conum\" data-value=\"5\"\u003e\u003c/i\u003e\u003cb\u003e(5)\u003c/b\u003e\n  \u003cspan class=\"kn\"\u003eproxy_pass\u003c/span\u003e               \u003cspan class=\"s\"\u003ehttp://heimdall:4456\u003c/span\u003e\u003cspan class=\"nv\"\u003e$request_uri\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003ci class=\"conum\" data-value=\"6\"\u003e\u003c/i\u003e\u003cb\u003e(6)\u003c/b\u003e\n  \u003cspan class=\"kn\"\u003eproxy_pass_request_body\u003c/span\u003e  \u003cspan class=\"no\"\u003eoff\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003ci class=\"conum\" data-value=\"7\"\u003e\u003c/i\u003e\u003cb\u003e(7)\u003c/b\u003e\n  \u003cspan class=\"kn\"\u003eproxy_set_header\u003c/span\u003e         \u003cspan class=\"s\"\u003eContent-Length\u003c/span\u003e   \u003cspan class=\"s\"\u003e\u0026#34;\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"kn\"\u003eproxy_set_header\u003c/span\u003e         \u003cspan class=\"s\"\u003eHost\u003c/span\u003e \u003cspan class=\"nv\"\u003e$http_host\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003ci class=\"conum\" data-value=\"8\"\u003e\u003c/i\u003e\u003cb\u003e(8)\u003c/b\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"colist arabic\"\u003e\n\u003ctable\u003e\n\u003ctbody\u003e\u003ctr\u003e\n\u003ctd\u003e\u003ci class=\"conum\" data-value=\"1\"\u003e\u003c/i\u003e\u003cb\u003e1\u003c/b\u003e\u003c/td\u003e\n\u003ctd\u003eConfigures NGINX to forward every request to the internal \u003ccode\u003e/_auth\u003c/code\u003e endpoint (this is where the actual heimdall integration happens - see below).\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003ci class=\"conum\" data-value=\"2\"\u003e\u003c/i\u003e\u003cb\u003e2\u003c/b\u003e\u003c/td\u003e\n\u003ctd\u003eWhen the response from heimdall returns, this and the next line set the Cookies set by heimdall in the response (whether you need this depends on your \u003ca href=\"/docs/mechanisms/contextualizers/\"\u003eContextualizers\u003c/a\u003e and \u003ca href=\"/docs/mechanisms/finalizers/\"\u003eFinalizers\u003c/a\u003e configuration)\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003ci class=\"conum\" data-value=\"3\"\u003e\u003c/i\u003e\u003cb\u003e3\u003c/b\u003e\u003c/td\u003e\n\u003ctd\u003eWhen the response from heimdall returns, this and the next line set the \u003ccode\u003eAuthorization\u003c/code\u003e header set by heimdall in the response (which header to set depends again on your \u003ca href=\"/docs/mechanisms/contextualizers/\"\u003eContextualizers\u003c/a\u003e and \u003ca href=\"/docs/mechanisms/finalizers/\"\u003eFinalizers\u003c/a\u003e configuration)\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003ci class=\"conum\" data-value=\"4\"\u003e\u003c/i\u003e\u003cb\u003e4\u003c/b\u003e\u003c/td\u003e\n\u003ctd\u003eThis is where the \u0026#34;magic\u0026#34; happens\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003ci class=\"conum\" data-value=\"5\"\u003e\u003c/i\u003e\u003cb\u003e5\u003c/b\u003e\u003c/td\u003e\n\u003ctd\u003eConfigure NGINX to use the HTTP method used by its client. Without this setting the implementation of \u003ccode\u003eproxy_path\u003c/code\u003e will use the HTTP GET method.\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003ci class=\"conum\" data-value=\"6\"\u003e\u003c/i\u003e\u003cb\u003e6\u003c/b\u003e\u003c/td\u003e\n\u003ctd\u003eConfigures NGINX to pass the request to heimdall and sets the request path and queries from the original request\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003ci class=\"conum\" data-value=\"7\"\u003e\u003c/i\u003e\u003cb\u003e7\u003c/b\u003e\u003c/td\u003e\n\u003ctd\u003eDisables sending of the request body. If your heimdall rules make use of the body, you should set this to \u003ccode\u003eon\u003c/code\u003e and remove the next line.\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003ci class=\"conum\" data-value=\"8\"\u003e\u003c/i\u003e\u003cb\u003e8\u003c/b\u003e\u003c/td\u003e\n\u003ctd\u003eLets the NGINX setting the \u003ccode\u003eHost\u003c/code\u003e header, so it is accessible to heimdall.\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_second_option\"\u003eForward all information in \u003ccode\u003eX-Forwarded-*\u003c/code\u003e headers\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eWith this method you set the \u003ccode\u003eX-Forwarded-Method\u003c/code\u003e, \u003ccode\u003eX-Forwarded-Proto\u003c/code\u003e, \u003ccode\u003eX-Forwarded-Host\u003c/code\u003e and \u003ccode\u003eX-Forwarded-Uri\u003c/code\u003e to let heimdall know the host, respectively domain url and the used HTTP method.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eCompared to the \u003ca href=\"#_first_option\"\u003eprevious integration\u003c/a\u003e option, the configuration only differs in the definition of the internal \u003ccode\u003e/_auth\u003c/code\u003e endpoint. So, the example configuration is limited to that part only.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"admonitionblock note\"\u003e\n\u003ctable\u003e\n\u003ctbody\u003e\u003ctr\u003e\n\u003ctd class=\"icon\"\u003e\n\u003ci class=\"fa icon-note\" title=\"Note\"\u003e\u003c/i\u003e\n\u003c/td\u003e\n\u003ctd class=\"content\"\u003e\nProper configuration of \u003ccode\u003etrusted_proxies\u003c/code\u003e is mandatory if using this option.\n\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"nginx\"\u003e\u003cspan class=\"c1\"\u003e# nginx.conf\u003c/span\u003e\n\u003cspan class=\"k\"\u003e...\u003c/span\u003e\n\n\u003cspan class=\"s\"\u003elocation\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003e/_auth\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"kn\"\u003einternal\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"kn\"\u003eproxy_pass\u003c/span\u003e               \u003cspan class=\"s\"\u003ehttp://heimdall:4456\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e  \u003ci class=\"conum\" data-value=\"1\"\u003e\u003c/i\u003e\u003cb\u003e(1)\u003c/b\u003e\n  \u003cspan class=\"kn\"\u003eproxy_pass_request_body\u003c/span\u003e  \u003cspan class=\"no\"\u003eoff\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"kn\"\u003eproxy_set_header\u003c/span\u003e         \u003cspan class=\"s\"\u003eContent-Length\u003c/span\u003e         \u003cspan class=\"s\"\u003e\u0026#34;\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"kn\"\u003eproxy_set_header\u003c/span\u003e         \u003cspan class=\"s\"\u003eX-Forwarded-Method\u003c/span\u003e     \u003cspan class=\"nv\"\u003e$request_method\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e  \u003ci class=\"conum\" data-value=\"2\"\u003e\u003c/i\u003e\u003cb\u003e(2)\u003c/b\u003e\n  \u003cspan class=\"kn\"\u003eproxy_set_header\u003c/span\u003e         \u003cspan class=\"s\"\u003eX-Forwarded-Proto\u003c/span\u003e      \u003cspan class=\"nv\"\u003e$scheme\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e  \u003ci class=\"conum\" data-value=\"3\"\u003e\u003c/i\u003e\u003cb\u003e(3)\u003c/b\u003e\n  \u003cspan class=\"kn\"\u003eproxy_set_header\u003c/span\u003e         \u003cspan class=\"s\"\u003eX-Forwarded-Host\u003c/span\u003e       \u003cspan class=\"nv\"\u003e$http_host\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e  \u003ci class=\"conum\" data-value=\"4\"\u003e\u003c/i\u003e\u003cb\u003e(4)\u003c/b\u003e\n  \u003cspan class=\"kn\"\u003eproxy_set_header\u003c/span\u003e         \u003cspan class=\"s\"\u003eX-Forwarded-Uri\u003c/span\u003e        \u003cspan class=\"nv\"\u003e$request_uri\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e  \u003ci class=\"conum\" data-value=\"5\"\u003e\u003c/i\u003e\u003cb\u003e(5)\u003c/b\u003e\n  \u003cspan class=\"kn\"\u003eproxy_set_header\u003c/span\u003e         \u003cspan class=\"s\"\u003eX-Forwarded-For\u003c/span\u003e        \u003cspan class=\"nv\"\u003e$remote_addr\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"colist arabic\"\u003e\n\u003ctable\u003e\n\u003ctbody\u003e\u003ctr\u003e\n\u003ctd\u003e\u003ci class=\"conum\" data-value=\"1\"\u003e\u003c/i\u003e\u003cb\u003e1\u003c/b\u003e\u003c/td\u003e\n\u003ctd\u003eConfigures NGINX to pass the request to heimdall.\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003ci class=\"conum\" data-value=\"2\"\u003e\u003c/i\u003e\u003cb\u003e2\u003c/b\u003e\u003c/td\u003e\n\u003ctd\u003eLet NGINX forward the used HTTP method to heimdall.\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003ci class=\"conum\" data-value=\"3\"\u003e\u003c/i\u003e\u003cb\u003e3\u003c/b\u003e\u003c/td\u003e\n\u003ctd\u003eLet NGINX forward the used HTTP scheme to heimdall.\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003ci class=\"conum\" data-value=\"4\"\u003e\u003c/i\u003e\u003cb\u003e4\u003c/b\u003e\u003c/td\u003e\n\u003ctd\u003eLet NGINX forward the used host to heimdall.\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003ci class=\"conum\" data-value=\"5\"\u003e\u003c/i\u003e\u003cb\u003e5\u003c/b\u003e\u003c/td\u003e\n\u003ctd\u003eLet NGINX forward the used path and query parameter to heimdall.\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_nginx_ingress_controller\"\u003eNGINX Ingress Controller\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eEven one can configure an external auth server globally with vanilla NGINX, there is no way to achieve that with the \u003ca href=\"https://kubernetes.github.io/ingress-nginx/\"\u003eNGINX Ingress Controller\u003c/a\u003e. Only route based configuration/integration is possible.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_using_x_forwarded_headers\"\u003eUsing \u003ccode\u003eX-Forwarded-*\u003c/code\u003e headers\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eTo integrate heimdall with the NGINX Ingress Controller you can make use of the \u003ccode\u003enginx.ingress.kubernetes.io/auth-url\u003c/code\u003e, \u003ccode\u003enginx.ingress.kubernetes.io/auth-response-headers\u003c/code\u003e and the \u003ccode\u003enginx.ingress.kubernetes.io/auth-snippet\u003c/code\u003e annotation as shown in the example below. This will result in an NGINX configuration corresponding to the integration option, described in the \u003ca href=\"#_second_option\"\u003eForward all information in \u003ccode\u003eX-Forwarded-*\u003c/code\u003e headers\u003c/a\u003e section.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"admonitionblock note\"\u003e\n\u003ctable\u003e\n\u003ctbody\u003e\u003ctr\u003e\n\u003ctd class=\"icon\"\u003e\n\u003ci class=\"fa icon-note\" title=\"Note\"\u003e\u003c/i\u003e\n\u003c/td\u003e\n\u003ctd class=\"content\"\u003e\nThe configuration used in the example below requires proper configuration of \u003ccode\u003etrusted_proxies\u003c/code\u003e.\n\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"yaml\"\u003e\u003cspan class=\"na\"\u003enginx.ingress.kubernetes.io/auth-url\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"s\"\u003ehttp://\u0026lt;heimdall\u003c/span\u003e\u003cspan class=\"nv\"\u003e \u003c/span\u003e\u003cspan class=\"s\"\u003eservice\u003c/span\u003e\u003cspan class=\"nv\"\u003e \u003c/span\u003e\u003cspan class=\"s\"\u003ename\u0026gt;.\u0026lt;namespace\u0026gt;.svc.cluster.local:\u0026lt;decision\u003c/span\u003e\u003cspan class=\"nv\"\u003e \u003c/span\u003e\u003cspan class=\"s\"\u003eport\u0026gt;\u0026#34;\u003c/span\u003e \u003ci class=\"conum\" data-value=\"1\"\u003e\u003c/i\u003e\u003cb\u003e(1)\u003c/b\u003e\n\u003cspan class=\"na\"\u003enginx.ingress.kubernetes.io/auth-response-headers\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eAuthorization\u003c/span\u003e \u003ci class=\"conum\" data-value=\"2\"\u003e\u003c/i\u003e\u003cb\u003e(2)\u003c/b\u003e\n\u003cspan class=\"na\"\u003enginx.ingress.kubernetes.io/auth-snippet\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"pi\"\u003e|\u003c/span\u003e \u003ci class=\"conum\" data-value=\"3\"\u003e\u003c/i\u003e\u003cb\u003e(3)\u003c/b\u003e\n  \u003cspan class=\"s\"\u003eproxy_set_header    X-Forwarded-Method   $request_method;\u003c/span\u003e\n  \u003cspan class=\"s\"\u003eproxy_set_header    X-Forwarded-Proto    $scheme;\u003c/span\u003e\n  \u003cspan class=\"s\"\u003eproxy_set_header    X-Forwarded-Host     $http_host;\u003c/span\u003e\n  \u003cspan class=\"s\"\u003eproxy_set_header    X-Forwarded-Uri      $request_uri;\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e# other annotations required\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"colist arabic\"\u003e\n\u003ctable\u003e\n\u003ctbody\u003e\u003ctr\u003e\n\u003ctd\u003e\u003ci class=\"conum\" data-value=\"1\"\u003e\u003c/i\u003e\u003cb\u003e1\u003c/b\u003e\u003c/td\u003e\n\u003ctd\u003eConfigures the controller to use heimdall’s decision service endpoint with \u003ccode\u003e\u0026lt;heimdall service name\u0026gt;\u003c/code\u003e, \u003ccode\u003e\u0026lt;namespace\u0026gt;\u003c/code\u003e and \u003ccode\u003e\u0026lt;decision port\u0026gt;\u003c/code\u003e depending on your configuration.\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003ci class=\"conum\" data-value=\"2\"\u003e\u003c/i\u003e\u003cb\u003e2\u003c/b\u003e\u003c/td\u003e\n\u003ctd\u003eLet NGINX forward the \u003ccode\u003eAuthorization\u003c/code\u003e header set by heimdall to the upstream service upon successful response. This configuration depends on\nyour \u003ca href=\"/docs/mechanisms/contextualizers/\"\u003eContextualizers\u003c/a\u003e and \u003ca href=\"/docs/mechanisms/finalizers/\"\u003eFinalizers\u003c/a\u003e configuration. If not configured, NGINX will only react on \u003ccode\u003eSet-Cookie\u003c/code\u003e headers in responses from heimdall by default.\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003ci class=\"conum\" data-value=\"3\"\u003e\u003c/i\u003e\u003cb\u003e3\u003c/b\u003e\u003c/td\u003e\n\u003ctd\u003eConfigures the required headers to pass the information about the used HTTP scheme, host and port, request path and used query parameters to be forwarded to heimdall.\n\u003cdiv class=\"admonitionblock note\"\u003e\n\u003ctable\u003e\n\u003ctbody\u003e\u003ctr\u003e\n\u003ctd class=\"icon\"\u003e\n\u003ci class=\"fa icon-note\" title=\"Note\"\u003e\u003c/i\u003e\n\u003c/td\u003e\n\u003ctd class=\"content\"\u003e\nWithout that, heimdall will not be able extracting relevant information from the NGINX request as it does not support NGINX proprietary \u003ccode\u003eX-Original-Method\u003c/code\u003e and \u003ccode\u003eX-Original-Uri\u003c/code\u003e used by it for the same purposes.\n\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\u003c/table\u003e\n\u003c/div\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_alternative_configuration\"\u003eAlternative Configuration\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eAlternatively, if you don’t want configuring \u003ccode\u003etrusted_proxies\u003c/code\u003e and do not rely on the used HTTP scheme, host and port in your rules, you can also use the \u003ccode\u003enginx.ingress.kubernetes.io/configuration-snippet\u003c/code\u003e and \u003ccode\u003enginx.ingress.kubernetes.io/server-snippet\u003c/code\u003e annotations and use the configuration shown below.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThis example is an exact copy of the configuration used in the very first \u003ca href=\"#_first_option\"\u003eintegration option\u003c/a\u003e described above.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"yaml\"\u003e\u003cspan class=\"na\"\u003enginx.ingress.kubernetes.io/configuration-snippet\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"pi\"\u003e|\u003c/span\u003e\n  \u003cspan class=\"s\"\u003eauth_request               /_auth;\u003c/span\u003e\n  \u003cspan class=\"s\"\u003eauth_request_set           $auth_cookie $upstream_http_set_cookie;\u003c/span\u003e\n  \u003cspan class=\"s\"\u003eadd_header                 Set-Cookie $auth_cookie;\u003c/span\u003e\n  \u003cspan class=\"s\"\u003eauth_request_set           $auth_header $upstream_http_authorization;\u003c/span\u003e\n  \u003cspan class=\"s\"\u003eproxy_set_header           \u0026#39;Authorization\u0026#39; $auth_header;\u003c/span\u003e\n  \u003cspan class=\"s\"\u003eproxy_set_header Proxy     \u0026#34;\u0026#34;;\u003c/span\u003e\n\u003cspan class=\"na\"\u003enginx.ingress.kubernetes.io/server-snippet\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"pi\"\u003e|\u003c/span\u003e\n  \u003cspan class=\"s\"\u003elocation = /_auth {\u003c/span\u003e\n    \u003cspan class=\"s\"\u003einternal;\u003c/span\u003e\n    \u003cspan class=\"s\"\u003eaccess_log               off;\u003c/span\u003e\n    \u003cspan class=\"s\"\u003eproxy_method             $request_method;\u003c/span\u003e\n    \u003cspan class=\"s\"\u003eproxy_pass               http://\u0026lt;heimdall service name\u0026gt;.\u0026lt;namespace\u0026gt;.svc.cluster.local:\u0026lt;decision port\u0026gt;$request_uri;\u003c/span\u003e\n    \u003cspan class=\"s\"\u003eproxy_pass_request_body  off;\u003c/span\u003e\n    \u003cspan class=\"s\"\u003eproxy_set_header         Content-Length   \u0026#34;\u0026#34;;\u003c/span\u003e\n    \u003cspan class=\"s\"\u003eproxy_set_header         Host $http_host;\u003c/span\u003e\n  \u003cspan class=\"s\"\u003e}\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e# other annotations required\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_additional_resources\"\u003eAdditional Resources\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eCheckout the examples on \u003ca href=\"https://github.com/dadrus/heimdall/tree/main/examples\"\u003eGitHub\u003c/a\u003e for a working demo.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n","sections":["Guides","API Gateways \u0026 Proxies"],"tags":null,"title":"NGINX Integration","url":"/guides/proxies/nginx/"},{"categories":null,"content":" Traefik Proxy is a modern HTTP proxy and load balancer for microservices, heimdall can be integrated with via the ForwardAuth Middleware while operated in the Decision Operation Mode. In such setup, traefik delegates authentication and authorization to heimdall. If heimdall answers with a 2XX code, traefik grants access and forwards the original request to the upstream service. Otherwise, the response from heimdall is returned to the client.\nTo achieve this, configure traefik\nto make use of the aforesaid ForwardAuth middleware by setting the address property to the decision service endpoint and\nconfigure the authResponseHeaders to contain the required header name(s), heimdall sets in the HTTP responses (depends on your Contextualizers and Finalizers configuration).\nConfigure the route of your service to make use of this middleware.\nTraefik makes use of X-Forwarded-* HTTP headers to forward the HTTP method, protocol, host, etc. to the ForwardAuth middleware. By default, heimdall does not trust those. To allow heimdall making use of such headers, you must configure trusted proxies in heimdall’s decision service configuration to contain the IPs or networks of your traefik instances. For test purposes, you can set it to \u0026#34;0.0.0.0/0\u0026#34;, which would basically disable the check and let heimdall trust requests from any source.\nSince traefik makes use of those X-Forwarded-* headers, which heimdall also handles with precedence, there is no need to drop any headers to prevent spoofing (see also Security Considerations for details. Example 1. Using Docker labels edge-router: image: traefik # further configuration labels: - traefik.http.middlewares.heimdall.forwardauth.address=http://heimdall:4456 - traefik.http.middlewares.heimdall.forwardauth.authResponseHeaders=X-Id-Token,Authorization # further labels service: image: my-service # further configuration labels: - traefik.http.routers.service.middlewares=heimdall # further labels A fully working example with Traefik is shown in the Protect an Application quickstart and is also available on GitHub.\n","description":"Explains how to integrate heimdall with Traefik Proxy, a modern HTTP proxy and load balancer for microservices.","html_content":"\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e\u003ca href=\"https://doc.traefik.io/traefik/\"\u003eTraefik Proxy\u003c/a\u003e is a modern HTTP proxy and load balancer for microservices, heimdall can be integrated with via the \u003ca href=\"https://doc.traefik.io/traefik/middlewares/http/forwardauth/\"\u003eForwardAuth Middleware\u003c/a\u003e while operated in the \u003ca href=\"/docs/concepts/operating_modes/#_decision_mode\"\u003eDecision Operation Mode\u003c/a\u003e. In such setup, traefik delegates authentication and authorization to heimdall. If heimdall answers with a 2XX code, traefik grants access and forwards the original request to the upstream service. Otherwise, the response from heimdall is returned to the client.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eTo achieve this, configure traefik\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eto make use of the aforesaid ForwardAuth middleware by setting the \u003ccode\u003eaddress\u003c/code\u003e property to the decision service endpoint and\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003econfigure the \u003ccode\u003eauthResponseHeaders\u003c/code\u003e to contain the required header name(s), heimdall sets in the HTTP responses (depends on your \u003ca href=\"/docs/mechanisms/contextualizers/\"\u003eContextualizers\u003c/a\u003e and \u003ca href=\"/docs/mechanisms/finalizers/\"\u003eFinalizers\u003c/a\u003e configuration).\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eConfigure the route of your service to make use of this middleware.\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"admonitionblock caution\"\u003e\n\u003ctable\u003e\n\u003ctbody\u003e\u003ctr\u003e\n\u003ctd class=\"icon\"\u003e\n\u003ci class=\"fa icon-caution\" title=\"Caution\"\u003e\u003c/i\u003e\n\u003c/td\u003e\n\u003ctd class=\"content\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eTraefik makes use of \u003ccode\u003eX-Forwarded-*\u003c/code\u003e HTTP headers to forward the HTTP method, protocol, host, etc. to the ForwardAuth middleware. By default, heimdall does not trust those. To allow heimdall making use of such headers, you must configure \u003ca href=\"/docs/services/decision/#_trusted_proxies\"\u003etrusted proxies\u003c/a\u003e in heimdall’s decision service configuration to contain the IPs or networks of your traefik instances. For test purposes, you can set it to \u0026#34;0.0.0.0/0\u0026#34;, which would basically disable the check and let heimdall trust requests from any source.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003cdiv class=\"admonitionblock note\"\u003e\n\u003ctable\u003e\n\u003ctbody\u003e\u003ctr\u003e\n\u003ctd class=\"icon\"\u003e\n\u003ci class=\"fa icon-note\" title=\"Note\"\u003e\u003c/i\u003e\n\u003c/td\u003e\n\u003ctd class=\"content\"\u003e\nSince traefik makes use of those \u003ccode\u003eX-Forwarded-*\u003c/code\u003e headers, which heimdall also handles with precedence, there is no need to drop any headers to prevent spoofing (see also \u003ca href=\"/docs/operations/security/#_http_headers_security_considerations\"\u003eSecurity Considerations\u003c/a\u003e for details.\n\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003cdiv class=\"exampleblock\"\u003e\n\u003cdiv class=\"title\"\u003eExample 1. Using Docker labels\u003c/div\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"yaml\"\u003e\u003cspan class=\"na\"\u003eedge-router\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eimage\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003etraefik\u003c/span\u003e\n  \u003cspan class=\"c1\"\u003e# further configuration\u003c/span\u003e\n  \u003cspan class=\"na\"\u003elabels\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003etraefik.http.middlewares.heimdall.forwardauth.address=http://heimdall:4456\u003c/span\u003e\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003etraefik.http.middlewares.heimdall.forwardauth.authResponseHeaders=X-Id-Token,Authorization\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e# further labels\u003c/span\u003e\n\n\u003cspan class=\"na\"\u003eservice\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eimage\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003emy-service\u003c/span\u003e\n  \u003cspan class=\"c1\"\u003e# further configuration\u003c/span\u003e\n  \u003cspan class=\"na\"\u003elabels\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003etraefik.http.routers.service.middlewares=heimdall\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e# further labels\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eA fully working example with Traefik is shown in the \u003ca href=\"/docs/getting_started/protect_an_app/\"\u003eProtect an Application\u003c/a\u003e quickstart and is also available on \u003ca href=\"https://github.com/dadrus/heimdall/tree/main/examples\"\u003eGitHub\u003c/a\u003e.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n","sections":["Guides","API Gateways \u0026 Proxies"],"tags":null,"title":"Traefik Proxy Integration","url":"/guides/proxies/traefik/"},{"categories":null,"content":" Open Policy Agent, or OPA, is an open source, general purpose policy engine, which decouples authorization, respectively policy decisions from other responsibilities of an application and can be used to implement fine-grained access control for your application. As such it is a very good fit for integrating with heimdall. And indeed, the integration is very simple. It is just a matter of using a Remote Authorizer or a Generic Contextualizer. Which one is better for a particular use case depends on the specific application requirements. Here some examples demonstrating these and how it can be solved with heimdall:\nExample 1. Sharing Service Imagine you have a sharing service, e.g. to let friends share all their photos with each other and the API looks roughly as follows:\nGET /\u0026lt;user\u0026gt;/photos returns all the photos of the user either to the owner of the photo collection itself or to its friends.\nTo achieve this using OPA, we would need something like the following Rego policy:\npackage share_photos default allow = false # user is owner. that is, the value of first path # fragment is equal to the identified user allow { split(input.path, \u0026#34;/\u0026#34;)[1] == input.user } # user is friend. that is, the user referenced by the # first path fragment has the identified user in its friends list allow { data.friends[split(input.path, \u0026#34;/\u0026#34;)[1]][_] == input.user } It expects two pieces of information in the payload to the OPA instance:\nthe actual user, making the request and\nthe path to witch the request is made\nSo something like this: { \u0026#34;input\u0026#34;: { \u0026#34;user\u0026#34;: \u0026#34;alice\u0026#34;, \u0026#34;path\u0026#34;: \u0026#34;bob/photos\u0026#34; } }. Since the Rego policy defined above returns just true or false, the corresponding response from the OPA endpoint would be { \u0026#34;result\u0026#34;: true } or { \u0026#34;result\u0026#34;: false }. Given this and assuming the above policy can be used by making requests to https://opa.local/v1/data/share_photos/policy/allow, the configuration of the Remote Authorizer would look like follows:\nid: photos_access type: remote config: endpoint: url: https://opa.local/v1/data/share_photos/policy/allow payload: | { \u0026#34;input\u0026#34;: { \u0026#34;user\u0026#34;: {{ quote .Subject.ID }}, \u0026#34;path\u0026#34;: {{ quote .RequestURL.Path }} } } expressions: - expression: | Payload.result == true Here the entire authorization happens within heimdall and is completely outsourced from the business logic of our sharing service.\nExample 2. Membership Verification Imagine you have a billing service, which requires information about the membership of a user to different groups, which represent different subscription options for you entire offering. Depending on this information your service would create invoices with different amounts. The imaginary API of that service could look like follows:\nPOST /create_invoice to invoice the identified user.\nYou could perform the required query to OPA entirely in your service and use the retrieved group memberships then. Alternatively, you could outsource the communication to OPA to heimdall and deal only with the group membership information in your service. Compared to the Sharing Service example, this time heimdall would not perform any authorization, but rather enrich the subject information with further information. This way, we’re not going to use a Authorizer, but a Generic Contextualizer instead. As with Sharing Service example, there is a need for a Rego policy, which could look like this:\npackage invoice groups_graph[data.groups[subject].name] = edges { edges := data.groups[subject].member_of } member_of_groups[subject] = groups { groups_graph[subject] groups := graph.reachable(groups_graph, {subject}) } groups { member_of_groups[input.user][_] } It expects just one piece of information, namely the actual user, making the request. So something like this: { \u0026#34;input\u0026#34;: { \u0026#34;user\u0026#34;: \u0026#34;alice\u0026#34; } }. Since the Rego policy defined above returns a list of groups, the corresponding response from the OPA endpoint would be { \u0026#34;result\u0026#34;: [\u0026#34;group1\u0026#34;, \u0026#34;group2\u0026#34;] }. Given this and assuming the above policy can be used by making requests to https://opa.local/v1/data/invoice/policy/groups and the authentication to that endpoint requires basic authentication, the configuration of the Generic Contextualizer would look like follows:\nid: billing_contextualizer type: generic config: endpoint: url: https://opa.local/v1/data/invoice/policy/groups auth: type: basic_auth config: user: MyOpaUser password: SuperSecretPassword payload: | { \u0026#34;input\u0026#34;: { \u0026#34;user\u0026#34;: {{ quote .Subject.ID }} } } Upon successful execution of the corresponding request, the response from the OPA endpoint will be stored in the Subject.Attributes[\u0026#34;billing_contextualizer\u0026#34;] field. That way, you can use that information in a Finalizer to forward the group membership to the billing service API.\n","description":"Explains how to integrate heimdall with the Open Policy Agent, an open source, general purpose policy engine.","html_content":"\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e\u003ca href=\"https://www.openpolicyagent.org/\"\u003eOpen Policy Agent\u003c/a\u003e, or OPA, is an open source, general purpose policy engine, which decouples authorization, respectively policy decisions from other responsibilities of an application and can be used to implement fine-grained access control for your application. As such it is a very good fit for integrating with heimdall. And indeed, the integration is very simple. It is just a matter of using a \u003ca href=\"/docs/mechanisms/authorizers/#_remote\"\u003eRemote Authorizer\u003c/a\u003e or a \u003ca href=\"/docs/mechanisms/contextualizers/#_generic\"\u003eGeneric Contextualizer\u003c/a\u003e. Which one is better for a particular use case depends on the specific application requirements. Here some examples demonstrating these and how it can be solved with heimdall:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv id=\"_sharing_service_example\" class=\"exampleblock\"\u003e\n\u003cdiv class=\"title\"\u003eExample 1. Sharing Service\u003c/div\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eImagine you have a sharing service, e.g. to let friends share all their photos with each other and the API looks roughly as follows:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003eGET /\u0026lt;user\u0026gt;/photos\u003c/code\u003e returns all the photos of the user either to the owner of the photo collection itself or to its friends.\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eTo achieve this using OPA, we would need something like the following \u003ca href=\"https://www.openpolicyagent.org/docs/latest/policy-language/\"\u003eRego\u003c/a\u003e policy:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"rego\"\u003e\u003cspan class=\"ow\"\u003epackage\u003c/span\u003e \u003cspan class=\"n\"\u003eshare_photos\u003c/span\u003e\n\n\u003cspan class=\"ow\"\u003edefault\u003c/span\u003e \u003cspan class=\"n\"\u003eallow\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kc\"\u003efalse\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e# user is owner. that is, the value of first path\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e# fragment is equal to the identified user\u003c/span\u003e\n\u003cspan class=\"n\"\u003eallow\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003esplit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003einput\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;/\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e)[\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003einput\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003euser\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e# user is friend. that is, the user referenced by the\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e# first path fragment has the identified user in its friends list\u003c/span\u003e\n\u003cspan class=\"n\"\u003eallow\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003edata\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003efriends\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003esplit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003einput\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;/\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e)[\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e]][\u003c/span\u003e\u003cspan class=\"n\"\u003e_\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003einput\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003euser\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eIt expects two pieces of information in the payload to the OPA instance:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003ethe actual user, making the request and\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003ethe path to witch the request is made\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eSo something like this: \u003ccode\u003e{ \u0026#34;input\u0026#34;: { \u0026#34;user\u0026#34;: \u0026#34;alice\u0026#34;, \u0026#34;path\u0026#34;: \u0026#34;bob/photos\u0026#34; } }\u003c/code\u003e. Since the Rego policy defined above returns just \u003ccode\u003etrue\u003c/code\u003e or \u003ccode\u003efalse\u003c/code\u003e, the corresponding response from the OPA endpoint would be \u003ccode\u003e{ \u0026#34;result\u0026#34;: true }\u003c/code\u003e or \u003ccode\u003e{ \u0026#34;result\u0026#34;: false }\u003c/code\u003e. Given this and assuming the above policy can be used by making requests to \u003ccode\u003ehttps://opa.local/v1/data/share_photos/policy/allow\u003c/code\u003e, the configuration of the \u003ca href=\"/docs/mechanisms/authorizers/#_remote\"\u003eRemote Authorizer\u003c/a\u003e would look like follows:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"yaml\"\u003e\u003cspan class=\"na\"\u003eid\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ephotos_access\u003c/span\u003e\n\u003cspan class=\"na\"\u003etype\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eremote\u003c/span\u003e\n\u003cspan class=\"na\"\u003econfig\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eendpoint\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"na\"\u003eurl\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ehttps://opa.local/v1/data/share_photos/policy/allow\u003c/span\u003e\n  \u003cspan class=\"na\"\u003epayload\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"pi\"\u003e|\u003c/span\u003e\n    \u003cspan class=\"s\"\u003e{ \u0026#34;input\u0026#34;: { \u0026#34;user\u0026#34;: {{ quote .Subject.ID }}, \u0026#34;path\u0026#34;: {{ quote .RequestURL.Path }} } }\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eexpressions\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eexpression\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"pi\"\u003e|\u003c/span\u003e\n      \u003cspan class=\"s\"\u003ePayload.result == true\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eHere the entire authorization happens within heimdall and is completely outsourced from the business logic of our sharing service.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"exampleblock\"\u003e\n\u003cdiv class=\"title\"\u003eExample 2. Membership Verification\u003c/div\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eImagine you have a billing service, which requires information about the membership of a user to different groups, which represent different subscription options for you entire offering. Depending on this information your service would create invoices with different amounts. The imaginary API of that service could look like follows:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003ePOST /create_invoice\u003c/code\u003e to invoice the identified user.\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eYou could perform the required query to OPA entirely in your service and use the retrieved group memberships then. Alternatively, you could outsource the communication to OPA to heimdall and deal only with the group membership information in your service. Compared to the \u003ca href=\"#_sharing_service_example\"\u003eSharing Service\u003c/a\u003e example, this time heimdall would not perform any authorization, but rather enrich the subject information with further information. This way, we’re not going to use a \u003ca href=\"/docs/mechanisms/authorizers/\"\u003eAuthorizer\u003c/a\u003e, but a \u003ca href=\"/docs/mechanisms/contextualizers/#_generic\"\u003eGeneric Contextualizer\u003c/a\u003e instead. As with \u003ca href=\"#_sharing_service_example\"\u003eSharing Service\u003c/a\u003e example, there is a need for a \u003ca href=\"https://www.openpolicyagent.org/docs/latest/policy-language/\"\u003eRego\u003c/a\u003e policy, which could look like this:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"rego\"\u003e\u003cspan class=\"ow\"\u003epackage\u003c/span\u003e \u003cspan class=\"n\"\u003einvoice\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003egroups_graph\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003edata\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003egroups\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003esubject\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eedges\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"n\"\u003eedges\u003c/span\u003e \u003cspan class=\"o\"\u003e:=\u003c/span\u003e \u003cspan class=\"n\"\u003edata\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003egroups\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003esubject\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003emember_of\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003emember_of_groups\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003esubject\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003egroups\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"n\"\u003egroups_graph\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003esubject\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n  \u003cspan class=\"n\"\u003egroups\u003c/span\u003e \u003cspan class=\"o\"\u003e:=\u003c/span\u003e \u003cspan class=\"n\"\u003egraph\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ereachable\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003egroups_graph\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003esubject\u003c/span\u003e\u003cspan class=\"p\"\u003e})\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003egroups\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"n\"\u003emember_of_groups\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003einput\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003euser\u003c/span\u003e\u003cspan class=\"p\"\u003e][\u003c/span\u003e\u003cspan class=\"n\"\u003e_\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eIt expects just one piece of information, namely the actual user, making the request. So something like this: \u003ccode\u003e{ \u0026#34;input\u0026#34;: { \u0026#34;user\u0026#34;: \u0026#34;alice\u0026#34; } }\u003c/code\u003e. Since the Rego policy defined above returns a list of groups, the corresponding response from the OPA endpoint would be \u003ccode\u003e{ \u0026#34;result\u0026#34;: [\u0026#34;group1\u0026#34;, \u0026#34;group2\u0026#34;] }\u003c/code\u003e. Given this and assuming the above policy can be used by making requests to \u003ccode\u003ehttps://opa.local/v1/data/invoice/policy/groups\u003c/code\u003e and the authentication to that endpoint requires basic authentication, the configuration of the \u003ca href=\"/docs/mechanisms/contextualizers/#_generic\"\u003eGeneric Contextualizer\u003c/a\u003e would look like follows:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"yaml\"\u003e\u003cspan class=\"na\"\u003eid\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ebilling_contextualizer\u003c/span\u003e\n\u003cspan class=\"na\"\u003etype\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003egeneric\u003c/span\u003e\n\u003cspan class=\"na\"\u003econfig\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eendpoint\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"na\"\u003eurl\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ehttps://opa.local/v1/data/invoice/policy/groups\u003c/span\u003e\n    \u003cspan class=\"na\"\u003eauth\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"na\"\u003etype\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ebasic_auth\u003c/span\u003e\n      \u003cspan class=\"na\"\u003econfig\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"na\"\u003euser\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eMyOpaUser\u003c/span\u003e\n        \u003cspan class=\"na\"\u003epassword\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eSuperSecretPassword\u003c/span\u003e\n  \u003cspan class=\"na\"\u003epayload\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"pi\"\u003e|\u003c/span\u003e\n    \u003cspan class=\"s\"\u003e{ \u0026#34;input\u0026#34;: { \u0026#34;user\u0026#34;: {{ quote .Subject.ID }} } }\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eUpon successful execution of the corresponding request, the response from the OPA endpoint will be stored in the \u003ccode\u003eSubject.Attributes[\u0026#34;billing_contextualizer\u0026#34;]\u003c/code\u003e field. That way, you can use that information in a \u003ca href=\"/docs/mechanisms/finalizers/\"\u003eFinalizer\u003c/a\u003e to forward the group membership to the billing service API.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n","sections":["Guides","Authorization Services"],"tags":null,"title":"Integration with OPA","url":"/guides/authz/opa/"},{"categories":null,"content":" Configuration in heimdall can refer to two different things:\nthe static startup configuration, which is the scope of this document and\nthe configuration of rules, respectively rule sets, which you can find here.\nElements in the static configuration set up the services, like decision service, which basically define the entry points, heimdall will listen to, the observability capabilities, like logging, the mechanism catalogue, the default rule, as well as the rule providers (these elements are not expected to change often).\nThe rule set contains everything that defines how the requests are handled by heimdall for your system. This configuration can change and is seamlessly hot-reloaded, without any request interruption or connection loss.\nOverview There are two different, not mutually exclusive (you can combine them), ways to define static configuration options in Heimdall:\nin a configuration file (only YAML is supported as format)\nas environment variables\nThe evaluation happens also in the order stated above. That also means, you can always overwrite configuration options defined in a configuration file with corresponding environment variables.\nIf no configuration is provided, heimdall will set useful defaults. These are however not enough, as heimdall doesn’t know your context - which mechanisms are required for the one or the other of your upstream services. So, you’ll not really be able to use heimdall as all requests will be answered with an HTTP 405 Method Not Allowed response code.\nConfiguration File At start up, heimdall searches for static configuration in a file named heimdall.yaml in\n/etc/heimdall\n$HOME/.config\nthe current working directory\nYou can also override this using the config argument: heimdall --config \u0026lt;path-to-your-config-file\u0026gt;.\nThe values in the configuration file can also make use of environment variables. Access to these happens using Bash syntax. Following expressions are supported:\n${var} - Value of $var\n${var=default} - If $var is not set, evaluate expression as default\n${var:=default} - If $var is not set or is empty, evaluate expression as default\nExample 1. Possible minimal fully working configuration The configuration below defines a default rule which lets heimdall create a JSON Web Token (JWT) with sub claim set to anonymous for every request on every URL for the HTTP methods GET and POST. The JWT itself will be put into the Authorization header as a bearer token.\nlog: level: info mechanisms: authenticators: - id: anonymous_authenticator type: anonymous finalizers: - id: create_jwt type: jwt default_rule: methods: - GET - POST execute: - authenticator: anonymous_authenticator - finalizer: create_jwt Example 2. Configuration with a mechanism defined using environment variables substitution mechanisms: authenticators: - id: hydra_authenticator type: oauth2_introspection config: introspection_endpoint: url: http://hydra:4445/oauth2/introspect auth: type: basic_auth config: user: ${INTROSPECT_EP_USER} password: ${INTROSPECT_EP_PASSWORD} finalizers: - id: create_jwt type: jwt Environment Variables Every configuration property, which can be defined in a configuration file can also be defined as environment variable. Following rules apply:\nIf not specified while starting heimdall, all variables start with HEIMDALLCFG_ prefix.\nIf for whatever reason, your environment configuration contains variables starting with HEIMDALLCFG_, which do not define heimdall specific configuration, heimdall will refuse starting if such configuration variable clashes (has an unexpected type) with heimdall’s configuration properties (even for environment variables, the configuration is type safe). You can overcome such situation, by ether renaming such variables, or, if this is not possible, make use of the --env-config-prefix flag with heimdall’s serve command. Properties in a hierarchy are separated by _\nE.g. the log level can be set to info in a config file as also shown in the above example with\nlog: level: info and using an environment variable with\nHEIMDALLCFG_LOG_LEVEL=info Array entries must be defined using _\u0026lt;IDX\u0026gt;[_], with IDX being the index of the array starting with 0 and _ in brackets being only required, if the value of the configured element has a structure/hierarchy.\nE.g. the methods of the default rule can be configured in a config file as\ndefault_rule: methods: - GET - POST and using environment variables with\nHEIMDALLCFG_DEFAULT__RULE_METHODS_0=GET HEIMDALLCFG_DEFAULT__RULE_METHODS_1=POST For structured configuration, like the definition of the authenticators in the example above\nmechanisms: authenticators: - id: anonymous_authenticator type: anonymous The corresponding environment variables would be\nHEIMDALLCFG_MECHANISMS_AUTHENTICATORS_0_ID=anonymous_authenticator HEIMDALLCFG_MECHANISMS_AUTHENTICATORS_0_TYPE=anonymous If a name of a property has _ it must be escaped with an additional _.\nE.g. the service name, appearing for heimdall for your tracing backend can be configured in a configuration file with\ntracing: service_name: foobar and using the environment variables with\nHEIMDALLCFG_TRACING_SERVICE__NAME=foobar ","description":"This page explains the available configuration options in detail.","html_content":"\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eConfiguration in heimdall can refer to two different things:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003ethe static startup configuration, which is the scope of this document and\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003ethe configuration of rules, respectively rule sets, which you can find \u003ca href=\"/docs/rules/rule_sets/\"\u003ehere\u003c/a\u003e.\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eElements in the static configuration set up the services, like \u003ca href=\"/docs/services/decision/\"\u003edecision service\u003c/a\u003e, which basically define the entry points, heimdall will listen to, the observability capabilities, like \u003ca href=\"/docs/operations/observability/#_logging\"\u003elogging\u003c/a\u003e, the \u003ca href=\"/docs/concepts/mechanisms/\"\u003emechanism catalogue\u003c/a\u003e, the \u003ca href=\"/docs/rules/default_rule/\"\u003edefault rule\u003c/a\u003e, as well as the \u003ca href=\"/docs/rules/providers/\"\u003erule providers\u003c/a\u003e (these elements are not expected to change often).\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe rule set contains everything that defines how the requests are handled by heimdall for your system.\nThis configuration can change and is seamlessly hot-reloaded, without any request interruption or connection loss.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_overview\"\u003eOverview\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThere are two different, not mutually exclusive (you can combine them), ways to define static configuration options in Heimdall:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"olist arabic\"\u003e\n\u003col class=\"arabic\"\u003e\n\u003cli\u003e\n\u003cp\u003ein a \u003ca href=\"#_configuration_file\"\u003econfiguration file\u003c/a\u003e (only \u003ca href=\"https://yaml.org/spec/1.2.2/\"\u003eYAML\u003c/a\u003e is supported as format)\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eas \u003ca href=\"#_environment_variables\"\u003eenvironment variables\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe evaluation happens also in the order stated above.\nThat also means, you can always overwrite configuration options defined in a configuration file with corresponding environment variables.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eIf no configuration is provided, heimdall will set useful defaults.\nThese are however not enough, as heimdall doesn’t know your context - which mechanisms are required for the one or the other of your upstream services.\nSo, you’ll not really be able to use heimdall as all requests will be answered with an HTTP \u003ccode\u003e405 Method Not Allowed\u003c/code\u003e response code.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_configuration_file\"\u003eConfiguration File\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eAt start up, heimdall searches for static configuration in a file named \u003ccode\u003eheimdall.yaml\u003c/code\u003e in\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003e/etc/heimdall\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003e$HOME/.config\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003ethe current working directory\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eYou can also override this using the \u003ccode\u003econfig\u003c/code\u003e argument: \u003ccode\u003eheimdall --config \u0026lt;path-to-your-config-file\u0026gt;\u003c/code\u003e.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe values in the configuration file can also make use of environment variables. Access to these happens using Bash syntax. Following expressions are supported:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003e${var}\u003c/code\u003e - Value of \u003ccode\u003e$var\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003e${var=default}\u003c/code\u003e - If \u003ccode\u003e$var\u003c/code\u003e is not set, evaluate expression as \u003ccode\u003edefault\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003e${var:=default}\u003c/code\u003e - If \u003ccode\u003e$var\u003c/code\u003e is not set or is empty, evaluate expression as \u003ccode\u003edefault\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"exampleblock\"\u003e\n\u003cdiv class=\"title\"\u003eExample 1. Possible minimal fully working configuration\u003c/div\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe configuration below defines a \u003ca href=\"/docs/rules/default_rule/\"\u003edefault rule\u003c/a\u003e which lets heimdall create a JSON Web Token (JWT) with \u003ccode\u003esub\u003c/code\u003e claim set to \u003ccode\u003eanonymous\u003c/code\u003e for every request on every URL for the HTTP methods GET and POST.\nThe JWT itself will be put into the \u003ccode\u003eAuthorization\u003c/code\u003e header as a bearer token.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"yaml\"\u003e\u003cspan class=\"na\"\u003elog\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"na\"\u003elevel\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003einfo\u003c/span\u003e\n\n\u003cspan class=\"na\"\u003emechanisms\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eauthenticators\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eid\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eanonymous_authenticator\u003c/span\u003e\n    \u003cspan class=\"na\"\u003etype\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eanonymous\u003c/span\u003e\n  \u003cspan class=\"na\"\u003efinalizers\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eid\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ecreate_jwt\u003c/span\u003e\n    \u003cspan class=\"na\"\u003etype\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ejwt\u003c/span\u003e\n\n\u003cspan class=\"na\"\u003edefault_rule\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"na\"\u003emethods\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003eGET\u003c/span\u003e\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003ePOST\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eexecute\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eauthenticator\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eanonymous_authenticator\u003c/span\u003e\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003efinalizer\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ecreate_jwt\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"exampleblock\"\u003e\n\u003cdiv class=\"title\"\u003eExample 2. Configuration with a mechanism defined using environment variables substitution\u003c/div\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"yaml\"\u003e\u003cspan class=\"na\"\u003emechanisms\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eauthenticators\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eid\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ehydra_authenticator\u003c/span\u003e\n    \u003cspan class=\"na\"\u003etype\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eoauth2_introspection\u003c/span\u003e\n    \u003cspan class=\"na\"\u003econfig\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"na\"\u003eintrospection_endpoint\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"na\"\u003eurl\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ehttp://hydra:4445/oauth2/introspect\u003c/span\u003e\n        \u003cspan class=\"na\"\u003eauth\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n          \u003cspan class=\"na\"\u003etype\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ebasic_auth\u003c/span\u003e\n          \u003cspan class=\"na\"\u003econfig\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"na\"\u003euser\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e${INTROSPECT_EP_USER}\u003c/span\u003e\n            \u003cspan class=\"na\"\u003epassword\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e${INTROSPECT_EP_PASSWORD}\u003c/span\u003e\n  \u003cspan class=\"na\"\u003efinalizers\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eid\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ecreate_jwt\u003c/span\u003e\n    \u003cspan class=\"na\"\u003etype\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ejwt\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_environment_variables\"\u003eEnvironment Variables\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eEvery configuration property, which can be defined in a \u003ca href=\"#_configuration_file\"\u003econfiguration file\u003c/a\u003e can also be defined as environment variable.\nFollowing rules apply:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eIf not specified while starting heimdall, all variables start with \u003ccode\u003eHEIMDALLCFG_\u003c/code\u003e prefix.\u003c/p\u003e\n\u003cdiv class=\"admonitionblock caution\"\u003e\n\u003ctable\u003e\n\u003ctbody\u003e\u003ctr\u003e\n\u003ctd class=\"icon\"\u003e\n\u003ci class=\"fa icon-caution\" title=\"Caution\"\u003e\u003c/i\u003e\n\u003c/td\u003e\n\u003ctd class=\"content\"\u003e\nIf for whatever reason, your environment configuration contains variables starting with \u003ccode\u003eHEIMDALLCFG_\u003c/code\u003e, which do not define heimdall specific configuration, heimdall will refuse starting if such configuration variable clashes (has an unexpected type) with heimdall’s configuration properties (even for environment variables, the configuration is type safe).\nYou can overcome such situation, by ether renaming such variables, or, if this is not possible, make use of the \u003ccode\u003e--env-config-prefix\u003c/code\u003e flag with heimdall’s \u003ccode\u003eserve\u003c/code\u003e command.\n\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eProperties in a hierarchy are separated by \u003ccode\u003e_\u003c/code\u003e\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eE.g. the log level can be set to \u003ccode\u003einfo\u003c/code\u003e in a config file as also shown in the above example with\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"yaml\"\u003e\u003cspan class=\"na\"\u003elog\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"na\"\u003elevel\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003einfo\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eand using an environment variable with\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"bash\"\u003e\u003cspan class=\"nv\"\u003eHEIMDALLCFG_LOG_LEVEL\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003einfo\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eArray entries must be defined using \u003ccode\u003e_\u0026lt;IDX\u0026gt;[_]\u003c/code\u003e, with \u003ccode\u003eIDX\u003c/code\u003e being the index of the array starting with \u003ccode\u003e0\u003c/code\u003e and \u003ccode\u003e_\u003c/code\u003e in brackets being only required, if the value of the configured element has a structure/hierarchy.\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eE.g. the \u003ccode\u003emethods\u003c/code\u003e of the \u003ca href=\"/docs/rules/default_rule/\"\u003edefault rule\u003c/a\u003e can be configured in a config file as\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"yaml\"\u003e\u003cspan class=\"na\"\u003edefault_rule\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"na\"\u003emethods\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003eGET\u003c/span\u003e\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003ePOST\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eand using environment variables with\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"bash\"\u003e\u003cspan class=\"nv\"\u003eHEIMDALLCFG_DEFAULT__RULE_METHODS_0\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eGET\n\u003cspan class=\"nv\"\u003eHEIMDALLCFG_DEFAULT__RULE_METHODS_1\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003ePOST\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eFor structured configuration, like the definition of the authenticators in the example above\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"yaml\"\u003e\u003cspan class=\"na\"\u003emechanisms\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eauthenticators\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eid\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eanonymous_authenticator\u003c/span\u003e\n    \u003cspan class=\"na\"\u003etype\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eanonymous\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe corresponding environment variables would be\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"bash\"\u003e\u003cspan class=\"nv\"\u003eHEIMDALLCFG_MECHANISMS_AUTHENTICATORS_0_ID\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eanonymous_authenticator\n\u003cspan class=\"nv\"\u003eHEIMDALLCFG_MECHANISMS_AUTHENTICATORS_0_TYPE\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eanonymous\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eIf a name of a property has \u003ccode\u003e_\u003c/code\u003e it must be escaped with an additional \u003ccode\u003e_\u003c/code\u003e.\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eE.g. the service name, appearing for heimdall for your tracing backend can be configured in a configuration file with\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"yaml\"\u003e\u003cspan class=\"na\"\u003etracing\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eservice_name\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003efoobar\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eand using the environment variables with\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"bash\"\u003e\u003cspan class=\"nv\"\u003eHEIMDALLCFG_TRACING_SERVICE__NAME\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003efoobar\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n","sections":["Operations"],"tags":null,"title":"Configuration ","url":"/docs/operations/configuration/"},{"categories":null,"content":" Usage Patterns heimdall [command] [flags] [arguments] Use heimdall help to get overview about available commands, respectively heimdall [command] help for help on any command.\nFlag’s usage:\n# set flag_argument to flag(s) heimdall [--flag=flag_argument] [-f [flag_argument]] E.g.\nheimdall validate config -c config.yaml Commands completion\nGenerates the autocompletion script for the specified shell.\nhealth\nCalls heimdall’s healthcheck endpoint to verify the status of the deployment.\nhelp\nProvides an overview about the available commands and their descriptions.\nserve\nStarts heimdall in the decision, or the reverse proxy operation mode.\nvalidate\nValidates heimdall configuration, like rules or the actual configuration.\n","description":"Here, you can find the description of heimdall's command line interface.","html_content":"\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_usage_patterns\"\u003eUsage Patterns\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"bash\"\u003eheimdall \u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"nb\"\u003ecommand\u003c/span\u003e\u003cspan class=\"o\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e[\u003c/span\u003eflags] \u003cspan class=\"o\"\u003e[\u003c/span\u003earguments]\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eUse \u003ccode\u003eheimdall help\u003c/code\u003e to get overview about available commands, respectively \u003ccode\u003eheimdall [command] help\u003c/code\u003e for help on any command.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eFlag’s usage:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"bash\"\u003e\u003cspan class=\"c\"\u003e# set flag_argument to flag(s)\u003c/span\u003e\nheimdall \u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"nt\"\u003e--flag\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eflag_argument] \u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"nt\"\u003e-f\u003c/span\u003e \u003cspan class=\"o\"\u003e[\u003c/span\u003eflag_argument]]\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eE.g.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"bash\"\u003eheimdall validate config \u003cspan class=\"nt\"\u003e-c\u003c/span\u003e config.yaml\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_commands\"\u003eCommands\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003ecompletion\u003c/code\u003e\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eGenerates the autocompletion script for the specified shell.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003ehealth\u003c/code\u003e\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eCalls heimdall’s healthcheck endpoint to verify the status of the deployment.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003ehelp\u003c/code\u003e\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eProvides an overview about the available commands and their descriptions.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003eserve\u003c/code\u003e\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eStarts heimdall in the decision, or the reverse proxy operation mode.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003evalidate\u003c/code\u003e\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eValidates heimdall configuration, like rules or the actual configuration.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n","sections":["Operations"],"tags":null,"title":"CLI","url":"/docs/operations/cli/"},{"categories":null,"content":" Logging Heimdall’s implementation uses zerolog - Zero Allocation JSON Logger, which can however also log in plain text. All emitted log statements include information related to distributed tracing (if tracing is enabled) so that not only log statements can be correlated to traces, but also all log statements belonging to single request/transaction can be correlated as well.\nConfiguration Logging configuration can be adjusted in the log property of heimdall’s configuration and supports following properties.\nformat: string (optional)\nWith text and gelf being the available formats. text is the default format. And gelf defines a JSON format adhering to GELF.\nUsage of text (default) format is not recommended for production deployments as it requires more computational resources and is hence slow. Example 1. Configuring logging to emit logs using GELD format. log: format: gelf level: string (optional)\nFollowing log levels are available: trace, debug, info, warn, error, fatal, panic and disabled. The last one effectively disables logging. You usually do not want to do this. By default, the level is set to error.\ndebug and trace log levels are not meant for production as setting log level to one of these will result in a high log verbosity and also affect performance pretty much. Both are only meant for setup analysis and debugging! trace log level will also dump all incoming and outgoing HTTP requests and responses, as well as the contents of objects used in templates. That dump is unedited. That means sensitive data will be available in logs. Due to some limitations of the GRPC framework capabilities, setting log level to trace will not dump GRPC requests and responses. If you need these for analysis purposes (e.g. when debugging the integration with envoy proxy), you’ll have to set GODEBUG as well as the GRPC_GO_LOG_VERBOSITY_LEVEL and GRPC_GO_LOG_SEVERITY_LEVEL environment variables. Example 2. Configuring logging to emit logs in debug level. log: level: debug Regular Log Events If you configure heimdall to log in text format, you can expect output similar to the one shown below:\n2022-08-03T12:51:48+02:00 INF Opentelemetry tracing initialized. 2022-08-03T12:51:48+02:00 INF Instantiating in memory cache 2022-08-03T12:51:48+02:00 DBG Creating rule set event queue. 2022-08-03T12:51:48+02:00 INF Loading pipeline definitions 2022-08-03T12:51:48+02:00 DBG Loading definitions for authenticators 2022-08-03T12:51:48+02:00 DBG Loading pipeline definition id=anonymous_authenticator type=anonymous ... 2022-08-03T12:51:52+02:00 DBG Decision endpoint called 2022-08-03T12:51:52+02:00 DBG Executing default rule 2022-08-03T12:51:52+02:00 DBG Authenticating using anonymous authenticator 2022-08-03T12:51:52+02:00 DBG Finalizing using JWT finalizer 2022-08-03T12:51:52+02:00 DBG Generating new JWT 2022-08-03T12:51:52+02:00 DBG Finalizing request Usage of this format is not recommended for production deployments as it requires more computational resources and is hence slow. Otherwise, if you configure it to use gelf (see GELF for format details) format, the output will look as follows:\n{\u0026#34;_level_name\u0026#34;: \u0026#34;INFO\u0026#34;, \u0026#34;version\u0026#34;:\u0026#34;1.1\u0026#34;, \u0026#34;host\u0026#34;: \u0026#34;unknown\u0026#34;, \u0026#34;timestamp\u0026#34;: 1659523288, \u0026#34;level\u0026#34;: 6, \u0026#34;short_message\u0026#34;: \u0026#34;Opentracing tracer initialized.\u0026#34;} {\u0026#34;_level_name\u0026#34;: \u0026#34;INFO\u0026#34;, \u0026#34;version\u0026#34;: \u0026#34;1.1\u0026#34;, \u0026#34;host\u0026#34;: \u0026#34;unknown\u0026#34;, \u0026#34;timestamp\u0026#34;: 1659523288, \u0026#34;level\u0026#34;: 6, \u0026#34;short_message\u0026#34;: \u0026#34;Instantiating in memory cache\u0026#34;} {\u0026#34;_level_name\u0026#34;: \u0026#34;DEBUG\u0026#34;, \u0026#34;version\u0026#34;: \u0026#34;1.1\u0026#34;, \u0026#34;host\u0026#34;: \u0026#34;unknown\u0026#34;, \u0026#34;timestamp\u0026#34;: 1659523288, \u0026#34;level\u0026#34;: 7, \u0026#34;short_message\u0026#34;: \u0026#34;Creating rule set event queue.\u0026#34;} {\u0026#34;_level_name\u0026#34;: \u0026#34;INFO\u0026#34;, \u0026#34;version\u0026#34;: \u0026#34;1.1\u0026#34;, \u0026#34;host\u0026#34;: \u0026#34;unknown\u0026#34;, \u0026#34;timestamp\u0026#34;: 1659523288, \u0026#34;level\u0026#34;: 6, \u0026#34;short_message\u0026#34;: \u0026#34;Loading pipeline definitions\u0026#34;} {\u0026#34;_level_name\u0026#34;: \u0026#34;DEBUG\u0026#34;, \u0026#34;version\u0026#34;: \u0026#34;1.1\u0026#34;, \u0026#34;host\u0026#34;: \u0026#34;unknown\u0026#34;, \u0026#34;timestamp\u0026#34;: 1659523288, \u0026#34;level\u0026#34;: 7,\u0026#34;short_message\u0026#34;: \u0026#34;Loading definitions for authenticators\u0026#34;} {\u0026#34;_level_name\u0026#34;: \u0026#34;DEBUG\u0026#34;, \u0026#34;version\u0026#34;: \u0026#34;1.1\u0026#34;, \u0026#34;host\u0026#34;: \u0026#34;unknown\u0026#34;, \u0026#34;id\u0026#34;: \u0026#34;anonymous_authenticator\u0026#34;, \u0026#34;type\u0026#34;: \u0026#34;anonymous\u0026#34;,\u0026#34;timestamp\u0026#34;: 1659523288, \u0026#34;level\u0026#34;: 7, \u0026#34;short_message\u0026#34;: \u0026#34;Loading pipeline definition\u0026#34;} ... {\u0026#34;_level_name\u0026#34;: \u0026#34;DEBUG\u0026#34;, \u0026#34;version\u0026#34;: \u0026#34;1.1\u0026#34;, \u0026#34;host\u0026#34;: \u0026#34;unknown\u0026#34;, \u0026#34;timestamp\u0026#34;: 1659523295, \u0026#34;level\u0026#34;: 7, \u0026#34;_parent_id\u0026#34;: \u0026#34;3449bda63ed70206\u0026#34;, \u0026#34;_span_id\u0026#34;: \u0026#34;f57c007257fee0ed\u0026#34;, \u0026#34;_trace_id\u0026#34;: \u0026#34;00000000000000000a5af97bffe6a8a2\u0026#34;, \u0026#34;short_message\u0026#34;: \u0026#34;Decision endpoint called\u0026#34;} {\u0026#34;_level_name\u0026#34;: \u0026#34;DEBUG\u0026#34;, \u0026#34;version\u0026#34;: \u0026#34;1.1\u0026#34;, \u0026#34;host\u0026#34;: \u0026#34;unknown\u0026#34;, \u0026#34;timestamp\u0026#34;:1659523295, \u0026#34;level\u0026#34;: 7, \u0026#34;_parent_id\u0026#34;: \u0026#34;3449bda63ed70206\u0026#34;, \u0026#34;_span_id\u0026#34;: \u0026#34;f57c007257fee0ed\u0026#34;, \u0026#34;_trace_id\u0026#34;: \u0026#34;00000000000000000a5af97bffe6a8a2\u0026#34;, \u0026#34;short_message\u0026#34;: \u0026#34;Executing default rule\u0026#34;} {\u0026#34;_level_name\u0026#34;: \u0026#34;DEBUG\u0026#34;, \u0026#34;version\u0026#34;:\u0026#34;1.1\u0026#34;, \u0026#34;host\u0026#34;: \u0026#34;unknown\u0026#34;, \u0026#34;timestamp\u0026#34;:1659523295, \u0026#34;level\u0026#34;: 7, \u0026#34;_parent_id\u0026#34;: \u0026#34;3449bda63ed70206\u0026#34;, \u0026#34;_span_id\u0026#34;: \u0026#34;f57c007257fee0ed\u0026#34;, \u0026#34;_trace_id\u0026#34;: \u0026#34;00000000000000000a5af97bffe6a8a2\u0026#34;, \u0026#34;short_message\u0026#34;: \u0026#34;Authenticating using anonymous authenticator\u0026#34;} {\u0026#34;_level_name\u0026#34;: \u0026#34;DEBUG\u0026#34;, \u0026#34;version\u0026#34;: \u0026#34;1.1\u0026#34;, \u0026#34;host\u0026#34;: \u0026#34;unknown\u0026#34;, \u0026#34;timestamp\u0026#34;: 1659523295, \u0026#34;level\u0026#34;: 7, \u0026#34;_parent_id\u0026#34;: \u0026#34;3449bda63ed70206\u0026#34;, \u0026#34;_span_id\u0026#34;: \u0026#34;f57c007257fee0ed\u0026#34;, \u0026#34;_trace_id\u0026#34;: \u0026#34;00000000000000000a5af97bffe6a8a2\u0026#34;, \u0026#34;short_message\u0026#34;: \u0026#34;Finalizing using JWT finalizer\u0026#34;} {\u0026#34;_level_name\u0026#34;: \u0026#34;DEBUG\u0026#34;, \u0026#34;version\u0026#34;: \u0026#34;1.1\u0026#34;, \u0026#34;host\u0026#34;: \u0026#34;unknown\u0026#34;, \u0026#34;timestamp\u0026#34;: 1659523295, \u0026#34;level\u0026#34;: 7, \u0026#34;_parent_id\u0026#34;: \u0026#34;3449bda63ed70206\u0026#34;, \u0026#34;_span_id\u0026#34;: \u0026#34;f57c007257fee0ed\u0026#34;, \u0026#34;_trace_id\u0026#34;: \u0026#34;00000000000000000a5af97bffe6a8a2\u0026#34;, \u0026#34;short_message\u0026#34;: \u0026#34;Generating new JWT\u0026#34;} {\u0026#34;_level_name\u0026#34;: \u0026#34;DEBUG\u0026#34;, \u0026#34;version\u0026#34;: \u0026#34;1.1\u0026#34;, \u0026#34;host\u0026#34;: \u0026#34;unknown\u0026#34;, \u0026#34;timestamp\u0026#34;: 1659523295, \u0026#34;level\u0026#34;: 7, \u0026#34;_parent_id\u0026#34;: \u0026#34;3449bda63ed70206\u0026#34;, \u0026#34;_span_id\u0026#34;: \u0026#34;f57c007257fee0ed\u0026#34;, \u0026#34;_trace_id\u0026#34;: \u0026#34;00000000000000000a5af97bffe6a8a2\u0026#34;, \u0026#34;short_message\u0026#34;: \u0026#34;Finalizing request\u0026#34;} Each log statement does also include the following fields in both log formats for incoming requests if tracing is enabled:\n_trace_id - The trace id as defined by OpenTelemetry.\n_span_id - The span id as defined by OpenTelemetry of the current transaction.\n_parent_id - The span id of the callee, which started the given transaction. Only present if the callee set the corresponding tracing header.\nAccess Log Events In addition to regular logs, heimdall emits access logs. These events are always emitted regardless the configured log level and the log level of these events in the log output is always INFO.\nEach request to any of heimdall’s endpoints will result in two access events:\nevent describing the start of the transaction, and an\nevent describing the finalization of the transaction.\nFollowing are the fields, which are always set for both events:\n_tx_start - Timestamp in Unix epoch format, when the transaction started.\n_client_ip - The IP of the client of the request.\nIf the event has been emitted for an HTTP request, following fields are set as well:\n_http_method - The HTTP method used by the client while calling heimdall’s endpoint.\n_http_path - The used HTTP path.\n_http_user_agent - The agent used by the client. The value is taken from the HTTP \u0026#34;User-Agent\u0026#34; header.\n_http_host - The host part of the URI, the client is using while communicating with Heimdall.\n_http_scheme - The scheme part of the URI, the client is using while communicating with Heimdall.\nIf the event has been emitted for a GRPC request, following fields are set:\n_grpc_method - The full GRPC method used.\nIf the request comes from an intermediary, like e.g. an API Gateway and heimdall is configured to trust that \u0026#34;proxy\u0026#34; (see trusted_proxies configuration of the Decision service, as well as the trusted_proxies configuration of the Proxy service), then following fields will be part of the events as well if the corresponding HTTP headers were sent.\n_http_x_forwarded_proto - The value of the \u0026#34;X-Forwarded-Proto\u0026#34; header.\n_http_x_forwarded_host - The value of the \u0026#34;X-Forwarded-Host\u0026#34; header.\n_http_x_forwarded_uri - The value of the \u0026#34;X-Forwarded-Uri\u0026#34; header.\n_http_x_forwarded_for - The value of the \u0026#34;X-Forwarded-For\u0026#34; header.\n_http_forwarded - The value of the \u0026#34;Forwarded\u0026#34; header.\nFollowing are the fields, which are set in the transaction finalization event in addition:\n_body_bytes_sent - The length of the response body.\n_tx_duration_ms - The duration of the transaction in milliseconds. If heimdall is operated in proxy mode, it will also include the time used to communicate with the upstream service.\n_access_granted - Set either to true or false, indicating whether heimdall granted access or not.\n_subject - The subject identifier if the access was granted.\n_error - The information about an error, which e.g. led to the denial of the request.\nIf the finalization event has been emitted for an HTTP request, following fields are set as well:\n_http_status_code - The numeric HTTP response status code\nIf the finalization event has been emitted for a GRPC request, following fields are set:\n_grpc_status_code - The numeric GRPC status code.\nFollowing are the fields, which are set if tracing is enabled:\n_trace_id - The trace id as defined by OpenTelemetry.\n_span_id - The span id as defined by OpenTelemetry of the current transaction.\n_parent_id - The span id of the callee, which started the given transaction. Only present if the callee set the corresponding tracing header.\nIf you configure heimdall to log in text format, you can expect output as shown below:\n2022-08-03T12:40:16+02:00 INF TX started _client_ip=127.0.0.1 _http_host=127.0.0.1:4468 _http_method=GET _http_path=/foo _http_scheme=http _http_user_agent=curl/7.74.0 _parent_id=3449bda63ed70206 _span_id=f57c007257fee0ed _trace_id=00000000000000000a5af97bffe6a8a2 _tx_start=1659523216 .... 2022-08-03T12:40:16+02:00 INF TX finished _access_granted=true _body_bytes_sent=0 _client_ip=127.0.0.1 _http_host=127.0.0.1:4468 _http_method=GET _http_path=/foo _http_scheme=http _http_status_code=202 _http_user_agent=curl/7.74.0 _subject=anonymous _parent_id=3449bda63ed70206 _span_id=f57c007257fee0ed _trace_id=00000000000000000a5af97bffe6a8a2 _tx_duration_ms=0 _tx_start=1659523216 Otherwise, if you configure it to use gelf format, the output will look as follows:\n{\u0026#34;_level_name\u0026#34;: \u0026#34;INFO\u0026#34;, \u0026#34;version\u0026#34;:\u0026#34;1.1\u0026#34;, \u0026#34;host\u0026#34;:\u0026#34;unknown\u0026#34;, \u0026#34;_tx_start\u0026#34;:1659523295, \u0026#34;_client_ip\u0026#34;: \u0026#34;127.0.0.1\u0026#34;, \u0026#34;_http_method\u0026#34;: \u0026#34;GET\u0026#34;, \u0026#34;_http_path\u0026#34;:\u0026#34;/foo\u0026#34;, \u0026#34;_http_user_agent\u0026#34;: \u0026#34;curl/7.74.0\u0026#34;, \u0026#34;_http_host\u0026#34;: \u0026#34;127.0.0.1:4468\u0026#34;, \u0026#34;_http_scheme\u0026#34;: \u0026#34;http\u0026#34;, \u0026#34;timestamp\u0026#34;: 1659523295, \u0026#34;level\u0026#34;: 6, \u0026#34;_parent_id\u0026#34;: \u0026#34;3449bda63ed70206\u0026#34;, \u0026#34;_span_id\u0026#34;: \u0026#34;f57c007257fee0ed\u0026#34;, \u0026#34;_trace_id\u0026#34;: \u0026#34;00000000000000000a5af97bffe6a8a2\u0026#34;, \u0026#34;short_message\u0026#34;: \u0026#34;TX started\u0026#34;} .... {\u0026#34;_level_name\u0026#34;: \u0026#34;INFO\u0026#34;, \u0026#34;version\u0026#34;: \u0026#34;1.1\u0026#34;, \u0026#34;host\u0026#34;: \u0026#34;unknown\u0026#34;, \u0026#34;_tx_start\u0026#34;: 1659523295, \u0026#34;_client_ip\u0026#34;: \u0026#34;127.0.0.1\u0026#34;, \u0026#34;_http_method\u0026#34;: \u0026#34;GET\u0026#34;, \u0026#34;_http_path\u0026#34;: \u0026#34;/foo\u0026#34;, \u0026#34;_http_user_agent\u0026#34;: \u0026#34;curl/7.74.0\u0026#34;, \u0026#34;_http_host\u0026#34;: \u0026#34;127.0.0.1:4468\u0026#34;, \u0026#34;_http_scheme\u0026#34;: \u0026#34;http\u0026#34;, \u0026#34;_body_bytes_sent\u0026#34;: 0, \u0026#34;_http_status_code\u0026#34;:200, \u0026#34;_tx_duration_ms\u0026#34;:0, \u0026#34;_subject\u0026#34;: \u0026#34;anonymous\u0026#34;, \u0026#34;_access_granted\u0026#34;: true, \u0026#34;timestamp\u0026#34;:1659523295, \u0026#34;level\u0026#34;: 6, \u0026#34;_parent_id\u0026#34;: \u0026#34;3449bda63ed70206\u0026#34;, \u0026#34;_span_id\u0026#34;: \u0026#34;f57c007257fee0ed\u0026#34;, \u0026#34;_trace_id\u0026#34;: \u0026#34;00000000000000000a5af97bffe6a8a2\u0026#34;, \u0026#34;short_message\u0026#34;: \u0026#34;TX finished\u0026#34;} Tracing Heimdall makes use of OpenTelemetry for distributed tracing to support recording of paths taken by requests and supports all environment variables including the defined values according to OpenTelemetry Environment Variables and OpenTelemetry SDK Configuration specifications. In addition to these environment variables, heimdall defines some additional options, which are described below and can be used to tune the behaviour.\nConfiguration By default, tracing is enabled and can be disabled or slightly tuned in the tracing property of heimdall’s configuration supporting the following properties.\nenabled: boolean (optional)\nBy making use of this property, you can configure heimdall to enable or disable tracing. Defaults to true (tracing enabled).\nExample 3. Disabling tracing. tracing: enabled: false span_processor: string (optional)\nWith simple and batch being the available options. By setting this property, you can define how heimdall shall process the created spans. Defaults to batch. This property is only there, as there is no corresponding setting option via OTEL tracing environment variables available.\nExample 4. Setting the span processor to export completed spans in batches. tracing: span_processor: batch Description of the options:\nsimple - Configures heimdall to synchronously export the created spans via configured exporters. This is not recommended for production use as it is slow and has a high computation resource usage overhead. It might be however good for testing, debugging, or showing examples of other features.\nbatch - Configures heimdall to send completed span batches to the exporter. Recommended setting for production use.\nTracing Context Propagation When a request arrives at heimdall, it will create a trace context object based on the received headers, which according to OTEL are the traceparent and tracestate HTTP headers, defined in W3C Trace Context as well as baggage HTTP header, defined in W3C Baggage. The creation of that context, as well as the transformation of it into new HTTP headers, set by heimdall while communicating with further services is named propagation and the components responsible for the creation of such context object are named propagators.\nSince not every service in a multi-service system may set or understand the above OTEL specific HTTP headers (as these might still be using tracing vendor specific headers), interoperability can be achieved by configuring the required propagators by making use of the OTEL_PROPAGATORS environment variable. OTEL defines the following values for this variable:\ntracecontext - W3C Trace Context propagator. Enabled by default, if OTEL_PROPAGATORS is not set.\nbaggage - W3C Baggage propagator. Enabled by default if OTEL_PROPAGATORS is not set.\nb3 - Zipkin B3 Single Header propagator.\nb3multi - Zipkin B3 Multiple Header propagator.\njaeger - Jaeger Header propagator.\nxray - AWS X-Ray Header propagator.\nottrace - OT Trace Header propagator.\nnone - No automatically configured propagator.\nAll of these are supported by heimdall. In addition, following propagators can be configured as well:\ndatadog - Datadog APM Trace Header propagator.[1]\nConfigured propagators are used for inbound, as well as for outbound traffic.\nSpan Exporters Span Exporter handle the delivery of spans to external receivers (collectors, or agents). This is the final component in the trace export pipeline and typically provided by the APM vendor, like Jaeger, Zipkin, Instana, etc. Since not every multi-service system may have an up to day telemetry receiver supporting protocols defined by OTEL, interoperability can be achieved by configuring the required exporters by making use of the OTEL_TRACES_EXPORTER environment variable. OTEL defines the following values for this variable[2]:\notlp - OTLP exporter. Enabled by default if OTEL_TRACES_EXPORTER is not set.\nzipkin - Zipkin exporter to export spans in Zipkin data model.\nnone - No automatically configured exporter for traces.\nAll of these are supported by heimdall. In addition, following exporters can be configured as well:\ninstana - Instana exporter to export spans in Instana data model.[3]\nExample Configuration The environment variables set below configure heimdall to use Jaeger propagator and to export the spans via OTLP over grpc to the collector available under http://collector:4317.\nOTEL_PROPAGATORS=jaeger OTEL_TRACES_EXPORTER=otlp OTEL_EXPORTER_OTLP_TRACES_PROTOCOL=grpc OTEL_EXPORTER_OTLP_TRACES_ENDPOINT=http://collector:4317 If your environment supports OpenTelemetry and usage of defaults is ok, most probably, the only required environment variable to be set might be the OTEL_EXPORTER_OTLP_TRACES_ENDPOINT.\nMetrics Heimdall makes use of OpenTelemetry to emit metrics. Depending on the configuration, push or pull based metrics export is supported.\nConfiguration As with tracing, the entire configuration happens via environment variables as defined by OpenTelemetry Environment Variables and OpenTelemetry SDK Configuration specifications. The generated metrics can either be exported by pushing these to an OTEL collector (the default behavior). Alternatively, the available metrics can be pulled and are then exported in the (Prometheus style).\nMetrics are generated and exported by default. If this is not desired, you can explicitly disable this behavior within the metrics property of heimdall’s configuration by making use of the following property:\nenabled: boolean (optional)\nBy making use of this property, you can configure heimdall to enable or disable the metrics collection. Defaults to true (metrics exposure is enabled).\nExample 5. Disabling metrics. metrics: enabled: false Metric Exporters By default, metrics are pushed to the OTEL collector using the http/protobuf transport protocol. You can change that behavior by making use of either the OTEL_EXPORTER_OTLP_METRICS_PROTOCOL, or the OTEL_EXPORTER_OTLP_PROTOCOL environment variable.\nTo let heimdall know where to push the metrics to, either OTEL_EXPORTER_OTLP_METRICS_ENDPOINT, or OTEL_EXPORTER_OTLP_ENDPOINT must be defined.\nTo let heimdall expose metrics over a pull based service (Prometheus style), the OTEL_METRICS_EXPORTER environment variable must be set to \u0026#34;prometheus\u0026#34;. In that case heimdall will expose the 127.0.0.1:9464/metrics endpoint which can be queried using the HTTP GET verb. You can change the host and port of that service by making use of the OTEL_EXPORTER_PROMETHEUS_HOST and OTEL_EXPORTER_PROMETHEUS_PORT environment variables.\nYou can also disable metrics export by setting the OTEL_METRICS_EXPORTER environment variable to none.\nAvailable Metrics System metrics according to OpenTelemetry Semantic Conventions for System Metrics.\nProcess and Go runtime metrics according to OpenTelemetry Semantic Conventions for OS Process Metrics.\nInformation about the handled requests on each active service, as well as information about requests in progress according to OpenTelemetry Semantic Conventions for HTTP Metrics and General RPC conventions.\nInformation about the metrics endpoint itself (if enabled), including the number of internal errors encountered while gathering the metrics, number of current inflight and overall scrapes done.\nInformation about expiry for configured certificates.\nAll, but custom metrics adhere to the OpenTelementry semantic conventions. For that reason, only the custom metrics are listed in the table below.\nMetric: certificate.expiry Number of seconds until a certificate used by a particular service (decision, proxy, management), as well as signer expires. The metric type is UpDownCounter und the unit is s.\nAttribute Type Description service\nstring\nThe service, the certificate is configured for.\nissuer\nstring\nIssuer DN of the certificate.\nserial_nr\nstring\nThe serial number of the certificate.\nsubject\nstring\nSubject DN of the certificate.\ndns_names\nstring\nDNS entries in the SAN extension\nRuntime Profiling If enabled, heimdall exposes a /debug/pprof HTTP endpoint on port 10251 (See also the configuration options below) on which runtime profiling data in the profile.proto format (also known as pprof format) can be consumed by APM tools, like Google’s pprof, Grafana Phlare, Pyroscope and many more for visualization purposes. Following information is available:\nallocs - A sampling of all past memory allocations.\nblock - Stack traces that led to blocking on synchronization primitives.\ncmdline - The command line invocation of the current program, with arguments separated by NUL bytes.\ngoroutine - Stack traces of all current goroutines.\nheap - A sampling of memory allocations of live objects.\nmutex - Stack traces of holders of contended mutexes.\nprofile - Cpu profile. Profiling lasts for duration specified in seconds parameter, or for 30 seconds if not specified\nsymbol - Looks up the program counters listed in the request, responding with a table mapping program counters to function names.\nthreadcreate - Stack traces that led to the creation of new OS threads.\ntrace - Execution trace in binary form. Tracing lasts for duration specified in seconds parameter, or for 1 second if not specified.\nSee also the API documentation for the documentation of the actual API.\nConfiguration Configuration for this service can be adjusted in the profiling property of heimdall’s configuration by making use of the following properties.\nenabled: boolean (optional)\nBy making use of this property, you can configure heimdall to enable or disable runtime profiling. Defaults to false (profiling disabled).\nExample 6. Enabling profiling. profiling: enabled: true host: string (optional)\nBy making use of this property, you can specify the TCP/IP address on which heimdall should listen for connections from client applications interested in profiling data. The entry 0.0.0.0 allows listening for all IPv4 addresses. Defaults to 127.0.0.1, which allow only local TCP/IP “loopback” connections to be made.\nIf you operate heimdall in a container, you should set this property to a value, which would allow your APM system to scrape this information. Example 7. Configure heimdall to listen on 192.168.2.10. profiling: host: 192.168.2.10 port: integer (optional)\nBy making use of this property, you can specify the TCP port the heimdall should listen on. Defaults to 10251.\nExample 8. Configure heimdall to listen on port 9999 for runtime profiling requests. metrics: port: 9999 1. Datadog supports the OTLP protokoll. For that reason, there is no exporter available. 2. jaeger exporter has been marked as deprecated and is not supported anymore 3. Instana supports the W3C header used by OTEL. For that reason, there is no propagator available. ","description":"To support easier operation and integration in diverse APM products heimdall implements different observability mechanisms. The following sections provide insights about what can be expected.","html_content":"\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_logging\"\u003eLogging\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eHeimdall’s implementation uses \u003ca href=\"https://github.com/rs/zerolog\"\u003ezerolog\u003c/a\u003e - Zero Allocation JSON Logger, which can however also log in plain text. All emitted log statements include information related to distributed tracing (if tracing is enabled) so that not only log statements can be correlated to traces, but also all log statements belonging to single request/transaction can be correlated as well.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_configuration\"\u003eConfiguration\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eLogging configuration can be adjusted in the \u003ccode\u003elog\u003c/code\u003e property of heimdall’s configuration and supports following properties.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003eformat\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003estring\u003c/em\u003e (optional)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eWith \u003ccode\u003etext\u003c/code\u003e and \u003ccode\u003egelf\u003c/code\u003e being the available formats. \u003ccode\u003etext\u003c/code\u003e is the default format. And \u003ccode\u003egelf\u003c/code\u003e defines a JSON format adhering to \u003ca href=\"https://docs.graylog.org/v1/docs/gelf\"\u003eGELF\u003c/a\u003e.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"admonitionblock warning\"\u003e\n\u003ctable\u003e\n\u003ctbody\u003e\u003ctr\u003e\n\u003ctd class=\"icon\"\u003e\n\u003ci class=\"fa icon-warning\" title=\"Warning\"\u003e\u003c/i\u003e\n\u003c/td\u003e\n\u003ctd class=\"content\"\u003e\nUsage of \u003ccode\u003etext\u003c/code\u003e (default) format is not recommended for production deployments as it requires more computational resources and is hence slow.\n\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003cdiv class=\"exampleblock\"\u003e\n\u003cdiv class=\"title\"\u003eExample 1. Configuring logging to emit logs using GELD format.\u003c/div\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"yaml\"\u003e\u003cspan class=\"na\"\u003elog\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eformat\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003egelf\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003elevel\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003estring\u003c/em\u003e (optional)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eFollowing log levels are available: \u003ccode\u003etrace\u003c/code\u003e, \u003ccode\u003edebug\u003c/code\u003e, \u003ccode\u003einfo\u003c/code\u003e, \u003ccode\u003ewarn\u003c/code\u003e, \u003ccode\u003eerror\u003c/code\u003e, \u003ccode\u003efatal\u003c/code\u003e, \u003ccode\u003epanic\u003c/code\u003e and \u003ccode\u003edisabled\u003c/code\u003e. The last one effectively disables logging. You usually do not want to do this. By default, the level is set to \u003ccode\u003eerror\u003c/code\u003e.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"admonitionblock warning\"\u003e\n\u003ctable\u003e\n\u003ctbody\u003e\u003ctr\u003e\n\u003ctd class=\"icon\"\u003e\n\u003ci class=\"fa icon-warning\" title=\"Warning\"\u003e\u003c/i\u003e\n\u003c/td\u003e\n\u003ctd class=\"content\"\u003e\n\u003ccode\u003edebug\u003c/code\u003e and \u003ccode\u003etrace\u003c/code\u003e log levels are not meant for production as setting log level to one of these will result in a high log verbosity and also affect performance pretty much. Both are only meant for setup analysis and debugging! \u003ccode\u003etrace\u003c/code\u003e log level will also dump all incoming and outgoing HTTP requests and responses, as well as the contents of objects used in templates. That dump is unedited. That means sensitive data will be available in logs.\n\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003cdiv class=\"admonitionblock note\"\u003e\n\u003ctable\u003e\n\u003ctbody\u003e\u003ctr\u003e\n\u003ctd class=\"icon\"\u003e\n\u003ci class=\"fa icon-note\" title=\"Note\"\u003e\u003c/i\u003e\n\u003c/td\u003e\n\u003ctd class=\"content\"\u003e\nDue to some limitations of the GRPC framework capabilities, setting log level to \u003ccode\u003etrace\u003c/code\u003e will not dump GRPC requests and responses. If you need these for analysis purposes (e.g. when debugging the integration with envoy proxy), you’ll have to set \u003ca href=\"https://pkg.go.dev/net/http?utm_source=godoc#hdr-HTTP_2\"\u003e\u003ccode\u003eGODEBUG\u003c/code\u003e\u003c/a\u003e as well as the \u003ca href=\"https://pkg.go.dev/google.golang.org/grpc/examples/features/debugging#section-readme\"\u003e\u003ccode\u003eGRPC_GO_LOG_VERBOSITY_LEVEL\u003c/code\u003e\u003c/a\u003e and \u003ca href=\"https://pkg.go.dev/google.golang.org/grpc/examples/features/debugging#section-readme\"\u003e\u003ccode\u003eGRPC_GO_LOG_SEVERITY_LEVEL\u003c/code\u003e\u003c/a\u003e environment variables.\n\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003cdiv class=\"exampleblock\"\u003e\n\u003cdiv class=\"title\"\u003eExample 2. Configuring logging to emit logs in debug level.\u003c/div\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"yaml\"\u003e\u003cspan class=\"na\"\u003elog\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"na\"\u003elevel\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003edebug\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_regular_log_events\"\u003eRegular Log Events\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eIf you configure heimdall to log in \u003ccode\u003etext\u003c/code\u003e format, you can expect output similar to the one shown below:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"log\"\u003e2022-08-03T12:51:48+02:00 INF Opentelemetry tracing initialized.\n2022-08-03T12:51:48+02:00 INF Instantiating in memory cache\n2022-08-03T12:51:48+02:00 DBG Creating rule set event queue.\n2022-08-03T12:51:48+02:00 INF Loading pipeline definitions\n2022-08-03T12:51:48+02:00 DBG Loading definitions for authenticators\n2022-08-03T12:51:48+02:00 DBG Loading pipeline definition id=anonymous_authenticator type=anonymous\n...\n2022-08-03T12:51:52+02:00 DBG Decision endpoint called\n2022-08-03T12:51:52+02:00 DBG Executing default rule\n2022-08-03T12:51:52+02:00 DBG Authenticating using anonymous authenticator\n2022-08-03T12:51:52+02:00 DBG Finalizing using JWT finalizer\n2022-08-03T12:51:52+02:00 DBG Generating new JWT\n2022-08-03T12:51:52+02:00 DBG Finalizing request\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"admonitionblock warning\"\u003e\n\u003ctable\u003e\n\u003ctbody\u003e\u003ctr\u003e\n\u003ctd class=\"icon\"\u003e\n\u003ci class=\"fa icon-warning\" title=\"Warning\"\u003e\u003c/i\u003e\n\u003c/td\u003e\n\u003ctd class=\"content\"\u003e\nUsage of this format is not recommended for production deployments as it requires more computational resources and is hence slow.\n\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eOtherwise, if you configure it to use \u003ccode\u003egelf\u003c/code\u003e (see \u003ca href=\"https://docs.graylog.org/v1/docs/gelf\"\u003eGELF\u003c/a\u003e for format details) format, the output will look as follows:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"json\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;_level_name\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;INFO\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;version\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;1.1\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;host\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;unknown\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;timestamp\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"mi\"\u003e1659523288\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;level\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"mi\"\u003e6\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;short_message\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;Opentracing tracer initialized.\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;_level_name\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;INFO\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;version\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;1.1\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;host\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;unknown\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;timestamp\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"mi\"\u003e1659523288\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;level\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"mi\"\u003e6\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;short_message\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;Instantiating in memory cache\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;_level_name\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;DEBUG\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;version\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;1.1\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;host\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;unknown\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;timestamp\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"mi\"\u003e1659523288\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;level\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"mi\"\u003e7\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;short_message\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;Creating rule set event queue.\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;_level_name\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;INFO\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;version\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;1.1\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;host\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;unknown\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;timestamp\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"mi\"\u003e1659523288\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;level\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"mi\"\u003e6\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;short_message\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;Loading pipeline definitions\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;_level_name\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;DEBUG\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;version\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;1.1\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;host\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;unknown\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;timestamp\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"mi\"\u003e1659523288\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;level\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"mi\"\u003e7\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;short_message\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;Loading definitions for authenticators\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;_level_name\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;DEBUG\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;version\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;1.1\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;host\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;unknown\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;id\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;anonymous_authenticator\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;type\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;anonymous\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;timestamp\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"mi\"\u003e1659523288\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;level\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"mi\"\u003e7\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;short_message\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;Loading pipeline definition\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\n\u003c/span\u003e\u003cspan class=\"err\"\u003e...\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\n\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;_level_name\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;DEBUG\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;version\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;1.1\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;host\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;unknown\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;timestamp\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"mi\"\u003e1659523295\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;level\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"mi\"\u003e7\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;_parent_id\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;3449bda63ed70206\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;_span_id\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;f57c007257fee0ed\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;_trace_id\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;00000000000000000a5af97bffe6a8a2\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;short_message\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;Decision endpoint called\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;_level_name\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;DEBUG\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;version\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;1.1\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;host\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;unknown\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;timestamp\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"mi\"\u003e1659523295\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;level\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"mi\"\u003e7\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;_parent_id\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;3449bda63ed70206\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;_span_id\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;f57c007257fee0ed\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;_trace_id\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;00000000000000000a5af97bffe6a8a2\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;short_message\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;Executing default rule\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;_level_name\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;DEBUG\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;version\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;1.1\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;host\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;unknown\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;timestamp\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"mi\"\u003e1659523295\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;level\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"mi\"\u003e7\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;_parent_id\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;3449bda63ed70206\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;_span_id\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;f57c007257fee0ed\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;_trace_id\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;00000000000000000a5af97bffe6a8a2\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;short_message\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;Authenticating using anonymous authenticator\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;_level_name\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;DEBUG\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;version\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;1.1\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;host\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;unknown\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;timestamp\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"mi\"\u003e1659523295\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;level\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"mi\"\u003e7\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;_parent_id\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;3449bda63ed70206\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;_span_id\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;f57c007257fee0ed\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;_trace_id\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;00000000000000000a5af97bffe6a8a2\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;short_message\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;Finalizing using JWT finalizer\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;_level_name\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;DEBUG\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;version\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;1.1\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;host\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;unknown\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;timestamp\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"mi\"\u003e1659523295\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;level\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"mi\"\u003e7\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;_parent_id\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;3449bda63ed70206\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;_span_id\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;f57c007257fee0ed\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;_trace_id\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;00000000000000000a5af97bffe6a8a2\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;short_message\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;Generating new JWT\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;_level_name\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;DEBUG\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;version\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;1.1\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;host\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;unknown\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;timestamp\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"mi\"\u003e1659523295\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;level\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"mi\"\u003e7\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;_parent_id\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;3449bda63ed70206\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;_span_id\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;f57c007257fee0ed\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;_trace_id\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;00000000000000000a5af97bffe6a8a2\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;short_message\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;Finalizing request\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eEach log statement does also include the following fields in both log formats for incoming requests if tracing is enabled:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003e_trace_id\u003c/code\u003e - The trace id as defined by OpenTelemetry.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003e_span_id\u003c/code\u003e - The span id as defined by OpenTelemetry of the current transaction.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003e_parent_id\u003c/code\u003e - The span id of the callee, which started the given transaction. Only present if the callee set the corresponding tracing header.\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_access_log_events\"\u003eAccess Log Events\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eIn addition to regular logs, heimdall emits access logs. These events are always emitted regardless the configured log level and the log level of these events in the log output is always \u003ccode\u003eINFO\u003c/code\u003e.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eEach request to any of heimdall’s endpoints will result in two access events:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eevent describing the start of the transaction, and an\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eevent describing the finalization of the transaction.\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eFollowing are the fields, which are always set for both events:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003e_tx_start\u003c/code\u003e - Timestamp in Unix epoch format, when the transaction started.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003e_client_ip\u003c/code\u003e - The IP of the client of the request.\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eIf the event has been emitted for an HTTP request, following fields are set as well:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003e_http_method\u003c/code\u003e - The HTTP method used by the client while calling heimdall’s endpoint.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003e_http_path\u003c/code\u003e - The used HTTP path.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003e_http_user_agent\u003c/code\u003e - The agent used by the client. The value is taken from the HTTP \u0026#34;User-Agent\u0026#34; header.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003e_http_host\u003c/code\u003e - The host part of the URI, the client is using while communicating with Heimdall.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003e_http_scheme\u003c/code\u003e - The scheme part of the URI, the client is using while communicating with Heimdall.\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eIf the event has been emitted for a GRPC request, following fields are set:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003e_grpc_method\u003c/code\u003e - The full GRPC method used.\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eIf the request comes from an intermediary, like e.g. an API Gateway and heimdall is configured to trust that \u0026#34;proxy\u0026#34; (see \u003ca href=\"/docs/services/decision/#_trusted_proxies\"\u003e\u003ccode\u003etrusted_proxies\u003c/code\u003e configuration\u003c/a\u003e of the Decision service, as well as the \u003ca href=\"/docs/services/proxy/#_trusted_proxies\"\u003e\u003ccode\u003etrusted_proxies\u003c/code\u003e configuration\u003c/a\u003e of the Proxy service), then following fields will be part of the events as well if the corresponding HTTP headers were sent.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003e_http_x_forwarded_proto\u003c/code\u003e - The value of the \u0026#34;X-Forwarded-Proto\u0026#34; header.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003e_http_x_forwarded_host\u003c/code\u003e - The value of the \u0026#34;X-Forwarded-Host\u0026#34; header.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003e_http_x_forwarded_uri\u003c/code\u003e - The value of the \u0026#34;X-Forwarded-Uri\u0026#34; header.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003e_http_x_forwarded_for\u003c/code\u003e - The value of the \u0026#34;X-Forwarded-For\u0026#34; header.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003e_http_forwarded\u003c/code\u003e - The value of the \u0026#34;Forwarded\u0026#34; header.\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eFollowing are the fields, which are set in the transaction finalization event in addition:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003e_body_bytes_sent\u003c/code\u003e - The length of the response body.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003e_tx_duration_ms\u003c/code\u003e - The duration of the transaction in milliseconds. If heimdall is operated in proxy mode, it will also include the time used to communicate with the upstream service.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003e_access_granted\u003c/code\u003e - Set either to \u003ccode\u003etrue\u003c/code\u003e or \u003ccode\u003efalse\u003c/code\u003e, indicating whether heimdall granted access or not.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003e_subject\u003c/code\u003e - The subject identifier if the access was granted.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003e_error\u003c/code\u003e - The information about an error, which e.g. led to the denial of the request.\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eIf the finalization event has been emitted for an HTTP request, following fields are set as well:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003e_http_status_code\u003c/code\u003e - The numeric HTTP response status code\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eIf the finalization event has been emitted for a GRPC request, following fields are set:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003e_grpc_status_code\u003c/code\u003e - The numeric GRPC status code.\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eFollowing are the fields, which are set if tracing is enabled:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003e_trace_id\u003c/code\u003e - The trace id as defined by OpenTelemetry.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003e_span_id\u003c/code\u003e - The span id as defined by OpenTelemetry of the current transaction.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003e_parent_id\u003c/code\u003e - The span id of the callee, which started the given transaction. Only present if the callee set the corresponding tracing header.\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eIf you configure heimdall to log in \u003ccode\u003etext\u003c/code\u003e format, you can expect output as shown below:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"text\"\u003e2022-08-03T12:40:16+02:00 INF TX started _client_ip=127.0.0.1 _http_host=127.0.0.1:4468 _http_method=GET\n _http_path=/foo _http_scheme=http _http_user_agent=curl/7.74.0 _parent_id=3449bda63ed70206\n _span_id=f57c007257fee0ed _trace_id=00000000000000000a5af97bffe6a8a2 _tx_start=1659523216\n\n....\n\n2022-08-03T12:40:16+02:00 INF TX finished _access_granted=true _body_bytes_sent=0 _client_ip=127.0.0.1\n _http_host=127.0.0.1:4468 _http_method=GET _http_path=/foo _http_scheme=http _http_status_code=202\n _http_user_agent=curl/7.74.0 _subject=anonymous _parent_id=3449bda63ed70206 _span_id=f57c007257fee0ed\n _trace_id=00000000000000000a5af97bffe6a8a2 _tx_duration_ms=0 _tx_start=1659523216\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eOtherwise, if you configure it to use \u003ccode\u003egelf\u003c/code\u003e format, the output will look as follows:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"json\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;_level_name\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;INFO\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;version\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;1.1\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;host\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;unknown\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;_tx_start\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"mi\"\u003e1659523295\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;_client_ip\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;127.0.0.1\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;_http_method\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;GET\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;_http_path\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;/foo\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;_http_user_agent\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;curl/7.74.0\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;_http_host\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;127.0.0.1:4468\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;_http_scheme\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;http\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;timestamp\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"mi\"\u003e1659523295\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;level\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"mi\"\u003e6\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;_parent_id\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;3449bda63ed70206\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;_span_id\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;f57c007257fee0ed\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;_trace_id\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;00000000000000000a5af97bffe6a8a2\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;short_message\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;TX started\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\n\u003c/span\u003e\u003cspan class=\"err\"\u003e....\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\n\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;_level_name\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;INFO\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;version\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;1.1\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;host\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;unknown\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;_tx_start\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"mi\"\u003e1659523295\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;_client_ip\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;127.0.0.1\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;_http_method\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;GET\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;_http_path\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;/foo\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;_http_user_agent\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;curl/7.74.0\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;_http_host\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;127.0.0.1:4468\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;_http_scheme\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;http\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;_body_bytes_sent\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;_http_status_code\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"mi\"\u003e200\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;_tx_duration_ms\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;_subject\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;anonymous\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;_access_granted\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;timestamp\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"mi\"\u003e1659523295\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;level\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"mi\"\u003e6\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;_parent_id\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;3449bda63ed70206\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;_span_id\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;f57c007257fee0ed\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;_trace_id\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;00000000000000000a5af97bffe6a8a2\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;short_message\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;TX finished\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_tracing\"\u003eTracing\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eHeimdall makes use of \u003ca href=\"https://opentelemetry.io/\"\u003eOpenTelemetry\u003c/a\u003e for distributed tracing to support recording of paths taken by requests and supports all environment variables including the defined values according to \u003ca href=\"https://opentelemetry.io/docs/reference/specification/sdk-environment-variables/\"\u003eOpenTelemetry Environment Variables\u003c/a\u003e and \u003ca href=\"https://opentelemetry.io/docs/concepts/sdk-configuration/\"\u003eOpenTelemetry SDK Configuration\u003c/a\u003e specifications. In addition to these environment variables, heimdall defines some additional options, which are described below and can be used to tune the behaviour.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_configuration_2\"\u003eConfiguration\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eBy default, tracing is enabled and can be disabled or slightly tuned in the \u003ccode\u003etracing\u003c/code\u003e property of heimdall’s configuration supporting the following properties.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003eenabled\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003eboolean\u003c/em\u003e (optional)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eBy making use of this property, you can configure heimdall to enable or disable tracing. Defaults to \u003ccode\u003etrue\u003c/code\u003e (tracing enabled).\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"exampleblock\"\u003e\n\u003cdiv class=\"title\"\u003eExample 3. Disabling tracing.\u003c/div\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"yaml\"\u003e\u003cspan class=\"na\"\u003etracing\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eenabled\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003efalse\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003espan_processor\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003estring\u003c/em\u003e (optional)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eWith \u003ccode\u003esimple\u003c/code\u003e and \u003ccode\u003ebatch\u003c/code\u003e being the available options. By setting this property, you can define how heimdall shall process the created spans. Defaults to \u003ccode\u003ebatch\u003c/code\u003e. This property is only there, as there is no corresponding setting option via OTEL tracing environment variables available.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"exampleblock\"\u003e\n\u003cdiv class=\"title\"\u003eExample 4. Setting the span processor to export completed spans in batches.\u003c/div\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"yaml\"\u003e\u003cspan class=\"na\"\u003etracing\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"na\"\u003espan_processor\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ebatch\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eDescription of the options:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003esimple\u003c/code\u003e - Configures heimdall to synchronously export the created spans via configured exporters. This is not recommended for production use as it is slow and has a high computation resource usage overhead. It might be however good for testing, debugging, or showing examples of other features.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003ebatch\u003c/code\u003e - Configures heimdall to send completed span batches to the exporter. Recommended setting for production use.\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_tracing_context_propagation\"\u003eTracing Context Propagation\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eWhen a request arrives at heimdall, it will create a trace context object based on the received headers, which according to OTEL are the \u003ccode\u003etraceparent\u003c/code\u003e and \u003ccode\u003etracestate\u003c/code\u003e HTTP headers, defined in \u003ca href=\"https://www.w3.org/TR/trace-context/\"\u003eW3C Trace Context\u003c/a\u003e as well as \u003ccode\u003ebaggage\u003c/code\u003e HTTP header, defined in \u003ca href=\"https://www.w3.org/TR/baggage/\"\u003eW3C Baggage\u003c/a\u003e. The creation of that context, as well as the transformation of it into new HTTP headers, set by heimdall while communicating with further services is named propagation and the components responsible for the creation of such context object are named propagators.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eSince not every service in a multi-service system may set or understand the above OTEL specific HTTP headers (as these might still be using tracing vendor specific headers), interoperability can be achieved by configuring the required propagators by making use of the \u003ccode\u003eOTEL_PROPAGATORS\u003c/code\u003e environment variable. OTEL defines the following values for this variable:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003etracecontext\u003c/code\u003e - \u003ca href=\"https://www.w3.org/TR/trace-context/\"\u003eW3C Trace Context\u003c/a\u003e propagator. Enabled by default, if \u003ccode\u003eOTEL_PROPAGATORS\u003c/code\u003e is not set.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003ebaggage\u003c/code\u003e - \u003ca href=\"https://www.w3.org/TR/baggage/\"\u003eW3C Baggage\u003c/a\u003e propagator. Enabled by default if \u003ccode\u003eOTEL_PROPAGATORS\u003c/code\u003e is not set.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003eb3\u003c/code\u003e - \u003ca href=\"https://github.com/openzipkin/b3-propagation#single-header\"\u003eZipkin B3 Single Header\u003c/a\u003e propagator.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003eb3multi\u003c/code\u003e - \u003ca href=\"https://github.com/openzipkin/b3-propagation#multiple-headers\"\u003eZipkin B3 Multiple Header\u003c/a\u003e propagator.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003ejaeger\u003c/code\u003e - \u003ca href=\"https://www.jaegertracing.io/docs/1.38/client-libraries/#propagation-format\"\u003eJaeger Header\u003c/a\u003e propagator.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003exray\u003c/code\u003e - \u003ca href=\"https://docs.aws.amazon.com/xray/latest/devguide/xray-concepts.html#xray-concepts-tracingheader\"\u003eAWS X-Ray Header\u003c/a\u003e propagator.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003eottrace\u003c/code\u003e - \u003ca href=\"https://github.com/opentracing?q=basic\u0026amp;type=\u0026amp;language=\"\u003eOT Trace Header\u003c/a\u003e propagator.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003enone\u003c/code\u003e - No automatically configured propagator.\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eAll of these are supported by heimdall. In addition, following propagators can be configured as well:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003edatadog\u003c/code\u003e - \u003ca href=\"https://www.datadoghq.com/product/apm/\"\u003eDatadog APM Trace Header\u003c/a\u003e propagator.\u003csup class=\"footnote\"\u003e[\u003ca id=\"_footnoteref_1\" class=\"footnote\" href=\"#_footnotedef_1\" title=\"View footnote.\"\u003e1\u003c/a\u003e]\u003c/sup\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eConfigured propagators are used for inbound, as well as for outbound traffic.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_span_exporters\"\u003eSpan Exporters\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eSpan Exporter handle the delivery of spans to external receivers (collectors, or agents). This is the final component in the trace export pipeline and typically provided by the APM vendor, like Jaeger, Zipkin, Instana, etc. Since not every multi-service system may have an up to day telemetry receiver supporting protocols defined by OTEL, interoperability can be achieved by configuring the required exporters by making use of the \u003ccode\u003eOTEL_TRACES_EXPORTER\u003c/code\u003e environment variable. OTEL defines the following values for this variable\u003csup class=\"footnote\"\u003e[\u003ca id=\"_footnoteref_2\" class=\"footnote\" href=\"#_footnotedef_2\" title=\"View footnote.\"\u003e2\u003c/a\u003e]\u003c/sup\u003e:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003eotlp\u003c/code\u003e - \u003ca href=\"https://opentelemetry.io/docs/reference/specification/protocol/otlp/\"\u003eOTLP\u003c/a\u003e exporter. Enabled by default if \u003ccode\u003eOTEL_TRACES_EXPORTER\u003c/code\u003e is not set.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003ezipkin\u003c/code\u003e - \u003ca href=\"https://zipkin.io/zipkin-api/\"\u003eZipkin\u003c/a\u003e exporter to export spans in Zipkin data model.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003enone\u003c/code\u003e - No automatically configured exporter for traces.\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eAll of these are supported by heimdall. In addition, following exporters can be configured as well:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003einstana\u003c/code\u003e - \u003ca href=\"https://www.instana.com/\"\u003eInstana\u003c/a\u003e exporter to export spans in Instana data model.\u003csup class=\"footnote\"\u003e[\u003ca id=\"_footnoteref_3\" class=\"footnote\" href=\"#_footnotedef_3\" title=\"View footnote.\"\u003e3\u003c/a\u003e]\u003c/sup\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_example_configuration\"\u003eExample Configuration\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe environment variables set below configure heimdall to use Jaeger propagator and to export the spans via OTLP over grpc to the collector available under \u003ccode\u003ehttp://collector:4317\u003c/code\u003e.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"text\"\u003eOTEL_PROPAGATORS=jaeger\nOTEL_TRACES_EXPORTER=otlp\nOTEL_EXPORTER_OTLP_TRACES_PROTOCOL=grpc\nOTEL_EXPORTER_OTLP_TRACES_ENDPOINT=http://collector:4317\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eIf your environment supports OpenTelemetry and usage of defaults is ok, most probably, the only required environment variable to be set might be the \u003ccode\u003eOTEL_EXPORTER_OTLP_TRACES_ENDPOINT\u003c/code\u003e.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_metrics\"\u003eMetrics\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eHeimdall makes use of \u003ca href=\"https://opentelemetry.io/\"\u003eOpenTelemetry\u003c/a\u003e to emit metrics. Depending on the configuration, push or pull based metrics export is supported.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_configuration_3\"\u003eConfiguration\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eAs with tracing, the entire configuration happens via environment variables as defined by \u003ca href=\"https://opentelemetry.io/docs/reference/specification/sdk-environment-variables/\"\u003eOpenTelemetry Environment Variables\u003c/a\u003e and \u003ca href=\"https://opentelemetry.io/docs/concepts/sdk-configuration/\"\u003eOpenTelemetry SDK Configuration\u003c/a\u003e specifications. The generated metrics can either be exported by pushing these to an OTEL collector (the default behavior). Alternatively, the available metrics can be pulled and are then exported in the (\u003ca href=\"https://grafana.com/oss/prometheus/\"\u003ePrometheus\u003c/a\u003e style).\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eMetrics are generated and exported by default. If this is not desired, you can explicitly disable this behavior within the \u003ccode\u003emetrics\u003c/code\u003e property of heimdall’s configuration by making use of the following property:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003eenabled\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003eboolean\u003c/em\u003e (optional)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eBy making use of this property, you can configure heimdall to enable or disable the metrics collection. Defaults to \u003ccode\u003etrue\u003c/code\u003e (metrics exposure is enabled).\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"exampleblock\"\u003e\n\u003cdiv class=\"title\"\u003eExample 5. Disabling metrics.\u003c/div\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"yaml\"\u003e\u003cspan class=\"na\"\u003emetrics\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eenabled\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003efalse\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect3\"\u003e\n\u003ch4 id=\"_metric_exporters\"\u003eMetric Exporters\u003c/h4\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eBy default, metrics are pushed to the OTEL collector using the \u003ccode\u003ehttp/protobuf\u003c/code\u003e transport protocol. You can change that behavior by making use of either the \u003ca href=\"https://opentelemetry.io/docs/concepts/sdk-configuration/otlp-exporter-configuration/#otel_exporter_otlp_metrics_protocol\"\u003e\u003ccode\u003eOTEL_EXPORTER_OTLP_METRICS_PROTOCOL\u003c/code\u003e\u003c/a\u003e, or the \u003ca href=\"https://opentelemetry.io/docs/concepts/sdk-configuration/otlp-exporter-configuration/#otel_exporter_otlp_protocol\"\u003e\u003ccode\u003eOTEL_EXPORTER_OTLP_PROTOCOL\u003c/code\u003e\u003c/a\u003e environment variable.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eTo let heimdall know where to push the metrics to, either \u003ca href=\"https://opentelemetry.io/docs/concepts/sdk-configuration/otlp-exporter-configuration/#otel_exporter_otlp_metrics_endpoint\"\u003e\u003ccode\u003eOTEL_EXPORTER_OTLP_METRICS_ENDPOINT\u003c/code\u003e\u003c/a\u003e, or \u003ca href=\"https://opentelemetry.io/docs/concepts/sdk-configuration/otlp-exporter-configuration/#otel_exporter_otlp_endpoint\"\u003e\u003ccode\u003eOTEL_EXPORTER_OTLP_ENDPOINT\u003c/code\u003e\u003c/a\u003e must be defined.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eTo let heimdall expose metrics over a pull based service (\u003ca href=\"https://grafana.com/oss/prometheus/\"\u003ePrometheus\u003c/a\u003e style), the \u003ca href=\"https://opentelemetry.io/docs/concepts/sdk-configuration/general-sdk-configuration/#otel_metrics_exporter\"\u003e\u003ccode\u003eOTEL_METRICS_EXPORTER\u003c/code\u003e\u003c/a\u003e environment variable must be set to \u003ccode\u003e\u0026#34;prometheus\u0026#34;\u003c/code\u003e. In that case heimdall will expose the \u003ccode\u003e127.0.0.1:9464/metrics\u003c/code\u003e endpoint which can be queried using the HTTP GET verb. You can change the host and port of that service by making use of the \u003ca href=\"https://opentelemetry.io/docs/specs/otel/configuration/sdk-environment-variables/#prometheus-exporter\"\u003e\u003ccode\u003eOTEL_EXPORTER_PROMETHEUS_HOST\u003c/code\u003e\u003c/a\u003e and \u003ca href=\"https://opentelemetry.io/docs/specs/otel/configuration/sdk-environment-variables/#prometheus-exporter\"\u003e\u003ccode\u003eOTEL_EXPORTER_PROMETHEUS_PORT\u003c/code\u003e\u003c/a\u003e environment variables.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eYou can also disable metrics export by setting the \u003ccode\u003eOTEL_METRICS_EXPORTER\u003c/code\u003e environment variable to \u003ccode\u003enone\u003c/code\u003e.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_available_metrics\"\u003eAvailable Metrics\u003c/h3\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eSystem metrics according to \u003ca href=\"https://opentelemetry.io/docs/specs/otel/metrics/semantic_conventions/system-metrics/\"\u003eOpenTelemetry Semantic Conventions for System Metrics\u003c/a\u003e.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eProcess and Go runtime metrics according to \u003ca href=\"https://opentelemetry.io/docs/specs/otel/metrics/semantic_conventions/process-metrics/\"\u003eOpenTelemetry Semantic Conventions for OS Process Metrics\u003c/a\u003e.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eInformation about the handled requests on each active service, as well as information about requests in progress according to OpenTelemetry \u003ca href=\"https://opentelemetry.io/docs/specs/otel/metrics/semantic_conventions/http-metrics/\"\u003eSemantic Conventions for HTTP Metrics\u003c/a\u003e and \u003ca href=\"https://opentelemetry.io/docs/specs/otel/metrics/semantic_conventions/rpc-metrics/\"\u003eGeneral RPC conventions\u003c/a\u003e.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eInformation about the metrics endpoint itself (if enabled), including the number of internal errors encountered while gathering the metrics, number of current inflight and overall scrapes done.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eInformation about expiry for configured certificates.\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eAll, but custom metrics adhere to the \u003ca href=\"https://opentelemetry.io/docs/specs/otel/metrics/semantic_conventions/\"\u003eOpenTelementry semantic conventions\u003c/a\u003e. For that reason, only the custom metrics are listed in the table below.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect3\"\u003e\n\u003ch4 id=\"_metric_certificate_expiry\"\u003eMetric: \u003ccode\u003ecertificate.expiry\u003c/code\u003e\u003c/h4\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eNumber of seconds until a certificate used by a particular service (decision, proxy, management), as well as signer expires. The metric type is UpDownCounter und the unit is s.\u003c/p\u003e\n\u003c/div\u003e\n\u003ctable class=\"tableblock frame-all grid-all stretch\"\u003e\n\u003ccolgroup\u003e\n\u003ccol style=\"width: 25%;\"/\u003e\n\u003ccol style=\"width: 12.5%;\"/\u003e\n\u003ccol style=\"width: 62.5%;\"/\u003e\n\u003c/colgroup\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth class=\"tableblock halign-left valign-top\"\u003e\u003cstrong\u003eAttribute\u003c/strong\u003e\u003c/th\u003e\n\u003cth class=\"tableblock halign-left valign-top\"\u003e\u003cstrong\u003eType\u003c/strong\u003e\u003c/th\u003e\n\u003cth class=\"tableblock halign-left valign-top\"\u003e\u003cstrong\u003eDescription\u003c/strong\u003e\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd class=\"tableblock halign-left valign-top\"\u003e\u003cp class=\"tableblock\"\u003e\u003ccode\u003eservice\u003c/code\u003e\u003c/p\u003e\u003c/td\u003e\n\u003ctd class=\"tableblock halign-left valign-top\"\u003e\u003cp class=\"tableblock\"\u003estring\u003c/p\u003e\u003c/td\u003e\n\u003ctd class=\"tableblock halign-left valign-top\"\u003e\u003cp class=\"tableblock\"\u003eThe service, the certificate is configured for.\u003c/p\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd class=\"tableblock halign-left valign-top\"\u003e\u003cp class=\"tableblock\"\u003e\u003ccode\u003eissuer\u003c/code\u003e\u003c/p\u003e\u003c/td\u003e\n\u003ctd class=\"tableblock halign-left valign-top\"\u003e\u003cp class=\"tableblock\"\u003estring\u003c/p\u003e\u003c/td\u003e\n\u003ctd class=\"tableblock halign-left valign-top\"\u003e\u003cp class=\"tableblock\"\u003eIssuer DN of the certificate.\u003c/p\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd class=\"tableblock halign-left valign-top\"\u003e\u003cp class=\"tableblock\"\u003e\u003ccode\u003eserial_nr\u003c/code\u003e\u003c/p\u003e\u003c/td\u003e\n\u003ctd class=\"tableblock halign-left valign-top\"\u003e\u003cp class=\"tableblock\"\u003estring\u003c/p\u003e\u003c/td\u003e\n\u003ctd class=\"tableblock halign-left valign-top\"\u003e\u003cp class=\"tableblock\"\u003eThe serial number of the certificate.\u003c/p\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd class=\"tableblock halign-left valign-top\"\u003e\u003cp class=\"tableblock\"\u003e\u003ccode\u003esubject\u003c/code\u003e\u003c/p\u003e\u003c/td\u003e\n\u003ctd class=\"tableblock halign-left valign-top\"\u003e\u003cp class=\"tableblock\"\u003estring\u003c/p\u003e\u003c/td\u003e\n\u003ctd class=\"tableblock halign-left valign-top\"\u003e\u003cp class=\"tableblock\"\u003eSubject DN of the certificate.\u003c/p\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd class=\"tableblock halign-left valign-top\"\u003e\u003cp class=\"tableblock\"\u003e\u003ccode\u003edns_names\u003c/code\u003e\u003c/p\u003e\u003c/td\u003e\n\u003ctd class=\"tableblock halign-left valign-top\"\u003e\u003cp class=\"tableblock\"\u003estring\u003c/p\u003e\u003c/td\u003e\n\u003ctd class=\"tableblock halign-left valign-top\"\u003e\u003cp class=\"tableblock\"\u003eDNS entries in the SAN extension\u003c/p\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_runtime_profiling\"\u003eRuntime Profiling\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eIf enabled, heimdall exposes a \u003ccode\u003e/debug/pprof\u003c/code\u003e HTTP endpoint on port \u003ccode\u003e10251\u003c/code\u003e (See also the configuration options below) on which runtime profiling data in the \u003ccode\u003eprofile.proto\u003c/code\u003e format (also known as \u003ccode\u003epprof\u003c/code\u003e format) can be consumed by APM tools, like \u003ca href=\"https://github.com/google/pprof\"\u003eGoogle’s pprof\u003c/a\u003e, \u003ca href=\"https://grafana.com/oss/phlare/\"\u003eGrafana Phlare\u003c/a\u003e, \u003ca href=\"https://pyroscope.io/\"\u003ePyroscope\u003c/a\u003e and many more for visualization purposes. Following information is available:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003eallocs\u003c/code\u003e - A sampling of all past memory allocations.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003eblock\u003c/code\u003e - Stack traces that led to blocking on synchronization primitives.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003ecmdline\u003c/code\u003e - The command line invocation of the current program, with arguments separated by NUL bytes.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003egoroutine\u003c/code\u003e - Stack traces of all current goroutines.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003eheap\u003c/code\u003e - A sampling of memory allocations of live objects.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003emutex\u003c/code\u003e - Stack traces of holders of contended mutexes.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003eprofile\u003c/code\u003e - Cpu profile. Profiling lasts for duration specified in \u003ccode\u003eseconds\u003c/code\u003e parameter, or for 30 seconds if not specified\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003esymbol\u003c/code\u003e - Looks up the program counters listed in the request, responding with a table mapping program counters to function names.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003ethreadcreate\u003c/code\u003e - Stack traces that led to the creation of new OS threads.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003etrace\u003c/code\u003e - Execution trace in binary form. Tracing lasts for duration specified in \u003ccode\u003eseconds\u003c/code\u003e parameter, or for 1 second if not specified.\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eSee also the \u003ca href=\"/openapi/#tag/Profiling\"\u003eAPI\u003c/a\u003e documentation for the documentation of the actual API.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_configuration_4\"\u003eConfiguration\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eConfiguration for this service can be adjusted in the \u003ccode\u003eprofiling\u003c/code\u003e property of heimdall’s configuration by making use of the following properties.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003eenabled\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003eboolean\u003c/em\u003e (optional)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eBy making use of this property, you can configure heimdall to enable or disable runtime profiling. Defaults to \u003ccode\u003efalse\u003c/code\u003e (profiling disabled).\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"exampleblock\"\u003e\n\u003cdiv class=\"title\"\u003eExample 6. Enabling profiling.\u003c/div\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"yaml\"\u003e\u003cspan class=\"na\"\u003eprofiling\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eenabled\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003ehost\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003estring\u003c/em\u003e (optional)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eBy making use of this property, you can specify the TCP/IP address on which heimdall should listen for connections from client applications interested in profiling data. The entry \u003ccode\u003e0.0.0.0\u003c/code\u003e allows listening for all IPv4 addresses. Defaults to \u003ccode\u003e127.0.0.1\u003c/code\u003e, which allow only local TCP/IP “loopback” connections to be made.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"admonitionblock note\"\u003e\n\u003ctable\u003e\n\u003ctbody\u003e\u003ctr\u003e\n\u003ctd class=\"icon\"\u003e\n\u003ci class=\"fa icon-note\" title=\"Note\"\u003e\u003c/i\u003e\n\u003c/td\u003e\n\u003ctd class=\"content\"\u003e\nIf you operate heimdall in a container, you should set this property to a value, which would allow your APM system to scrape this information.\n\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003cdiv class=\"exampleblock\"\u003e\n\u003cdiv class=\"title\"\u003eExample 7. Configure heimdall to listen on \u003ccode\u003e192.168.2.10\u003c/code\u003e.\u003c/div\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"yaml\"\u003e\u003cspan class=\"na\"\u003eprofiling\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"na\"\u003ehost\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e192.168.2.10\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003eport\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003einteger\u003c/em\u003e (optional)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eBy making use of this property, you can specify the TCP port the heimdall should listen on. Defaults to \u003ccode\u003e10251\u003c/code\u003e.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"exampleblock\"\u003e\n\u003cdiv class=\"title\"\u003eExample 8. Configure heimdall to listen on port \u003ccode\u003e9999\u003c/code\u003e for runtime profiling requests.\u003c/div\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"yaml\"\u003e\u003cspan class=\"na\"\u003emetrics\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eport\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e9999\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv id=\"footnotes\"\u003e\n\u003chr/\u003e\n\u003cdiv class=\"footnote\" id=\"_footnotedef_1\"\u003e\n\u003ca href=\"#_footnoteref_1\"\u003e1\u003c/a\u003e. Datadog supports the OTLP protokoll. For that reason, there is no exporter available.\n\u003c/div\u003e\n\u003cdiv class=\"footnote\" id=\"_footnotedef_2\"\u003e\n\u003ca href=\"#_footnoteref_2\"\u003e2\u003c/a\u003e. jaeger exporter has been marked as deprecated and is not supported anymore\n\u003c/div\u003e\n\u003cdiv class=\"footnote\" id=\"_footnotedef_3\"\u003e\n\u003ca href=\"#_footnoteref_3\"\u003e3\u003c/a\u003e. Instana supports the W3C header used by OTEL. For that reason, there is no propagator available.\n\u003c/div\u003e\n\u003c/div\u003e\n","sections":["Operations"],"tags":null,"title":"Observability ","url":"/docs/operations/observability/"},{"categories":null,"content":" Even some default caching is in place, and you can instruct heimdall to cache particular data for some amount of time, like e.g how long to cache the response from the JWKS endpoint when using the JWT Authenticator, all these options require a caching backend to be available. Otherwise, the corresponding configurations do not have any effect.\nConfiguration of that backend happens by making use of the cache property in heimdall’s configuration, which supports the following options:\ntype - The mandatory specific type of the cache backend.\nconfig - A cache backend specific configuration if required by the type.\nNoop Backend With that backend configured, caching is disabled entirely. That means any cache settings on any mechanism do not have any effect. Even those, applied by heimdall by default are disabled.\nTo configure this backend, you have to specify noop as type. No further configuration is supported. Here an example:\ncache: type: noop In-Memory Backend This backend manages the cached items in memory of heimdall’s process.\nTo configure it, you have to specify in-memory as type. No further configuration is supported. Here an example:\ncache: type: in-memory By default, heimdall makes use of this backend. Redis Backends As the name of this chapter implies, there are multiple backend types, you can configure to make use of Redis as distributed cache:\na Redis single instance,\na Redis cluster and\na Redis sentinel.\nAll types use pipelining to increase performance and do also make use of client side caching if not disabled (see also below).\nCommon Settings All Redis cache backend types support the following configuration options:\ncredentials: Credentials (optional)\nHerewith you can define the credentials to be used for connection purposes. Following settings are possible\npath: string (mandatory)\nPath to a JSON/YAML file with credentials (supports watching for secrets rotation) specifying the username and password as shown below.\n# contents of a credentials file username: Aladdin password: SesameOpen! If used no other properties can be configured for credentials.\nusername: string(optional)\nThe username to use to connect to the Redis DB/Cluster, and\npassword: string(mandatory)\nThe password to be used\nclient_cache: ClientCache (optional)\nConfigurs the client cache to reduce roundtrip time. Following settings are possible:\ndisabled: boolean (optional)\nWhether the client cache should be disabled. Defaults to false.\nttl: Duration (optional)\nSpecifies the maximum TTL on the client side for all used keys. If the key’s TTL on the server is smaller than the client side TTL, the client side TTL will be capped.\nsize_per_connection: ByteSize (optional)\nClient side cache size that bind to each TCP connection to a single redis instance. Defaults to 128MB.\nbuffer_limit: BufferLimit (optional)\nRead and write buffer limits for established connections. Following configuration properties are supported:\nread: ByteSize (optional)\nThe maximum size for the read buffer allowed to read the full request including body. Defaults to 0.5MB.\nwrite: ByteSize (optional)\nThe maximum size for the write buffer of the response. Defaults to 0.5MB.\ntimeout: Timeout (optional)\nBy using this property you can override the default connection timeouts. Following properties are supported:\nwrite: Duration (optional)\nThe maximum duration before timing out writes of the response. Defaults to 150s.\nmax_flush_delay: Duration (optional)\nData flush delay. When greater than zero, pauses pipeline write loop for some time (not larger than the specified delay) after each flushing of data to the connection. This gives pipeline a chance to collect more commands to send to Redis. Adding this delay increases latency, reduces throughput, but in most cases may significantly reduce application and Redis CPU utilization due to less executed system calls. By default, the data is flushed to the connection without extra delays. Depending on network latency and application-specific conditions the value of max_flush_delay may vary, something like 20 µs should not affect latency/throughput a lot but still produce notable CPU usage reduction under load. Defaults to 0s.\ntls: TLS (optional)\nTLS settings. By default, the communication to Redis happens over TLS. This requires however a properly configured trust store, as otherwise heimdall won’t trust the certificates used by the Redis services. In addition to the referenced configuration options, you can also make use of the following properties:\ndisabled: boolean (optional)\nDisables TLS. Defaults to false.\nRedis Single Instance As the name implies, this type supports configuration of a single instance Redis DB.\nTo use it, you have to specify redis as type. Configuration is mandatory with following options in addition to the configuration options described in Common Settings.\naddress: string (mandatory)\nThe Redis instance address to connect to.\ndb: integer (optional)\nRedis DB ID to use. Defaults to 0.\nHere an example:\ncache: type: redis config: address: foo:12345 credentials: path: /path/to/credentials.yaml client_cache: ttl: 10m size_per_connection: 128MB buffer_limit: read: 1MB write: 1MB timeout: write: 150s max_flush_delay: 20us tls: # TLS client auth is used here key_store: path: /path/to/keystore/file.pem password: ${MY_REDIS_CLIENT_KEYSTORE} min_version: TLS1.2 Redis Cluster As the name implies, this type supports configuration of a Redis cluster.\nTo use it, you have to specify redis-cluster as type. Configuration is mandatory with following options in addition to the configuration options described in Common Settings.\nnodes: array of strings (mandatory)\nThe addresses of Redis nodes to connect to.\nHere an example:\ncache: type: redis-cluster config: nodes: - foo:1234 - bar:1234 credentials: username: ${MY_REDIS_USER} password: ${MY_REDIS_PASSWORD} Redis Sentinel As the name implies, this type supports configuration of a Redis sentinel.\nTo use it, you have to specify redis-sentinel as type. Configuration is mandatory with following options in addition to the configuration options described in Common Settings.\nnodes: array of strings (mandatory)\nThe addresses of Redis sentinel nodes to connect to.\ndb: integer (optional)\nRedis DB ID to use. Defaults to 0.\nmaster: string (mandatory)\nSentinel master set name\nSame credentials are used to connect to the sentinel service and to the Redis DB instances. This is also true if TLS client authentication is used. Here an example:\ncache: type: redis-sentinel config: nodes: - foo:1234 - bar:1234 db: 0 master: whatever credentials: path: /path/to/credentials.yaml ","description":"To increase performance, you can configure heimdall to make use of caching. Indeed, caching is even done by default in some places.","html_content":"\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eEven some default caching is in place, and you can instruct heimdall to cache particular data for some amount of time, like e.g how long to cache the response from the JWKS endpoint when using the \u003ca href=\"/docs/mechanisms/authenticators/#_jwt\"\u003eJWT Authenticator\u003c/a\u003e, all these options require a caching backend to be available. Otherwise, the corresponding configurations do not have any effect.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eConfiguration of that backend happens by making use of the \u003ccode\u003ecache\u003c/code\u003e property in heimdall’s configuration, which supports the following options:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003etype\u003c/code\u003e - The mandatory specific type of the cache backend.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003econfig\u003c/code\u003e - A cache backend specific configuration if required by the type.\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_noop_backend\"\u003eNoop Backend\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eWith that backend configured, caching is disabled entirely. That means any cache settings on any mechanism do not have any effect. Even those, applied by heimdall by default are disabled.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eTo configure this backend, you have to specify \u003ccode\u003enoop\u003c/code\u003e as type. No further configuration is supported. Here an example:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"yaml\"\u003e\u003cspan class=\"na\"\u003ecache\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"na\"\u003etype\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003enoop\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_in_memory_backend\"\u003eIn-Memory Backend\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThis backend manages the cached items in memory of heimdall’s process.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eTo configure it, you have to specify \u003ccode\u003ein-memory\u003c/code\u003e as type. No further configuration is supported. Here an example:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"yaml\"\u003e\u003cspan class=\"na\"\u003ecache\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"na\"\u003etype\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ein-memory\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"admonitionblock note\"\u003e\n\u003ctable\u003e\n\u003ctbody\u003e\u003ctr\u003e\n\u003ctd class=\"icon\"\u003e\n\u003ci class=\"fa icon-note\" title=\"Note\"\u003e\u003c/i\u003e\n\u003c/td\u003e\n\u003ctd class=\"content\"\u003e\nBy default, heimdall makes use of this backend.\n\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_redis_backends\"\u003eRedis Backends\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eAs the name of this chapter implies, there are multiple backend types, you can configure to make use of \u003ca href=\"https://redis.io/\"\u003eRedis\u003c/a\u003e as distributed cache:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003ea \u003ca href=\"#_redis_single_instance\"\u003eRedis single instance\u003c/a\u003e,\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003ea \u003ca href=\"#_redis_cluster\"\u003eRedis cluster\u003c/a\u003e and\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003ea \u003ca href=\"#_redis_sentinel\"\u003eRedis sentinel\u003c/a\u003e.\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eAll types use pipelining to increase performance and do also make use of client side caching if not disabled (see also below).\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_common_settings\"\u003eCommon Settings\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eAll Redis cache backend types support the following configuration options:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003ecredentials\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003eCredentials\u003c/em\u003e (optional)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eHerewith you can define the credentials to be used for connection purposes. Following settings are possible\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003epath\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003estring\u003c/em\u003e (mandatory)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003ePath to a JSON/YAML file with credentials (supports watching for secrets rotation) specifying the \u003ccode\u003eusername\u003c/code\u003e and \u003ccode\u003epassword\u003c/code\u003e as shown below.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"yaml\"\u003e\u003cspan class=\"c1\"\u003e# contents of a credentials file\u003c/span\u003e\n\u003cspan class=\"na\"\u003eusername\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eAladdin\u003c/span\u003e\n\u003cspan class=\"na\"\u003epassword\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eSesameOpen!\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eIf used no other properties can be configured for credentials.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003eusername\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003estring\u003c/em\u003e(optional)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe username to use to connect to the Redis DB/Cluster, and\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003epassword\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003estring\u003c/em\u003e(mandatory)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe password to be used\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003eclient_cache\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003eClientCache\u003c/em\u003e (optional)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eConfigurs the client cache to reduce roundtrip time. Following settings are possible:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003edisabled\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003eboolean\u003c/em\u003e (optional)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eWhether the client cache should be disabled. Defaults to \u003ccode\u003efalse\u003c/code\u003e.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003ettl\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003e\u003ca href=\"/docs/configuration/types/#_duration\"\u003eDuration\u003c/a\u003e\u003c/em\u003e (optional)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eSpecifies the maximum TTL on the client side for all used keys. If the key’s TTL on the server is smaller than the client side TTL, the client side TTL will be capped.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003esize_per_connection\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003e\u003ca href=\"/docs/configuration/types/#_bytesize\"\u003eByteSize\u003c/a\u003e\u003c/em\u003e (optional)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eClient side cache size that bind to each TCP connection to a single redis instance. Defaults to 128MB.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003ebuffer_limit\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003eBufferLimit\u003c/em\u003e (optional)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eRead and write buffer limits for established connections. Following configuration properties are supported:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003eread\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003e\u003ca href=\"/docs/configuration/types/#_bytesize\"\u003eByteSize\u003c/a\u003e\u003c/em\u003e (optional)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe maximum size for the read buffer allowed to read the full request including body. Defaults to 0.5MB.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003ewrite\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003e\u003ca href=\"/docs/configuration/types/#_bytesize\"\u003eByteSize\u003c/a\u003e\u003c/em\u003e (optional)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe maximum size for the write buffer of the response. Defaults to 0.5MB.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003etimeout\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003eTimeout\u003c/em\u003e (optional)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eBy using this property you can override the default connection timeouts. Following properties are supported:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003ewrite\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003e\u003ca href=\"/docs/configuration/types/#_duration\"\u003eDuration\u003c/a\u003e\u003c/em\u003e (optional)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe maximum duration before timing out writes of the response. Defaults to 150s.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003emax_flush_delay\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003e\u003ca href=\"/docs/configuration/types/#_duration\"\u003eDuration\u003c/a\u003e\u003c/em\u003e (optional)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eData flush delay. When greater than zero, pauses pipeline write loop for some time (not larger than the specified delay) after each flushing of data to the connection. This gives pipeline a chance to collect more commands to send to Redis. Adding this delay increases latency, reduces throughput, but in most cases may significantly reduce application and Redis CPU utilization due to less executed system calls. By default, the data is flushed to the connection without extra delays. Depending on network latency and application-specific conditions the value of max_flush_delay may vary, something like 20 µs should not affect latency/throughput a lot but still produce notable CPU usage reduction under load. Defaults to 0s.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003etls\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003e\u003ca href=\"/docs/configuration/types/#_tls\"\u003eTLS\u003c/a\u003e\u003c/em\u003e (optional)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eTLS settings. By default, the communication to Redis happens over TLS. This requires however a properly configured \u003ca href=\"/docs/operations/security/#_tls_trust_store\"\u003etrust store\u003c/a\u003e, as otherwise heimdall won’t trust the certificates used by the Redis services. In addition to the referenced configuration options, you can also make use of the following properties:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003edisabled\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003eboolean\u003c/em\u003e (optional)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eDisables TLS. Defaults to \u003ccode\u003efalse\u003c/code\u003e.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_redis_single_instance\"\u003eRedis Single Instance\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eAs the name implies, this type supports configuration of a single instance Redis DB.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eTo use it, you have to specify \u003ccode\u003eredis\u003c/code\u003e as type. Configuration is mandatory with following options in addition to the configuration options described in \u003ca href=\"#_common_settings\"\u003eCommon Settings\u003c/a\u003e.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003eaddress\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003estring\u003c/em\u003e (mandatory)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe Redis instance address to connect to.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003edb\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003einteger\u003c/em\u003e (optional)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eRedis DB ID to use. Defaults to 0.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eHere an example:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"yaml\"\u003e\u003cspan class=\"na\"\u003ecache\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"na\"\u003etype\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eredis\u003c/span\u003e\n  \u003cspan class=\"na\"\u003econfig\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"na\"\u003eaddress\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003efoo:12345\u003c/span\u003e\n    \u003cspan class=\"na\"\u003ecredentials\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"na\"\u003epath\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e/path/to/credentials.yaml\u003c/span\u003e\n    \u003cspan class=\"na\"\u003eclient_cache\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"na\"\u003ettl\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e10m\u003c/span\u003e\n      \u003cspan class=\"na\"\u003esize_per_connection\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e128MB\u003c/span\u003e\n    \u003cspan class=\"na\"\u003ebuffer_limit\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"na\"\u003eread\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e1MB\u003c/span\u003e\n      \u003cspan class=\"na\"\u003ewrite\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e1MB\u003c/span\u003e\n    \u003cspan class=\"na\"\u003etimeout\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"na\"\u003ewrite\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e150s\u003c/span\u003e\n    \u003cspan class=\"na\"\u003emax_flush_delay\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e20us\u003c/span\u003e\n    \u003cspan class=\"na\"\u003etls\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"c1\"\u003e# TLS client auth is used here\u003c/span\u003e\n      \u003cspan class=\"na\"\u003ekey_store\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"na\"\u003epath\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e/path/to/keystore/file.pem\u003c/span\u003e\n        \u003cspan class=\"na\"\u003epassword\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e${MY_REDIS_CLIENT_KEYSTORE}\u003c/span\u003e\n      \u003cspan class=\"na\"\u003emin_version\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eTLS1.2\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_redis_cluster\"\u003eRedis Cluster\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eAs the name implies, this type supports configuration of a Redis cluster.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eTo use it, you have to specify \u003ccode\u003eredis-cluster\u003c/code\u003e as type. Configuration is mandatory with following options in addition to the configuration options described in \u003ca href=\"#_common_settings\"\u003eCommon Settings\u003c/a\u003e.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003enodes\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003earray of strings\u003c/em\u003e (mandatory)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe addresses of Redis nodes to connect to.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eHere an example:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"yaml\"\u003e\u003cspan class=\"na\"\u003ecache\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"na\"\u003etype\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eredis-cluster\u003c/span\u003e\n  \u003cspan class=\"na\"\u003econfig\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"na\"\u003enodes\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003efoo:1234\u003c/span\u003e\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003ebar:1234\u003c/span\u003e\n    \u003cspan class=\"na\"\u003ecredentials\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"na\"\u003eusername\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e${MY_REDIS_USER}\u003c/span\u003e\n      \u003cspan class=\"na\"\u003epassword\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e${MY_REDIS_PASSWORD}\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_redis_sentinel\"\u003eRedis Sentinel\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eAs the name implies, this type supports configuration of a Redis sentinel.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eTo use it, you have to specify \u003ccode\u003eredis-sentinel\u003c/code\u003e as type. Configuration is mandatory with following options in addition to the configuration options described in \u003ca href=\"#_common_settings\"\u003eCommon Settings\u003c/a\u003e.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003enodes\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003earray of strings\u003c/em\u003e (mandatory)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe addresses of Redis sentinel nodes to connect to.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003edb\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003einteger\u003c/em\u003e (optional)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eRedis DB ID to use. Defaults to 0.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003emaster\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003estring\u003c/em\u003e (mandatory)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eSentinel master set name\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"admonitionblock note\"\u003e\n\u003ctable\u003e\n\u003ctbody\u003e\u003ctr\u003e\n\u003ctd class=\"icon\"\u003e\n\u003ci class=\"fa icon-note\" title=\"Note\"\u003e\u003c/i\u003e\n\u003c/td\u003e\n\u003ctd class=\"content\"\u003e\nSame credentials are used to connect to the sentinel service and to the Redis DB instances. This is also true if TLS client authentication is used.\n\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eHere an example:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"yaml\"\u003e\u003cspan class=\"na\"\u003ecache\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"na\"\u003etype\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eredis-sentinel\u003c/span\u003e\n  \u003cspan class=\"na\"\u003econfig\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"na\"\u003enodes\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003efoo:1234\u003c/span\u003e\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003ebar:1234\u003c/span\u003e\n    \u003cspan class=\"na\"\u003edb\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\n    \u003cspan class=\"na\"\u003emaster\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ewhatever\u003c/span\u003e\n    \u003cspan class=\"na\"\u003ecredentials\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"na\"\u003epath\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e/path/to/credentials.yaml\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n","sections":["Operations"],"tags":null,"title":"Caching","url":"/docs/operations/cache/"},{"categories":null,"content":" HTTP Header Security Considerations If trusted_proxies property is configured (see also the corresponding Decision and Proxy service configuration options) to let heimdall make use of different HTTP headers to build the URL for rule and HTTP method matching purposes, following logic apply:\nThe value for the used HTTP scheme is taken from the X-Forwarded-Proto header.\nThe value for the used HTTP host and port is taken from the X-Forwarded-Host header.\nThe value for the used HTTP path is taken from X-Forwarded-Uri header, which may also contain query parameters.\nThe value for the used HTTP method is taken from the X-Forwarded-Method header.\nIf the evaluation result for any of the above said steps is empty, the corresponding value is taken from the actual request to heimdall. E.g. if X-Forwarded-Method is set, the HTTP method used to communicate with heimdall is used for rule matching respectively evaluation purposes.\nThat means, if the client integrating with heimdall does not make use of the above said headers and does not drop them, a malicious actor could spoof them most probably leading to privileges escalation (depending on your rules). To avoid such situations, please adhere to the following practices:\nIf you can, try avoiding usage of trusted_proxies. Nothing can be spoofed then. However, you will lose the information about the used HTTP scheme, host and port and cannot rely on these in your rules.\nConfigure all headers and use those taking precedence. That is, always set X-Forwarded-Method, X-Forwarded-Proto, X-Forwarded-Host, X-Forwarded-Uri.\nIf you cannot influence, which headers are set by your system, you’re integrating with heimdall, let it drop unused ones. E.g. If the proxy forwarding the request to heimdall by default sets only X-Forwarded-Proto and X-Forwarded-Host, let it drop the X-Forwarded-Method and X-Forwarded-Uri headers.\nThe API Gateways \u0026amp; Proxies Guides follow these practices, respectively highlight where caution is required. So, you can find examples there.\nObservability Information Logs, metrics and profiling information is very valuable for operating heimdall. These are however also very valuable for any adversary. For this reason, the corresponding services, exposing such information are by default, if enabled, listening only on the loopback (127.0.0.1) interface. If you have to configure them to listen to other interfaces, e.g. because you operate heimdall in a container, make sure, you don’t expose them publicly.\nTLS Trust Store As documented in Concepts section, the execution of heimdall’s pipeline typically includes communication to other systems. The endpoints of the corresponding systems should be TLS protected. This is however actually out of scope for heimdall. What is in scope, is the verification of the used TLS server certificate if TLS is used. This happens by making use of the operating system-wide trust store, containing the certificates of Root and Intermediate CAs (trust anchors) shipped with the OS. That means, you should\nensure this trust store contains the certificates of the Root CAs of your PKI hierarchy and\nensure the endpoints, heimdall communicates with over TLS, provide not only their own certificates, but also the intermediate certificates and cross certificates not included within the OS trust store\nBoth is required to enable heimdall building the certificate chain for TLS server certificate verification purpose. If heimdall fails doing so, the connection will be dropped.\nAs written above, heimdall makes use of the OS wide trust store to build the certificate chain. The most common installation directory on a Linux system for that trust store is the /etc/ssl/certs directory. In addition to the separate root and intermediate CA certificates, it also contains a ca-certificates.crt file, containing all installed certificates as well. This file is used by heimdall for the aforesaid purpose.\nheimdall container image is shipped without any certificates by intention to ensure you take care about the up-to-date status of the trust store. This way, if you use heimdall in a container, you have to mount the OS trust store into heimdall’s container to enable its usage.\nE.g.\ndocker run -t -p 4456:4456 \\ -v $PWD:/heimdall/conf \\ -v /etc/ssl/certs/ca-certificates.crt:/etc/ssl/certs/ca-certificates.crt:ro \\ dadrus/heimdall:latest serve decision \\ -c /heimdall/conf/heimdall.yaml The verification of TLS server certificates is not the single configuration option. You should also ensure heimdall’s services, you’re using, are configured to be available via TLS as well. See TLS Configuration for all available options.\nSignatures When heimdall is used to issue signed objects, like JWTs, to enable upstream services to rely on authentic subject information, it acts as an issuer of such objects and requires corresponding configuration.\nConfiguration The configuration related to the issuance of signed objects can be done using the signer property, which resides on the top level of heimdall’s configuration and supports the following properties.\nname: string (optional)\nThe name used to specify the issuer. E.g. if a JWT is generated, this value is used to set the iss claim. If not set, the value heimdall is used.\nkey_store: Key Store (optional)\nThe key store containing the cryptographic material. If configured, at least one private key and the corresponding certificate must be present. If not configured, heimdall generates an ECDSA P-384 key pair on start up and uses it then.\nYou should always configure a valid key store for production use! key_id: string (optional)\nIf the key_store contains multiple keys, this property can be used to specify the key to use (see also Key-Id Lookup). If not specified, the first key is used. If specified, but there is no key for the given key id present, an error is raised and heimdall will refuse to start.\nExample 1. Possible configuration Imagine you have a PEM file located in /opt/heimdall/keystore.pem with the following contents:\n-----BEGIN EC PRIVATE KEY----- X-Key-ID: foo MIGkAgEBBDBRLr783dIM5NHJnDDMRVBiFSF56xqHle5lZk1ZCyyow9wKZGuF4EWK jRBISBkE3NSgBwYFK4EEACKhZANiAAQ+oGUOJpVjntIWuanYxpXe6oN5tKhzLhBX GP1SOXiLhnPNnN2uZu9KwOoBzoZhr/Fxw+sziXmzHJwjluz78VOlFKyopxTfmxRZ 0qq3f/KHWdDtVvmTfT0O/ux9mg6mCJw= -----END EC PRIVATE KEY----- -----BEGIN CERTIFICATE----- MIIByjCCAVGgAwIBAgIBATAKBggqhkjOPQQDAzAuMQswCQYDVQQGEwJFVTENMAsG A1UEChMEVGVzdDEQMA4GA1UEAxMHVGVzdCBDQTAeFw0yMjA4MTUwOTE3MTFaFw0y MjA4MTUxMDE3MTFaMDAxCzAJBgNVBAYTAkVVMQ0wCwYDVQQKEwRUZXN0MRIwEAYD VQQDEwlUZXN0IEVFIDEwdjAQBgcqhkjOPQIBBgUrgQQAIgNiAAQ+oGUOJpVjntIW uanYxpXe6oN5tKhzLhBXGP1SOXiLhnPNnN2uZu9KwOoBzoZhr/Fxw+sziXmzHJwj luz78VOlFKyopxTfmxRZ0qq3f/KHWdDtVvmTfT0O/ux9mg6mCJyjQTA/MA4GA1Ud DwEB/wQEAwIHgDAMBgNVHQ4EBQQDYmFyMB8GA1UdIwQYMBaAFLO77bgPgZMKz11D BVDUXvtNGeBnMAoGCCqGSM49BAMDA2cAMGQCMFRlx9Bq0MuSh5pDhDTqRq/MnxxD W7qZg15AXoNnLrR60vV9gHjzkp1UkcU9viRIuAIwU0BjwDncp9z1seqKh+/eJV3f xstQe2rzUEptWLIiPFoOBWZuw9wJ/Hunjik3a9T/ -----END CERTIFICATE----- -----BEGIN CERTIFICATE----- MIIByjCCAVCgAwIBAgIBATAKBggqhkjOPQQDAzAuMQswCQYDVQQGEwJFVTENMAsG A1UEChMEVGVzdDEQMA4GA1UEAxMHVGVzdCBDQTAeFw0yMjA4MTUwOTE3MTFaFw0y MjA4MTYwOTE3MTFaMC4xCzAJBgNVBAYTAkVVMQ0wCwYDVQQKEwRUZXN0MRAwDgYD VQQDEwdUZXN0IENBMHYwEAYHKoZIzj0CAQYFK4EEACIDYgAEf96tstMNdNoNfYjl bGY6BvBFTsl9E3hpPnta7SJn6BqIYz6KEohDJ+8DXwUMVb5Ytr/QkEikg966HCY3 A9TFBUdAs01TV8f2KoAPRQVrh+ccSLLJyACENfZ5VbGSQ0wso0IwQDAOBgNVHQ8B Af8EBAMCAQYwDwYDVR0TAQH/BAUwAwEB/zAdBgNVHQ4EFgQUs7vtuA+BkwrPXUMF UNRe+00Z4GcwCgYIKoZIzj0EAwMDaAAwZQIxAMPgE/Z+1Dcj+lH7jioE16Hig0HQ FC4qBx1UU05H05Gs23ECB1hzD2qXikVpaNyuDgIwbogEu42wIwpDa5xdJIZcIhmz DIuPvEscUDjU3C+1GPxmACcRMPv9QVUEcBAvZkfn -----END CERTIFICATE----- Then you can configure heimdall to use it like follows:\nsigner: name: foobar key_store: path: /opt/heimdall/keystore.pem key_id: foo Security Considerations In a typical production scenario, there is a need for proper key and certificate management. This is supported by heimdall in the following way:\nyou can and should configure not only the private key for signature creation purposes, but also the corresponding certificate chain. This way your upstream services are able not only to verify the signatures of the signed objects for cryptographic validity, but also perform verification of the revocation status of used certificates and also their time validity. All of that is crucial for secure communication.\nThe cryptographic material for the above said verification purposes is available via the JWKS endpoint for the upstream services.\nyou can configure multiple keys in heimdall’s key_store and specify the key_id of the key to use. The easiest way to let heimdall use the key id, you need, is to set X-Key-ID header in the PEM block of the corresponding private key (as also shown in the example above). Usage of key ids allows for seamless key rotation in setups which do not support or allow usage of secret management systems, respectively hot reloading of the corresponding updates by heimdall.\nSecret Management \u0026amp; Rotation When configuring heimdall, there are many places requiring secrets, like passwords, tokens, key material, etc. While you can directly configure these in heimdall’s config file, there is a huge chance for leaking them. Please reference the secrets in the config file via environment variables, or make use of external files where possible instead, and let the contents of these be managed by a secret management system.\nUsage of external files can even allow you to rotate the configured secrets without the need to restart heimdall if desired. Watching for secrets rotation is however disabled by default, but can be enabled by setting the secrets_reload_enabled property to true on the top level of heimdall’s configuration.\nAs of today secret reloading is only supported for key stores and Redis cache backend credentials. Verifying Heimdall Binaries and Container Images Heimdall binaries and container images are signed using Cosign and the keyless signing feature.\nPrerequisites Install Cosign\nContainer Image Signature Verification The signatures are stored in a repository named dadrus/heimdall-signatures. To verify the container image using Cosign, execute the following command:\nCOSIGN_REPOSITORY=dadrus/heimdall-signatures \\ cosign verify dadrus/heimdall:\u0026lt;tag\u0026gt; \\ --certificate-identity-regexp=https://github.com/dadrus/heimdall/.github/workflows/ci.yaml* \\ --certificate-oidc-issuer=https://token.actions.githubusercontent.com | jq If you pull heimdall images from ghcr.io, reference the ghcr.io registry while specifying the repository names. So dadrus/heimdall-signatures becomes ghcr.io/dadrus/heimdall-signatures and dadrus/heimdall:\u0026lt;tag\u0026gt; becomes ghcr.io/dadrus/heimdall:\u0026lt;tag\u0026gt;. In successful verification case, cosign will print similar output to the one shown below and exit with 0.\n[ { \u0026#34;critical\u0026#34;: { \u0026#34;identity\u0026#34;: { \u0026#34;docker-reference\u0026#34;: \u0026#34;index.docker.io/dadrus/heimdall\u0026#34; }, \u0026#34;image\u0026#34;: { \u0026#34;docker-manifest-digest\u0026#34;: \u0026#34;sha256:289b1a3eeeceeef08362a6fbcf4b95e726686d17998798e149c30b6974728eaf\u0026#34; }, \u0026#34;type\u0026#34;: \u0026#34;cosign container image signature\u0026#34; }, \u0026#34;optional\u0026#34;: { \u0026#34;1.3.6.1.4.1.57264.1.1\u0026#34;: \u0026#34;https://token.actions.githubusercontent.com\u0026#34;, \u0026#34;1.3.6.1.4.1.57264.1.2\u0026#34;: \u0026#34;push\u0026#34;, \u0026#34;1.3.6.1.4.1.57264.1.3\u0026#34;: \u0026#34;04379639dc5f3fbfc260e883ee4938a35076d63e\u0026#34;, \u0026#34;1.3.6.1.4.1.57264.1.4\u0026#34;: \u0026#34;CI\u0026#34;, \u0026#34;1.3.6.1.4.1.57264.1.5\u0026#34;: \u0026#34;dadrus/heimdall\u0026#34;, \u0026#34;1.3.6.1.4.1.57264.1.6\u0026#34;: \u0026#34;refs/heads/main\u0026#34;, \u0026#34;Bundle\u0026#34;: { \u0026#34;SignedEntryTimestamp\u0026#34;: \u0026#34;MEUCIFIvxs30zysroG6ItUNL+hfE3Cxn4GuiQe8d1u5N27OEAiEAqmzLrw80846U53nL/jtQ3U/2yx8Jqu8H75g6sihIcpg=\u0026#34;, \u0026#34;Payload\u0026#34;: { \u0026#34;body\u0026#34;: \u0026#34;eyJhcGlWZXJzaW9uIjoi...xTMHRMUW89In19fX0=\u0026#34;, \u0026#34;integratedTime\u0026#34;: 1692727396, \u0026#34;logIndex\u0026#34;: 32332529, \u0026#34;logID\u0026#34;: \u0026#34;c0d23d6ad406973f9559f3ba2d1ca01f84147d8ffc5b8445c224f98b9591801d\u0026#34; } }, \u0026#34;Issuer\u0026#34;: \u0026#34;https://token.actions.githubusercontent.com\u0026#34;, \u0026#34;Subject\u0026#34;: \u0026#34;https://github.com/dadrus/heimdall/.github/workflows/ci.yaml@refs/heads/main\u0026#34;, \u0026#34;githubWorkflowName\u0026#34;: \u0026#34;CI\u0026#34;, \u0026#34;githubWorkflowRef\u0026#34;: \u0026#34;refs/heads/main\u0026#34;, \u0026#34;githubWorkflowRepository\u0026#34;: \u0026#34;dadrus/heimdall\u0026#34;, \u0026#34;githubWorkflowSha\u0026#34;: \u0026#34;04379639dc5f3fbfc260e883ee4938a35076d63e\u0026#34;, \u0026#34;githubWorkflowTrigger\u0026#34;: \u0026#34;push\u0026#34; } } ] For released images, the Subject value ends with @refs/tags/\u0026lt;release version\u0026gt;.\nRelease Binary Signature Verification The detached signatures, as well as certificates for all released archives are published together with the corresponding platform specific archive. The names of the signature files adhere to the \u0026lt;archive\u0026gt;-keyless.sig name pattern and the names of the certificate files adhere to the \u0026lt;archive\u0026gt;-keyless.pem name pattern, with \u0026lt;archive\u0026gt; being the archive for a platform specific build.\nTo verify the signature of the archive, hence its contents including the platform specific heimdall binary with Cosign execute the following command:\ncosign verify-blob /path/to/the/downloaded/\u0026lt;archive\u0026gt; \\ --certificate-identity-regexp=https://github.com/dadrus/heimdall/.github/workflows/ci.yaml* \\ --certificate-oidc-issuer=https://token.actions.githubusercontent.com \\ --signature /path/to/the/downloaded/\u0026lt;archive\u0026gt;-keyless.sig \\ --certificate /path/to/the/downloaded/\u0026lt;archive\u0026gt;--keyless.pem In successful verification case, cosign will print the following output and exit with 0.\nVerified OK Software Bill of Material (SBOM) Heimdall is shipped with an SBOM in CyclonDX (json) format.\nIf you use a released binary of heimdall, the corresponding file is part of the platform specific archive. That way, if you verify the signature of the archive (see above), you do also get evidence about the validity of the SBOM.\nIf you use a container image, the same SBOM is attached to the image as attestation signed with Cosign. These attestations are stored in the dadrus/heimdall-sbom repository. To verify the attestation and retrieve the SBOM execute the following command once Cosign is installed:\nCOSIGN_REPOSITORY=dadrus/heimdall-sbom \\ cosign verify-attestation dadrus/heimdall:\u0026lt;tag\u0026gt; \\ --certificate-identity-regexp=https://github.com/dadrus/heimdall/.github/workflows/ci.yaml* \\ --certificate-oidc-issuer=https://token.actions.githubusercontent.com \\ --type=cyclonedx If you pull heimdall images from ghcr.io, reference the ghcr.io registry while specifying the repository names. So dadrus/heimdall-sbom becomes ghcr.io/dadrus/heimdall-sbom and dadrus/heimdall:\u0026lt;tag\u0026gt; becomes ghcr.io/dadrus/heimdall:\u0026lt;tag\u0026gt;. In successful verification case, cosign will print similar output to the one shown below and exit with 0.\n{ \u0026#34;payloadType\u0026#34;: \u0026#34;application/vnd.in-toto+json\u0026#34;, \u0026#34;payload\u0026#34;: \u0026#34;eyJfdHlwZSI6Imh...LCJ2ZXJzaW9uIjoxfX0=\u0026#34;, \u0026#34;signatures\u0026#34;: [ { \u0026#34;keyid\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;sig\u0026#34;: \u0026#34;MEQCICGdo9hmIUrBRzVQ23VS...6ToNGa5YrommZNCQ==\u0026#34; } ] } Here, payload is the base64 encoded attestation value embedding the SBOM.\nAs one-liner, you can verify the signature and extract the SBOM as follows:\nCOSIGN_REPOSITORY=dadrus/heimdall-sbom \\ cosign verify-attestation dadrus/heimdall:\u0026lt;tag\u0026gt; \\ --certificate-identity-regexp=https://github.com/dadrus/heimdall/.github/workflows/ci.yaml* \\ --certificate-oidc-issuer=https://token.actions.githubusercontent.com \\ --type=cyclonedx | jq -r \u0026#34;.payload\u0026#34; | base64 -d | jq -r \u0026#34;.predicate\u0026#34; \u0026gt; heimdall.sbom.json The result will be the heimdall.sbom.json SBOM document, which you can use with any SCA or monitoring tool of your choice, e.g. Dependency Track.\n","description":"To operate heimdall in a secure way, you should configure heimdall accordingly. Following sections address the corresponding areas.","html_content":"\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_http_header_security_considerations\"\u003eHTTP Header Security Considerations\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eIf \u003ccode\u003etrusted_proxies\u003c/code\u003e property is configured (see also the corresponding \u003ca href=\"/docs/services/decision/#_trusted_proxies\"\u003eDecision\u003c/a\u003e and \u003ca href=\"/docs/services/proxy/#_trusted_proxies\"\u003eProxy\u003c/a\u003e service configuration options) to let heimdall make use of different HTTP headers to build the URL for rule and HTTP method matching purposes, following logic apply:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eThe value for the used HTTP scheme is taken from the \u003ccode\u003eX-Forwarded-Proto\u003c/code\u003e header.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eThe value for the used HTTP host and port is taken from the \u003ccode\u003eX-Forwarded-Host\u003c/code\u003e header.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eThe value for the used HTTP path is taken from \u003ccode\u003eX-Forwarded-Uri\u003c/code\u003e header, which may also contain query parameters.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eThe value for the used HTTP method is taken from the \u003ccode\u003eX-Forwarded-Method\u003c/code\u003e header.\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eIf the evaluation result for any of the above said steps is empty, the corresponding value is taken from the actual request to heimdall. E.g. if \u003ccode\u003eX-Forwarded-Method\u003c/code\u003e is set, the HTTP method used to communicate with heimdall is used for rule matching respectively evaluation purposes.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThat means, if the client integrating with heimdall does not make use of the above said headers and does not drop them, a malicious actor could spoof them most probably leading to privileges escalation (depending on your rules). To avoid such situations, please adhere to the following practices:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eIf you can, try avoiding usage of \u003ccode\u003etrusted_proxies\u003c/code\u003e. Nothing can be spoofed then. However, you will lose the information about the used HTTP scheme, host and port and cannot rely on these in your rules.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eConfigure all headers and use those taking precedence. That is, always set \u003ccode\u003eX-Forwarded-Method\u003c/code\u003e, \u003ccode\u003eX-Forwarded-Proto\u003c/code\u003e, \u003ccode\u003eX-Forwarded-Host\u003c/code\u003e, \u003ccode\u003eX-Forwarded-Uri\u003c/code\u003e.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eIf you cannot influence, which headers are set by your system, you’re integrating with heimdall, let it drop unused ones. E.g. If the proxy forwarding the request to heimdall by default sets only \u003ccode\u003eX-Forwarded-Proto\u003c/code\u003e and \u003ccode\u003eX-Forwarded-Host\u003c/code\u003e, let it drop the \u003ccode\u003eX-Forwarded-Method\u003c/code\u003e and \u003ccode\u003eX-Forwarded-Uri\u003c/code\u003e headers.\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe \u003ca href=\"/guides/proxies/\"\u003eAPI Gateways \u0026amp; Proxies Guides\u003c/a\u003e follow these practices, respectively highlight where caution is required. So, you can find examples there.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_observability_information\"\u003eObservability Information\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eLogs, metrics and profiling information is very valuable for operating heimdall. These are however also very valuable for any adversary. For this reason, the corresponding services, exposing such information are by default, if enabled, listening only on the loopback (\u003ccode\u003e127.0.0.1\u003c/code\u003e) interface. If you have to configure them to listen to other interfaces, e.g. because you operate heimdall in a container, make sure, you don’t expose them publicly.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_tls_trust_store\"\u003eTLS Trust Store\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eAs documented in \u003ca href=\"/docs/concepts/pipelines/\"\u003eConcepts\u003c/a\u003e section, the execution of heimdall’s pipeline typically includes communication to other systems. The endpoints of the corresponding systems should be TLS protected. This is however actually out of scope for heimdall. What is in scope, is the verification of the used TLS server certificate if TLS is used. This happens by making use of the operating system-wide trust store, containing the certificates of Root and Intermediate CAs (trust anchors) shipped with the OS. That means, you should\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"olist arabic\"\u003e\n\u003col class=\"arabic\"\u003e\n\u003cli\u003e\n\u003cp\u003eensure this trust store contains the certificates of the Root CAs of your PKI hierarchy and\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eensure the endpoints, heimdall communicates with over TLS, provide not only their own certificates, but also the intermediate certificates and cross certificates not included within the OS trust store\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eBoth is required to enable heimdall building the certificate chain for TLS server certificate verification purpose. If heimdall fails doing so, the connection will be dropped.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eAs written above, heimdall makes use of the OS wide trust store to build the certificate chain. The most common installation directory on a Linux system for that trust store is the \u003ccode\u003e/etc/ssl/certs\u003c/code\u003e directory. In addition to the separate root and intermediate CA certificates, it also contains a \u003ccode\u003eca-certificates.crt\u003c/code\u003e file, containing all installed certificates as well. This file is used by heimdall for the aforesaid purpose.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"admonitionblock note\"\u003e\n\u003ctable\u003e\n\u003ctbody\u003e\u003ctr\u003e\n\u003ctd class=\"icon\"\u003e\n\u003ci class=\"fa icon-note\" title=\"Note\"\u003e\u003c/i\u003e\n\u003c/td\u003e\n\u003ctd class=\"content\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eheimdall container image is shipped without any certificates by intention to ensure you take care about the up-to-date status of the trust store. This way, if you use heimdall in a container, you have to mount the OS trust store into heimdall’s container to enable its usage.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eE.g.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"bash\"\u003edocker run \u003cspan class=\"nt\"\u003e-t\u003c/span\u003e \u003cspan class=\"nt\"\u003e-p\u003c/span\u003e 4456:4456 \u003cspan class=\"se\"\u003e\\\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e-v\u003c/span\u003e \u003cspan class=\"nv\"\u003e$PWD\u003c/span\u003e:/heimdall/conf \u003cspan class=\"se\"\u003e\\\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e-v\u003c/span\u003e /etc/ssl/certs/ca-certificates.crt:/etc/ssl/certs/ca-certificates.crt:ro \u003cspan class=\"se\"\u003e\\\u003c/span\u003e\n   dadrus/heimdall:latest serve decision \u003cspan class=\"se\"\u003e\\\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e-c\u003c/span\u003e /heimdall/conf/heimdall.yaml\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe verification of TLS server certificates is not the single configuration option. You should also ensure heimdall’s services, you’re using, are configured to be available via TLS as well. See \u003ca href=\"/docs/configuration/types/#_tls\"\u003eTLS Configuration\u003c/a\u003e for all available options.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_signatures\"\u003eSignatures\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eWhen heimdall is used to issue signed objects, like JWTs, to enable upstream services to rely on authentic subject information, it acts as an issuer of such objects and requires corresponding configuration.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_configuration\"\u003eConfiguration\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe configuration related to the issuance of signed objects can be done using the \u003ccode\u003esigner\u003c/code\u003e property, which resides on the top level of heimdall’s configuration and supports the following properties.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003ename\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003estring\u003c/em\u003e (optional)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe name used to specify the issuer. E.g. if a JWT is generated, this value is used to set the \u003ccode\u003eiss\u003c/code\u003e claim. If not set, the value \u003ccode\u003eheimdall\u003c/code\u003e is used.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003ekey_store\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003e\u003ca href=\"/docs/configuration/types/#_key_store\"\u003eKey Store\u003c/a\u003e\u003c/em\u003e (optional)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe key store containing the cryptographic material. If configured, at least one private key and the corresponding certificate must be present. If not configured, heimdall generates an ECDSA P-384 key pair on start up and uses it then.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"admonitionblock warning\"\u003e\n\u003ctable\u003e\n\u003ctbody\u003e\u003ctr\u003e\n\u003ctd class=\"icon\"\u003e\n\u003ci class=\"fa icon-warning\" title=\"Warning\"\u003e\u003c/i\u003e\n\u003c/td\u003e\n\u003ctd class=\"content\"\u003e\nYou should always configure a valid key store for production use!\n\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003ekey_id\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003estring\u003c/em\u003e (optional)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eIf the \u003ccode\u003ekey_store\u003c/code\u003e contains multiple keys, this property can be used to specify the key to use (see also \u003ca href=\"/docs/configuration/types/#_key_id_lookup\"\u003eKey-Id Lookup\u003c/a\u003e). If not specified, the first key is used. If specified, but there is no key for the given key id present, an error is raised and heimdall will refuse to start.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"exampleblock\"\u003e\n\u003cdiv class=\"title\"\u003eExample 1. Possible configuration\u003c/div\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eImagine you have a PEM file located in \u003ccode\u003e/opt/heimdall/keystore.pem\u003c/code\u003e with the following contents:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"txt\"\u003e-----BEGIN EC PRIVATE KEY-----\nX-Key-ID: foo\n\nMIGkAgEBBDBRLr783dIM5NHJnDDMRVBiFSF56xqHle5lZk1ZCyyow9wKZGuF4EWK\njRBISBkE3NSgBwYFK4EEACKhZANiAAQ+oGUOJpVjntIWuanYxpXe6oN5tKhzLhBX\nGP1SOXiLhnPNnN2uZu9KwOoBzoZhr/Fxw+sziXmzHJwjluz78VOlFKyopxTfmxRZ\n0qq3f/KHWdDtVvmTfT0O/ux9mg6mCJw=\n-----END EC PRIVATE KEY-----\n-----BEGIN CERTIFICATE-----\nMIIByjCCAVGgAwIBAgIBATAKBggqhkjOPQQDAzAuMQswCQYDVQQGEwJFVTENMAsG\nA1UEChMEVGVzdDEQMA4GA1UEAxMHVGVzdCBDQTAeFw0yMjA4MTUwOTE3MTFaFw0y\nMjA4MTUxMDE3MTFaMDAxCzAJBgNVBAYTAkVVMQ0wCwYDVQQKEwRUZXN0MRIwEAYD\nVQQDEwlUZXN0IEVFIDEwdjAQBgcqhkjOPQIBBgUrgQQAIgNiAAQ+oGUOJpVjntIW\nuanYxpXe6oN5tKhzLhBXGP1SOXiLhnPNnN2uZu9KwOoBzoZhr/Fxw+sziXmzHJwj\nluz78VOlFKyopxTfmxRZ0qq3f/KHWdDtVvmTfT0O/ux9mg6mCJyjQTA/MA4GA1Ud\nDwEB/wQEAwIHgDAMBgNVHQ4EBQQDYmFyMB8GA1UdIwQYMBaAFLO77bgPgZMKz11D\nBVDUXvtNGeBnMAoGCCqGSM49BAMDA2cAMGQCMFRlx9Bq0MuSh5pDhDTqRq/MnxxD\nW7qZg15AXoNnLrR60vV9gHjzkp1UkcU9viRIuAIwU0BjwDncp9z1seqKh+/eJV3f\nxstQe2rzUEptWLIiPFoOBWZuw9wJ/Hunjik3a9T/\n-----END CERTIFICATE-----\n-----BEGIN CERTIFICATE-----\nMIIByjCCAVCgAwIBAgIBATAKBggqhkjOPQQDAzAuMQswCQYDVQQGEwJFVTENMAsG\nA1UEChMEVGVzdDEQMA4GA1UEAxMHVGVzdCBDQTAeFw0yMjA4MTUwOTE3MTFaFw0y\nMjA4MTYwOTE3MTFaMC4xCzAJBgNVBAYTAkVVMQ0wCwYDVQQKEwRUZXN0MRAwDgYD\nVQQDEwdUZXN0IENBMHYwEAYHKoZIzj0CAQYFK4EEACIDYgAEf96tstMNdNoNfYjl\nbGY6BvBFTsl9E3hpPnta7SJn6BqIYz6KEohDJ+8DXwUMVb5Ytr/QkEikg966HCY3\nA9TFBUdAs01TV8f2KoAPRQVrh+ccSLLJyACENfZ5VbGSQ0wso0IwQDAOBgNVHQ8B\nAf8EBAMCAQYwDwYDVR0TAQH/BAUwAwEB/zAdBgNVHQ4EFgQUs7vtuA+BkwrPXUMF\nUNRe+00Z4GcwCgYIKoZIzj0EAwMDaAAwZQIxAMPgE/Z+1Dcj+lH7jioE16Hig0HQ\nFC4qBx1UU05H05Gs23ECB1hzD2qXikVpaNyuDgIwbogEu42wIwpDa5xdJIZcIhmz\nDIuPvEscUDjU3C+1GPxmACcRMPv9QVUEcBAvZkfn\n-----END CERTIFICATE-----\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThen you can configure heimdall to use it like follows:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"yaml\"\u003e\u003cspan class=\"na\"\u003esigner\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"na\"\u003ename\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003efoobar\u003c/span\u003e\n  \u003cspan class=\"na\"\u003ekey_store\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"na\"\u003epath\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e/opt/heimdall/keystore.pem\u003c/span\u003e\n  \u003cspan class=\"na\"\u003ekey_id\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003efoo\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_security_considerations\"\u003eSecurity Considerations\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eIn a typical production scenario, there is a need for proper key and certificate management. This is supported by heimdall in the following way:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eyou can and should configure not only the private key for signature creation purposes, but also the corresponding certificate chain. This way your upstream services are able not only to verify the signatures of the signed objects for cryptographic validity, but also perform verification of the revocation status of used certificates and also their time validity. All of that is crucial for secure communication.\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe cryptographic material for the above said verification purposes is available via the \u003ca href=\"/openapi/#tag/Well-Known/operation/well_known_jwks\"\u003eJWKS endpoint\u003c/a\u003e for the upstream services.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eyou can configure multiple keys in heimdall’s \u003ccode\u003ekey_store\u003c/code\u003e and specify the \u003ccode\u003ekey_id\u003c/code\u003e of the key to use. The easiest way to let heimdall use the key id, you need, is to set \u003ccode\u003eX-Key-ID\u003c/code\u003e header in the PEM block of the corresponding private key (as also shown in the example above). Usage of key ids allows for seamless key rotation in setups which do not support or allow usage of secret management systems, respectively hot reloading of the corresponding updates by heimdall.\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_secret_management_rotation\"\u003eSecret Management \u0026amp; Rotation\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eWhen configuring heimdall, there are many places requiring secrets, like passwords, tokens, key material, etc. While you can directly configure these in heimdall’s config file, there is a huge chance for leaking them. Please reference the secrets in the config file via \u003ca href=\"/docs/operations/configuration/#_configuration_file\"\u003eenvironment variables\u003c/a\u003e, or make use of external files where possible instead, and let the contents of these be managed by a secret management system.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eUsage of external files can even allow you to rotate the configured secrets without the need to restart heimdall if desired. Watching for secrets rotation is however disabled by default, but can be enabled by setting the \u003ccode\u003esecrets_reload_enabled\u003c/code\u003e property to \u003ccode\u003etrue\u003c/code\u003e on the top level of heimdall’s configuration.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"admonitionblock note\"\u003e\n\u003ctable\u003e\n\u003ctbody\u003e\u003ctr\u003e\n\u003ctd class=\"icon\"\u003e\n\u003ci class=\"fa icon-note\" title=\"Note\"\u003e\u003c/i\u003e\n\u003c/td\u003e\n\u003ctd class=\"content\"\u003e\nAs of today secret reloading is only supported for \u003ca href=\"/docs/configuration/types/#_key_store\"\u003ekey stores\u003c/a\u003e and \u003ca href=\"/docs/operations/cache/#_common_settings\"\u003eRedis cache backend credentials\u003c/a\u003e.\n\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_verifying_heimdall_binaries_and_container_images\"\u003eVerifying Heimdall Binaries and Container Images\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eHeimdall binaries and container images are signed using \u003ca href=\"https://docs.sigstore.dev/docs/signing/quickstart/\"\u003eCosign\u003c/a\u003e and the \u003ca href=\"https://docs.sigstore.dev/docs/signing/overview/\"\u003ekeyless signing feature\u003c/a\u003e.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_prerequisites\"\u003ePrerequisites\u003c/h3\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eInstall \u003ca href=\"https://docs.sigstore.dev/docs/system_config/installation/\"\u003eCosign\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_container_image_signature_verification\"\u003eContainer Image Signature Verification\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe signatures are stored in a repository named \u003ccode\u003edadrus/heimdall-signatures\u003c/code\u003e. To verify the container image using Cosign, execute the following command:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"bash\"\u003e\u003cspan class=\"nv\"\u003eCOSIGN_REPOSITORY\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003edadrus/heimdall-signatures \u003cspan class=\"se\"\u003e\\\u003c/span\u003e\ncosign verify dadrus/heimdall:\u0026lt;tag\u0026gt; \u003cspan class=\"se\"\u003e\\\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e--certificate-identity-regexp\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003ehttps://github.com/dadrus/heimdall/.github/workflows/ci.yaml\u003cspan class=\"k\"\u003e*\u003c/span\u003e \u003cspan class=\"se\"\u003e\\\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e--certificate-oidc-issuer\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003ehttps://token.actions.githubusercontent.com | jq\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"admonitionblock note\"\u003e\n\u003ctable\u003e\n\u003ctbody\u003e\u003ctr\u003e\n\u003ctd class=\"icon\"\u003e\n\u003ci class=\"fa icon-note\" title=\"Note\"\u003e\u003c/i\u003e\n\u003c/td\u003e\n\u003ctd class=\"content\"\u003e\nIf you pull heimdall images from ghcr.io, reference the \u003ccode\u003eghcr.io\u003c/code\u003e registry while specifying the repository names. So \u003ccode\u003edadrus/heimdall-signatures\u003c/code\u003e becomes \u003ccode\u003eghcr.io/dadrus/heimdall-signatures\u003c/code\u003e and \u003ccode\u003edadrus/heimdall:\u0026lt;tag\u0026gt;\u003c/code\u003e becomes \u003ccode\u003eghcr.io/dadrus/heimdall:\u0026lt;tag\u0026gt;\u003c/code\u003e.\n\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eIn successful verification case, cosign will print similar output to the one shown below and exit with \u003ccode\u003e0\u003c/code\u003e.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"json\"\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"w\"\u003e\n  \u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;critical\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"w\"\u003e\n      \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;identity\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"w\"\u003e\n        \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;docker-reference\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;index.docker.io/dadrus/heimdall\u0026#34;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n      \u003c/span\u003e\u003cspan class=\"p\"\u003e},\u003c/span\u003e\u003cspan class=\"w\"\u003e\n      \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;image\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"w\"\u003e\n        \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;docker-manifest-digest\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;sha256:289b1a3eeeceeef08362a6fbcf4b95e726686d17998798e149c30b6974728eaf\u0026#34;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n      \u003c/span\u003e\u003cspan class=\"p\"\u003e},\u003c/span\u003e\u003cspan class=\"w\"\u003e\n      \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;type\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;cosign container image signature\u0026#34;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"p\"\u003e},\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;optional\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"w\"\u003e\n      \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;1.3.6.1.4.1.57264.1.1\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;https://token.actions.githubusercontent.com\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n      \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;1.3.6.1.4.1.57264.1.2\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;push\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n      \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;1.3.6.1.4.1.57264.1.3\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;04379639dc5f3fbfc260e883ee4938a35076d63e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n      \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;1.3.6.1.4.1.57264.1.4\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;CI\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n      \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;1.3.6.1.4.1.57264.1.5\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;dadrus/heimdall\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n      \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;1.3.6.1.4.1.57264.1.6\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;refs/heads/main\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n      \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;Bundle\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"w\"\u003e\n        \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;SignedEntryTimestamp\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;MEUCIFIvxs30zysroG6ItUNL+hfE3Cxn4GuiQe8d1u5N27OEAiEAqmzLrw80846U53nL/jtQ3U/2yx8Jqu8H75g6sihIcpg=\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n        \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;Payload\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"w\"\u003e\n          \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;body\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;eyJhcGlWZXJzaW9uIjoi...xTMHRMUW89In19fX0=\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n          \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;integratedTime\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"mi\"\u003e1692727396\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n          \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;logIndex\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"mi\"\u003e32332529\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n          \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;logID\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;c0d23d6ad406973f9559f3ba2d1ca01f84147d8ffc5b8445c224f98b9591801d\u0026#34;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n        \u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"w\"\u003e\n      \u003c/span\u003e\u003cspan class=\"p\"\u003e},\u003c/span\u003e\u003cspan class=\"w\"\u003e\n      \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;Issuer\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;https://token.actions.githubusercontent.com\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n      \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;Subject\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;https://github.com/dadrus/heimdall/.github/workflows/ci.yaml@refs/heads/main\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n      \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;githubWorkflowName\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;CI\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n      \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;githubWorkflowRef\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;refs/heads/main\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n      \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;githubWorkflowRepository\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;dadrus/heimdall\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n      \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;githubWorkflowSha\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;04379639dc5f3fbfc260e883ee4938a35076d63e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n      \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;githubWorkflowTrigger\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;push\u0026#34;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"w\"\u003e\n  \u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eFor released images, the \u003ccode\u003eSubject\u003c/code\u003e value ends with \u003ccode\u003e@refs/tags/\u0026lt;release version\u0026gt;\u003c/code\u003e.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_release_binary_signature_verification\"\u003eRelease Binary Signature Verification\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe detached signatures, as well as certificates for all released archives are published together with the corresponding platform specific archive. The names of the signature files adhere to the \u003ccode\u003e\u0026lt;archive\u0026gt;-keyless.sig\u003c/code\u003e name pattern and the names of the certificate files adhere to the \u003ccode\u003e\u0026lt;archive\u0026gt;-keyless.pem\u003c/code\u003e name pattern, with \u003ccode\u003e\u0026lt;archive\u0026gt;\u003c/code\u003e being the archive for a platform specific build.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eTo verify the signature of the archive, hence its contents including the platform specific heimdall binary with Cosign execute the following command:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"bash\"\u003ecosign verify-blob /path/to/the/downloaded/\u0026lt;archive\u0026gt; \u003cspan class=\"se\"\u003e\\\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e--certificate-identity-regexp\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003ehttps://github.com/dadrus/heimdall/.github/workflows/ci.yaml\u003cspan class=\"k\"\u003e*\u003c/span\u003e \u003cspan class=\"se\"\u003e\\\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e--certificate-oidc-issuer\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003ehttps://token.actions.githubusercontent.com \u003cspan class=\"se\"\u003e\\\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e--signature\u003c/span\u003e /path/to/the/downloaded/\u0026lt;archive\u0026gt;-keyless.sig \u003cspan class=\"se\"\u003e\\\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e--certificate\u003c/span\u003e /path/to/the/downloaded/\u0026lt;archive\u0026gt;--keyless.pem\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eIn successful verification case, cosign will print the following output and exit with \u003ccode\u003e0\u003c/code\u003e.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"bash\"\u003eVerified OK\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_software_bill_of_material_sbom\"\u003eSoftware Bill of Material (SBOM)\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eHeimdall is shipped with an SBOM in \u003ca href=\"https://cyclonedx.org/\"\u003eCyclonDX\u003c/a\u003e (json) format.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eIf you use a released binary of heimdall, the corresponding file is part of the platform specific archive. That way, if you verify the signature of the archive (see above), you do also get evidence about the validity of the SBOM.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eIf you use a container image, the same SBOM is attached to the image as attestation signed with Cosign. These attestations are stored in the \u003ccode\u003edadrus/heimdall-sbom\u003c/code\u003e repository. To verify the attestation and retrieve the SBOM execute the following command once Cosign is installed:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"bash\"\u003e\u003cspan class=\"nv\"\u003eCOSIGN_REPOSITORY\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003edadrus/heimdall-sbom \u003cspan class=\"se\"\u003e\\\u003c/span\u003e\ncosign verify-attestation dadrus/heimdall:\u0026lt;tag\u0026gt; \u003cspan class=\"se\"\u003e\\\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e--certificate-identity-regexp\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003ehttps://github.com/dadrus/heimdall/.github/workflows/ci.yaml\u003cspan class=\"k\"\u003e*\u003c/span\u003e \u003cspan class=\"se\"\u003e\\\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e--certificate-oidc-issuer\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003ehttps://token.actions.githubusercontent.com \u003cspan class=\"se\"\u003e\\\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e--type\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003ecyclonedx\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"admonitionblock note\"\u003e\n\u003ctable\u003e\n\u003ctbody\u003e\u003ctr\u003e\n\u003ctd class=\"icon\"\u003e\n\u003ci class=\"fa icon-note\" title=\"Note\"\u003e\u003c/i\u003e\n\u003c/td\u003e\n\u003ctd class=\"content\"\u003e\nIf you pull heimdall images from ghcr.io, reference the \u003ccode\u003eghcr.io\u003c/code\u003e registry while specifying the repository names. So \u003ccode\u003edadrus/heimdall-sbom\u003c/code\u003e becomes \u003ccode\u003eghcr.io/dadrus/heimdall-sbom\u003c/code\u003e and \u003ccode\u003edadrus/heimdall:\u0026lt;tag\u0026gt;\u003c/code\u003e becomes \u003ccode\u003eghcr.io/dadrus/heimdall:\u0026lt;tag\u0026gt;\u003c/code\u003e.\n\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eIn successful verification case, cosign will print similar output to the one shown below and exit with \u003ccode\u003e0\u003c/code\u003e.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"bash\"\u003e\u003cspan class=\"o\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"s2\"\u003e\u0026#34;payloadType\u0026#34;\u003c/span\u003e: \u003cspan class=\"s2\"\u003e\u0026#34;application/vnd.in-toto+json\u0026#34;\u003c/span\u003e,\n  \u003cspan class=\"s2\"\u003e\u0026#34;payload\u0026#34;\u003c/span\u003e: \u003cspan class=\"s2\"\u003e\u0026#34;eyJfdHlwZSI6Imh...LCJ2ZXJzaW9uIjoxfX0=\u0026#34;\u003c/span\u003e,\n  \u003cspan class=\"s2\"\u003e\u0026#34;signatures\u0026#34;\u003c/span\u003e: \u003cspan class=\"o\"\u003e[\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"s2\"\u003e\u0026#34;keyid\u0026#34;\u003c/span\u003e: \u003cspan class=\"s2\"\u003e\u0026#34;\u0026#34;\u003c/span\u003e,\n      \u003cspan class=\"s2\"\u003e\u0026#34;sig\u0026#34;\u003c/span\u003e: \u003cspan class=\"s2\"\u003e\u0026#34;MEQCICGdo9hmIUrBRzVQ23VS...6ToNGa5YrommZNCQ==\u0026#34;\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"o\"\u003e]\u003c/span\u003e\n\u003cspan class=\"o\"\u003e}\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eHere, \u003ccode\u003epayload\u003c/code\u003e is the base64 encoded attestation value embedding the SBOM.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eAs one-liner, you can verify the signature and extract the SBOM as follows:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"bash\"\u003e\u003cspan class=\"nv\"\u003eCOSIGN_REPOSITORY\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003edadrus/heimdall-sbom \u003cspan class=\"se\"\u003e\\\u003c/span\u003e\ncosign verify-attestation dadrus/heimdall:\u0026lt;tag\u0026gt; \u003cspan class=\"se\"\u003e\\\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e--certificate-identity-regexp\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003ehttps://github.com/dadrus/heimdall/.github/workflows/ci.yaml\u003cspan class=\"k\"\u003e*\u003c/span\u003e \u003cspan class=\"se\"\u003e\\\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e--certificate-oidc-issuer\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003ehttps://token.actions.githubusercontent.com \u003cspan class=\"se\"\u003e\\\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e--type\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003ecyclonedx | jq \u003cspan class=\"nt\"\u003e-r\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;.payload\u0026#34;\u003c/span\u003e | \u003cspan class=\"nb\"\u003ebase64\u003c/span\u003e \u003cspan class=\"nt\"\u003e-d\u003c/span\u003e | jq \u003cspan class=\"nt\"\u003e-r\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;.predicate\u0026#34;\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e heimdall.sbom.json\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe result will be the \u003ccode\u003eheimdall.sbom.json\u003c/code\u003e SBOM document, which you can use with any SCA or monitoring tool of your choice, e.g. \u003ca href=\"https://dependencytrack.org/\"\u003eDependency Track\u003c/a\u003e.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n","sections":["Operations"],"tags":null,"title":"Security","url":"/docs/operations/security/"},{"categories":null,"content":" To make use of this service you have to start heimdall with heimdall serve decision or heimdall serve decision --envoy-grpc. By default, heimdall listens on 0.0.0.0:4456 endpoint for incoming requests in this mode of operation and also configures useful default timeouts, as well as buffer limits. No other options are configured. You can, and should however adjust the configuration for your needs.\nConfiguration The configuration of the Decision service can be adjusted in the decision property, which lives in the serve property of heimdall’s configuration and supports the following properties.\nhost: string (optional)\nBy making use of this property, you can specify the TCP/IP address on which heimdall should listen for connections from client applications. The entry 0.0.0.0 allows listening for all IPv4 addresses. 0.0.0.0 is also the default setting.\nport: integer (optional)\nBy making use of this property, you can specify the TCP port the heimdall should listen on. Defaults to 4456.\ntimeout: Timeout (optional)\nBy using this property you can override the default timeouts used by heimdall. Following properties are supported:\nidle: Duration (optional)\nThe maximum amount of time to wait for the next request when keep-alive is enabled. If set to 0, the value of the read timeout is used. Defaults to 2 minutes.\nread: Duration (optional)\nThe absolute amount of time allowed to read the entire request, including body. Defaults to 5 seconds. Setting this property to 0s will disable the timeout.\nwrite: Duration (optional)\nThe maximum duration before timing out writes of the response. Defaults to 10 seconds. Setting this property to 0s will disable the timeout.\nbuffer_limit: BufferLimit (optional)\nBuffer limits for inbound requests and outbound responses. Following configuration properties are supported:\nread: ByteSize (optional)\nThe maximum size for the read buffer allowed to read the full request including body. Defaults to 4KB.\nwrite: ByteSize (optional)\nThe maximum size for the write buffer of the response. Defaults to 4KB.\ntls: TLS (optional)\nBy default, the Decision service accepts HTTP requests. Depending on your deployment scenario, you could require Heimdall to accept HTTPs requests only (which is highly recommended). You can do so by making use of this option.\ntrusted_proxies: string array (optional)\nThe usage of the Decision service makes only sense, if operated behind some sort of proxy, like API Gateway, etc. In such cases certain header information may be sent to Heimdall using e.g. special X-Forwarded-* headers or the Forwarded header. For example, the Host HTTP header is usually used to set the requested host. But when you’re behind a proxy, the actual host may be stored in an X-Forwarded-Host header, which could, however, also be spoofed.\nDepending on the integration options offered by those systems, which are used to integrate heimdall with, you may need to rely on the aforesaid headers. In such cases, you have to configure the trusted_proxies option and list the IPs, or IP ranges (CIDR notation) of your proxies, which integrate with heimdall. If not configured, heimdall will not accept those headers from any client to prevent spoofing as it might result in privilege escalation.\nPlease consider security implications when making use of this property. respond: Respond (optional)\nBy making use of this property you can instruct heimdall to preserve error information and provide it in the response body to the caller, as well as to use HTTP status codes deviating from those heimdall would usually use.\nExample 1. Complex decision service configuration. decision: host: 127.0.0.1 tls: key_store: path: /path/to/keystore.pem password: VerySecure! timeout: read: 1s write: 2s idle: 30s buffer_limit: read: 4KB write: 10KB trusted_proxies: - 192.168.1.0/24 respond: verbose: true with: authentication_error: code: 404 authorization_error: code: 404 ","description":"Decision service implements the decision operating mode using which you can integrate heimdall with existing reverse proxies, or API gateways.","html_content":"\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eTo make use of this service you have to start heimdall with \u003ccode\u003eheimdall serve decision\u003c/code\u003e or \u003ccode\u003eheimdall serve decision --envoy-grpc\u003c/code\u003e. By default, heimdall listens on \u003ccode\u003e0.0.0.0:4456\u003c/code\u003e endpoint for incoming requests in this mode of operation and also configures useful default timeouts, as well as buffer limits. No other options are configured. You can, and should however adjust the configuration for your needs.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_configuration\"\u003eConfiguration\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe configuration of the Decision service can be adjusted in the \u003ccode\u003edecision\u003c/code\u003e property, which lives in the \u003ccode\u003eserve\u003c/code\u003e property of heimdall’s configuration and supports the following properties.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003ehost\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003estring\u003c/em\u003e (optional)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eBy making use of this property, you can specify the TCP/IP address on which heimdall should listen for connections from client applications. The entry \u003ccode\u003e0.0.0.0\u003c/code\u003e allows listening for all IPv4 addresses. \u003ccode\u003e0.0.0.0\u003c/code\u003e is also the default setting.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003eport\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003einteger\u003c/em\u003e (optional)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eBy making use of this property, you can specify the TCP port the heimdall should listen on. Defaults to \u003ccode\u003e4456\u003c/code\u003e.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003etimeout\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003eTimeout\u003c/em\u003e (optional)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eBy using this property you can override the default timeouts used by heimdall. Following properties are supported:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003eidle\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003e\u003ca href=\"/docs/configuration/types/#_duration\"\u003eDuration\u003c/a\u003e\u003c/em\u003e (optional)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe maximum amount of time to wait for the next request when keep-alive is enabled. If set to 0, the value of the \u003ccode\u003eread\u003c/code\u003e timeout is used. Defaults to 2 minutes.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003eread\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003e\u003ca href=\"/docs/configuration/types/#_duration\"\u003eDuration\u003c/a\u003e\u003c/em\u003e (optional)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe absolute amount of time allowed to read the entire request, including body. Defaults to 5 seconds. Setting this property to 0s will disable the timeout.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003ewrite\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003e\u003ca href=\"/docs/configuration/types/#_duration\"\u003eDuration\u003c/a\u003e\u003c/em\u003e (optional)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe maximum duration before timing out writes of the response. Defaults to 10 seconds. Setting this property to 0s will disable the timeout.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003ebuffer_limit\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003eBufferLimit\u003c/em\u003e (optional)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eBuffer limits for inbound requests and outbound responses. Following configuration properties are supported:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003eread\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003e\u003ca href=\"/docs/configuration/types/#_bytesize\"\u003eByteSize\u003c/a\u003e\u003c/em\u003e (optional)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe maximum size for the read buffer allowed to read the full request including body. Defaults to 4KB.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003ewrite\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003e\u003ca href=\"/docs/configuration/types/#_bytesize\"\u003eByteSize\u003c/a\u003e\u003c/em\u003e (optional)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe maximum size for the write buffer of the response. Defaults to 4KB.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003etls\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003e\u003ca href=\"/docs/configuration/types/#_tls\"\u003eTLS\u003c/a\u003e\u003c/em\u003e (optional)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eBy default, the Decision service accepts HTTP requests. Depending on your deployment scenario, you could require Heimdall to accept HTTPs requests only (which is highly recommended). You can do so by making use of this option.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv id=\"_trusted_proxies\" class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003etrusted_proxies\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003estring array\u003c/em\u003e (optional)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe usage of the Decision service makes only sense, if operated behind some sort of proxy, like API Gateway, etc. In such cases certain header information may be sent to Heimdall using e.g. special \u003ccode\u003eX-Forwarded-*\u003c/code\u003e headers or the \u003ca href=\"https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Forwarded\"\u003eForwarded\u003c/a\u003e header. For example, the \u003ccode\u003eHost\u003c/code\u003e HTTP header is usually used to set the requested host. But when you’re behind a proxy, the actual host may be stored in an \u003ccode\u003eX-Forwarded-Host\u003c/code\u003e header, which could, however, also be spoofed.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eDepending on the integration options offered by those systems, which are used to integrate heimdall with, you may need to rely on the aforesaid headers. In such cases, you have to configure the \u003ccode\u003etrusted_proxies\u003c/code\u003e option and list the IPs, or IP ranges (CIDR notation) of your proxies, which integrate with heimdall. If not configured, heimdall will not accept those headers from any client to prevent spoofing as it might result in privilege escalation.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"admonitionblock caution\"\u003e\n\u003ctable\u003e\n\u003ctbody\u003e\u003ctr\u003e\n\u003ctd class=\"icon\"\u003e\n\u003ci class=\"fa icon-caution\" title=\"Caution\"\u003e\u003c/i\u003e\n\u003c/td\u003e\n\u003ctd class=\"content\"\u003e\nPlease consider \u003ca href=\"/docs/operations/security/#_http_header_security_considerations\"\u003esecurity implications\u003c/a\u003e when making use of this property.\n\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003erespond\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003e\u003ca href=\"/docs/configuration/types/#_respond\"\u003eRespond\u003c/a\u003e\u003c/em\u003e (optional)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eBy making use of this property you can instruct heimdall to preserve error information and provide it in the response body to the caller, as well as to use HTTP status codes deviating from those heimdall would usually use.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"exampleblock\"\u003e\n\u003cdiv class=\"title\"\u003eExample 1. Complex decision service configuration.\u003c/div\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"yaml\"\u003e\u003cspan class=\"na\"\u003edecision\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"na\"\u003ehost\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e127.0.0.1\u003c/span\u003e\n  \u003cspan class=\"na\"\u003etls\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"na\"\u003ekey_store\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"na\"\u003epath\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e/path/to/keystore.pem\u003c/span\u003e\n      \u003cspan class=\"na\"\u003epassword\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eVerySecure!\u003c/span\u003e\n  \u003cspan class=\"na\"\u003etimeout\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"na\"\u003eread\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e1s\u003c/span\u003e\n    \u003cspan class=\"na\"\u003ewrite\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e2s\u003c/span\u003e\n    \u003cspan class=\"na\"\u003eidle\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e30s\u003c/span\u003e\n  \u003cspan class=\"na\"\u003ebuffer_limit\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"na\"\u003eread\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e4KB\u003c/span\u003e\n    \u003cspan class=\"na\"\u003ewrite\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e10KB\u003c/span\u003e\n  \u003cspan class=\"na\"\u003etrusted_proxies\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003e192.168.1.0/24\u003c/span\u003e\n  \u003cspan class=\"na\"\u003erespond\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"na\"\u003everbose\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\n    \u003cspan class=\"na\"\u003ewith\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"na\"\u003eauthentication_error\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"na\"\u003ecode\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"m\"\u003e404\u003c/span\u003e\n      \u003cspan class=\"na\"\u003eauthorization_error\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"na\"\u003ecode\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e404\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n","sections":["Services"],"tags":null,"title":"Decision Service","url":"/docs/services/decision/"},{"categories":null,"content":" To make use of this service you have to start Heimdall with heimdall serve proxy. By default, Heimdall listens on 0.0.0.0:4455 endpoint for incoming requests in this mode of operation and also configures useful default timeouts, amount of possible upstream connections is active and idle state, as well as buffer limits. No other options are configured. You can, and should however adjust the configuration for your needs.\nConfiguration The configuration of the Proxy endpoint can be adjusted in the proxy property, which lives in the serve property of heimdall’s configuration and supports the following properties.\nhost: string (optional)\nBy making use of this property, you can specify the TCP/IP address on which heimdall should listen for connections from client applications. The entry 0.0.0.0 allows listening for all IPv4 addresses. 0.0.0.0 is also the default setting.\nport: integer (optional)\nBy making use of this property, you can specify the TCP port the heimdall should listen on. Defaults to 4455.\ntimeout: Timeout (optional)\nBy using this property you can override the default timeouts used by heimdall. Following properties are supported:\nidle: Duration (optional)\nThe maximum amount of time to wait for the next request when keep-alive is enabled. If set to 0, the value of the read timeout is used. Defaults to 2 minutes. This value is also used for the maximum amount of time an idle (keep-alive) connection to the upstream will remain idle before closing itself.\nread: Duration (optional)\nThe absolute amount of time allowed to read the entire request, including body. Defaults to 5 seconds. The read timeout is also used while waiting for the responses from the upstream service. Here it specifies the amount of time to wait for a server’s response headers after fully writing the request (including its body, if any). Upon successful upgrade responses from the upstream service, this timeout is disabled, allowing e.g. for WebSockets proxying. Setting this property to 0s will disable the timeout.\nSetting this timout to 0 will make heimdall vulnerable to Slowloris attacks. write: Duration (optional)\nThe maximum duration before timing out writes of the response. Defaults to 10 seconds. Setting this property to 0s will disable the timeout. Compared to the read timeout, the write timeout is not absolute and reset each time data is written to the output stream. This allows Server-Sent-Events and other unidirectional communication without the need to extend the timeout. As with the read timeout, this timeout is disabled upon successful upgrade responses from the upstream service, allowing e.g. for WebSockets proxying.\nbuffer_limit: BufferLimit (optional)\nBuffer limits for inbound requests and outbound responses. You can however override this by making use of this property and specifying the limits you need. Following configuration properties are supported:\nread: ByteSize (optional)\nThe maximum size for the read buffer allowed to read the full request including body. Defaults to 4KB.\nwrite: ByteSize (optional)\nThe maximum size for the write buffer of the response. Defaults to 4KB.\nconnections_limit: ConnectionsLimit (optional)\nAllowed connections limit per upstream service. Following limits can be configured:\nmax_per_host: integer (optional)\nLimits the total number of connections per host, including connections in the dialing, active, and idle states. On limit violation, dials will block. Defaults to 0, which means there is no limit.\nmax_idle: integer (optional)\nControls the maximum number of idle (keep-alive) connections across all hosts. 0 means no limit. Defaults to 100.\nmax_idle_per_host: integer (optional)\nControls the maximum number of idle (keep-alive) connections per hosts. Defaults to 100. Cannot exceed the value of max_idle.\ncors: CORS (optional)\nCORS (Cross-Origin Resource Sharing) headers can be added and configured by making use of this option. This functionality allows for advanced security features to quickly be set. If CORS headers are set, then the Heimdall does not pass preflight requests neither to its pipeline, nor to the upstream service. Instead, the response will be generated and sent back to the client directly.\ntls: TLS (optional)\nBy default, the Proxy endpoint accepts HTTP requests. Depending on your deployment scenario, you could require Heimdall to accept HTTPs requests only (which is highly recommended). You can do so by making use of this option.\ntrusted_proxies: string array (optional)\nHeimdall can make use of X-Forwarded-*, like X-Forwarded-For, X-Forwarded-Method, etc, or the Forwarded header sent by its clients and also forward some of these (X-Forwarded-For and Forwarded) to the configured upstream services. However, since these headers can easily be spoofed, the usage of them is only possible, when the request comes from a trusted source. This is typically the case, when Heimdall is operated behind yet another proxy. For example, the Host HTTP header is usually used to return the requested host. But when you’re behind a proxy, the actual host may be stored in an X-Forwarded-Host header, which could, however, also be spoofed.\nDepending on your setup you may need to rely on the aforesaid headers. In such cases, you have to configure the trusted_proxies option and list the IPs, or IP ranges (CIDR notation) of your proxies in front of heimdall. If not configured, heimdall will not accept those headers from any client to prevent spoofing as it might result in privilege escalation.\nPlease consider security implications when making use of this property. respond: Respond (optional)\nBy making use of this property you can instruct heimdall to preserve error information and provide it in the response body to the caller, as well as to use HTTP status codes deviating from those heimdall would usually use.\nThis mapping is only applicable if the HTTP status code is set by heimdall and not by the upstream service in the response to the proxied request. For that reason you cannot configure the mapping for the accepted response (it will be ignored). Example 1. Complex proxy service configuration. proxy: host: 172.17.0.2 tls: key_store: path: /path/to/keystore.pem password: VerySecure! timeout: read: 1s write: 2s idle: 30s connections_limit: max_per_host: 20 max_idle: 100 max_idle_per_host: 10 buffer_limit: read: 4KB write: 10KB trusted_proxies: - 192.168.1.0/24 cors: allowed_origins: - example.org allowed_methods: - HEAD - PATCH allow_credentials: true max_age: 10s respond: verbose: true with: authentication_error: code: 404 authorization_error: code: 404 ","description":"When heimdall is started exposing this service, you can make use of heimdall's proxy operating mode and use it as a proxy in front of your upstream API or web server","html_content":"\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eTo make use of this service you have to start Heimdall with \u003ccode\u003eheimdall serve proxy\u003c/code\u003e. By default, Heimdall listens on \u003ccode\u003e0.0.0.0:4455\u003c/code\u003e endpoint for incoming requests in this mode of operation and also configures useful default timeouts, amount of possible upstream connections is active and idle state, as well as buffer limits. No other options are configured. You can, and should however adjust the configuration for your needs.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_configuration\"\u003eConfiguration\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe configuration of the Proxy endpoint can be adjusted in the \u003ccode\u003eproxy\u003c/code\u003e property, which lives in the \u003ccode\u003eserve\u003c/code\u003e property of heimdall’s configuration and supports the following properties.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003ehost\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003estring\u003c/em\u003e (optional)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eBy making use of this property, you can specify the TCP/IP address on which heimdall should listen for connections from client applications. The entry \u003ccode\u003e0.0.0.0\u003c/code\u003e allows listening for all IPv4 addresses. \u003ccode\u003e0.0.0.0\u003c/code\u003e is also the default setting.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003eport\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003einteger\u003c/em\u003e (optional)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eBy making use of this property, you can specify the TCP port the heimdall should listen on. Defaults to \u003ccode\u003e4455\u003c/code\u003e.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003etimeout\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003eTimeout\u003c/em\u003e (optional)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eBy using this property you can override the default timeouts used by heimdall. Following properties are supported:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003eidle\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003e\u003ca href=\"/docs/configuration/types/#_duration\"\u003eDuration\u003c/a\u003e\u003c/em\u003e (optional)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe maximum amount of time to wait for the next request when keep-alive is enabled. If set to 0, the value of the \u003ccode\u003eread\u003c/code\u003e timeout is used. Defaults to 2 minutes. This value is also used for the maximum amount of time an idle (keep-alive) connection to the upstream will remain idle before closing itself.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003eread\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003e\u003ca href=\"/docs/configuration/types/#_duration\"\u003eDuration\u003c/a\u003e\u003c/em\u003e (optional)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe absolute amount of time allowed to read the entire request, including body. Defaults to 5 seconds. The \u003ccode\u003eread\u003c/code\u003e timeout is also used while waiting for the responses from the upstream service. Here it specifies the amount of time to wait for a server’s response headers after fully writing the request (including its body, if any). Upon successful upgrade responses from the upstream service, this timeout is disabled, allowing e.g. for WebSockets proxying. Setting this property to 0s will disable the timeout.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"admonitionblock caution\"\u003e\n\u003ctable\u003e\n\u003ctbody\u003e\u003ctr\u003e\n\u003ctd class=\"icon\"\u003e\n\u003ci class=\"fa icon-caution\" title=\"Caution\"\u003e\u003c/i\u003e\n\u003c/td\u003e\n\u003ctd class=\"content\"\u003e\nSetting this timout to 0 will make heimdall vulnerable to \u003ca href=\"https://en.wikipedia.org/wiki/Slowloris_(computer_security\"\u003eSlowloris attacks\u003c/a\u003e.\n\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003ewrite\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003e\u003ca href=\"/docs/configuration/types/#_duration\"\u003eDuration\u003c/a\u003e\u003c/em\u003e (optional)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe maximum duration before timing out writes of the response. Defaults to 10 seconds. Setting this property to 0s will disable the timeout. Compared to the \u003ccode\u003eread\u003c/code\u003e timeout, the \u003ccode\u003ewrite\u003c/code\u003e timeout is not absolute and reset each time data is written to the output stream. This allows Server-Sent-Events and other unidirectional communication without the need to extend the timeout. As with the \u003ccode\u003eread\u003c/code\u003e timeout, this timeout is disabled upon successful upgrade responses from the upstream service, allowing e.g. for WebSockets proxying.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003ebuffer_limit\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003eBufferLimit\u003c/em\u003e (optional)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eBuffer limits for inbound requests and outbound responses. You can however override this by making use of this property and specifying the limits you need. Following configuration properties are supported:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003eread\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003e\u003ca href=\"/docs/configuration/types/#_bytesize\"\u003eByteSize\u003c/a\u003e\u003c/em\u003e (optional)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe maximum size for the read buffer allowed to read the full request including body. Defaults to 4KB.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003ewrite\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003e\u003ca href=\"/docs/configuration/types/#_bytesize\"\u003eByteSize\u003c/a\u003e\u003c/em\u003e (optional)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe maximum size for the write buffer of the response. Defaults to 4KB.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003econnections_limit\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003eConnectionsLimit\u003c/em\u003e (optional)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eAllowed connections limit per upstream service. Following limits can be configured:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003emax_per_host\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003einteger\u003c/em\u003e (optional)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eLimits the total number of connections per host, including connections in the dialing, active, and idle states. On limit violation, dials will block. Defaults to 0, which means there is no limit.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003emax_idle\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003einteger\u003c/em\u003e (optional)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eControls the maximum number of idle (keep-alive) connections across all hosts. 0 means no limit. Defaults to 100.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003emax_idle_per_host\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003einteger\u003c/em\u003e (optional)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eControls the maximum number of idle (keep-alive) connections per hosts. Defaults to 100. Cannot exceed the value of \u003ccode\u003emax_idle\u003c/code\u003e.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003ecors\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003e\u003ca href=\"/docs/configuration/types/#_cors\"\u003eCORS\u003c/a\u003e\u003c/em\u003e (optional)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e\u003ca href=\"https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS\"\u003eCORS\u003c/a\u003e (Cross-Origin Resource Sharing) headers can be added and configured by making use of this option. This functionality allows for advanced security features to quickly be set. If CORS headers are set, then the Heimdall does not pass preflight requests neither to its pipeline, nor to the upstream service. Instead, the response will be generated and sent back to the client directly.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003etls\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003e\u003ca href=\"/docs/configuration/types/#_tls\"\u003eTLS\u003c/a\u003e\u003c/em\u003e (optional)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eBy default, the Proxy endpoint accepts HTTP requests. Depending on your deployment scenario, you could require Heimdall to accept HTTPs requests only (which is highly recommended). You can do so by making use of this option.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv id=\"_trusted_proxies\" class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003etrusted_proxies\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003estring array\u003c/em\u003e (optional)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eHeimdall can make use of \u003ccode\u003eX-Forwarded-*\u003c/code\u003e, like \u003ccode\u003eX-Forwarded-For\u003c/code\u003e, \u003ccode\u003eX-Forwarded-Method\u003c/code\u003e, etc, or the \u003ca href=\"https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Forwarded\"\u003e\u003ccode\u003eForwarded\u003c/code\u003e\u003c/a\u003e header sent by its clients and also forward some of these (\u003ccode\u003eX-Forwarded-For\u003c/code\u003e and \u003ccode\u003eForwarded\u003c/code\u003e) to the configured upstream services. However, since these headers can easily be spoofed, the usage of them is only possible, when the request comes from a trusted source. This is typically the case, when Heimdall is operated behind yet another proxy. For example, the \u003ccode\u003eHost\u003c/code\u003e HTTP header is usually used to return the requested host. But when you’re behind a proxy, the actual host may be stored in an \u003ccode\u003eX-Forwarded-Host\u003c/code\u003e header, which could, however, also be spoofed.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eDepending on your setup you may need to rely on the aforesaid headers. In such cases, you have to configure the \u003ccode\u003etrusted_proxies\u003c/code\u003e option and list the IPs, or IP ranges (CIDR notation) of your proxies in front of heimdall. If not configured, heimdall will not accept those headers from any client to prevent spoofing as it might result in privilege escalation.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"admonitionblock caution\"\u003e\n\u003ctable\u003e\n\u003ctbody\u003e\u003ctr\u003e\n\u003ctd class=\"icon\"\u003e\n\u003ci class=\"fa icon-caution\" title=\"Caution\"\u003e\u003c/i\u003e\n\u003c/td\u003e\n\u003ctd class=\"content\"\u003e\nPlease consider \u003ca href=\"/docs/operations/security/#_http_header_security_considerations\"\u003esecurity implications\u003c/a\u003e when making use of this property.\n\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003erespond\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003e\u003ca href=\"/docs/configuration/types/#_respond\"\u003eRespond\u003c/a\u003e\u003c/em\u003e (optional)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eBy making use of this property you can instruct heimdall to preserve error information and provide it in the response body to the caller, as well as to use HTTP status codes deviating from those heimdall would usually use.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"admonitionblock note\"\u003e\n\u003ctable\u003e\n\u003ctbody\u003e\u003ctr\u003e\n\u003ctd class=\"icon\"\u003e\n\u003ci class=\"fa icon-note\" title=\"Note\"\u003e\u003c/i\u003e\n\u003c/td\u003e\n\u003ctd class=\"content\"\u003e\nThis mapping is only applicable if the HTTP status code is set by heimdall and not by the upstream service in the response to the proxied request. For that reason you cannot configure the mapping for the \u003ccode\u003eaccepted\u003c/code\u003e response (it will be ignored).\n\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"exampleblock\"\u003e\n\u003cdiv class=\"title\"\u003eExample 1. Complex proxy service configuration.\u003c/div\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"yaml\"\u003e\u003cspan class=\"na\"\u003eproxy\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"na\"\u003ehost\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e172.17.0.2\u003c/span\u003e\n  \u003cspan class=\"na\"\u003etls\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"na\"\u003ekey_store\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"na\"\u003epath\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e/path/to/keystore.pem\u003c/span\u003e\n      \u003cspan class=\"na\"\u003epassword\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eVerySecure!\u003c/span\u003e\n  \u003cspan class=\"na\"\u003etimeout\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"na\"\u003eread\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e1s\u003c/span\u003e\n    \u003cspan class=\"na\"\u003ewrite\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e2s\u003c/span\u003e\n    \u003cspan class=\"na\"\u003eidle\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e30s\u003c/span\u003e\n  \u003cspan class=\"na\"\u003econnections_limit\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"na\"\u003emax_per_host\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"m\"\u003e20\u003c/span\u003e\n    \u003cspan class=\"na\"\u003emax_idle\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"m\"\u003e100\u003c/span\u003e\n    \u003cspan class=\"na\"\u003emax_idle_per_host\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"m\"\u003e10\u003c/span\u003e\n  \u003cspan class=\"na\"\u003ebuffer_limit\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"na\"\u003eread\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e4KB\u003c/span\u003e\n    \u003cspan class=\"na\"\u003ewrite\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e10KB\u003c/span\u003e\n  \u003cspan class=\"na\"\u003etrusted_proxies\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003e192.168.1.0/24\u003c/span\u003e\n  \u003cspan class=\"na\"\u003ecors\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"na\"\u003eallowed_origins\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003eexample.org\u003c/span\u003e\n    \u003cspan class=\"na\"\u003eallowed_methods\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003eHEAD\u003c/span\u003e\n      \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003ePATCH\u003c/span\u003e\n    \u003cspan class=\"na\"\u003eallow_credentials\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\n    \u003cspan class=\"na\"\u003emax_age\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e10s\u003c/span\u003e\n  \u003cspan class=\"na\"\u003erespond\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"na\"\u003everbose\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\n    \u003cspan class=\"na\"\u003ewith\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"na\"\u003eauthentication_error\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"na\"\u003ecode\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"m\"\u003e404\u003c/span\u003e\n      \u003cspan class=\"na\"\u003eauthorization_error\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"na\"\u003ecode\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e404\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n","sections":["Services"],"tags":null,"title":"Proxy Service","url":"/docs/services/proxy/"},{"categories":null,"content":" By default, Heimdall listens on 0.0.0.0:4457 endpoint for incoming requests and also configures useful default timeouts as well as buffer limits. No other options are configured. You can however adjust the configuration for your needs.\nThis service exposes the health and the JWKS endpoints.\nConfiguration The configuration for of the Management endpoint can be adjusted in the management property, which lives in the serve property of heimdall’s configuration and supports the following properties.\nhost: string (optional)\nBy making use of this property, you can specify the TCP/IP address on which heimdall should listen for connections from client applications. The entry 0.0.0.0 allows listening for all IPv4 addresses. 0.0.0.0 is also the default setting.\nport: integer (optional)\nBy making use of this property, you can specify the TCP port the heimdall should listen on. Defaults to 4457.\ntimeout: Timeout (optional)\nBy using this property you can override the default timeouts used by heimdall. Following properties are supported:\nidle: Duration (optional)\nThe maximum amount of time to wait for the next request when keep-alive is enabled. If set to 0, the value of the read timeout is used. Defaults to 2 minutes.\nread: Duration (optional)\nThe absolute amount of time allowed to read the entire request, including body. Defaults to 5 seconds. Setting this property to 0s will disable the timeout.\nwrite: Duration (optional)\nThe maximum duration before timing out writes of the response. Defaults to 10 seconds. Setting this property to 0s will disable the timeout.\nbuffer_limit: BufferLimit (optional)\nBuffer limits for inbound requests and outbound responses. Following configuration properties are supported:\nread: ByteSize (optional)\nThe maximum size for the read buffer allowed to read the full request including body. Defaults to 4KB.\nwrite: ByteSize (optional)\nThe maximum size for the write buffer of the response. Defaults to 4KB.\ncors: CORS (optional)\nCORS (Cross-Origin Resource Sharing) headers can be added and configured by making use of this option. This functionality allows for advanced security features to quickly be set.\ntls: TLS (optional)\nBy default, the Management endpoint accepts HTTP requests. Depending on your deployment scenario, you could require Heimdall to accept HTTPs requests only (which is highly recommended). You can do so by making use of this option.\nExample 1. Complex management service configuration. management: host: 127.0.0.1 tls: key_store: path: /path/to/keystore.pem password: VerySecure! timeout: read: 1s write: 2s idle: 30s buffer_limit: read: 4KB write: 10KB ","description":"When heimdall is started, the management service is always exposed and offers endpoints for health monitoring and to retrieve keys and certificates used by heimdall for JWT creation purposes.","html_content":"\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eBy default, Heimdall listens on \u003ccode\u003e0.0.0.0:4457\u003c/code\u003e endpoint for incoming requests and also configures useful default timeouts as well as buffer limits. No other options are configured. You can however adjust the configuration for your needs.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThis service exposes the health and the JWKS endpoints.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_configuration\"\u003eConfiguration\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe configuration for of the Management endpoint can be adjusted in the \u003ccode\u003emanagement\u003c/code\u003e property, which lives in the \u003ccode\u003eserve\u003c/code\u003e property of heimdall’s configuration and supports the following properties.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003ehost\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003estring\u003c/em\u003e (optional)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eBy making use of this property, you can specify the TCP/IP address on which heimdall should listen for connections from client applications. The entry \u003ccode\u003e0.0.0.0\u003c/code\u003e allows listening for all IPv4 addresses. \u003ccode\u003e0.0.0.0\u003c/code\u003e is also the default setting.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003eport\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003einteger\u003c/em\u003e (optional)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eBy making use of this property, you can specify the TCP port the heimdall should listen on. Defaults to \u003ccode\u003e4457\u003c/code\u003e.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003etimeout\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003eTimeout\u003c/em\u003e (optional)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eBy using this property you can override the default timeouts used by heimdall. Following properties are supported:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003eidle\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003e\u003ca href=\"/docs/configuration/types/#_duration\"\u003eDuration\u003c/a\u003e\u003c/em\u003e (optional)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe maximum amount of time to wait for the next request when keep-alive is enabled. If set to 0, the value of the \u003ccode\u003eread\u003c/code\u003e timeout is used. Defaults to 2 minutes.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003eread\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003e\u003ca href=\"/docs/configuration/types/#_duration\"\u003eDuration\u003c/a\u003e\u003c/em\u003e (optional)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe absolute amount of time allowed to read the entire request, including body. Defaults to 5 seconds. Setting this property to 0s will disable the timeout.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003ewrite\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003e\u003ca href=\"/docs/configuration/types/#_duration\"\u003eDuration\u003c/a\u003e\u003c/em\u003e (optional)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe maximum duration before timing out writes of the response. Defaults to 10 seconds. Setting this property to 0s will disable the timeout.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003ebuffer_limit\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003eBufferLimit\u003c/em\u003e (optional)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eBuffer limits for inbound requests and outbound responses. Following configuration properties are supported:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003eread\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003e\u003ca href=\"/docs/configuration/types/#_bytesize\"\u003eByteSize\u003c/a\u003e\u003c/em\u003e (optional)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe maximum size for the read buffer allowed to read the full request including body. Defaults to 4KB.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003ewrite\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003e\u003ca href=\"/docs/configuration/types/#_bytesize\"\u003eByteSize\u003c/a\u003e\u003c/em\u003e (optional)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe maximum size for the write buffer of the response. Defaults to 4KB.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003ecors\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003e\u003ca href=\"/docs/configuration/types/#_cors\"\u003eCORS\u003c/a\u003e\u003c/em\u003e (optional)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e\u003ca href=\"https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS\"\u003eCORS\u003c/a\u003e (Cross-Origin Resource Sharing) headers can be added and configured by making use of this option. This functionality allows for advanced security features to quickly be set.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003etls\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003e\u003ca href=\"/docs/configuration/types/#_tls\"\u003eTLS\u003c/a\u003e\u003c/em\u003e (optional)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eBy default, the Management endpoint accepts HTTP requests. Depending on your deployment scenario, you could require Heimdall to accept HTTPs requests only (which is highly recommended). You can do so by making use of this option.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"exampleblock\"\u003e\n\u003cdiv class=\"title\"\u003eExample 1. Complex management service configuration.\u003c/div\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"yaml\"\u003e\u003cspan class=\"na\"\u003emanagement\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"na\"\u003ehost\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e127.0.0.1\u003c/span\u003e\n  \u003cspan class=\"na\"\u003etls\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"na\"\u003ekey_store\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"na\"\u003epath\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e/path/to/keystore.pem\u003c/span\u003e\n      \u003cspan class=\"na\"\u003epassword\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eVerySecure!\u003c/span\u003e\n  \u003cspan class=\"na\"\u003etimeout\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"na\"\u003eread\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e1s\u003c/span\u003e\n    \u003cspan class=\"na\"\u003ewrite\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e2s\u003c/span\u003e\n    \u003cspan class=\"na\"\u003eidle\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e30s\u003c/span\u003e\n  \u003cspan class=\"na\"\u003ebuffer_limit\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"na\"\u003eread\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e4KB\u003c/span\u003e\n    \u003cspan class=\"na\"\u003ewrite\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e10KB\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n","sections":["Services"],"tags":null,"title":"Management Service","url":"/docs/services/management/"},{"categories":null,"content":" As described in Concepts section, mechanisms must be defined and configured before these can be used in rules. That is happening in the so-called mechanisms catalogue. On start up heimdall instantiates all defined and configured mechanisms and makes these available for usage in rules.\nCatalogue Configuration The corresponding mechanisms catalogue resides under the mechanisms property of heimdall static configuration and is organized based on mechanism categories as also shown in the snippet below.\nmechanisms: authenticators: \u0026lt;list of authenticator definitions\u0026gt; authorizers: \u0026lt;list of authorizer definitions\u0026gt; contextualizers: \u0026lt;list of contextualizer definitions\u0026gt; finalizers: \u0026lt;list of finalizer definitions\u0026gt; error_handlers: \u0026lt;list of error handler definitions\u0026gt; General Mechanism Configuration Each mechanism definition entry in the catalogue contains the following properties:\nid - A mandatory unique identifier of the mechanism. Identifiers are used to reference the required mechanism within a rule, respectively its pipelines. You can choose whatever identifier, you want. It is just a name. It must however be unique across all defined mechanisms of a particular mechanism category (like authenticator, authorizer, etc.).\ntype - The mandatory specific type of the mechanism in the given category.\nconfig - The mechanism’s specific configuration if required by the type.\nEvery mechanism type can be configured as many times as needed. However, for those, which don’t have a configuration, it doesn’t really make sense, as all of them would behave the same way.\nFor example, your authenticator definitions could look like this:\nmechanisms: authenticators: - id: anon1 type: anonymous - id: anon2 type: anonymous - id: anon3 type: anonymous config: subject: anon - id: anon4 type: anonymous config: subject: bla The above snippet configures four different instances of the anonymous authenticator mechanism, with anon1 and anon2 being configured identically (as no configuration is provided), and anon3 and anon4 being different in their configuration. Since the first two mentioned behave the same way (both will set the Subject ID to anonymous), there is actually no need to define two instances of them.\nExample Here is an example which defines a mechanism catalogue using some of the available types:\nmechanisms: authenticators: - id: anon_authn type: anonymous - id: opaque_auth_token_authn type: oauth2_introspection config: introspection_endpoint: url: http://hydra:4445/oauth2/introspect assertions: issuers: - http://127.0.0.1:4444/ authorizers: - id: deny_all_authz type: deny - id: local_authz type: cel config: expressions: - expression: \u0026#34;manager\u0026#34; in Subject.Attributes.groups message: user is not in the expected group contextualizers: - id: group_manager type: generic config: endpoint: url: http://group-manager.local/groups method: GET forward_headers: - Authorization cache_ttl: 1m finalizers: - id: jwt_finalizer type: jwt config: ttl: 5m claims: | { {{ $user_name := .Subject.Attributes.identity.user_name -}} \u0026#34;email\u0026#34;: {{ quote .Subject.Attributes.identity.email }}, \u0026#34;email_verified\u0026#34;: {{ .Subject.Attributes.identity.email_verified }}, {{ if $user_name -}} \u0026#34;name\u0026#34;: {{ quote $user_name }} {{ else -}} \u0026#34;name\u0026#34;: {{ quote $email }} {{ end -}} } error_handlers: - id: default type: default - id: authenticate_with_kratos if: | type(Error) in [authentication_error, authorization_error] \u0026amp;\u0026amp; Request.Header(\u0026#34;Accept\u0026#34;).contains(\u0026#34;text/html\u0026#34;) type: redirect config: to: http://127.0.0.1:4433/self-service/login/browser?return_to={{ .Request.URL | urlenc }} ","description":"Defines and configures those mechanisms, which should be available for usage in rules.","html_content":"\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eAs described in \u003ca href=\"/docs/concepts/mechanisms/\"\u003eConcepts\u003c/a\u003e section, mechanisms must be defined and configured before these can be used in rules. That is happening in the so-called mechanisms catalogue. On start up heimdall instantiates all defined and configured mechanisms and makes these available for usage in rules.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_catalogue_configuration\"\u003eCatalogue Configuration\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe corresponding mechanisms catalogue resides under the \u003ccode\u003emechanisms\u003c/code\u003e property of heimdall static configuration and is organized based on mechanism categories as also shown in the snippet below.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"yaml\"\u003e\u003cspan class=\"na\"\u003emechanisms\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eauthenticators\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"s\"\u003e\u0026lt;list of authenticator definitions\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eauthorizers\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"s\"\u003e\u0026lt;list of authorizer definitions\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"na\"\u003econtextualizers\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"s\"\u003e\u0026lt;list of contextualizer definitions\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"na\"\u003efinalizers\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"s\"\u003e\u0026lt;list of finalizer definitions\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eerror_handlers\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"s\"\u003e\u0026lt;list of error handler definitions\u0026gt;\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_general_mechanism_configuration\"\u003eGeneral Mechanism Configuration\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eEach mechanism definition entry in the catalogue contains the following properties:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003eid\u003c/code\u003e - A mandatory unique identifier of the mechanism. Identifiers are used to reference the required mechanism within a rule, respectively its pipelines. You can choose whatever identifier, you want. It is just a name. It must however be unique across all defined mechanisms of a particular mechanism category (like authenticator, authorizer, etc.).\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003etype\u003c/code\u003e - The mandatory specific type of the mechanism in the given category.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003econfig\u003c/code\u003e - The mechanism’s specific configuration if required by the type.\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eEvery mechanism type can be configured as many times as needed. However, for those, which don’t have a configuration, it doesn’t really make sense, as all of them would behave the same way.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eFor example, your authenticator definitions could look like this:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"yaml\"\u003e\u003cspan class=\"na\"\u003emechanisms\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eauthenticators\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eid\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eanon1\u003c/span\u003e\n    \u003cspan class=\"na\"\u003etype\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eanonymous\u003c/span\u003e\n  \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eid\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eanon2\u003c/span\u003e\n    \u003cspan class=\"na\"\u003etype\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eanonymous\u003c/span\u003e\n  \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eid\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eanon3\u003c/span\u003e\n    \u003cspan class=\"na\"\u003etype\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eanonymous\u003c/span\u003e\n    \u003cspan class=\"na\"\u003econfig\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"na\"\u003esubject\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eanon\u003c/span\u003e\n  \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eid\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eanon4\u003c/span\u003e\n    \u003cspan class=\"na\"\u003etype\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eanonymous\u003c/span\u003e\n    \u003cspan class=\"na\"\u003econfig\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"na\"\u003esubject\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ebla\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe above snippet configures four different instances of the anonymous authenticator mechanism, with \u003ccode\u003eanon1\u003c/code\u003e and \u003ccode\u003eanon2\u003c/code\u003e being configured identically (as no configuration is provided), and \u003ccode\u003eanon3\u003c/code\u003e and \u003ccode\u003eanon4\u003c/code\u003e being different in their configuration. Since the first two mentioned behave the same way (both will set the Subject ID to \u003ccode\u003eanonymous\u003c/code\u003e), there is actually no need to define two instances of them.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_example\"\u003eExample\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eHere is an example which defines a mechanism catalogue using some of the available types:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"yaml\"\u003e\u003cspan class=\"na\"\u003emechanisms\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eauthenticators\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eid\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eanon_authn\u003c/span\u003e\n    \u003cspan class=\"na\"\u003etype\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eanonymous\u003c/span\u003e\n  \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eid\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eopaque_auth_token_authn\u003c/span\u003e\n    \u003cspan class=\"na\"\u003etype\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eoauth2_introspection\u003c/span\u003e\n    \u003cspan class=\"na\"\u003econfig\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"na\"\u003eintrospection_endpoint\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"na\"\u003eurl\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ehttp://hydra:4445/oauth2/introspect\u003c/span\u003e\n    \u003cspan class=\"na\"\u003eassertions\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"na\"\u003eissuers\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003ehttp://127.0.0.1:4444/\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eauthorizers\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eid\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003edeny_all_authz\u003c/span\u003e\n    \u003cspan class=\"na\"\u003etype\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003edeny\u003c/span\u003e\n  \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eid\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003elocal_authz\u003c/span\u003e\n    \u003cspan class=\"na\"\u003etype\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ecel\u003c/span\u003e\n    \u003cspan class=\"na\"\u003econfig\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"na\"\u003eexpressions\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eexpression\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"s\"\u003emanager\u0026#34;\u003c/span\u003e \u003cspan class=\"s\"\u003ein Subject.Attributes.groups\u003c/span\u003e\n          \u003cspan class=\"na\"\u003emessage\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003euser is not in the expected group\u003c/span\u003e\n  \u003cspan class=\"na\"\u003econtextualizers\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eid\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003egroup_manager\u003c/span\u003e\n    \u003cspan class=\"na\"\u003etype\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003egeneric\u003c/span\u003e\n    \u003cspan class=\"na\"\u003econfig\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"na\"\u003eendpoint\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"na\"\u003eurl\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ehttp://group-manager.local/groups\u003c/span\u003e\n        \u003cspan class=\"na\"\u003emethod\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eGET\u003c/span\u003e\n      \u003cspan class=\"na\"\u003eforward_headers\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003eAuthorization\u003c/span\u003e\n      \u003cspan class=\"na\"\u003ecache_ttl\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e1m\u003c/span\u003e\n  \u003cspan class=\"na\"\u003efinalizers\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eid\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ejwt_finalizer\u003c/span\u003e\n    \u003cspan class=\"na\"\u003etype\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ejwt\u003c/span\u003e\n    \u003cspan class=\"na\"\u003econfig\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"na\"\u003ettl\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e5m\u003c/span\u003e\n      \u003cspan class=\"na\"\u003eclaims\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"pi\"\u003e|\u003c/span\u003e\n          \u003cspan class=\"s\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"s\"\u003e{{ $user_name := .Subject.Attributes.identity.user_name -}}\u003c/span\u003e\n            \u003cspan class=\"s\"\u003e\u0026#34;email\u0026#34;: {{ quote .Subject.Attributes.identity.email }},\u003c/span\u003e\n            \u003cspan class=\"s\"\u003e\u0026#34;email_verified\u0026#34;: {{ .Subject.Attributes.identity.email_verified }},\u003c/span\u003e\n            \u003cspan class=\"s\"\u003e{{ if $user_name -}}\u003c/span\u003e\n            \u003cspan class=\"s\"\u003e\u0026#34;name\u0026#34;: {{ quote $user_name }}\u003c/span\u003e\n            \u003cspan class=\"s\"\u003e{{ else -}}\u003c/span\u003e\n            \u003cspan class=\"s\"\u003e\u0026#34;name\u0026#34;: {{ quote $email }}\u003c/span\u003e\n            \u003cspan class=\"s\"\u003e{{ end -}}\u003c/span\u003e\n          \u003cspan class=\"s\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eerror_handlers\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eid\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003edefault\u003c/span\u003e\n    \u003cspan class=\"na\"\u003etype\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003edefault\u003c/span\u003e\n  \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eid\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eauthenticate_with_kratos\u003c/span\u003e\n    \u003cspan class=\"na\"\u003eif\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"pi\"\u003e|\u003c/span\u003e\n      \u003cspan class=\"s\"\u003etype(Error) in [authentication_error, authorization_error] \u0026amp;\u0026amp;\u003c/span\u003e\n      \u003cspan class=\"s\"\u003eRequest.Header(\u0026#34;Accept\u0026#34;).contains(\u0026#34;text/html\u0026#34;)\u003c/span\u003e\n    \u003cspan class=\"na\"\u003etype\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eredirect\u003c/span\u003e\n    \u003cspan class=\"na\"\u003econfig\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"na\"\u003eto\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ehttp://127.0.0.1:4433/self-service/login/browser?return_to={{ .Request.URL | urlenc }}\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n","sections":["Mechanisms"],"tags":null,"title":"Catalogue","url":"/docs/mechanisms/catalogue/"},{"categories":null,"content":" E.g. in one case, you want to have access to a particular request header. In another case you would like to add specific data to the resulting JWT created by heimdall. And in yet another case, you may want to check whether some expectations apply. These capabilities are described on this page.\nObjects Objects represent state in the execution of a particular rule. These are the entities, either created or used by particular mechanisms and can represent things, like the actual request, the authenticated subject of the request and many more.\nSubject This object contains the information about the authenticated subject and has the following attributes:\nID: string\nThe identifier of the subject. This value is set by the authenticator, which was able to authenticate the subject.\nAttributes: map\nContains all attributes, which are known about the subject. The content is initially set by the authenticator, which was able to authenticate the subject. Mechanisms in the following stages can update it, but cannot override any entries.\nEach object of this type can be thought as a JSON object. Here some examples:\nExample 1. Subject created by an Anonymous Authenticator Subject = { ID: \u0026#34;anonymous\u0026#34;, Attributes: {} } Example 2. Possible Subject created by an OAuth2 Authenticator Subject = { ID: \u0026#34;foobar\u0026#34;, Attributes: { \u0026#34;sub\u0026#34;: \u0026#34;foobar\u0026#34;, \u0026#34;exp\u0026#34;: \u0026#34;1670600805\u0026#34;, \u0026#34;jti\u0026#34;: \u0026#34;7b91ed8a-0251-4e02-8d51-9792785851e8\u0026#34;, \u0026#34;iat\u0026#34;: \u0026#34;1670600305\u0026#34;, \u0026#34;iss\u0026#34;: \u0026#34;http://testauthserver.local\u0026#34;, \u0026#34;nbf\u0026#34;: \u0026#34;1670600305\u0026#34;, \u0026#34;extra\u0026#34;: { \u0026#34;foo\u0026#34;: [\u0026#34;bar\u0026#34;, \u0026#34;baz\u0026#34;] } } } Request This object contains information about the request handled by heimdall and has the following attributes and methods:\nMethod: string\nThe HTTP method used, like GET, POST, etc.\nURL: URL\nThe URL of the matched request. This object has the following properties and methods:\nScheme: string\nThe HTTP scheme part of the url\nHost: string\nThe host part of the url\nPath: string\nThe path part of the url\nRawQuery: string\nThe raw query part of the url.\nString(): method\nThis method returns the URL as valid URL string of a form scheme:host/path?query.\nQuery(): method\nThe parsed query with each key-value pair being a string to array of strings mapping.\nClientIPAddresses: string array\nThe list of IP addresses the request passed through with the first entry being the ultimate client of the request. Only available if heimdall is configured to trust the client, sending this information, e.g. in the X-Forwarded-From header (see e.g. Decision Service trusted_proxies configuration for more details).\nHeader(name): method,\nThis method expects the name of a header as input and returns its value as a string. If the header is not present in the HTTP request an empty string (\u0026#34;\u0026#34;) is returned. If a header appears multiple times in the request, the returned string is a comma separated list of all values.\nA single header may be a comma separated list of actual values as well. Best example is the Accept header, which might be set to e.g. text/html,application/xhtml+xml,application/xml;q=0.9,/;q=0.8). Cookie(name): method,\nThis method expects the name of a cookie as input and returns the value of it as string. If the cookie is not present in the HTTP request an empty string (\u0026#34;\u0026#34;) is returned.\nBody(): method,\nThe parsed body with contents depending on the Content-Type header. Supported content types are any MIME types with json or yaml subtype, as well as application/x-www-form-urlencoded. If MIME type is unsupported, the method returns a string with the actual body contents.\nThe actual request body is parsed only on the first use of this function. All subsequent calls return the cached result. Example 3. Example results If the Content-Type header is set to application/json and the actual request body is a valid JSON object, shown below\n{ \u0026#34;context\u0026#34;: \u0026#34;heimdall\u0026#34; } The call to the Body() function will return exactly this representation as a map.\nIf the Content-Type header is set to application/yaml and the actual request body is a valid YAML object, shown below\ncontext: heimdall The call to the Body() function will return { \u0026#34;context\u0026#34;: \u0026#34;heimdall\u0026#34; } representation as a map.\nIf the Content-Type header is set to application/x-www-form-urlencoded and the actual request body is a valid object, shown below\ncontext=heimdall The call to the Body() function will return this representation as a map with each value being a string array. In this particular case as { \u0026#34;context\u0026#34;: [ \u0026#34;heimdall\u0026#34; ] }.\nHere is an example for a request object:\nExample 4. Example request object Request = { Method: \u0026#34;GET\u0026#34;, Url: { Scheme: \u0026#34;https\u0026#34;, Host: \u0026#34;localhost\u0026#34;, Path: \u0026#34;/test\u0026#34;, RawQuery: \u0026#34;baz=zab\u0026amp;baz=bar\u0026amp;foo=bar\u0026#34; }, ClientIP: [\u0026#34;127.0.0.1\u0026#34;, \u0026#34;10.10.10.10\u0026#34;] } Payload This object represents the contents of a payload, like the request body or a response body. The contents depend on the MIME-Type of the payload. For json, yaml or x-www-form-urlencoded encoded payload, the object is transformed to a JSON object. Otherwise, it is just a string.\nHere some examples:\nExample 5. Structured payload The following JSON object is a typical response from OPA.\nPayload = { \u0026#34;result\u0026#34;: true } Example 6. Unstructured payload Payload = \u0026#34;SomeStringValue\u0026#34; Error This object represents an error, which has been raised during the execution of a rule and is available in if CEL expressions of Error Handlers. Following properties are available:\nSource: string\nThe ID of the mechanism, which raised the error.\nProper error handling requires attention to the actual error type available via type(Error).\nValues This object represents a key value map, with both, the key and the value being of string type. Though, the actual values can be templated (see (Templating). The contents and the variables available in templates depend on the configuration of the particular mechanism, respectively the corresponding override in a rule.\nHere is an example:\nExample 7. Example values object Values = { \u0026#34;some-key-1\u0026#34;: \u0026#34;value-1\u0026#34;, \u0026#34;some-key-2\u0026#34;: \u0026#34;value-2\u0026#34; } Templating Some mechanisms support templating using Golang Text Templates. Templates can act on all objects described above (Subject, Request, Payload and Values). Which exactly are supported is mechanism specific.\nTo ease the usage, all sprig functions, except env and expandenv, as well as the following functions are available:\nurlenc - Encodes a given string using url encoding. Is handy if you need to generate request body or query parameters e.g. for communication with further systems.\natIndex - Implements python-like access to arrays and takes as a single argument the index to access the element in the array at. With index being a positive values it works exactly the same way, as with the usage of the build-in index function to access array elements. With negative index value, one can access the array elements from the tail of the array. -1 is the index of the last element, -2 the index of the element before the last one, etc.\nExample: {{ atIndex 2 [1,2,3,4,5] }} evaluates to 3 (behaves the same way as the index function) and {{ atIndex -2 [1,2,3,4,5] }} evaluates to 4.\nsplitList - Splits a given string using a separator (part of the sprig library, but not documented). The result is a string array.\nExample: {{ splitList \u0026#34;/\u0026#34; \u0026#34;/foo/bar\u0026#34; }} evaluates to the [\u0026#34;\u0026#34;, \u0026#34;foo\u0026#34;, \u0026#34;bar\u0026#34;] array.\nExample 8. Rendering a JSON object Imagine, we have a POST request for the URL http://foobar.baz/zab?foo=bar, with a header X-Foo set to bar value, for which heimdall was able to identify a subject, with ID=foo and which Attributes contain an entry email: foo@bar, then you can generate a JSON object with this information with the following template:\n{ \u0026#34;subject_id\u0026#34;: {{ quote .Subject.ID }}, \u0026#34;email\u0026#34;: {{ quote .Subject.Attributes.email }}, \u0026#34;request_url\u0026#34;: {{ quote .Request.URL }}, \u0026#34;foo_value\u0026#34;: {{ index .Request.URL.Query.foo 0 | quote }} \u0026#34;request_method\u0026#34;: {{ quote .Request.Method }}, \u0026#34;x_foo_value\u0026#34;: {{ .Request.Header \u0026#34;X-Foo\u0026#34; | quote }} } Please note how the access to the foo query parameter is done. Since .Request.URL.Query.foo returns an array of strings, the first element is taken to render the value for the foo_value key.\nThis will result in the following JSON object:\n{ \u0026#34;subject_id\u0026#34;: \u0026#34;foo\u0026#34;, \u0026#34;email\u0026#34;: \u0026#34;foo@bar.baz\u0026#34;, \u0026#34;request_url\u0026#34;: \u0026#34;http://foobar.baz/zab?foo=bar\u0026#34;, \u0026#34;foo_value\u0026#34;: \u0026#34;bar\u0026#34;, \u0026#34;request_method\u0026#34;: \u0026#34;POST\u0026#34;, \u0026#34;x_foo_value\u0026#34;: \u0026#34;bar\u0026#34; } Example 9. Access the last part of the path Imagine, we have a POST request to the URL http://foobar.baz/zab/1234, with 1234 being the identifier of a file, which should be updated with the contents sent in the body of the request, and you would like to control access to the aforesaid object using e.g. OpenFGA. This can be achieved with the following authorizer:\nid: openfga_authorizer type: remote config: endpoint: url: https://openfga/stores/files/check payload: | { \u0026#34;user\u0026#34;: \u0026#34;user:{{ .Subject.ID }}\u0026#34;, \u0026#34;relation\u0026#34;: \u0026#34;write\u0026#34;, \u0026#34;object\u0026#34;: \u0026#34;file:{{ splitList \u0026#34;/\u0026#34; .Request.URL.Path | last }}\u0026#34; } expressions: - expression: | Payload.allowed == true Please note how the \u0026#34;object\u0026#34; is set in the payload property above. When the payload template is rendered and for the above said request heimdall was able to identify the subject with ID=foo, following JSON object will be created:\n{ \u0026#34;user\u0026#34;: \u0026#34;user:foo\u0026#34;, \u0026#34;relation\u0026#34;: \u0026#34;write\u0026#34;, \u0026#34;object\u0026#34;: \u0026#34;file:1234\u0026#34; } You can find further examples as part of mechanism descriptions, supporting templating.\nExpressions Expressions can be used to execute conditional logic. As of today only CEL is supported as expression language. All standard, as well as extension functions are available. Which of the evaluation objects are available to the expression depends on the mechanism.\nIn addition to the build-in, respectively extension methods and functions, as well as the methods available on the evaluation objects, following functions are available as well:\nsplit - this function works on strings and expects a separator as a single argument. The result is a string array.\nExample: \u0026#34;/foo/bar/baz\u0026#34;.split(\u0026#34;/\u0026#34;) returns [\u0026#34;\u0026#34;, \u0026#34;foo\u0026#34;, \u0026#34;bar\u0026#34;, \u0026#34;baz\u0026#34;].\nregexFind - this function returns the first (left most) match of a regular expression in the given string.\nExample: \u0026#34;abcd1234\u0026#34;.regexFind(\u0026#34;[a-zA-Z][1-9]\u0026#34;) returns \u0026#34;d1\u0026#34;.\nregexFindAll - this function returns an array of all matches of a regular expression in the given string.\nExample: \u0026#34;123456789\u0026#34;.regexFindAll(\u0026#34;[2,4,6,8]\u0026#34;) returns [\u0026#34;2\u0026#34;,\u0026#34;4\u0026#34;,\u0026#34;6\u0026#34;,\u0026#34;8\u0026#34;].\nat - this function implements python-like access to arrays and takes as a single argument the index to access the element in the array at. With index being a positive values it works exactly the same way, as with the usage of [] to access array elements. With negative index value, one can access the array elements from the tail of the array. -1 is the index of the last element, -2 the index of the element before the last one, etc.\nExample: [1,2,3,4,5].at(2) returns 3 and [1,2,3,4,5].at(-2) returns 4.\nlast - this function works on arrays and returns the last element of an array or nil if the array is empty.\nExample: [1,2,3,4,5].last() returns 5\nSome examples:\nExample 10. Evaluate Payload object Given the following Payload object\nPayload = { \u0026#34;result\u0026#34;: true } a CEL expression to check whether the result attribute is set to true, would look as follows:\nPayload.result == true Example 11. Check whether the user is member of the admin group has(Subject.Attributes.groups) \u0026amp;\u0026amp; Subject.Attributes.groups.exists(g, g == \u0026#34;admin\u0026#34;) Example 12. Access the last path part of the matched URL Request.URL.Path.split(\u0026#34;/\u0026#34;).last() Example 13. Check if an error has been raised by an authenticator with the ID \u0026#34;foo\u0026#34; type(Error) == authentication_error \u0026amp;\u0026amp; Error.Source == \u0026#34;foo\u0026#34; ","description":"The dynamic nature of mechanisms is given by the ability to work on different objects and making use of templates and expressions to implement different use cases.","html_content":"\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eE.g. in one case, you want to have access to a particular request header. In another case you would like to add specific data to the resulting JWT created by heimdall. And in yet another case, you may want to check whether some expectations apply. These capabilities are described on this page.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_objects\"\u003eObjects\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eObjects represent state in the execution of a particular rule. These are the entities, either created or used by particular mechanisms and can represent things, like the actual request, the authenticated subject of the request and many more.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_subject\"\u003eSubject\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThis object contains the information about the authenticated subject and has the following attributes:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003eID\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003estring\u003c/em\u003e\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe identifier of the subject. This value is set by the authenticator, which was able to authenticate the subject.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003eAttributes\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003emap\u003c/em\u003e\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eContains all attributes, which are known about the subject. The content is initially set by the authenticator, which was able to authenticate the subject. Mechanisms in the following stages can update it, but cannot override any entries.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eEach object of this type can be thought as a JSON object. Here some examples:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"exampleblock\"\u003e\n\u003cdiv class=\"title\"\u003eExample 1. Subject created by an Anonymous Authenticator\u003c/div\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"javascript\"\u003e\u003cspan class=\"nx\"\u003eSubject\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eID\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"dl\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"s2\"\u003eanonymous\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eAttributes\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"exampleblock\"\u003e\n\u003cdiv class=\"title\"\u003eExample 2. Possible Subject created by an OAuth2 Authenticator\u003c/div\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"javascript\"\u003e\u003cspan class=\"nx\"\u003eSubject\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eID\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"dl\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"s2\"\u003efoobar\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eAttributes\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"dl\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"s2\"\u003esub\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"dl\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"s2\"\u003efoobar\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"dl\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"s2\"\u003eexp\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"dl\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"s2\"\u003e1670600805\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"dl\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"s2\"\u003ejti\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"dl\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"s2\"\u003e7b91ed8a-0251-4e02-8d51-9792785851e8\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"dl\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"s2\"\u003eiat\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"dl\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"s2\"\u003e1670600305\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"dl\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"s2\"\u003eiss\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"dl\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"s2\"\u003ehttp://testauthserver.local\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"dl\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"s2\"\u003enbf\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"dl\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"s2\"\u003e1670600305\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"dl\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"s2\"\u003eextra\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"dl\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"s2\"\u003efoo\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"s2\"\u003ebar\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"dl\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"s2\"\u003ebaz\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_request\"\u003eRequest\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThis object contains information about the request handled by heimdall and has the following attributes and methods:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003eMethod\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003estring\u003c/em\u003e\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe HTTP method used, like \u003ccode\u003eGET\u003c/code\u003e, \u003ccode\u003ePOST\u003c/code\u003e, etc.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003eURL\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003eURL\u003c/em\u003e\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe URL of the matched request. This object has the following properties and methods:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003eScheme\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003estring\u003c/em\u003e\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe HTTP scheme part of the url\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003eHost\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003estring\u003c/em\u003e\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe host part of the url\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003ePath\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003estring\u003c/em\u003e\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe path part of the url\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003eRawQuery\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003estring\u003c/em\u003e\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe raw query part of the url.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003eString()\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003emethod\u003c/em\u003e\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThis method returns the URL as valid URL string of a form \u003ccode\u003escheme:host/path?query\u003c/code\u003e.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003eQuery()\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003emethod\u003c/em\u003e\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe parsed query with each key-value pair being a string to array of strings mapping.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003eClientIPAddresses\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003estring array\u003c/em\u003e\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe list of IP addresses the request passed through with the first entry being the ultimate client of the request. Only available if heimdall is configured to trust the client, sending this information, e.g. in the \u003ccode\u003eX-Forwarded-From\u003c/code\u003e header (see e.g. Decision Service \u003ca href=\"/docs/services/decision/#_trusted_proxies\"\u003etrusted_proxies\u003c/a\u003e configuration for more details).\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003eHeader(name)\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003emethod\u003c/em\u003e,\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThis method expects the name of a header as input and returns its value as a \u003ccode\u003estring\u003c/code\u003e. If the header is not present in the HTTP request an empty string (\u003ccode\u003e\u0026#34;\u0026#34;\u003c/code\u003e) is returned. If a header appears multiple times in the request, the returned \u003ccode\u003estring\u003c/code\u003e is a comma separated list of all values.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"admonitionblock note\"\u003e\n\u003ctable\u003e\n\u003ctbody\u003e\u003ctr\u003e\n\u003ctd class=\"icon\"\u003e\n\u003ci class=\"fa icon-note\" title=\"Note\"\u003e\u003c/i\u003e\n\u003c/td\u003e\n\u003ctd class=\"content\"\u003e\nA single header may be a comma separated list of actual values as well. Best example is the \u003ccode\u003eAccept\u003c/code\u003e header, which might be set to e.g. \u003ccode\u003etext/html,application/xhtml+xml,application/xml;q=0.9,\u003cstrong\u003e/\u003c/strong\u003e;q=0.8\u003c/code\u003e).\n\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003eCookie(name)\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003emethod\u003c/em\u003e,\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThis method expects the name of a cookie as input and returns the value of it as \u003ccode\u003estring\u003c/code\u003e. If the cookie is not present in the HTTP request an empty string (\u003ccode\u003e\u0026#34;\u0026#34;\u003c/code\u003e) is returned.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003eBody()\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003emethod\u003c/em\u003e,\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe parsed body with contents depending on the \u003ccode\u003eContent-Type\u003c/code\u003e header. Supported content types are any MIME types with \u003ccode\u003ejson\u003c/code\u003e or \u003ccode\u003eyaml\u003c/code\u003e subtype, as well as \u003ccode\u003eapplication/x-www-form-urlencoded\u003c/code\u003e. If MIME type is unsupported, the method returns a string with the actual body contents.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"admonitionblock note\"\u003e\n\u003ctable\u003e\n\u003ctbody\u003e\u003ctr\u003e\n\u003ctd class=\"icon\"\u003e\n\u003ci class=\"fa icon-note\" title=\"Note\"\u003e\u003c/i\u003e\n\u003c/td\u003e\n\u003ctd class=\"content\"\u003e\nThe actual request body is parsed only on the first use of this function. All subsequent calls return the cached result.\n\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003cdiv class=\"exampleblock\"\u003e\n\u003cdiv class=\"title\"\u003eExample 3. Example results\u003c/div\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eIf the \u003ccode\u003eContent-Type\u003c/code\u003e header is set to \u003ccode\u003eapplication/json\u003c/code\u003e and the actual request body is a valid JSON object, shown below\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"json\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;context\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;heimdall\u0026#34;\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe call to the \u003ccode\u003eBody()\u003c/code\u003e function will return exactly this representation as a map.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eIf the \u003ccode\u003eContent-Type\u003c/code\u003e header is set to \u003ccode\u003eapplication/yaml\u003c/code\u003e and the actual request body is a valid YAML object, shown below\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"yaml\"\u003e\u003cspan class=\"na\"\u003econtext\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eheimdall\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe call to the \u003ccode\u003eBody()\u003c/code\u003e function will return \u003ccode\u003e{ \u0026#34;context\u0026#34;: \u0026#34;heimdall\u0026#34; }\u003c/code\u003e representation as a map.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eIf the \u003ccode\u003eContent-Type\u003c/code\u003e header is set to \u003ccode\u003eapplication/x-www-form-urlencoded\u003c/code\u003e and the actual request body is a valid object, shown below\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"yaml\"\u003e\u003cspan class=\"s\"\u003econtext=heimdall\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe call to the \u003ccode\u003eBody()\u003c/code\u003e function will return this representation as a map with each value being a string array. In this particular case as \u003ccode\u003e{ \u0026#34;context\u0026#34;: [ \u0026#34;heimdall\u0026#34; ] }\u003c/code\u003e.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eHere is an example for a request object:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"exampleblock\"\u003e\n\u003cdiv class=\"title\"\u003eExample 4. Example request object\u003c/div\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"javascript\"\u003e\u003cspan class=\"nx\"\u003eRequest\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eMethod\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"dl\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"s2\"\u003eGET\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eUrl\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"na\"\u003eScheme\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"dl\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"s2\"\u003ehttps\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"na\"\u003eHost\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"dl\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"s2\"\u003elocalhost\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"na\"\u003ePath\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"dl\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"s2\"\u003e/test\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"na\"\u003eRawQuery\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"dl\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"s2\"\u003ebaz=zab\u0026amp;baz=bar\u0026amp;foo=bar\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#34;\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eClientIP\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"s2\"\u003e127.0.0.1\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"dl\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"s2\"\u003e10.10.10.10\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_payload\"\u003ePayload\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThis object represents the contents of a payload, like the request body or a response body. The contents depend on the MIME-Type of the payload. For \u003ccode\u003ejson\u003c/code\u003e, \u003ccode\u003eyaml\u003c/code\u003e or \u003ccode\u003ex-www-form-urlencoded\u003c/code\u003e encoded payload, the object is transformed to a JSON object. Otherwise, it is just a string.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eHere some examples:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"exampleblock\"\u003e\n\u003cdiv class=\"title\"\u003eExample 5. Structured payload\u003c/div\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe following JSON object is a typical response from OPA.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"javascript\"\u003e\u003cspan class=\"nx\"\u003ePayload\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"dl\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"s2\"\u003eresult\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003etrue\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"exampleblock\"\u003e\n\u003cdiv class=\"title\"\u003eExample 6. Unstructured payload\u003c/div\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"javascript\"\u003e\u003cspan class=\"nx\"\u003ePayload\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"dl\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"s2\"\u003eSomeStringValue\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#34;\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_error\"\u003eError\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThis object represents an error, which has been raised during the execution of a rule and is available in \u003ccode\u003eif\u003c/code\u003e \u003ca href=\"#_expressions\"\u003eCEL expressions\u003c/a\u003e of \u003ca href=\"/docs/mechanisms/error_handlers/\"\u003eError Handlers\u003c/a\u003e. Following properties are available:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003eSource\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003estring\u003c/em\u003e\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe ID of the mechanism, which raised the error.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eProper error handling requires attention to the actual \u003cem\u003e\u003ca href=\"/docs/configuration/types/#_errorstate_type\"\u003eerror type\u003c/a\u003e\u003c/em\u003e available via \u003ccode\u003etype(Error)\u003c/code\u003e.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_values\"\u003eValues\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThis object represents a key value map, with both, the key and the value being of string type. Though, the actual values can be templated (see (\u003ca href=\"#_templating\"\u003eTemplating\u003c/a\u003e). The contents and the variables available in templates depend on the configuration of the particular mechanism, respectively the corresponding override in a rule.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eHere is an example:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"exampleblock\"\u003e\n\u003cdiv class=\"title\"\u003eExample 7. Example values object\u003c/div\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"javascript\"\u003e\u003cspan class=\"nx\"\u003eValues\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"dl\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"s2\"\u003esome-key-1\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"dl\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"s2\"\u003evalue-1\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"dl\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"s2\"\u003esome-key-2\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"dl\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"s2\"\u003evalue-2\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#34;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_templating\"\u003eTemplating\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eSome mechanisms support templating using \u003ca href=\"https://golang.org/pkg/text/template/\"\u003eGolang Text Templates\u003c/a\u003e. Templates can act on all objects described above (\u003ca href=\"#_subject\"\u003eSubject\u003c/a\u003e, \u003ca href=\"#_request\"\u003eRequest\u003c/a\u003e, \u003ca href=\"#_payload\"\u003ePayload\u003c/a\u003e and \u003ca href=\"#_values\"\u003eValues\u003c/a\u003e). Which exactly are supported is mechanism specific.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eTo ease the usage, all \u003ca href=\"http://masterminds.github.io/sprig/\"\u003esprig\u003c/a\u003e functions, except \u003ccode\u003eenv\u003c/code\u003e and \u003ccode\u003eexpandenv\u003c/code\u003e, as well as the following functions are available:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003eurlenc\u003c/code\u003e - Encodes a given string using url encoding. Is handy if you need to generate request body or query parameters e.g. for communication with further systems.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003eatIndex\u003c/code\u003e - Implements python-like access to arrays and takes as a single argument the index to access the element in the array at. With index being a positive values it works exactly the same way, as with the usage of the build-in index function to access array elements. With negative index value, one can access the array elements from the tail of the array. -1 is the index of the last element, -2 the index of the element before the last one, etc.\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eExample: \u003ccode\u003e{{ atIndex 2 [1,2,3,4,5] }}\u003c/code\u003e evaluates to \u003ccode\u003e3\u003c/code\u003e (behaves the same way as the \u003ccode\u003eindex\u003c/code\u003e function) and \u003ccode\u003e{{ atIndex -2 [1,2,3,4,5] }}\u003c/code\u003e evaluates to \u003ccode\u003e4\u003c/code\u003e.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003esplitList\u003c/code\u003e - Splits a given string using a separator (part of the sprig library, but not documented). The result is a string array.\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eExample: \u003ccode\u003e{{ splitList \u0026#34;/\u0026#34; \u0026#34;/foo/bar\u0026#34; }}\u003c/code\u003e evaluates to the \u003ccode\u003e[\u0026#34;\u0026#34;, \u0026#34;foo\u0026#34;, \u0026#34;bar\u0026#34;]\u003c/code\u003e array.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"exampleblock\"\u003e\n\u003cdiv class=\"title\"\u003eExample 8. Rendering a JSON object\u003c/div\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eImagine, we have a \u003ccode\u003ePOST\u003c/code\u003e request for the URL \u003ccode\u003ehttp://foobar.baz/zab?foo=bar\u003c/code\u003e, with a header \u003ccode\u003eX-Foo\u003c/code\u003e set to \u003ccode\u003ebar\u003c/code\u003e value, for which heimdall was able to identify a subject, with \u003ccode\u003eID=foo\u003c/code\u003e and which \u003ccode\u003eAttributes\u003c/code\u003e contain an entry \u003ccode\u003eemail: foo@bar\u003c/code\u003e, then you can generate a JSON object with this information with the following template:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"gotemplate\"\u003e{\n  \u0026#34;subject_id\u0026#34;: {{ quote .Subject.ID }},\n  \u0026#34;email\u0026#34;: {{ quote .Subject.Attributes.email }},\n  \u0026#34;request_url\u0026#34;: {{ quote .Request.URL }},\n  \u0026#34;foo_value\u0026#34;: {{ index .Request.URL.Query.foo 0 | quote }}\n  \u0026#34;request_method\u0026#34;: {{ quote .Request.Method }},\n  \u0026#34;x_foo_value\u0026#34;: {{ .Request.Header \u0026#34;X-Foo\u0026#34; | quote }}\n}\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003ePlease note how the access to the \u003ccode\u003efoo\u003c/code\u003e query parameter is done. Since \u003ccode\u003e.Request.URL.Query.foo\u003c/code\u003e returns an array of strings, the first element is taken to render the value for the \u003ccode\u003efoo_value\u003c/code\u003e key.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThis will result in the following JSON object:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"json\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;subject_id\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;foo\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;email\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;foo@bar.baz\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;request_url\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;http://foobar.baz/zab?foo=bar\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;foo_value\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;bar\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;request_method\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;POST\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;x_foo_value\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;bar\u0026#34;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"exampleblock\"\u003e\n\u003cdiv class=\"title\"\u003eExample 9. Access the last part of the path\u003c/div\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eImagine, we have a \u003ccode\u003ePOST\u003c/code\u003e request to the URL \u003ccode\u003ehttp://foobar.baz/zab/1234\u003c/code\u003e, with \u003ccode\u003e1234\u003c/code\u003e being the identifier of a file, which should be updated with the contents sent in the body of the request, and you would like to control access to the aforesaid object using e.g. OpenFGA. This can be achieved with the following authorizer:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"yaml\"\u003e\u003cspan class=\"na\"\u003eid\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eopenfga_authorizer\u003c/span\u003e\n\u003cspan class=\"na\"\u003etype\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eremote\u003c/span\u003e\n\u003cspan class=\"na\"\u003econfig\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eendpoint\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"na\"\u003eurl\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ehttps://openfga/stores/files/check\u003c/span\u003e\n  \u003cspan class=\"na\"\u003epayload\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"pi\"\u003e|\u003c/span\u003e\n    \u003cspan class=\"s\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"s\"\u003e\u0026#34;user\u0026#34;: \u0026#34;user:{{ .Subject.ID }}\u0026#34;,\u003c/span\u003e\n      \u003cspan class=\"s\"\u003e\u0026#34;relation\u0026#34;: \u0026#34;write\u0026#34;,\u003c/span\u003e\n      \u003cspan class=\"s\"\u003e\u0026#34;object\u0026#34;: \u0026#34;file:{{ splitList \u0026#34;/\u0026#34; .Request.URL.Path | last }}\u0026#34;\u003c/span\u003e\n    \u003cspan class=\"s\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eexpressions\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eexpression\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"pi\"\u003e|\u003c/span\u003e\n      \u003cspan class=\"s\"\u003ePayload.allowed == true\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003ePlease note how the \u003ccode\u003e\u0026#34;object\u0026#34;\u003c/code\u003e is set in the \u003ccode\u003epayload\u003c/code\u003e property above. When the \u003ccode\u003epayload\u003c/code\u003e template is rendered and for the above said request heimdall was able to identify the subject with \u003ccode\u003eID=foo\u003c/code\u003e, following JSON object will be created:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"json\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"w\"\u003e\n  \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;user\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;user:foo\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n  \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;relation\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;write\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n  \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;object\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;file:1234\u0026#34;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eYou can find further examples as part of mechanism descriptions, supporting templating.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_expressions\"\u003eExpressions\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eExpressions can be used to execute conditional logic. As of today only \u003ca href=\"https://github.com/google/cel-spec\"\u003eCEL\u003c/a\u003e is supported as expression language. All standard, as well as \u003ca href=\"https://pkg.go.dev/github.com/google/cel-go/ext#pkg-functions\"\u003eextension\u003c/a\u003e functions are available. Which of the \u003ca href=\"#_objects\"\u003eevaluation objects\u003c/a\u003e are available to the expression depends on the mechanism.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eIn addition to the build-in, respectively extension methods and functions, as well as the methods available on the evaluation objects, following functions are available as well:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003esplit\u003c/code\u003e - this function works on strings and expects a separator as a single argument. The result is a string array.\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eExample: \u003ccode\u003e\u0026#34;/foo/bar/baz\u0026#34;.split(\u0026#34;/\u0026#34;)\u003c/code\u003e returns \u003ccode\u003e[\u0026#34;\u0026#34;, \u0026#34;foo\u0026#34;, \u0026#34;bar\u0026#34;, \u0026#34;baz\u0026#34;]\u003c/code\u003e.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003eregexFind\u003c/code\u003e - this function returns the first (left most) match of a regular expression in the given string.\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eExample: \u003ccode\u003e\u0026#34;abcd1234\u0026#34;.regexFind(\u0026#34;[a-zA-Z][1-9]\u0026#34;)\u003c/code\u003e returns \u003ccode\u003e\u0026#34;d1\u0026#34;\u003c/code\u003e.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003eregexFindAll\u003c/code\u003e - this function returns an array of all matches of a regular expression in the given string.\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eExample: \u003ccode\u003e\u0026#34;123456789\u0026#34;.regexFindAll(\u0026#34;[2,4,6,8]\u0026#34;)\u003c/code\u003e returns \u003ccode\u003e[\u0026#34;2\u0026#34;,\u0026#34;4\u0026#34;,\u0026#34;6\u0026#34;,\u0026#34;8\u0026#34;]\u003c/code\u003e.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003eat\u003c/code\u003e - this function implements python-like access to arrays and takes as a single argument the index to access the element in the array at. With index being a positive values it works exactly the same way, as with the usage of \u003ccode\u003e[]\u003c/code\u003e to access array elements. With negative index value, one can access the array elements from the tail of the array. -1 is the index of the last element, -2 the index of the element before the last one, etc.\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eExample: \u003ccode\u003e[1,2,3,4,5].at(2)\u003c/code\u003e returns \u003ccode\u003e3\u003c/code\u003e and \u003ccode\u003e[1,2,3,4,5].at(-2)\u003c/code\u003e returns \u003ccode\u003e4\u003c/code\u003e.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003elast\u003c/code\u003e - this function works on arrays and returns the last element of an array or \u003ccode\u003enil\u003c/code\u003e if the array is empty.\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eExample: \u003ccode\u003e[1,2,3,4,5].last()\u003c/code\u003e returns \u003ccode\u003e5\u003c/code\u003e\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eSome examples:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"exampleblock\"\u003e\n\u003cdiv class=\"title\"\u003eExample 10. Evaluate Payload object\u003c/div\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eGiven the following Payload object\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"javascript\"\u003e\u003cspan class=\"nx\"\u003ePayload\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"dl\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"s2\"\u003eresult\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003etrue\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003ea CEL expression to check whether the \u003ccode\u003eresult\u003c/code\u003e attribute is set to \u003ccode\u003etrue\u003c/code\u003e, would look as follows:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"cel\"\u003ePayload.result == true\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"exampleblock\"\u003e\n\u003cdiv class=\"title\"\u003eExample 11. Check whether the user is member of the admin group\u003c/div\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"cel\"\u003ehas(Subject.Attributes.groups) \u0026amp;\u0026amp;\n   Subject.Attributes.groups.exists(g, g == \u0026#34;admin\u0026#34;)\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"exampleblock\"\u003e\n\u003cdiv class=\"title\"\u003eExample 12. Access the last path part of the matched URL\u003c/div\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"cel\"\u003eRequest.URL.Path.split(\u0026#34;/\u0026#34;).last()\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"exampleblock\"\u003e\n\u003cdiv class=\"title\"\u003eExample 13. Check if an error has been raised by an authenticator with the ID \u0026#34;foo\u0026#34;\u003c/div\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"cel\"\u003etype(Error) == authentication_error \u0026amp;\u0026amp; Error.Source == \u0026#34;foo\u0026#34;\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n","sections":["Mechanisms"],"tags":null,"title":"Objects, Templating \u0026 Co","url":"/docs/mechanisms/evaluation_objects/"},{"categories":null,"content":" Some of the supported authenticator types may support or require additional configuration. The corresponding properties are annotated with mandatory, respectively optional to denote configuration requirement, as well as with overridable, not overriddable and partially overridable to indicate whether the property can be overridden in a rule pipeline.\nUnauthorized This authenticator rejects all requests as unauthenticated (on HTTP response code level this is then mapped to 401 Unauthorized, hence the type name). It basically stops the successful execution of the pipeline resulting in the execution of the error handlers. This authenticator type doesn’t have any configuration options.\nTo enable the usage of this authenticator, you have to set the type property to unauthorized.\nExample 1. Configure Unauthorized authenticator id: foo type: unauthorized Anonymous This authenticator just creates a Subject object and sets its ID to anonymous without doing anything else. You can overwrite the value of subject’s id by using the optional config property.\nTo enable the usage of this authenticator, you have to set the type property to anonymous.\nConfiguration using the config property is optional. Following properties are available:\nsubject: string (optional, overridable)\nEnables setting the ID of the created Subject object to a custom value.\nExample 2. Configuration of Anonymous authenticator id: foo type: anonymous config: subject: anon Basic Auth This authenticator verifies the provided credentials according to the HTTP \u0026#34;Basic\u0026#34; authentication scheme, described in RFC 7617. It does however not challenge the authentication, it only verifies the provided credentials and sets the Subject ID to the configured user identifier if the authentication succeeds. Otherwise, it raises an error, resulting in the execution of the configured error handlers. The \u0026#34;WWW Authenticate\u0026#34; error handler mechanism can for example be used if the corresponding challenge is required.\nTo enable the usage of this authenticator, you have to set the type property to basic_auth.\nConfiguration using the config property is mandatory. Following properties are available:\nuser_id: string (mandatory, overridable)\nThe identifier of the subject to be verified.\npassword: string (mandatory, overridable)\nThe password of the subject to be verified.\nallow_fallback_on_error: boolean (optional, overridable)\nIf set to true, allows the pipeline to fall back to the next authenticator in the pipeline if this one fails to verify the credentials. Defaults to false.\nExample 3. Configuration of Basic Auth authenticator id: foo type: basic_auth config: user_id: bar password: baz Generic This authenticator is kind of a Swiss knife and can do a lot depending on the given configuration. It verifies the authentication status of the subject by making use of values available in cookies, headers, or query parameters of the HTTP request and communicating with the actual authentication system to perform the verification of the subject authentication status on the one hand, and to get the information about the subject on the other hand. There is however one limitation: it can only deal with JSON responses.\nTo enable the usage of this authenticator, you have to set the type property to generic.\nConfiguration using the config property is mandatory. Following properties are available:\nidentity_info_endpoint: Endpoint (mandatory, not overridable)\nThe endpoint to communicate to for the actual subject authentication status verification purpose. At least the url must be configured. If you don’t configure method, HTTP POST will be used. The Accept header is set to application/json by default. You can overwrite these setting if required. Query and header definitions can be templated and can make use of the AuthenticationData object (see below). Don’t forget - this authenticator supports only JSON responses.\nauthentication_data_source: Authentication Data Source (mandatory, not overridable)\nWhere to extract the authentication data from the request. The extracted value is made available as AuthenticationData for usage in templates defined as part of this authenticator configuration. So you can reference it in a body, header, etc.\nThe AuthenticationData object is available during the execution of this authenticator only and is not made available to other mechanisms. forward_headers: string array (optional, not overridable)\nIf the identity_info_endpoint API requires any headers from the request to heimdall, you can forward these unchanged by making use of this property. This might be the header used to extract the authentication data from.\nforward_cookies: string array (optional, not overridable)\nIf the identity_info_endpoint API requires any cookies from the request to heimdall, you can forward these unchanged by making use of this property. This might be the cookie used to extract the authentication data from.\npayload: string (optional, not overridable)\nYour template with definitions required to send the extracted authentication data. The template has access to the AuthenticationData object only.\nsubject: Subject (mandatory, not overridable)\nWhere to extract the Subject information from the identity info endpoint response.\ncache_ttl: Duration (optional, overridable)\nHow long to cache the response. If not set, response caching if disabled. The cache key is calculated from the identity_info_endpoint configuration and the actual authentication data value.\nallow_fallback_on_error: boolean (optional, overridable)\nIf set to true, allows the pipeline to fall back to the next authenticator in the pipeline if this one fails to verify the credentials. Defaults to false.\nsession_lifespan: Session Lifespan (optional, not overridable)\nWhere to extract the session validity information form the identity info endpoint response. If the not_after property is specified, the corresponding value from the response is also used for cache ttl calculation to prevent usage of not anymore valid session objects and overwrites the value configured for cache_ttl if the usage of that value would exceed the lifespan of the session object.\nIf you’re configuring the cache_ttl property, it is highly recommended to configure session_lifespan as well to ensure outdated session objects are not used for subsequent requests to heimdall. Usage of session_lifespan is recommended anyway to enable time based validation of the response from the identity info endpoint. Example 4. Configuration to work with session cookies This example shows how to configure this authenticator to work with Ory Kratos, an authentication system, which issues a cookie upon successful user authentication to maintain the authentication state. To reduce the communication overhead, it also makes use of cache_ttl to cache the response for 5 minutes if that time frame does not exceed the actual validity of the session represented by the cookie.\nid: kratos_session_cookie type: generic config: identity_info_endpoint: https://kratos/sessions/whoami authentication_data_source: - cookie: ory_kratos_session forward_cookies: - ory_kratos_session subject: id: \u0026#34;identity.id\u0026#34; cache_ttl: 5m session_lifespan: active: active issued_at: issued_at not_before: authenticated_at not_after: expires_at time_format: \u0026#34;2006-01-02T15:04:05.999999Z07\u0026#34; validity_leeway: 10s As kratos requires the ory_kratos_session cookie as is, this configuration makes use of the forward_cookies property and does not use the AuthenticationData object.\nThis example does also show how an endpoint can be configured by just specifying the URL as string, which is the simplest way for endpoint configuration.\nExample 5. Configuration to work with a Bearer token This example shows how to configure this authenticator to work with an OAuth2 authorization service, which issues a Bearer token upon successful user authentication. To reduce the communication overhead, it also makes use of cache_ttl to cache the response for 5 minutes if it does not exceed the validity of the information present in the response from the used endpoint.\nIn this example we configure the authenticator to use the introspection endpoint to get the information about the token.\nid: opaque_bearer_token type: generic config: identity_info_endpoint: url: https://my-auth.system/introspect headers: Content-Type: application/x-www-form-urlencoded auth: type: basic_auth config: user: Heimdall password: ${INTROSPECTION_PASSWORD} authentication_data_source: - header: Authorization scheme: Bearer payload: | token={{ urlenc .AuthenticationData }}\u0026amp;token_type_hint=access_token subject: id: sub cache_ttl: 5m session_lifespan: active: active issued_at: iat not_before: nbf not_after: exp validity_leeway: 10s Usually, you would not only like to verify the validity of a token, but also a couple of claims. This can be achieved by a CEL Authorizer. However, there is also a special purpose OAuth2 Introspection authenticator type, which supports asserting all security relevant claims in just one place and does not need so much configuration as shown above.\nIn this configuration the authenticator extracts the token from the Authorization header and request the information about the corresponding user from the http://my-auth.system/introspect endpoint by sending the extracted token in the body of the request in a parameter named token.\nExample 6. Configuration to work with Google’s Firebase. If you would like to integrate with Google’s Firebase, you would configure something like this:\nAssumption: The token issued by firebase is located in the HTTP Authorization header using Bearer scheme\nid: firebase_token type: generic config: identity_info_endpoint: url: https://identitytoolkit.googleapis.com/v1/accounts:lookup?key=${YOUR_API_KEY} headers: Content-Type: application/json authentication_data_source: - header: Authorization scheme: Bearer payload: | { \u0026#34;idToken\u0026#34;: {{ quote .AuthenticationData }} } subject: id: users.0.localId attributes: users.0 cache_ttl: 5m OAuth2 Introspection This authenticator handles requests that have Bearer token in the HTTP Authorization header (Authorization: Bearer \u0026lt;token\u0026gt;), in the access_token query parameter or the access_token body parameter (latter, if the body is of application/x-www-form-urlencoded MIME type). It then uses OAuth 2.0 Token Introspection endpoint to check if the token is valid. The validation includes at least the verification of the status and the time validity. That is if the token is still active and whether it has been issued in an acceptable time frame. Latter can be adjusted by specifying a leeway. All other validation options can and should be configured.\nTo enable the usage of this authenticator, you have to set the type property to oauth2_introspection.\nConfiguration using the config property is mandatory. Following properties are available:\nintrospection_endpoint: Endpoint (dependant, not overridable)\nThe OAuth 2.0 Token Introspection endpoint of the OAuth2 authorization provider.\nThe configuration of this property is mutually exclusive with metadata_endpoint. If used, at least the url must be configured. There is no need to define the method property or setting the Content-Type or the Accept header. These are set by default to the values required by the RFC referenced above. You can however override these while configuring the authenticator if needed. The path part of the url can be templated and has access to the TokenIssuer object, which is a string and only available if the format of the used token is JWT. It basically holds the value of the iss claim from the token.\nmetadata_endpoint: Endpoint (dependant, not overridable)\nThe OAuth 2.0 Authorization Server Metadata endpoint of the OAuth2, respectively OIDC authorization provider (the OpenID Connect Discovery specification is an OIDC specific profile of that specification). If the token introspection URL is not known upfront, it can be resolved by making use of that endpoint.\nThe configuration of this property is mutually exclusive with introspection_endpoint. If used, at least the url must be configured, can be templated and has access to the TokenIssuer object already introduced above (with the same limitations).\nThe metadata_endpoint is by default configured to use GET as HTTP method and sets the Accept header to application/json as also required by both specifications referenced above. In addition, to avoid useless communication, it is also configured to make use of HTTP cache according to RFC 7234 with default HTTP cache ttl set to 30m. All these settings can however be overridden if required.\nIn addition to the properties specified by the endpoint type, following properties are available:\ndisable_issuer_identifier_verification: boolean (optional, not overridable)\nUpon retrieval of the server metadata, both, the OAuth 2.0 Authorization Server Metadata RFC, and the OpenID Connect Discovery specification, require the verification of the issuer identifier for security reasons, e.g. to prevent Spoofing Attacks. There are however setups, where strictly following that recommendation would result in extended bandwidth usage (instead of communicating directly with the auth server within the cluster one would need to use the same domain, the client application uses, which introduces additional network hops). It might also not work at all as the actual identifier of the issuer would change depending on where the request come from. By making use of this property and setting it to true, one can disable the corresponding verification. Defaults to false.\ntoken_source: Authentication Data Source (optional, not overridable)\nWhere to get the access token from. Defaults to retrieve it from the Authorization header, the access_token query parameter or the access_token body parameter (latter, if the body is of application/x-www-form-urlencoded MIME type).\nassertions: Assertions (dependent, overridable)\nConfigures the required claim assertions. Overriding on rule level is possible even partially. Those parts of the assertion, which have not been overridden are taken from the prototype configuration. If metadata_endpoint is used, the list of issuers is optional, as the issuer will be resolved via the auth server metadata document. Otherwise, the list of issuers is mandatory.\nsubject: Subject (optional, not overridable)\nWhere to extract the Subject information from the introspection endpoint response. If not configured sub is used to extract the subject ID and all attributes from the introspection endpoint response are made available as Attributes.\ncache_ttl: Duration (optional, overridable)\nHow long to cache the response. If not set, caching of the introspection response is based on the available token expiration information. To disable caching, set it to 0s. If you set the ttl to a custom value \u0026gt; 0, the expiration time (if available) of the token will be considered. The cache key is calculated from the introspection_endpoint configuration and the value of the access token.\nallow_fallback_on_error: boolean (optional, overridable)\nIf set to true, allows the pipeline to fall back to the next authenticator in the pipeline if this one fails to verify the credentials. Defaults to false.\nExample 7. Minimal possible configuration based on the Introspection endpoint id: at_opaque type: oauth2_introspection config: introspection_endpoint: url: http://hydra:4445/oauth2/introspect assertions: issuers: - http://127.0.0.1:4444/ Example 8. Configuration for Keycloak utilizing metadata discovery id: keycloak type: metadata_endpoint config: metadata_endpoint: url: http://keycloak:8080/realms/{{ trimPrefix \u0026#34;https://my-auth-server/realms/\u0026#34; .TokenIssuer }}/.well-known/openid-configuration # Note that no assertions are configured here, since it\u0026#39;ll be resolved via the metadata endpoint This example does also show how to make use of templating if the format of the access token is JWT.\nThe external domain of the auth server in this example is https://my-auth-server.com. If the iss claim of the issued JWT is set to https://my-auth-server.com/realms/my-app, the above line will build an internal URL to the metadata endpoint of the same server and profile/realm, which is that case would be http://keycloak:8080/realms/my-app/.well-known/openid-configuration\nJWT As the OAuth2 Introspection authenticator, this authenticator handles requests that have a Bearer token in the Authorization header, in a different header, a query parameter or a body parameter as well. Unlike the OAuth2 Introspection authenticator it expects the token to be a JSON Web Token (JWT) and verifies it according RFC 7519, Section 7.2. It does however not support encrypted payloads and nested JWTs. In addition to this, validation includes the verification of the time validity. Latter can be adjusted by specifying a leeway. All other validation options can and should be configured.\nTo enable the usage of this authenticator, you have to set the type property to jwt.\nConfiguration using the config property is mandatory. Following properties are available:\njwks_endpoint: Endpoint (dependant, not overridable)\nThe JWKS endpoint, this authenticator retrieves the key material in a format specified in RFC 7519 from for JWT signature verification purposes.\nThe configuration of this property is mutually exclusive with metadata_endpoint. If used, at least the url must be configured. By default method is set to GET and the HTTP Accept header to application/json. The path part of the url can be templated and has access to the TokenIssuer object, which is a string and basically holds the value of the iss claim from the token.\nmetadata_endpoint: Endpoint (dependant, not overridable)\nThe OAuth 2.0 Authorization Server Metadata endpoint of the OAuth2, respectively OIDC authorization provider (the OpenID Connect Discovery specification is an OIDC specific profile of that specification). If the JWKS URL is not known upfront, it can be resolved by making use of that endpoint.\nThe configuration of this property is mutually exclusive with jwks_endpoint. If used, at least the url must be configured. As with the jwks_endpoint, the path part of the url can be templated and has access to the TokenIssuer object already introduced above.\nAs with the jwks_endpoint as well, the metadata_endpoint is by default configured to use GET as HTTP method and sets the Accept header to application/json, as also required by both specifications referenced above. In addition, to avoid useless communication, it is also configured to make use of HTTP cache according to RFC 7234 with default HTTP cache ttl set to 30m. All these settings can however be overridden if required.\nIn addition to the properties specified by the endpoint type, following properties are available:\ndisable_issuer_identifier_verification: boolean (optional, not overridable)\nUpon retrieval of the server metadata, both, the OAuth 2.0 Authorization Server Metadata RFC, and the OpenID Connect Discovery specification, require the verification of the issuer identifier for security reasons, e.g. to prevent Spoofing Attacks. There are however setups, where strictly following that recommendation would result in extended bandwidth usage (instead of communicating directly with the auth server within the cluster one would need to use the same domain, the client application uses, which introduces additional network hops). It might also not work at all as the actual identifier of the issuer would change depending on where the request come from. By making use of this property and setting it to true, one can disable the corresponding verification. Defaults to false.\njwt_source: Authentication Data Source (optional, not overridable)\nWhere to get the access token from. Defaults to retrieve it from the Authorization header, the access_token query parameter or the access_token body parameter (latter, if the body is of application/x-www-form-urlencoded MIME type).\nassertions: Assertions (dependant, overridable)\nConfigures the required claim assertions. Overriding on rule level is possible even partially. Those parts of the assertion, which have not been overridden are taken from the prototype configuration. If metadata_endpoint is used, the list of issuers is optional, as the issuer will be resolved via the auth server metadata document. Otherwise, the list of issuers is mandatory.\nsubject: Subject (optional, not overridable)\nWhere to extract the subject id from the JWT, as well as which attributes to use. If not configured sub is used to extract the subject id and all attributes from the JWT payload are made available as attributes of the subject.\ncache_ttl: Duration (optional, overridable)\nHow long to cache the key from the JWKS response, which was used for signature verification purposes. If not set, heimdall will cache this key for 10 minutes and not call JWKS endpoint again if the same kid is referenced in an JWT and same JWKS endpoint is used. The cache key is calculated from the jwks_endpoint configuration and the kid referenced in the JWT.\nallow_fallback_on_error: boolean (optional, overridable)\nIf set to true, allows the pipeline to fall back to the next authenticator in the pipeline if this one fails to verify the credentials. Defaults to false.\nvalidate_jwk: boolean (optional, not overridable)\nEnables or disables the verification of the JWK certificate used for JWT signature verification purposes. Effective only if the JWK contains a certificate. The verification happens according to RFC 5280, section 6.1 and also includes the check, that the certificate is allowed to be used for signature verification purposes. Revocation check is not supported. Defaults to true.\ntrust_store: string (optional, not overridable)\nThe path to a PEM file containing the trust anchors, to be used for the JWK certificate validation. Defaults to system trust store.\nIf a JWT does not reference a kid, heimdall always fetches a JWKS from the configured endpoint (so no caching is done) and iterates over the received keys until one matches. If none matches, the authenticator fails. Example 9. Minimal possible configuration based on the JWKS endpoint id: at_jwt type: jwt config: jwks_endpoint: url: http://hydra:4444/.well-known/jwks.json assertions: issuers: - http://127.0.0.1:4444/ Example 10. Configuration for Keycloak utilizing metadata discovery id: keycloak type: jwt config: metadata_endpoint: url: http://keycloak:8080/realms/my-app/.well-known/openid-configuration # Note that no assertions are configured here, since it\u0026#39;ll be resolved via the metadata endpoint ","description":"Authenticators verify the authentication status of requests and create subjects. This page  describes the available authenticator types in detail.","html_content":"\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eSome of the supported authenticator types may support or require additional configuration. The corresponding properties are annotated with \u003ccode\u003emandatory\u003c/code\u003e, respectively \u003ccode\u003eoptional\u003c/code\u003e to denote configuration requirement, as well as with \u003ccode\u003eoverridable\u003c/code\u003e, \u003ccode\u003enot overriddable\u003c/code\u003e and \u003ccode\u003epartially overridable\u003c/code\u003e to indicate whether the property can be overridden in a rule pipeline.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_unauthorized\"\u003eUnauthorized\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThis authenticator rejects all requests as unauthenticated (on HTTP response code level this is then mapped to \u003ccode\u003e401 Unauthorized\u003c/code\u003e, hence the type name). It basically stops the successful execution of the pipeline resulting in the execution of the error handlers. This authenticator type doesn’t have any configuration options.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eTo enable the usage of this authenticator, you have to set the \u003ccode\u003etype\u003c/code\u003e property to \u003ccode\u003eunauthorized\u003c/code\u003e.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"exampleblock\"\u003e\n\u003cdiv class=\"title\"\u003eExample 1. Configure Unauthorized authenticator\u003c/div\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"yaml\"\u003e\u003cspan class=\"na\"\u003eid\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003efoo\u003c/span\u003e\n\u003cspan class=\"na\"\u003etype\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eunauthorized\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_anonymous\"\u003eAnonymous\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThis authenticator just creates a \u003ca href=\"/docs/mechanisms/evaluation_objects/#_subject\"\u003e\u003ccode\u003eSubject\u003c/code\u003e\u003c/a\u003e object and sets its \u003ccode\u003eID\u003c/code\u003e to \u003ccode\u003eanonymous\u003c/code\u003e without doing anything else. You can overwrite the value of subject’s id by using the optional \u003ccode\u003econfig\u003c/code\u003e property.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eTo enable the usage of this authenticator, you have to set the \u003ccode\u003etype\u003c/code\u003e property to \u003ccode\u003eanonymous\u003c/code\u003e.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eConfiguration using the \u003ccode\u003econfig\u003c/code\u003e property is optional. Following properties are available:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003esubject\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003estring\u003c/em\u003e (optional, overridable)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eEnables setting the \u003ccode\u003eID\u003c/code\u003e of the created \u003ca href=\"/docs/mechanisms/evaluation_objects/#_subject\"\u003e\u003ccode\u003eSubject\u003c/code\u003e\u003c/a\u003e object to a custom value.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"exampleblock\"\u003e\n\u003cdiv class=\"title\"\u003eExample 2. Configuration of Anonymous authenticator\u003c/div\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"yaml\"\u003e\u003cspan class=\"na\"\u003eid\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003efoo\u003c/span\u003e\n\u003cspan class=\"na\"\u003etype\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eanonymous\u003c/span\u003e\n\u003cspan class=\"na\"\u003econfig\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"na\"\u003esubject\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eanon\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_basic_auth\"\u003eBasic Auth\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThis authenticator verifies the provided credentials according to the HTTP \u0026#34;Basic\u0026#34; authentication scheme, described in \u003ca href=\"https://datatracker.ietf.org/doc/html/rfc7617\"\u003eRFC 7617\u003c/a\u003e. It does however not challenge the authentication, it only verifies the provided credentials and sets the \u003ca href=\"/docs/mechanisms/evaluation_objects/#_subject\"\u003e\u003ccode\u003eSubject\u003c/code\u003e\u003c/a\u003e \u003ccode\u003eID\u003c/code\u003e to the configured user identifier if the authentication succeeds. Otherwise, it raises an error, resulting in the execution of the configured error handlers. The \u003ca href=\"/docs/mechanisms/error_handlers/#_www_authenticate\"\u003e\u0026#34;WWW Authenticate\u0026#34;\u003c/a\u003e error handler mechanism can for example be used if the corresponding challenge is required.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eTo enable the usage of this authenticator, you have to set the \u003ccode\u003etype\u003c/code\u003e property to \u003ccode\u003ebasic_auth\u003c/code\u003e.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eConfiguration using the \u003ccode\u003econfig\u003c/code\u003e property is mandatory. Following properties are available:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003euser_id\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003estring\u003c/em\u003e (mandatory, overridable)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe identifier of the subject to be verified.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003epassword\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003estring\u003c/em\u003e (mandatory, overridable)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe password of the subject to be verified.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003eallow_fallback_on_error\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003eboolean\u003c/em\u003e (optional, overridable)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eIf set to \u003ccode\u003etrue\u003c/code\u003e, allows the pipeline to fall back to the next authenticator in the pipeline if this one fails to verify the credentials. Defaults to \u003ccode\u003efalse\u003c/code\u003e.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"exampleblock\"\u003e\n\u003cdiv class=\"title\"\u003eExample 3. Configuration of Basic Auth authenticator\u003c/div\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"yaml\"\u003e\u003cspan class=\"na\"\u003eid\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003efoo\u003c/span\u003e\n\u003cspan class=\"na\"\u003etype\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ebasic_auth\u003c/span\u003e\n\u003cspan class=\"na\"\u003econfig\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"na\"\u003euser_id\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ebar\u003c/span\u003e\n  \u003cspan class=\"na\"\u003epassword\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ebaz\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_generic\"\u003eGeneric\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThis authenticator is kind of a Swiss knife and can do a lot depending on the given configuration. It verifies the authentication status of the subject by making use of values available in cookies, headers, or query parameters of the HTTP request and communicating with the actual authentication system to perform the verification of the subject authentication status on the one hand, and to get the information about the subject on the other hand. There is however one limitation: it can only deal with JSON responses.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eTo enable the usage of this authenticator, you have to set the \u003ccode\u003etype\u003c/code\u003e property to \u003ccode\u003egeneric\u003c/code\u003e.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eConfiguration using the \u003ccode\u003econfig\u003c/code\u003e property is mandatory. Following properties are available:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003eidentity_info_endpoint\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003e\u003ca href=\"/docs/configuration/types/#_endpoint\"\u003eEndpoint\u003c/a\u003e\u003c/em\u003e (mandatory, not overridable)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe endpoint to communicate to for the actual subject authentication status verification purpose. At least the \u003ccode\u003eurl\u003c/code\u003e must be configured. If you don’t configure \u003ccode\u003emethod\u003c/code\u003e, HTTP \u003ccode\u003ePOST\u003c/code\u003e will be used. The \u003ccode\u003eAccept\u003c/code\u003e header is set to \u003ccode\u003eapplication/json\u003c/code\u003e by default. You can overwrite these setting if required. Query and header definitions can be templated and can make use of the \u003ccode\u003eAuthenticationData\u003c/code\u003e object (see below). Don’t forget - this authenticator supports only JSON responses.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003eauthentication_data_source\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003e\u003ca href=\"/docs/configuration/types/#_authentication_data_source\"\u003eAuthentication Data Source\u003c/a\u003e\u003c/em\u003e (mandatory, not overridable)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eWhere to extract the authentication data from the request. The extracted value is made available as \u003ccode\u003eAuthenticationData\u003c/code\u003e for usage in templates defined as part of this authenticator configuration. So you can reference it in a body, header, etc.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"admonitionblock note\"\u003e\n\u003ctable\u003e\n\u003ctbody\u003e\u003ctr\u003e\n\u003ctd class=\"icon\"\u003e\n\u003ci class=\"fa icon-note\" title=\"Note\"\u003e\u003c/i\u003e\n\u003c/td\u003e\n\u003ctd class=\"content\"\u003e\nThe \u003ccode\u003eAuthenticationData\u003c/code\u003e object is available during the execution of this authenticator only and is not made available to other mechanisms.\n\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003eforward_headers\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003estring array\u003c/em\u003e (optional, not overridable)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eIf the \u003ccode\u003eidentity_info_endpoint\u003c/code\u003e API requires any headers from the request to heimdall, you can forward these unchanged by making use of this property. This might be the header used to extract the authentication data from.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003eforward_cookies\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003estring array\u003c/em\u003e (optional, not overridable)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eIf the \u003ccode\u003eidentity_info_endpoint\u003c/code\u003e API requires any cookies from the request to heimdall, you can forward these unchanged by making use of this property. This might be the cookie used to extract the authentication data from.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003epayload\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003estring\u003c/em\u003e (optional, not overridable)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eYour \u003ca href=\"/docs/mechanisms/evaluation_objects/#_templating\"\u003etemplate\u003c/a\u003e with definitions required to send the extracted authentication data. The template has access to the \u003ccode\u003eAuthenticationData\u003c/code\u003e object only.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003esubject\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003e\u003ca href=\"/docs/configuration/types/#_subject\"\u003eSubject\u003c/a\u003e\u003c/em\u003e (mandatory, not overridable)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eWhere to extract the \u003ca href=\"/docs/mechanisms/evaluation_objects/#_subject\"\u003e\u003ccode\u003eSubject\u003c/code\u003e\u003c/a\u003e information from the identity info endpoint response.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003ecache_ttl\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003e\u003ca href=\"/docs/configuration/types/#_duration\"\u003eDuration\u003c/a\u003e\u003c/em\u003e (optional, overridable)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eHow long to cache the response. If not set, response caching if disabled. The cache key is calculated from the \u003ccode\u003eidentity_info_endpoint\u003c/code\u003e configuration and the actual authentication data value.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003eallow_fallback_on_error\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003eboolean\u003c/em\u003e (optional, overridable)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eIf set to \u003ccode\u003etrue\u003c/code\u003e, allows the pipeline to fall back to the next authenticator in the pipeline if this one fails to verify the credentials. Defaults to \u003ccode\u003efalse\u003c/code\u003e.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003esession_lifespan\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003e\u003ca href=\"/docs/configuration/types/#_session_lifespan\"\u003eSession Lifespan\u003c/a\u003e\u003c/em\u003e (optional, not overridable)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eWhere to extract the session validity information form the identity info endpoint response. If the \u003ccode\u003enot_after\u003c/code\u003e property is specified, the corresponding value from the response is also used for cache ttl calculation to prevent usage of not anymore valid session objects and overwrites the value configured for \u003ccode\u003ecache_ttl\u003c/code\u003e if the usage of that value would exceed the lifespan of the session object.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"admonitionblock note\"\u003e\n\u003ctable\u003e\n\u003ctbody\u003e\u003ctr\u003e\n\u003ctd class=\"icon\"\u003e\n\u003ci class=\"fa icon-note\" title=\"Note\"\u003e\u003c/i\u003e\n\u003c/td\u003e\n\u003ctd class=\"content\"\u003e\nIf you’re configuring the \u003ccode\u003ecache_ttl\u003c/code\u003e property, it is highly recommended to configure \u003ccode\u003esession_lifespan\u003c/code\u003e as well to ensure outdated session objects are not used for subsequent requests to heimdall. Usage of \u003ccode\u003esession_lifespan\u003c/code\u003e is recommended anyway to enable time based validation of the response from the identity info endpoint.\n\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"exampleblock\"\u003e\n\u003cdiv class=\"title\"\u003eExample 4. Configuration to work with session cookies\u003c/div\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThis example shows how to configure this authenticator to work with Ory Kratos, an authentication system, which issues a cookie upon successful user authentication to maintain the authentication state. To reduce the communication overhead, it also makes use of \u003ccode\u003ecache_ttl\u003c/code\u003e to cache the response for 5 minutes if that time frame does not exceed the actual validity of the session represented by the cookie.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"yaml\"\u003e\u003cspan class=\"na\"\u003eid\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ekratos_session_cookie\u003c/span\u003e\n\u003cspan class=\"na\"\u003etype\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003egeneric\u003c/span\u003e\n\u003cspan class=\"na\"\u003econfig\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eidentity_info_endpoint\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ehttps://kratos/sessions/whoami\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eauthentication_data_source\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003ecookie\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eory_kratos_session\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eforward_cookies\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003eory_kratos_session\u003c/span\u003e\n  \u003cspan class=\"na\"\u003esubject\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"na\"\u003eid\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"s\"\u003eidentity.id\u0026#34;\u003c/span\u003e\n  \u003cspan class=\"na\"\u003ecache_ttl\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e5m\u003c/span\u003e\n  \u003cspan class=\"na\"\u003esession_lifespan\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"na\"\u003eactive\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eactive\u003c/span\u003e\n    \u003cspan class=\"na\"\u003eissued_at\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eissued_at\u003c/span\u003e\n    \u003cspan class=\"na\"\u003enot_before\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eauthenticated_at\u003c/span\u003e\n    \u003cspan class=\"na\"\u003enot_after\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eexpires_at\u003c/span\u003e\n    \u003cspan class=\"na\"\u003etime_format\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"s\"\u003e2006-01-02T15:04:05.999999Z07\u0026#34;\u003c/span\u003e\n    \u003cspan class=\"na\"\u003evalidity_leeway\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e10s\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eAs kratos requires the \u003ccode\u003eory_kratos_session\u003c/code\u003e cookie as is, this configuration makes use of the \u003ccode\u003eforward_cookies\u003c/code\u003e property and does not use the \u003ccode\u003eAuthenticationData\u003c/code\u003e object.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThis example does also show how an endpoint can be configured by just specifying the URL as string, which is the simplest way for endpoint configuration.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"exampleblock\"\u003e\n\u003cdiv class=\"title\"\u003eExample 5. Configuration to work with a Bearer token\u003c/div\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThis example shows how to configure this authenticator to work with an OAuth2 authorization service, which issues a Bearer token upon successful user authentication. To reduce the communication overhead, it also makes use of \u003ccode\u003ecache_ttl\u003c/code\u003e to cache the response for 5 minutes if it does not exceed the validity of the information present in the response from the used endpoint.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eIn this example we configure the authenticator to use the introspection endpoint to get the information about the token.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"yaml\"\u003e\u003cspan class=\"na\"\u003eid\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eopaque_bearer_token\u003c/span\u003e\n\u003cspan class=\"na\"\u003etype\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003egeneric\u003c/span\u003e\n\u003cspan class=\"na\"\u003econfig\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eidentity_info_endpoint\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"na\"\u003eurl\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ehttps://my-auth.system/introspect\u003c/span\u003e\n    \u003cspan class=\"na\"\u003eheaders\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"na\"\u003eContent-Type\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eapplication/x-www-form-urlencoded\u003c/span\u003e\n    \u003cspan class=\"na\"\u003eauth\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"na\"\u003etype\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ebasic_auth\u003c/span\u003e\n      \u003cspan class=\"na\"\u003econfig\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"na\"\u003euser\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eHeimdall\u003c/span\u003e\n        \u003cspan class=\"na\"\u003epassword\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e${INTROSPECTION_PASSWORD}\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eauthentication_data_source\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eheader\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eAuthorization\u003c/span\u003e\n      \u003cspan class=\"na\"\u003escheme\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eBearer\u003c/span\u003e\n  \u003cspan class=\"na\"\u003epayload\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"pi\"\u003e|\u003c/span\u003e\n    \u003cspan class=\"s\"\u003etoken={{ urlenc .AuthenticationData }}\u0026amp;token_type_hint=access_token\u003c/span\u003e\n  \u003cspan class=\"na\"\u003esubject\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"na\"\u003eid\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003esub\u003c/span\u003e\n  \u003cspan class=\"na\"\u003ecache_ttl\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e5m\u003c/span\u003e\n  \u003cspan class=\"na\"\u003esession_lifespan\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"na\"\u003eactive\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eactive\u003c/span\u003e\n    \u003cspan class=\"na\"\u003eissued_at\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eiat\u003c/span\u003e\n    \u003cspan class=\"na\"\u003enot_before\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003enbf\u003c/span\u003e\n    \u003cspan class=\"na\"\u003enot_after\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eexp\u003c/span\u003e\n    \u003cspan class=\"na\"\u003evalidity_leeway\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e10s\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eUsually, you would not only like to verify the validity of a token, but also a couple of claims. This can be achieved by a \u003ca href=\"/docs/mechanisms/authorizers/#_local_cel\"\u003eCEL Authorizer\u003c/a\u003e. However, there is also a special purpose \u003ca href=\"#_oauth2_introspection\"\u003eOAuth2 Introspection\u003c/a\u003e authenticator type, which supports asserting all security relevant claims in just one place and does not need so much configuration as shown above.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eIn this configuration the authenticator extracts the token from the \u003ccode\u003eAuthorization\u003c/code\u003e header and request the information about the corresponding user from the \u003ccode\u003ehttp://my-auth.system/introspect\u003c/code\u003e endpoint by sending the extracted token in the body of the request in a parameter named \u003ccode\u003etoken\u003c/code\u003e.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"exampleblock\"\u003e\n\u003cdiv class=\"title\"\u003eExample 6. Configuration to work with Google’s Firebase.\u003c/div\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eIf you would like to integrate with Google’s Firebase, you would configure something like this:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eAssumption: The token issued by firebase is located in the HTTP Authorization header using Bearer scheme\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"yaml\"\u003e\u003cspan class=\"na\"\u003eid\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003efirebase_token\u003c/span\u003e\n\u003cspan class=\"na\"\u003etype\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003egeneric\u003c/span\u003e\n\u003cspan class=\"na\"\u003econfig\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eidentity_info_endpoint\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"na\"\u003eurl\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ehttps://identitytoolkit.googleapis.com/v1/accounts:lookup?key=${YOUR_API_KEY}\u003c/span\u003e\n    \u003cspan class=\"na\"\u003eheaders\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"na\"\u003eContent-Type\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eapplication/json\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eauthentication_data_source\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eheader\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eAuthorization\u003c/span\u003e\n      \u003cspan class=\"na\"\u003escheme\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eBearer\u003c/span\u003e\n  \u003cspan class=\"na\"\u003epayload\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"pi\"\u003e|\u003c/span\u003e\n   \u003cspan class=\"s\"\u003e{ \u0026#34;idToken\u0026#34;: {{ quote .AuthenticationData }} }\u003c/span\u003e\n  \u003cspan class=\"na\"\u003esubject\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n   \u003cspan class=\"na\"\u003eid\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eusers.0.localId\u003c/span\u003e\n   \u003cspan class=\"na\"\u003eattributes\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eusers.0\u003c/span\u003e\n  \u003cspan class=\"na\"\u003ecache_ttl\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e5m\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_oauth2_introspection\"\u003eOAuth2 Introspection\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThis authenticator handles requests that have Bearer token in the HTTP Authorization header (\u003ccode\u003eAuthorization: Bearer \u0026lt;token\u0026gt;\u003c/code\u003e), in the \u003ccode\u003eaccess_token\u003c/code\u003e query parameter or the \u003ccode\u003eaccess_token\u003c/code\u003e body parameter (latter, if the body is of \u003ccode\u003eapplication/x-www-form-urlencoded\u003c/code\u003e MIME type). It then uses \u003ca href=\"https://datatracker.ietf.org/doc/html/rfc7662\"\u003eOAuth 2.0 Token Introspection\u003c/a\u003e endpoint to check if the token is valid. The validation includes at least the verification of the status and the time validity. That is if the token is still active and whether it has been issued in an acceptable time frame. Latter can be adjusted by specifying a leeway. All other validation options can and should be configured.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eTo enable the usage of this authenticator, you have to set the \u003ccode\u003etype\u003c/code\u003e property to \u003ccode\u003eoauth2_introspection\u003c/code\u003e.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eConfiguration using the \u003ccode\u003econfig\u003c/code\u003e property is mandatory. Following properties are available:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003eintrospection_endpoint\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003e\u003ca href=\"/docs/configuration/types/#_endpoint\"\u003eEndpoint\u003c/a\u003e\u003c/em\u003e (dependant, not overridable)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe \u003ca href=\"https://datatracker.ietf.org/doc/html/rfc7662\"\u003eOAuth 2.0 Token Introspection\u003c/a\u003e endpoint of the OAuth2 authorization provider.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe configuration of this property is mutually exclusive with \u003ccode\u003emetadata_endpoint\u003c/code\u003e. If used, at least the \u003ccode\u003eurl\u003c/code\u003e must be configured. There is no need to define the \u003ccode\u003emethod\u003c/code\u003e property or setting the \u003ccode\u003eContent-Type\u003c/code\u003e or the \u003ccode\u003eAccept\u003c/code\u003e header. These are set by default to the values required by the RFC referenced above. You can however override these while configuring the authenticator if needed. The path part of the \u003ccode\u003eurl\u003c/code\u003e can be \u003ca href=\"/docs/mechanisms/evaluation_objects/#_templating\"\u003etemplated\u003c/a\u003e and has access to the \u003ccode\u003eTokenIssuer\u003c/code\u003e object, which is a string and only available if the format of the used token is JWT. It basically holds the value of the \u003ccode\u003eiss\u003c/code\u003e claim from the token.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003emetadata_endpoint\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003e\u003ca href=\"/docs/configuration/types/#_endpoint\"\u003eEndpoint\u003c/a\u003e\u003c/em\u003e (dependant, not overridable)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe \u003ca href=\"https://datatracker.ietf.org/doc/html/rfc8414\"\u003eOAuth 2.0 Authorization Server Metadata\u003c/a\u003e endpoint of the OAuth2, respectively OIDC authorization provider (the \u003ca href=\"https://openid.net/specs/openid-connect-discovery-1_0.html\"\u003eOpenID Connect Discovery\u003c/a\u003e specification is an OIDC specific profile of that specification). If the token introspection URL is not known upfront, it can be resolved by making use of that endpoint.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe configuration of this property is mutually exclusive with \u003ccode\u003eintrospection_endpoint\u003c/code\u003e. If used, at least the \u003ccode\u003eurl\u003c/code\u003e must be configured, can be templated and has access to the \u003ccode\u003eTokenIssuer\u003c/code\u003e object already introduced above (with the same limitations).\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe \u003ccode\u003emetadata_endpoint\u003c/code\u003e is by default configured to use \u003ccode\u003eGET\u003c/code\u003e as HTTP method and sets the \u003ccode\u003eAccept\u003c/code\u003e header to \u003ccode\u003eapplication/json\u003c/code\u003e as also required by both specifications referenced above. In addition, to avoid useless communication, it is also configured to make use of HTTP cache according to \u003ca href=\"http://tools.ietf.org/html/rfc7234\"\u003eRFC 7234\u003c/a\u003e with default HTTP cache ttl set to \u003ccode\u003e30m\u003c/code\u003e. All these settings can however be overridden if required.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eIn addition to the properties specified by the \u003ca href=\"/docs/configuration/types/#_endpoint\"\u003e\u003ccode\u003eendpoint\u003c/code\u003e\u003c/a\u003e type, following properties are available:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003edisable_issuer_identifier_verification\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003eboolean\u003c/em\u003e (optional, not overridable)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eUpon retrieval of the server metadata, both, the \u003ca href=\"https://datatracker.ietf.org/doc/html/rfc8414\"\u003eOAuth 2.0 Authorization Server Metadata\u003c/a\u003e RFC, and the \u003ca href=\"https://openid.net/specs/openid-connect-discovery-1_0.html\"\u003eOpenID Connect Discovery\u003c/a\u003e specification, require the verification of the issuer identifier for security reasons, e.g. to prevent \u003ca href=\"https://datatracker.ietf.org/doc/html/rfc8414#section-6.2\"\u003eSpoofing Attacks\u003c/a\u003e. There are however setups, where strictly following that recommendation would result in extended bandwidth usage (instead of communicating directly with the auth server within the cluster one would need to use the same domain, the client application uses, which introduces additional network hops). It might also not work at all as the actual identifier of the issuer would change depending on where the request come from. By making use of this property and setting it to \u003ccode\u003etrue\u003c/code\u003e, one can disable the corresponding verification. Defaults to \u003ccode\u003efalse\u003c/code\u003e.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003etoken_source\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003e\u003ca href=\"/docs/configuration/types/#_authentication_data_source\"\u003eAuthentication Data Source\u003c/a\u003e\u003c/em\u003e (optional, not overridable)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eWhere to get the access token from. Defaults to retrieve it from the \u003ccode\u003eAuthorization\u003c/code\u003e header, the \u003ccode\u003eaccess_token\u003c/code\u003e query parameter or the \u003ccode\u003eaccess_token\u003c/code\u003e body parameter (latter, if the body is of \u003ccode\u003eapplication/x-www-form-urlencoded\u003c/code\u003e MIME type).\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003eassertions\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003e\u003ca href=\"/docs/configuration/types/#_assertions\"\u003eAssertions\u003c/a\u003e\u003c/em\u003e (dependent, overridable)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eConfigures the required claim assertions. Overriding on rule level is possible even partially. Those parts of the assertion, which have not been overridden are taken from the prototype configuration. If \u003ccode\u003emetadata_endpoint\u003c/code\u003e is used, the list of issuers is optional, as the issuer will be resolved via the auth server metadata document. Otherwise, the list of issuers is mandatory.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003esubject\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003e\u003ca href=\"/docs/configuration/types/#_subject\"\u003eSubject\u003c/a\u003e\u003c/em\u003e (optional, not overridable)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eWhere to extract the \u003ca href=\"/docs/mechanisms/evaluation_objects/#_subject\"\u003e\u003ccode\u003eSubject\u003c/code\u003e\u003c/a\u003e information from the introspection endpoint response. If not configured \u003ccode\u003esub\u003c/code\u003e is used to extract the subject \u003ccode\u003eID\u003c/code\u003e and all attributes from the introspection endpoint response are made available as \u003ccode\u003eAttributes\u003c/code\u003e.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003ecache_ttl\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003e\u003ca href=\"/docs/configuration/types/#_duration\"\u003eDuration\u003c/a\u003e\u003c/em\u003e (optional, overridable)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eHow long to cache the response. If not set, caching of the introspection response is based on the available token expiration information. To disable caching, set it to \u003ccode\u003e0s\u003c/code\u003e. If you set the ttl to a custom value \u0026gt; 0, the expiration time (if available) of the token will be considered. The cache key is calculated from the \u003ccode\u003eintrospection_endpoint\u003c/code\u003e configuration and the value of the access token.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003eallow_fallback_on_error\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003eboolean\u003c/em\u003e (optional, overridable)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eIf set to \u003ccode\u003etrue\u003c/code\u003e, allows the pipeline to fall back to the next authenticator in the pipeline if this one fails to verify the credentials. Defaults to \u003ccode\u003efalse\u003c/code\u003e.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"exampleblock\"\u003e\n\u003cdiv class=\"title\"\u003eExample 7. Minimal possible configuration based on the Introspection endpoint\u003c/div\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"yaml\"\u003e\u003cspan class=\"na\"\u003eid\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eat_opaque\u003c/span\u003e\n\u003cspan class=\"na\"\u003etype\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eoauth2_introspection\u003c/span\u003e\n\u003cspan class=\"na\"\u003econfig\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eintrospection_endpoint\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"na\"\u003eurl\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ehttp://hydra:4445/oauth2/introspect\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eassertions\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"na\"\u003eissuers\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003ehttp://127.0.0.1:4444/\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"exampleblock\"\u003e\n\u003cdiv class=\"title\"\u003eExample 8. Configuration for Keycloak utilizing metadata discovery\u003c/div\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"yaml\"\u003e\u003cspan class=\"na\"\u003eid\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ekeycloak\u003c/span\u003e\n\u003cspan class=\"na\"\u003etype\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003emetadata_endpoint\u003c/span\u003e\n\u003cspan class=\"na\"\u003econfig\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"na\"\u003emetadata_endpoint\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"na\"\u003eurl\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ehttp://keycloak:8080/realms/{{ trimPrefix \u0026#34;https://my-auth-server/realms/\u0026#34; .TokenIssuer }}/.well-known/openid-configuration\u003c/span\u003e\n  \u003cspan class=\"c1\"\u003e# Note that no assertions are configured here, since it\u0026#39;ll be resolved via the metadata endpoint\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThis example does also show how to make use of templating if the format of the access token is JWT.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe external domain of the auth server in this example is \u003ccode\u003ehttps://my-auth-server.com\u003c/code\u003e.\nIf the \u003ccode\u003eiss\u003c/code\u003e claim of the issued JWT is set to \u003ccode\u003ehttps://my-auth-server.com/realms/my-app\u003c/code\u003e, the above line will build an internal URL to the metadata endpoint of the same server and profile/realm, which is that case would be \u003ccode\u003ehttp://keycloak:8080/realms/my-app/.well-known/openid-configuration\u003c/code\u003e\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_jwt\"\u003eJWT\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eAs the \u003ca href=\"#_oauth2_introspection\"\u003eOAuth2 Introspection\u003c/a\u003e authenticator, this authenticator handles requests that have a Bearer token in the \u003ccode\u003eAuthorization\u003c/code\u003e header, in a different header, a query parameter or a body parameter as well. Unlike the OAuth2 Introspection authenticator it expects the token to be a JSON Web Token (JWT) and verifies it according \u003ca href=\"https://www.rfc-editor.org/rfc/rfc7519#section-7.2\"\u003eRFC 7519, Section 7.2\u003c/a\u003e. It does however not support encrypted payloads and nested JWTs. In addition to this, validation includes the verification of the time validity. Latter can be adjusted by specifying a leeway. All other validation options can and should be configured.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eTo enable the usage of this authenticator, you have to set the \u003ccode\u003etype\u003c/code\u003e property to \u003ccode\u003ejwt\u003c/code\u003e.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eConfiguration using the \u003ccode\u003econfig\u003c/code\u003e property is mandatory. Following properties are available:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003ejwks_endpoint\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003e\u003ca href=\"/docs/configuration/types/#_endpoint\"\u003eEndpoint\u003c/a\u003e\u003c/em\u003e (dependant, not overridable)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe JWKS endpoint, this authenticator retrieves the key material in a format specified in \u003ca href=\"https://datatracker.ietf.org/doc/html/rfc7519\"\u003eRFC 7519\u003c/a\u003e from for JWT signature verification purposes.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe configuration of this property is mutually exclusive with \u003ccode\u003emetadata_endpoint\u003c/code\u003e. If used, at least the \u003ccode\u003eurl\u003c/code\u003e must be configured. By default \u003ccode\u003emethod\u003c/code\u003e is set to \u003ccode\u003eGET\u003c/code\u003e and the HTTP \u003ccode\u003eAccept\u003c/code\u003e header to \u003ccode\u003eapplication/json\u003c/code\u003e. The path part of the \u003ccode\u003eurl\u003c/code\u003e can be \u003ca href=\"/docs/mechanisms/evaluation_objects/#_templating\"\u003etemplated\u003c/a\u003e and has access to the \u003ccode\u003eTokenIssuer\u003c/code\u003e object, which is a string and  basically holds the value of the \u003ccode\u003eiss\u003c/code\u003e claim from the token.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003emetadata_endpoint\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003e\u003ca href=\"/docs/configuration/types/#_endpoint\"\u003eEndpoint\u003c/a\u003e\u003c/em\u003e (dependant, not overridable)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe \u003ca href=\"https://datatracker.ietf.org/doc/html/rfc8414\"\u003eOAuth 2.0 Authorization Server Metadata\u003c/a\u003e endpoint of the OAuth2, respectively OIDC authorization provider (the \u003ca href=\"https://openid.net/specs/openid-connect-discovery-1_0.html\"\u003eOpenID Connect Discovery\u003c/a\u003e specification is an OIDC specific profile of that specification). If the JWKS URL is not known upfront, it can be resolved by making use of that endpoint.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe configuration of this property is mutually exclusive with \u003ccode\u003ejwks_endpoint\u003c/code\u003e. If used, at least the \u003ccode\u003eurl\u003c/code\u003e must be configured. As with the \u003ccode\u003ejwks_endpoint\u003c/code\u003e, the path part of the \u003ccode\u003eurl\u003c/code\u003e can be templated and has access to the \u003ccode\u003eTokenIssuer\u003c/code\u003e object already introduced above.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eAs with the \u003ccode\u003ejwks_endpoint\u003c/code\u003e as well, the \u003ccode\u003emetadata_endpoint\u003c/code\u003e is by default configured to use \u003ccode\u003eGET\u003c/code\u003e as HTTP method and sets the \u003ccode\u003eAccept\u003c/code\u003e header to \u003ccode\u003eapplication/json\u003c/code\u003e, as also required by both specifications referenced above. In addition, to avoid useless communication, it is also configured to make use of HTTP cache according to \u003ca href=\"http://tools.ietf.org/html/rfc7234\"\u003eRFC 7234\u003c/a\u003e with default HTTP cache ttl set to \u003ccode\u003e30m\u003c/code\u003e. All these settings can however be overridden if required.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eIn addition to the properties specified by the \u003ca href=\"/docs/configuration/types/#_endpoint\"\u003e\u003ccode\u003eendpoint\u003c/code\u003e\u003c/a\u003e type, following properties are available:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003edisable_issuer_identifier_verification\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003eboolean\u003c/em\u003e (optional, not overridable)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eUpon retrieval of the server metadata, both, the \u003ca href=\"https://datatracker.ietf.org/doc/html/rfc8414\"\u003eOAuth 2.0 Authorization Server Metadata\u003c/a\u003e RFC, and the \u003ca href=\"https://openid.net/specs/openid-connect-discovery-1_0.html\"\u003eOpenID Connect Discovery\u003c/a\u003e specification, require the verification of the issuer identifier for security reasons, e.g. to prevent \u003ca href=\"https://datatracker.ietf.org/doc/html/rfc8414#section-6.2\"\u003eSpoofing Attacks\u003c/a\u003e. There are however setups, where strictly following that recommendation would result in extended bandwidth usage (instead of communicating directly with the auth server within the cluster one would need to use the same domain, the client application uses, which introduces additional network hops). It might also not work at all as the actual identifier of the issuer would change depending on where the request come from. By making use of this property and setting it to \u003ccode\u003etrue\u003c/code\u003e, one can disable the corresponding verification. Defaults to \u003ccode\u003efalse\u003c/code\u003e.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003ejwt_source\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003e\u003ca href=\"/docs/configuration/types/#_authentication_data_source\"\u003eAuthentication Data Source\u003c/a\u003e\u003c/em\u003e (optional, not overridable)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eWhere to get the access token from. Defaults to retrieve it from the \u003ccode\u003eAuthorization\u003c/code\u003e header, the \u003ccode\u003eaccess_token\u003c/code\u003e query parameter or the \u003ccode\u003eaccess_token\u003c/code\u003e body parameter (latter, if the body is of \u003ccode\u003eapplication/x-www-form-urlencoded\u003c/code\u003e MIME type).\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003eassertions\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003e\u003ca href=\"/docs/configuration/types/#_assertions\"\u003eAssertions\u003c/a\u003e\u003c/em\u003e (dependant, overridable)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eConfigures the required claim assertions. Overriding on rule level is possible even partially. Those parts of the assertion, which have not been overridden are taken from the prototype configuration. If \u003ccode\u003emetadata_endpoint\u003c/code\u003e is used, the list of issuers is optional, as the issuer will be resolved via the auth server metadata document. Otherwise, the list of issuers is mandatory.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003esubject\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003e\u003ca href=\"/docs/configuration/types/#_subject\"\u003eSubject\u003c/a\u003e\u003c/em\u003e (optional, not overridable)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eWhere to extract the subject id from the JWT, as well as which attributes to use. If not configured \u003ccode\u003esub\u003c/code\u003e is used to extract the subject id and all attributes from the JWT payload are made available as attributes of the subject.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003ecache_ttl\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003e\u003ca href=\"/docs/configuration/types/#_duration\"\u003eDuration\u003c/a\u003e\u003c/em\u003e (optional, overridable)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eHow long to cache the key from the JWKS response, which was used for signature verification purposes. If not set, heimdall will cache this key for 10 minutes and not call JWKS endpoint again if the same \u003ccode\u003ekid\u003c/code\u003e is referenced in an JWT and same JWKS endpoint is used. The cache key is calculated from the \u003ccode\u003ejwks_endpoint\u003c/code\u003e configuration and the \u003ccode\u003ekid\u003c/code\u003e referenced in the JWT.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003eallow_fallback_on_error\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003eboolean\u003c/em\u003e (optional, overridable)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eIf set to \u003ccode\u003etrue\u003c/code\u003e, allows the pipeline to fall back to the next authenticator in the pipeline if this one fails to verify the credentials. Defaults to \u003ccode\u003efalse\u003c/code\u003e.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003evalidate_jwk\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003eboolean\u003c/em\u003e (optional, not overridable)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eEnables or disables the verification of the JWK certificate used for JWT signature verification purposes. Effective only if the JWK contains a certificate. The verification happens according to \u003ca href=\"https://www.rfc-editor.org/rfc/rfc5280#section-6.1\"\u003eRFC 5280, section 6.1\u003c/a\u003e and also includes the check, that the certificate is allowed to be used for signature verification purposes. Revocation check is not supported. Defaults to \u003ccode\u003etrue\u003c/code\u003e.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003etrust_store\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003estring\u003c/em\u003e (optional, not overridable)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe path to a PEM file containing the trust anchors, to be used for the JWK certificate validation. Defaults to system trust store.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"admonitionblock note\"\u003e\n\u003ctable\u003e\n\u003ctbody\u003e\u003ctr\u003e\n\u003ctd class=\"icon\"\u003e\n\u003ci class=\"fa icon-note\" title=\"Note\"\u003e\u003c/i\u003e\n\u003c/td\u003e\n\u003ctd class=\"content\"\u003e\nIf a JWT does not reference a \u003ccode\u003ekid\u003c/code\u003e, heimdall always fetches a JWKS from the configured endpoint (so no caching is done) and iterates over the received keys until one matches. If none matches, the authenticator fails.\n\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003cdiv class=\"exampleblock\"\u003e\n\u003cdiv class=\"title\"\u003eExample 9. Minimal possible configuration based on the JWKS endpoint\u003c/div\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"yaml\"\u003e\u003cspan class=\"na\"\u003eid\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eat_jwt\u003c/span\u003e\n\u003cspan class=\"na\"\u003etype\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ejwt\u003c/span\u003e\n\u003cspan class=\"na\"\u003econfig\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"na\"\u003ejwks_endpoint\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"na\"\u003eurl\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ehttp://hydra:4444/.well-known/jwks.json\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eassertions\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"na\"\u003eissuers\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003ehttp://127.0.0.1:4444/\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"exampleblock\"\u003e\n\u003cdiv class=\"title\"\u003eExample 10. Configuration for Keycloak utilizing metadata discovery\u003c/div\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"yaml\"\u003e\u003cspan class=\"na\"\u003eid\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ekeycloak\u003c/span\u003e\n\u003cspan class=\"na\"\u003etype\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ejwt\u003c/span\u003e\n\u003cspan class=\"na\"\u003econfig\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"na\"\u003emetadata_endpoint\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"na\"\u003eurl\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ehttp://keycloak:8080/realms/my-app/.well-known/openid-configuration\u003c/span\u003e\n  \u003cspan class=\"c1\"\u003e# Note that no assertions are configured here, since it\u0026#39;ll be resolved via the metadata endpoint\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n","sections":["Mechanisms"],"tags":null,"title":"Authenticators","url":"/docs/mechanisms/authenticators/"},{"categories":null,"content":" Some of the authorizers may support or require additional configuration. The corresponding properties are annotated with mandatory, respectively optional to denote configuration requirement, as well as with overridable, not overriddable and partially overridable to indicate whether the property can be overridden in a rule pipeline.\nAllow As the name implies, this authorizer allows any request passing through. This authorizer type also doesn’t have any configuration options.\nTo enable the usage of this authorizer, you have to set the type property to allow.\nExample 1. Configuration of Allow authorizer id: allow_any_request type: allow Deny As the name implies, this authorizer denies any request (on HTTP response code level this is then mapped to 403 Forbidden). It basically stops the successful execution of the pipeline resulting in the execution of the error handler mechanisms. This authorizer type doesn’t have any configuration options.\nTo enable the usage of this authorizer, you have to set the type property to deny.\nExample 2. Configuration of Deny authorizer id: deny_any_request type: deny Local (CEL) This authorizer allows definition of authorization requirements based on information available about the authenticated subject, as well as the actual request by using CEL based authorization expressions. Each expression is expected to return true to signal success. Otherwise, the authorization fails, resulting in the execution of the error handler mechanisms.\nTo enable the usage of this authorizer, you have to set the type property to cel.\nConfiguration using the config property is mandatory. Following properties are available:\nexpressions: Authorization Expression array (mandatory, overridable)\nList of authorization expressions, which define the actual authorization logic. Each expression has access to the Subject and the Request objects.\nExample 3. Authorization based on subject properties In this example the subject is checked to be member of the \u0026#34;admin\u0026#34; group.\nid: user_is_admin type: cel config: expressions: - expression: | has(Subject.Attributes.groups) \u0026amp;\u0026amp; Subject.Attributes.groups.exists(g, g == \u0026#34;admin\u0026#34;) message: User is not admin The first line of the expressions verifies that the property group exists. The second line checks, whether groups contains an entry named admin.\nThis example specifies also a message, which is logged, if the expression fails.\nExample 4. Authorization based on subject and request properties In this example the authorizer is configured to ensure anonymous access to a resource is possible for read requests only.\nid: no_modification_allowed_by_anonymous type: cel config: expressions: - expression: | Request.Method in [\u0026#34;GET\u0026#34;, \u0026#34;HEAD\u0026#34;, \u0026#34;OPTIONS\u0026#34;] || Subject.ID != \u0026#34;anonymous\u0026#34; message: Anonymous non-read access is forbidden The usage of this type of configuration makes sense in a pipeline, which combines multiple Authenticators, allowing anonymous and authenticated access.\nRemote This authorizer allows communication with other systems, like Open Policy Agent, Ory Keto, etc. for the actual authorization purpose. If the used endpoint answers with a not 2xx HTTP response code, this authorizer assumes, the authorization has failed, resulting in the execution of the error handler mechanisms. Otherwise, if no expressions for the verification of the response are defined, the authorizer assumes, the request has been authorized. If expressions are defined and do not fail, the authorization succeeds.\nIf your authorization system provides a payload in the response, heimdall inspects the Content-Type header to prepare the payload for further usage, e.g. for payload verification expressions, or for a Local (CEL) authorizer. If the content type does either end with json or is application/x-www-form-urlencoded, the payload is decoded, so key based access to the corresponding attributes is possible, otherwise it is made available as well, but as a simple string. In all cases this value is available for the authorization expressions as well as in the Subject’s Attributes property under a key named by the id of the authorizer (See also the example below).\nTo enable the usage of this authorizer, you have to set the type property to remote.\nConfiguration using the config property is mandatory. Following properties are available:\nendpoint: Endpoint (mandatory, not overridable)\nThe API endpoint of your authorization system. At least the url must be configured. This mechanism allows templating of the url and makes the Subject object, as well as the Values (see also below) objects available to it. By default, this authorizer will use HTTP POST to send the rendered payload to this endpoint. You can override this behavior by configuring method as well. Depending on the API requirements of your authorization system, you might need to configure further properties, like headers, etc.\npayload: string (optional, overridable)\nYour template with definitions required to communicate to the authorization endpoint. The template can make use of Values, Subject and Request objects.\nexpressions: Authorization Expression array (optional, overridable)\nList of CEL expressions which define the logic to be applied to the response returned by the endpoint. All expressions are expected to evaluate to true if the authorization was successful. If any of the expressions evaluates to false, the authorization fails and the message defined by the failed expression will be logged.\nEach expression has access to the Payload object.\nforward_response_headers_to_upstream: string array (optional, overridable)\nEnables forwarding of any headers from the authorization endpoint response to the upstream service.\ncache_ttl: Duration (optional, overridable)\nAllows caching of the authorization endpoint responses. Defaults to 0s, which means no caching. The cache key is calculated from the entire configuration of the authorizer instance and the available information about the current subject.\nvalues map of strings (optional, overridable)\nA key value map, which is made accessible to the template rendering engine as Values object, to render parts of the URL and/or the payload. The actual values in that map can be templated as well with access to the Subject and Request objects.\nExample 5. Configuration of Remote authorizer to communicate with Open Policy Agent (OPA) Here the remote authorizer is configured to communicate with OPA. Since OPA expects the query to be formatted as JSON, the corresponding Content-Type header is set. Since the responses are JSON objects as well, the Accept header is also provided. In addition, this examples uses the basic_auth auth type to authenticate against the endpoint.\nid: opa type: remote config: endpoint: url: https://opa.local/v1/data/{{ .Values.namespace }}/{{ .Values.policy }} headers: Content-Type: json Accept: json auth: type: basic_auth config: user: ${OPA_USER} password: ${OPA_PASSWORD} payload: | { \u0026#34;input\u0026#34;: { \u0026#34;user\u0026#34;: {{ quote .Subject.ID }} }, \u0026#34;some_data\u0026#34;: {{ quote .Values.whatever }} } values: namespace: myapi/policy policy: allow_write whatever: | {{ .Request.Header(\u0026#34;X-Whatever\u0026#34;) }} expressions: - expression: | Payload.result == true message: User does not have required permissions In this case, since an OPA response could look like { \u0026#34;result\u0026#34;: true } or { \u0026#34;result\u0026#34;: false }, heimdall makes the response also available under Subject.Attributes[\u0026#34;opa\u0026#34;] as a map, with \u0026#34;opa\u0026#34; being the id of the authorizer in this example.\nA specific rule could then use this authorizer in the following ways:\n- id: rule1 # other rule properties execute: - # other mechanisms - authorizer: opa # using defaults - # other mechanisms - id: rule2 # other rule properties execute: - # other mechanisms - authorizer: opa config: # overriding with rule specifics values: policy: allow_read whatever: | {{ .Request.Header(\u0026#34;X-SomethingElse\u0026#34;) }} - # other mechanisms ","description":"Authorizers ensure that only those subjects, which are eligible can access the desired resource. This page describes the available authorizer types in detail.","html_content":"\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eSome of the authorizers may support or require additional configuration. The corresponding properties are annotated with \u003ccode\u003emandatory\u003c/code\u003e, respectively \u003ccode\u003eoptional\u003c/code\u003e to denote configuration requirement, as well as with \u003ccode\u003eoverridable\u003c/code\u003e, \u003ccode\u003enot overriddable\u003c/code\u003e and \u003ccode\u003epartially overridable\u003c/code\u003e to indicate whether the property can be overridden in a rule pipeline.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_allow\"\u003eAllow\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eAs the name implies, this authorizer allows any request passing through. This authorizer type also doesn’t have any configuration options.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eTo enable the usage of this authorizer, you have to set the \u003ccode\u003etype\u003c/code\u003e property to \u003ccode\u003eallow\u003c/code\u003e.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"exampleblock\"\u003e\n\u003cdiv class=\"title\"\u003eExample 1. Configuration of Allow authorizer\u003c/div\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"yaml\"\u003e\u003cspan class=\"na\"\u003eid\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eallow_any_request\u003c/span\u003e\n\u003cspan class=\"na\"\u003etype\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eallow\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_deny\"\u003eDeny\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eAs the name implies, this authorizer denies any request (on HTTP response code level this is then mapped to \u003ccode\u003e403 Forbidden\u003c/code\u003e). It basically stops the successful execution of the pipeline resulting in the execution of the error handler mechanisms. This authorizer type doesn’t have any configuration options.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eTo enable the usage of this authorizer, you have to set the \u003ccode\u003etype\u003c/code\u003e property to \u003ccode\u003edeny\u003c/code\u003e.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"exampleblock\"\u003e\n\u003cdiv class=\"title\"\u003eExample 2. Configuration of Deny authorizer\u003c/div\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"yaml\"\u003e\u003cspan class=\"na\"\u003eid\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003edeny_any_request\u003c/span\u003e\n\u003cspan class=\"na\"\u003etype\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003edeny\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_local_cel\"\u003eLocal (CEL)\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThis authorizer allows definition of authorization requirements based on information available about the authenticated subject, as well as the actual request by using \u003ca href=\"https://github.com/google/cel-spec\"\u003eCEL\u003c/a\u003e based authorization expressions. Each expression is expected to return \u003ccode\u003etrue\u003c/code\u003e to signal success. Otherwise, the authorization fails, resulting in the execution of the error handler mechanisms.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eTo enable the usage of this authorizer, you have to set the \u003ccode\u003etype\u003c/code\u003e property to \u003ccode\u003ecel\u003c/code\u003e.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eConfiguration using the \u003ccode\u003econfig\u003c/code\u003e property is mandatory. Following properties are available:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003eexpressions\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003e\u003ca href=\"/docs/configuration/types/#_authorization_expression\"\u003eAuthorization Expression\u003c/a\u003e array\u003c/em\u003e (mandatory, overridable)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eList of authorization expressions, which define the actual authorization logic. Each expression has access to the \u003ca href=\"/docs/mechanisms/evaluation_objects/#_subject\"\u003e\u003ccode\u003eSubject\u003c/code\u003e\u003c/a\u003e and the \u003ca href=\"/docs/mechanisms/evaluation_objects/#_request\"\u003e\u003ccode\u003eRequest\u003c/code\u003e\u003c/a\u003e objects.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"exampleblock\"\u003e\n\u003cdiv class=\"title\"\u003eExample 3. Authorization based on subject properties\u003c/div\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eIn this example the subject is checked to be member of the \u0026#34;admin\u0026#34; group.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"yaml\"\u003e\u003cspan class=\"na\"\u003eid\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003euser_is_admin\u003c/span\u003e\n\u003cspan class=\"na\"\u003etype\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ecel\u003c/span\u003e\n\u003cspan class=\"na\"\u003econfig\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eexpressions\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eexpression\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"pi\"\u003e|\u003c/span\u003e\n        \u003cspan class=\"s\"\u003ehas(Subject.Attributes.groups) \u0026amp;\u0026amp;\u003c/span\u003e\n        \u003cspan class=\"s\"\u003eSubject.Attributes.groups.exists(g, g == \u0026#34;admin\u0026#34;)\u003c/span\u003e\n      \u003cspan class=\"na\"\u003emessage\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eUser is not admin\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe first line of the expressions verifies that the property group exists. The second line checks, whether \u003ccode\u003egroups\u003c/code\u003e contains an entry named \u003ccode\u003eadmin\u003c/code\u003e.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThis example specifies also a message, which is logged, if the expression fails.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"exampleblock\"\u003e\n\u003cdiv class=\"title\"\u003eExample 4. Authorization based on subject and request properties\u003c/div\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eIn this example the authorizer is configured to ensure anonymous access to a resource is possible for read requests only.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"yaml\"\u003e\u003cspan class=\"na\"\u003eid\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eno_modification_allowed_by_anonymous\u003c/span\u003e\n\u003cspan class=\"na\"\u003etype\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ecel\u003c/span\u003e\n\u003cspan class=\"na\"\u003econfig\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eexpressions\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eexpression\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"pi\"\u003e|\u003c/span\u003e\n        \u003cspan class=\"s\"\u003eRequest.Method in [\u0026#34;GET\u0026#34;, \u0026#34;HEAD\u0026#34;, \u0026#34;OPTIONS\u0026#34;] || Subject.ID != \u0026#34;anonymous\u0026#34;\u003c/span\u003e\n      \u003cspan class=\"na\"\u003emessage\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eAnonymous non-read access is forbidden\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe usage of this type of configuration makes sense in a pipeline, which combines multiple \u003ca href=\"/docs/mechanisms/authenticators/\"\u003eAuthenticators\u003c/a\u003e, allowing anonymous and authenticated access.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_remote\"\u003eRemote\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThis authorizer allows communication with other systems, like \u003ca href=\"https://www.openpolicyagent.org/\"\u003eOpen Policy Agent\u003c/a\u003e, \u003ca href=\"https://www.ory.sh/docs/keto/\"\u003eOry Keto\u003c/a\u003e, etc. for the actual authorization purpose. If the used endpoint answers with a not 2xx HTTP response code, this authorizer assumes, the authorization has failed, resulting in the execution of the error handler mechanisms. Otherwise, if no expressions for the verification of the response are defined, the authorizer assumes, the request has been authorized. If expressions are defined and do not fail, the authorization succeeds.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eIf your authorization system provides a payload in the response, heimdall inspects the \u003ccode\u003eContent-Type\u003c/code\u003e header to prepare the payload for further usage, e.g. for payload verification expressions, or for a \u003ca href=\"#_local_cel\"\u003eLocal (CEL)\u003c/a\u003e authorizer. If the content type does either end with \u003ccode\u003ejson\u003c/code\u003e or is \u003ccode\u003eapplication/x-www-form-urlencoded\u003c/code\u003e, the payload is decoded, so key based access to the corresponding attributes is possible, otherwise it is made available as well, but as a simple string. In all cases this value is available for the authorization expressions as well as in the \u003ca href=\"/docs/mechanisms/evaluation_objects/#_subject\"\u003eSubject’s\u003c/a\u003e \u003ccode\u003eAttributes\u003c/code\u003e property under a key named by the \u003ccode\u003eid\u003c/code\u003e of the authorizer (See also the example below).\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eTo enable the usage of this authorizer, you have to set the \u003ccode\u003etype\u003c/code\u003e property to \u003ccode\u003eremote\u003c/code\u003e.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eConfiguration using the \u003ccode\u003econfig\u003c/code\u003e property is mandatory. Following properties are available:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003eendpoint\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003e\u003ca href=\"/docs/configuration/types/#_endpoint\"\u003eEndpoint\u003c/a\u003e\u003c/em\u003e (mandatory, not overridable)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe API endpoint of your authorization system. At least the \u003ccode\u003eurl\u003c/code\u003e must be configured. This mechanism allows templating of the url and makes the \u003ca href=\"/docs/mechanisms/evaluation_objects/#_subject\"\u003e\u003ccode\u003eSubject\u003c/code\u003e\u003c/a\u003e object, as well as the \u003ca href=\"/docs/mechanisms/evaluation_objects/#_values\"\u003e\u003ccode\u003eValues\u003c/code\u003e\u003c/a\u003e (see also below) objects available to it. By default, this authorizer will use HTTP \u003ccode\u003ePOST\u003c/code\u003e to send the rendered payload to this endpoint. You can override this behavior by configuring \u003ccode\u003emethod\u003c/code\u003e as well. Depending on the API requirements of your authorization system, you might need to configure further properties, like headers, etc.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003epayload\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003estring\u003c/em\u003e (optional, overridable)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eYour \u003ca href=\"/docs/mechanisms/evaluation_objects/#_templating\"\u003etemplate\u003c/a\u003e with definitions required to communicate to the authorization endpoint. The template can make use of \u003ca href=\"/docs/mechanisms/evaluation_objects/#_values\"\u003e\u003ccode\u003eValues\u003c/code\u003e\u003c/a\u003e, \u003ca href=\"/docs/mechanisms/evaluation_objects/#_subject\"\u003e\u003ccode\u003eSubject\u003c/code\u003e\u003c/a\u003e and \u003ca href=\"/docs/mechanisms/evaluation_objects/#_request\"\u003e\u003ccode\u003eRequest\u003c/code\u003e\u003c/a\u003e objects.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003eexpressions\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003e\u003ca href=\"/docs/configuration/types/#_authorization_expression\"\u003eAuthorization Expression\u003c/a\u003e array\u003c/em\u003e (optional, overridable)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eList of \u003ca href=\"https://github.com/google/cel-spec\"\u003eCEL\u003c/a\u003e expressions which define the logic to be applied to the response returned by the endpoint. All expressions are expected to evaluate to \u003ccode\u003etrue\u003c/code\u003e if the authorization was successful. If any of the expressions evaluates to \u003ccode\u003efalse\u003c/code\u003e, the authorization fails and the message defined by the failed expression will be logged.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eEach expression has access to the \u003ca href=\"/docs/mechanisms/evaluation_objects/#_payload\"\u003e\u003ccode\u003ePayload\u003c/code\u003e\u003c/a\u003e object.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003eforward_response_headers_to_upstream\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003estring array\u003c/em\u003e (optional, overridable)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eEnables forwarding of any headers from the authorization endpoint response to the upstream service.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003ecache_ttl\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003e\u003ca href=\"/docs/configuration/types/#_duration\"\u003eDuration\u003c/a\u003e\u003c/em\u003e (optional, overridable)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eAllows caching of the authorization endpoint responses. Defaults to 0s, which means no caching. The cache key is calculated from the entire configuration of the authorizer instance and the available information about the current subject.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003evalues\u003c/code\u003e\u003c/strong\u003e \u003cem\u003emap of strings\u003c/em\u003e (optional, overridable)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eA key value map, which is made accessible to the template rendering engine as \u003ca href=\"/docs/mechanisms/evaluation_objects/#_values\"\u003e\u003ccode\u003eValues\u003c/code\u003e\u003c/a\u003e object, to render parts of the URL and/or the payload. The actual values in that map can be templated as well with access to the \u003ca href=\"/docs/mechanisms/evaluation_objects/#_subject\"\u003e\u003ccode\u003eSubject\u003c/code\u003e\u003c/a\u003e and \u003ca href=\"/docs/mechanisms/evaluation_objects/#_request\"\u003e\u003ccode\u003eRequest\u003c/code\u003e\u003c/a\u003e objects.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"exampleblock\"\u003e\n\u003cdiv class=\"title\"\u003eExample 5. Configuration of Remote authorizer to communicate with \u003ca href=\"https://www.openpolicyagent.org/\"\u003eOpen Policy Agent\u003c/a\u003e (OPA)\u003c/div\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eHere the remote authorizer is configured to communicate with OPA. Since OPA expects the query to be formatted as JSON, the corresponding \u003ccode\u003eContent-Type\u003c/code\u003e header is set. Since the responses are JSON objects as well, the \u003ccode\u003eAccept\u003c/code\u003e header is also provided. In addition, this examples uses the \u003ccode\u003ebasic_auth\u003c/code\u003e auth type to authenticate against the endpoint.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"yaml\"\u003e\u003cspan class=\"na\"\u003eid\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eopa\u003c/span\u003e\n\u003cspan class=\"na\"\u003etype\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eremote\u003c/span\u003e\n\u003cspan class=\"na\"\u003econfig\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eendpoint\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"na\"\u003eurl\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ehttps://opa.local/v1/data/{{ .Values.namespace }}/{{ .Values.policy }}\u003c/span\u003e\n    \u003cspan class=\"na\"\u003eheaders\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"na\"\u003eContent-Type\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ejson\u003c/span\u003e\n      \u003cspan class=\"na\"\u003eAccept\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ejson\u003c/span\u003e\n    \u003cspan class=\"na\"\u003eauth\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"na\"\u003etype\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ebasic_auth\u003c/span\u003e\n      \u003cspan class=\"na\"\u003econfig\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"na\"\u003euser\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e${OPA_USER}\u003c/span\u003e\n        \u003cspan class=\"na\"\u003epassword\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e${OPA_PASSWORD}\u003c/span\u003e\n  \u003cspan class=\"na\"\u003epayload\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"pi\"\u003e|\u003c/span\u003e\n    \u003cspan class=\"s\"\u003e{ \u0026#34;input\u0026#34;: { \u0026#34;user\u0026#34;: {{ quote .Subject.ID }} }, \u0026#34;some_data\u0026#34;: {{ quote .Values.whatever }} }\u003c/span\u003e\n  \u003cspan class=\"na\"\u003evalues\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"na\"\u003enamespace\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003emyapi/policy\u003c/span\u003e\n    \u003cspan class=\"na\"\u003epolicy\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eallow_write\u003c/span\u003e\n    \u003cspan class=\"na\"\u003ewhatever\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"pi\"\u003e|\u003c/span\u003e\n     \u003cspan class=\"s\"\u003e{{ .Request.Header(\u0026#34;X-Whatever\u0026#34;) }}\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eexpressions\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eexpression\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"pi\"\u003e|\u003c/span\u003e\n        \u003cspan class=\"s\"\u003ePayload.result == true\u003c/span\u003e\n      \u003cspan class=\"na\"\u003emessage\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eUser does not have required permissions\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eIn this case, since an OPA response could look like \u003ccode\u003e{ \u0026#34;result\u0026#34;: true }\u003c/code\u003e or \u003ccode\u003e{ \u0026#34;result\u0026#34;: false }\u003c/code\u003e, heimdall makes the response also available under \u003ccode\u003eSubject.Attributes[\u0026#34;opa\u0026#34;]\u003c/code\u003e as a map, with \u003ccode\u003e\u0026#34;opa\u0026#34;\u003c/code\u003e being the id of the authorizer in this example.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eA specific rule could then use this authorizer in the following ways:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"yaml\"\u003e\u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eid\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003erule1\u003c/span\u003e\n  \u003cspan class=\"c1\"\u003e# other rule properties\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eexecute\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"c1\"\u003e# other mechanisms\u003c/span\u003e\n  \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eauthorizer\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eopa\u003c/span\u003e \u003cspan class=\"c1\"\u003e# using defaults\u003c/span\u003e\n  \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"c1\"\u003e# other mechanisms\u003c/span\u003e\n\n\u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eid\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003erule2\u003c/span\u003e\n  \u003cspan class=\"c1\"\u003e# other rule properties\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eexecute\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"c1\"\u003e# other mechanisms\u003c/span\u003e\n  \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eauthorizer\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eopa\u003c/span\u003e\n    \u003cspan class=\"na\"\u003econfig\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"c1\"\u003e# overriding with rule specifics\u003c/span\u003e\n      \u003cspan class=\"na\"\u003evalues\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"na\"\u003epolicy\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eallow_read\u003c/span\u003e\n        \u003cspan class=\"na\"\u003ewhatever\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"pi\"\u003e|\u003c/span\u003e\n          \u003cspan class=\"s\"\u003e{{ .Request.Header(\u0026#34;X-SomethingElse\u0026#34;) }}\u003c/span\u003e\n  \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"c1\"\u003e# other mechanisms\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n","sections":["Mechanisms"],"tags":null,"title":"Authorizers","url":"/docs/mechanisms/authorizers/"},{"categories":null,"content":" Some of the contextualizers may support or require additional configuration. The corresponding properties are annotated with mandatory, respectively optional to denote configuration requirement, as well as with overridable, not overriddable and partially overridable to indicate whether the property can be overridden in a rule pipeline.\nGeneric This mechanism allows you to communicate to any API you want to fetch further information about the subject. Typical scenario is getting specific attributes for later authorization purposes which are not known to the authentication system and thus were not made available in Subject’s Attributes property. If the API responses with a 2xx HTTP response code, the payload is made available in the Attributes property of the Subject, otherwise, if not overridden, an error is thrown and the execution of the authentication \u0026amp; authorization pipeline stops. To avoid overwriting of existing attributes, this object is however not available on the top level, but under a key named by the id of the authorizer (See also the example below). If the Content-Type of the response is either ending with json or is application/x-www-form-urlencoded, the payload is decoded and made available as map, otherwise it is treated as string, but, as written above, is made available as well.\nTo enable the usage of this contextualizer, you have to set the type property to generic.\nConfiguration using the config property is mandatory. Following properties are available:\nendpoint: Endpoint (mandatory, not overridable)\nThe API of the service providing additional attributes about the authenticated user. At least the url must be configured. This mechanism allows templating of the url and makes the Subject object, as well as the Values (see also below) objects available to it. By default, this contextualizer will use HTTP POST to send the rendered payload to this endpoint. You can override this behavior by configuring method as well. Depending on the API requirements of the system, this contextualizer should communicate to, you might need to configure further properties, like headers, etc.\nforward_headers: string array (optional, overridable)\nIf the API requires any headers from the request to heimdall, you can forward these unchanged by making use of this property\nforward_cookies: string array (optional, overridable)\nIf the API requires any cookies from the request to heimdall, you can forward these unchanged by making use of this property.\npayload: string (optional, overridable)\nYour template with definitions required to communicate to the endpoint. The template can make use of Values, Subject and Request objects.\ncache_ttl: Duration (optional, overridable)\nAllows caching of the API responses. Defaults to 10 seconds. The cache key is calculated from the entire configuration of the contextualizer instance and the available information about the current subject.\ncontinue_pipeline_on_error: boolean (optional, overridable)\nIf set to true, allows the pipeline to continue with the execution of the next mechanisms. So the error, if thrown, is ignored. Defaults to false, which means the execution of the authentication \u0026amp; authorization pipeline is stopped and the execution of the error pipeline is started.\nvalues map of strings (optional, overridable)\nA key value map, which is made accessible to the template rendering engine as Values object to render parts of the URL and/or the payload. The actual values in that map can be templated as well with access to the Subject and Request objects.\nExample 1. Contextualizer configuration without payload In this example the contextualizer is configured to call an endpoint using the HTTP GET method with the subject id being part of the url path. As the endpoint requires the X-My-Session-Cookie cookie for subject authentication purposes, forward_cookies is used to achieve this.\nid: foo type: generic config: endpoint: url: https://some-other.service/users/{{.Subject.ID}} method: GET forward_cookies: - X-My-Session-Cookie Example 2. Contextualizer configuration with payload In this example the contextualizer is configured to call an endpoint using the HTTP POST and send some data.\nid: foo type: generic config: endpoint: url: https://some-other.service/users method: POST payload: | { \u0026#34;user_id\u0026#34;: {{ quote .Values.user_id }} \u0026#34;whatever\u0026#34;: {{ quote .Values.whatever }} } Since the values property is not defined but used in the payload, it must be specified in a rule making use of this contextualzer, e.g. in the following way:\n- id: rule1 # other rule properties execute: - # other mechanisms - contextualizer: foo config: # overriding with rule specifics values: user_id: \u0026#34;{{ .Subject.ID }}\u0026#34; whatever: \u0026#34;some value\u0026#34; - # other mechanisms ","description":"Contextualizers allow you enriching the information about the request and the authenticated subject. This page describes the available contextualizer types in detail.","html_content":"\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eSome of the contextualizers may support or require additional configuration. The corresponding properties are annotated with \u003ccode\u003emandatory\u003c/code\u003e, respectively \u003ccode\u003eoptional\u003c/code\u003e to denote configuration requirement, as well as with \u003ccode\u003eoverridable\u003c/code\u003e, \u003ccode\u003enot overriddable\u003c/code\u003e and \u003ccode\u003epartially overridable\u003c/code\u003e to indicate whether the property can be overridden in a rule pipeline.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_generic\"\u003eGeneric\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThis mechanism allows you to communicate to any API you want to fetch further information about the subject. Typical scenario is getting specific attributes for later authorization purposes which are not known to the authentication system and thus were not made available in \u003ca href=\"/docs/mechanisms/evaluation_objects/#_subject\"\u003e\u003ccode\u003eSubject’s\u003c/code\u003e\u003c/a\u003e \u003ccode\u003eAttributes\u003c/code\u003e property. If the API responses with a 2xx HTTP response code, the payload is made available in the \u003ccode\u003eAttributes\u003c/code\u003e property of the \u003ccode\u003eSubject\u003c/code\u003e, otherwise, if not overridden, an error is thrown and the execution of the authentication \u0026amp; authorization pipeline stops. To avoid overwriting of existing attributes, this object is however not available on the top level, but under a key named by the \u003ccode\u003eid\u003c/code\u003e of the authorizer (See also the example below). If the \u003ccode\u003eContent-Type\u003c/code\u003e of the response is either ending with \u003ccode\u003ejson\u003c/code\u003e or is \u003ccode\u003eapplication/x-www-form-urlencoded\u003c/code\u003e, the payload is decoded and made available as map, otherwise it is treated as string, but, as written above, is made available as well.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eTo enable the usage of this contextualizer, you have to set the \u003ccode\u003etype\u003c/code\u003e property to \u003ccode\u003egeneric\u003c/code\u003e.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eConfiguration using the \u003ccode\u003econfig\u003c/code\u003e property is mandatory. Following properties are available:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003eendpoint\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003e\u003ca href=\"/docs/configuration/types/#_endpoint\"\u003eEndpoint\u003c/a\u003e\u003c/em\u003e (mandatory, not overridable)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe API of the service providing additional attributes about the authenticated user. At least the \u003ccode\u003eurl\u003c/code\u003e must be configured. This mechanism allows templating of the url and makes the \u003ca href=\"/docs/mechanisms/evaluation_objects/#_subject\"\u003e\u003ccode\u003eSubject\u003c/code\u003e\u003c/a\u003e object, as well as the \u003ca href=\"/docs/mechanisms/evaluation_objects/#_values\"\u003e\u003ccode\u003eValues\u003c/code\u003e\u003c/a\u003e (see also below) objects available to it. By default, this contextualizer will use HTTP \u003ccode\u003ePOST\u003c/code\u003e to send the rendered payload to this endpoint. You can override this behavior by configuring \u003ccode\u003emethod\u003c/code\u003e as well. Depending on the API requirements of the system, this contextualizer should communicate to, you might need to configure further properties, like headers, etc.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003eforward_headers\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003estring array\u003c/em\u003e (optional, overridable)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eIf the API requires any headers from the request to heimdall, you can forward these unchanged by making use of this property\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003eforward_cookies\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003estring array\u003c/em\u003e (optional, overridable)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eIf the API requires any cookies from the request to heimdall, you can forward these unchanged by making use of this property.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003epayload\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003estring\u003c/em\u003e (optional, overridable)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eYour \u003ca href=\"/docs/mechanisms/evaluation_objects/#_templating\"\u003etemplate\u003c/a\u003e with definitions required to communicate to the endpoint. The template can make use of \u003ca href=\"/docs/mechanisms/evaluation_objects/#_values\"\u003e\u003ccode\u003eValues\u003c/code\u003e\u003c/a\u003e, \u003ca href=\"/docs/mechanisms/evaluation_objects/#_subject\"\u003e\u003ccode\u003eSubject\u003c/code\u003e\u003c/a\u003e and \u003ca href=\"/docs/mechanisms/evaluation_objects/#_request\"\u003e\u003ccode\u003eRequest\u003c/code\u003e\u003c/a\u003e objects.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003ecache_ttl\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003e\u003ca href=\"/docs/configuration/types/#_duration\"\u003eDuration\u003c/a\u003e\u003c/em\u003e (optional, overridable)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eAllows caching of the API responses. Defaults to 10 seconds. The cache key is calculated from the entire configuration of the contextualizer instance and the available information about the current subject.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003econtinue_pipeline_on_error\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003eboolean\u003c/em\u003e (optional, overridable)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eIf set to \u003ccode\u003etrue\u003c/code\u003e, allows the pipeline to continue with the execution of the next mechanisms. So the error, if thrown, is ignored. Defaults to \u003ccode\u003efalse\u003c/code\u003e, which means the execution of the authentication \u0026amp; authorization pipeline is stopped and the execution of the error pipeline is started.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003evalues\u003c/code\u003e\u003c/strong\u003e \u003cem\u003emap of strings\u003c/em\u003e (optional, overridable)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eA key value map, which is made accessible to the template rendering engine as \u003ca href=\"/docs/mechanisms/evaluation_objects/#_values\"\u003e\u003ccode\u003eValues\u003c/code\u003e\u003c/a\u003e object to render parts of the URL and/or the payload. The actual values in that map can be templated as well with access to the \u003ca href=\"/docs/mechanisms/evaluation_objects/#_subject\"\u003e\u003ccode\u003eSubject\u003c/code\u003e\u003c/a\u003e and \u003ca href=\"/docs/mechanisms/evaluation_objects/#_request\"\u003e\u003ccode\u003eRequest\u003c/code\u003e\u003c/a\u003e objects.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"exampleblock\"\u003e\n\u003cdiv class=\"title\"\u003eExample 1. Contextualizer configuration without payload\u003c/div\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eIn this example the contextualizer is configured to call an endpoint using the HTTP \u003ccode\u003eGET\u003c/code\u003e method with the subject id being part of the url path. As the endpoint requires the \u003ccode\u003eX-My-Session-Cookie\u003c/code\u003e cookie for subject authentication purposes, \u003ccode\u003eforward_cookies\u003c/code\u003e is used to achieve this.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"yaml\"\u003e\u003cspan class=\"na\"\u003eid\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003efoo\u003c/span\u003e\n\u003cspan class=\"na\"\u003etype\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003egeneric\u003c/span\u003e\n\u003cspan class=\"na\"\u003econfig\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eendpoint\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"na\"\u003eurl\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ehttps://some-other.service/users/{{.Subject.ID}}\u003c/span\u003e\n    \u003cspan class=\"na\"\u003emethod\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eGET\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eforward_cookies\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003eX-My-Session-Cookie\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"exampleblock\"\u003e\n\u003cdiv class=\"title\"\u003eExample 2. Contextualizer configuration with payload\u003c/div\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eIn this example the contextualizer is configured to call an endpoint using the HTTP \u003ccode\u003ePOST\u003c/code\u003e and send some data.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"yaml\"\u003e\u003cspan class=\"na\"\u003eid\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003efoo\u003c/span\u003e\n\u003cspan class=\"na\"\u003etype\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003egeneric\u003c/span\u003e\n\u003cspan class=\"na\"\u003econfig\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eendpoint\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"na\"\u003eurl\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ehttps://some-other.service/users\u003c/span\u003e\n    \u003cspan class=\"na\"\u003emethod\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ePOST\u003c/span\u003e\n  \u003cspan class=\"na\"\u003epayload\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"pi\"\u003e|\u003c/span\u003e\n    \u003cspan class=\"s\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"s\"\u003e\u0026#34;user_id\u0026#34;: {{ quote .Values.user_id }}\u003c/span\u003e\n      \u003cspan class=\"s\"\u003e\u0026#34;whatever\u0026#34;: {{ quote .Values.whatever }}\u003c/span\u003e\n    \u003cspan class=\"s\"\u003e}\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eSince the \u003ccode\u003evalues\u003c/code\u003e property is not defined but used in the payload, it must be specified in a rule making use of this contextualzer, e.g. in the following way:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"yaml\"\u003e\u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eid\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003erule1\u003c/span\u003e\n  \u003cspan class=\"c1\"\u003e# other rule properties\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eexecute\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"c1\"\u003e# other mechanisms\u003c/span\u003e\n  \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003econtextualizer\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003efoo\u003c/span\u003e\n    \u003cspan class=\"na\"\u003econfig\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"c1\"\u003e# overriding with rule specifics\u003c/span\u003e\n      \u003cspan class=\"na\"\u003evalues\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"na\"\u003euser_id\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"s\"\u003e{{\u003c/span\u003e\u003cspan class=\"nv\"\u003e \u003c/span\u003e\u003cspan class=\"s\"\u003e.Subject.ID\u003c/span\u003e\u003cspan class=\"nv\"\u003e \u003c/span\u003e\u003cspan class=\"s\"\u003e}}\u0026#34;\u003c/span\u003e\n        \u003cspan class=\"na\"\u003ewhatever\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"s\"\u003esome\u003c/span\u003e\u003cspan class=\"nv\"\u003e \u003c/span\u003e\u003cspan class=\"s\"\u003evalue\u0026#34;\u003c/span\u003e\n  \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"c1\"\u003e# other mechanisms\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n","sections":["Mechanisms"],"tags":null,"title":"Contextualizers","url":"/docs/mechanisms/contextualizers/"},{"categories":null,"content":" Some finalizers may support or require additional configuration. The corresponding properties are annotated with mandatory, respectively optional to denote configuration requirement, as well as with overridable, not overriddable and partially overridable to indicate whether the property can be overridden in a rule pipeline.\nNoop As the name implies, this finalizer does nothing. This finalizer type also doesn’t have any configuration options.\nTo enable the usage of this finalizer, you have to set the type property to noop.\nExample 1. Noop finalizer configuration id: foo type: noop Header This finalizer enables transformation of a Subject into HTTP headers. It can also be used to map information from the original Request into headers expected by the upstream service.\nTo enable the usage of this finalizer, you have to set the type property to header.\nConfiguration using the config property is mandatory. Following properties are available:\nheaders: string map (mandatory, overridable)\nEnables configuration of arbitrary headers with any values build from available subject and request information (See also Templating).\nExample 2. Header finalizer configuration id: foo type: header config: headers: X-User-ID: \u0026#39;{{ quote .Subject.ID }}\u0026#39; X-User-Email: \u0026#39;{{ index .Subject.Attributes \u0026#34;email\u0026#34; | quote }}\u0026#39; Host: \u0026#39;{{ .Request.Header \u0026#34;Host\u0026#34; | quote }}\u0026#39; Cookie This finalizer enables transformation of a Subject into cookies. It can also be used to map information from the original Request into cookies expected by the upstream service.\nTo enable the usage of this finalizer, you have to set the type property to cookie.\nConfiguration using the config property is mandatory. Following properties are available:\ncookies: string map (mandatory, overridable)\nEnables configuration of arbitrary cookies with any values build from available subject information (See also Templating).\nExample 3. Cookie finalizer configuration id: foo type: cookies config: cookies: user_id_cookie: \u0026#39;{{ quote .Subject.ID }}\u0026#39; user_email_cookie: \u0026#39;{{ index .Subject.Attributes \u0026#34;email\u0026#34; | quote }}\u0026#39; JWT This finalizer enables transformation of the Subject object into a token in a JWT format, which is then made available to your upstream service in either the HTTP Authorization header with Bearer scheme set, or in a custom header. In addition to setting the JWT specific claims, it allows setting custom claims as well. Your upstream service can then verify the signature of the JWT by making use of heimdall’s JWKS endpoint to retrieve the required public keys/certificates from.\nTo enable the usage of this finalizer, you have to set the type property to jwt.\nThe usage of this finalizer type requires a configured Signer as well. At least it is a must in production environments. Configuration using the config property is optional. Following properties are available:\nclaims: string (optional, overridable)\nYour template with custom claims, you would like to add to the JWT (See also Templating).\nttl: Duration (optional, overridable)\nDefines how long the JWT should be valid. Defaults to 5 minutes. Heimdall sets the iat and the nbf claims to the current system time. The value of the exp claim is then influenced by the ttl property.\nheader: object (optional, not overridable)\nDefines the name and scheme to be used for the header. Defaults to Authorization with scheme Bearer. If defined, the name property must be set. If scheme is not defined, no scheme will be prepended to the resulting JWT.\nThe generated JWT is always cached until 5 seconds before its expiration. The cache key is calculated from the entire configuration of the finalizer instance and the available information about the current subject.\nExample 4. JWT finalizer configuration id: jwt_finalizer type: jwt config: ttl: 5m header: name: X-Token claims: | { {{ $user_name := .Subject.Attributes.identity.user_name -}} \u0026#34;email\u0026#34;: {{ quote .Subject.Attributes.identity.email }}, \u0026#34;email_verified\u0026#34;: {{ .Subject.Attributes.identity.email_verified }}, \u0026#34;name\u0026#34;: {{ if $user_name }}{{ quote $user_name }}{{ else }}{{ quote $email }}{{ end }} } OAuth2 Client Credentials This finalizer drives the OAuth2 Client Credentials Grant flow to obtain a token, which should be used for communication with the upstream service. By default, as long as not otherwise configured (see the options below), the obtained token is made available to your upstream service in the HTTP Authorization header with Bearer scheme set. Unlike the other finalizers, it does not have access to any objects created by the rule execution pipeline.\nTo enable the usage of this finalizer, you have to set the type property to oauth2_client_credentials.\nConfiguration using the config property is mandatory. Following properties are available:\ntoken_url: string (mandatory, not overridable)\nThe token endpoint of the authorization server.\nclient_id: string (mandatory, not overridable)\nThe client identifier for heimdall.\nclient_secret: string (mandatory, not overridable)\nThe client secret for heimdall.\nauth_method: string (optional, not overridable)\nThe authentication method to be used according to RFC 6749, Client Password. Can be one of\nbasic_auth (default if auth_method is not set): With that authentication method, the \u0026#34;application/x-www-form-urlencoded\u0026#34; encoded values of client_id and client_secret are sent to the authorization server via the Authorization header using the Basic scheme.\nrequest_body: With that authentication method the client_id and client_secret are sent in the request body together with the other parameters (e.g. scopes) defined by the flow.\nUsage of request_body authentication method is not recommended and should be avoided. scopes: string array (optional, overridable)\nThe scopes required for the access token.\ncache_ttl: Duration (optional, overridable)\nHow long to cache the token received from the token endpoint. Defaults to the token expiration information from the token endpoint (the value of the expires_in field) if present. If the token expiration inforation is not present and cache_ttl is not configured, the received token is not cached. If the token expiration information is present in the response and cache_ttl is configured the shorter value is taken. If caching is enabled, the token is cached until 5 seconds before its expiration. To disable caching, set it to 0s. The cache key calculation is based on the entire oauth2_client_credentials configuration without considering the header property.\nheader: object (optional, overridable)\nDefines the name and scheme to be used for the header. Defaults to Authorization with scheme Bearer. If defined, the name property must be set. If scheme is not defined, no scheme will be prepended to the resulting JWT.\nExample 5. OAuth2 Client Credentials finalizer configuration id: get_token type: oauth2_client_credentials config: cache_ttl: 5m header: name: X-Token scheme: MyScheme token_url: https://my-oauth-provider.com/token client_id: my_client client_secret: VerySecret! auth_method: basic_auth scopes: - foo - bar ","description":"Finalizers are the last steps executed in a rule pipeline and can e.g. create a special representation of the subject to be made available to the upstream service. This page describes the available finalizer types in detail.","html_content":"\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eSome finalizers may support or require additional configuration. The corresponding properties are annotated with \u003ccode\u003emandatory\u003c/code\u003e, respectively \u003ccode\u003eoptional\u003c/code\u003e to denote configuration requirement, as well as with \u003ccode\u003eoverridable\u003c/code\u003e, \u003ccode\u003enot overriddable\u003c/code\u003e and \u003ccode\u003epartially overridable\u003c/code\u003e to indicate whether the property can be overridden in a rule pipeline.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_noop\"\u003eNoop\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eAs the name implies, this finalizer does nothing. This finalizer type also doesn’t have any configuration options.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eTo enable the usage of this finalizer, you have to set the \u003ccode\u003etype\u003c/code\u003e property to \u003ccode\u003enoop\u003c/code\u003e.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"exampleblock\"\u003e\n\u003cdiv class=\"title\"\u003eExample 1. Noop finalizer configuration\u003c/div\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"yaml\"\u003e\u003cspan class=\"na\"\u003eid\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003efoo\u003c/span\u003e\n\u003cspan class=\"na\"\u003etype\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003enoop\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_header\"\u003eHeader\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThis finalizer enables transformation of a \u003ca href=\"/docs/mechanisms/evaluation_objects/#_subject\"\u003e\u003ccode\u003eSubject\u003c/code\u003e\u003c/a\u003e into HTTP headers. It can also be used to map information from the original \u003ca href=\"/docs/mechanisms/evaluation_objects/#_request\"\u003e\u003ccode\u003eRequest\u003c/code\u003e\u003c/a\u003e into headers expected by the upstream service.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eTo enable the usage of this finalizer, you have to set the \u003ccode\u003etype\u003c/code\u003e property to \u003ccode\u003eheader\u003c/code\u003e.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eConfiguration using the \u003ccode\u003econfig\u003c/code\u003e property is mandatory. Following properties are available:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003eheaders\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003estring map\u003c/em\u003e (mandatory, overridable)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eEnables configuration of arbitrary headers with any values build from available subject and request information (See also \u003ca href=\"/docs/mechanisms/evaluation_objects/#_templating\"\u003eTemplating\u003c/a\u003e).\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"exampleblock\"\u003e\n\u003cdiv class=\"title\"\u003eExample 2. Header finalizer configuration\u003c/div\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"yaml\"\u003e\u003cspan class=\"na\"\u003eid\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003efoo\u003c/span\u003e\n\u003cspan class=\"na\"\u003etype\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eheader\u003c/span\u003e\n\u003cspan class=\"na\"\u003econfig\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eheaders\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"na\"\u003eX-User-ID\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"s\"\u003e{{\u003c/span\u003e\u003cspan class=\"nv\"\u003e \u003c/span\u003e\u003cspan class=\"s\"\u003equote\u003c/span\u003e\u003cspan class=\"nv\"\u003e \u003c/span\u003e\u003cspan class=\"s\"\u003e.Subject.ID\u003c/span\u003e\u003cspan class=\"nv\"\u003e \u003c/span\u003e\u003cspan class=\"s\"\u003e}}\u0026#39;\u003c/span\u003e\n    \u003cspan class=\"na\"\u003eX-User-Email\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"s\"\u003e{{\u003c/span\u003e\u003cspan class=\"nv\"\u003e \u003c/span\u003e\u003cspan class=\"s\"\u003eindex\u003c/span\u003e\u003cspan class=\"nv\"\u003e \u003c/span\u003e\u003cspan class=\"s\"\u003e.Subject.Attributes\u003c/span\u003e\u003cspan class=\"nv\"\u003e \u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;email\u0026#34;\u003c/span\u003e\u003cspan class=\"nv\"\u003e \u003c/span\u003e\u003cspan class=\"s\"\u003e|\u003c/span\u003e\u003cspan class=\"nv\"\u003e \u003c/span\u003e\u003cspan class=\"s\"\u003equote\u003c/span\u003e\u003cspan class=\"nv\"\u003e \u003c/span\u003e\u003cspan class=\"s\"\u003e}}\u0026#39;\u003c/span\u003e\n    \u003cspan class=\"na\"\u003eHost\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"s\"\u003e{{\u003c/span\u003e\u003cspan class=\"nv\"\u003e \u003c/span\u003e\u003cspan class=\"s\"\u003e.Request.Header\u003c/span\u003e\u003cspan class=\"nv\"\u003e \u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;Host\u0026#34;\u003c/span\u003e\u003cspan class=\"nv\"\u003e \u003c/span\u003e\u003cspan class=\"s\"\u003e|\u003c/span\u003e\u003cspan class=\"nv\"\u003e \u003c/span\u003e\u003cspan class=\"s\"\u003equote\u003c/span\u003e\u003cspan class=\"nv\"\u003e  \u003c/span\u003e\u003cspan class=\"s\"\u003e}}\u0026#39;\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_cookie\"\u003eCookie\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThis finalizer enables transformation of a \u003ca href=\"/docs/mechanisms/evaluation_objects/#_subject\"\u003e\u003ccode\u003eSubject\u003c/code\u003e\u003c/a\u003e into cookies. It can also be used to map information from the original \u003ca href=\"/docs/mechanisms/evaluation_objects/#_request\"\u003e\u003ccode\u003eRequest\u003c/code\u003e\u003c/a\u003e into cookies expected by the upstream service.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eTo enable the usage of this finalizer, you have to set the \u003ccode\u003etype\u003c/code\u003e property to \u003ccode\u003ecookie\u003c/code\u003e.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eConfiguration using the \u003ccode\u003econfig\u003c/code\u003e property is mandatory. Following properties are available:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003ecookies\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003estring map\u003c/em\u003e (mandatory, overridable)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eEnables configuration of arbitrary cookies with any values build from available subject information (See also \u003ca href=\"/docs/mechanisms/evaluation_objects/#_templating\"\u003eTemplating\u003c/a\u003e).\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"exampleblock\"\u003e\n\u003cdiv class=\"title\"\u003eExample 3. Cookie finalizer configuration\u003c/div\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"yaml\"\u003e\u003cspan class=\"na\"\u003eid\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003efoo\u003c/span\u003e\n\u003cspan class=\"na\"\u003etype\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ecookies\u003c/span\u003e\n\u003cspan class=\"na\"\u003econfig\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"na\"\u003ecookies\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"na\"\u003euser_id_cookie\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"s\"\u003e{{\u003c/span\u003e\u003cspan class=\"nv\"\u003e \u003c/span\u003e\u003cspan class=\"s\"\u003equote\u003c/span\u003e\u003cspan class=\"nv\"\u003e \u003c/span\u003e\u003cspan class=\"s\"\u003e.Subject.ID\u003c/span\u003e\u003cspan class=\"nv\"\u003e \u003c/span\u003e\u003cspan class=\"s\"\u003e}}\u0026#39;\u003c/span\u003e\n    \u003cspan class=\"na\"\u003euser_email_cookie\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"s\"\u003e{{\u003c/span\u003e\u003cspan class=\"nv\"\u003e \u003c/span\u003e\u003cspan class=\"s\"\u003eindex\u003c/span\u003e\u003cspan class=\"nv\"\u003e \u003c/span\u003e\u003cspan class=\"s\"\u003e.Subject.Attributes\u003c/span\u003e\u003cspan class=\"nv\"\u003e \u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;email\u0026#34;\u003c/span\u003e\u003cspan class=\"nv\"\u003e \u003c/span\u003e\u003cspan class=\"s\"\u003e|\u003c/span\u003e\u003cspan class=\"nv\"\u003e \u003c/span\u003e\u003cspan class=\"s\"\u003equote\u003c/span\u003e\u003cspan class=\"nv\"\u003e \u003c/span\u003e\u003cspan class=\"s\"\u003e}}\u0026#39;\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_jwt\"\u003eJWT\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThis finalizer enables transformation of the \u003ca href=\"/docs/mechanisms/evaluation_objects/#_subject\"\u003e\u003ccode\u003eSubject\u003c/code\u003e\u003c/a\u003e object into a token in a \u003ca href=\"https://www.rfc-editor.org/rfc/rfc7519\"\u003eJWT\u003c/a\u003e format, which is then made available to your upstream service in either the HTTP \u003ccode\u003eAuthorization\u003c/code\u003e header with \u003ccode\u003eBearer\u003c/code\u003e scheme set, or in a custom header. In addition to setting the JWT specific claims, it allows setting custom claims as well. Your upstream service can then verify the signature of the JWT by making use of heimdall’s JWKS endpoint to retrieve the required public keys/certificates from.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eTo enable the usage of this finalizer, you have to set the \u003ccode\u003etype\u003c/code\u003e property to \u003ccode\u003ejwt\u003c/code\u003e.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"admonitionblock note\"\u003e\n\u003ctable\u003e\n\u003ctbody\u003e\u003ctr\u003e\n\u003ctd class=\"icon\"\u003e\n\u003ci class=\"fa icon-note\" title=\"Note\"\u003e\u003c/i\u003e\n\u003c/td\u003e\n\u003ctd class=\"content\"\u003e\nThe usage of this finalizer type requires a configured \u003ca href=\"/docs/operations/security/#_signatures\"\u003eSigner\u003c/a\u003e as well. At least it is a must in production environments.\n\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eConfiguration using the \u003ccode\u003econfig\u003c/code\u003e property is optional. Following properties are available:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003eclaims\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003estring\u003c/em\u003e (optional, overridable)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eYour template with custom claims, you would like to add to the JWT (See also \u003ca href=\"/docs/mechanisms/evaluation_objects/#_templating\"\u003eTemplating\u003c/a\u003e).\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003ettl\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003e\u003ca href=\"/docs/configuration/types/#_duration\"\u003eDuration\u003c/a\u003e\u003c/em\u003e (optional, overridable)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eDefines how long the JWT should be valid. Defaults to 5 minutes. Heimdall sets the \u003ccode\u003eiat\u003c/code\u003e and the \u003ccode\u003enbf\u003c/code\u003e claims to the current system time. The value of the \u003ccode\u003eexp\u003c/code\u003e claim is then influenced by the \u003ccode\u003ettl\u003c/code\u003e property.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003eheader\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003eobject\u003c/em\u003e (optional, not overridable)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eDefines the \u003ccode\u003ename\u003c/code\u003e and \u003ccode\u003escheme\u003c/code\u003e to be used for the header. Defaults to \u003ccode\u003eAuthorization\u003c/code\u003e with scheme \u003ccode\u003eBearer\u003c/code\u003e. If defined, the \u003ccode\u003ename\u003c/code\u003e property must be set. If \u003ccode\u003escheme\u003c/code\u003e is not defined, no scheme will be prepended to the resulting JWT.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe generated JWT is always cached until 5 seconds before its expiration. The cache key is calculated from the entire configuration of the finalizer instance and the available information about the current subject.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"exampleblock\"\u003e\n\u003cdiv class=\"title\"\u003eExample 4. JWT finalizer configuration\u003c/div\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"yaml\"\u003e\u003cspan class=\"na\"\u003eid\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ejwt_finalizer\u003c/span\u003e\n\u003cspan class=\"na\"\u003etype\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ejwt\u003c/span\u003e\n\u003cspan class=\"na\"\u003econfig\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"na\"\u003ettl\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e5m\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eheader\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"na\"\u003ename\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eX-Token\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eclaims\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"pi\"\u003e|\u003c/span\u003e\n    \u003cspan class=\"s\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"s\"\u003e{{ $user_name := .Subject.Attributes.identity.user_name -}}\u003c/span\u003e\n      \u003cspan class=\"s\"\u003e\u0026#34;email\u0026#34;: {{ quote .Subject.Attributes.identity.email }},\u003c/span\u003e\n      \u003cspan class=\"s\"\u003e\u0026#34;email_verified\u0026#34;: {{ .Subject.Attributes.identity.email_verified }},\u003c/span\u003e\n      \u003cspan class=\"s\"\u003e\u0026#34;name\u0026#34;: {{ if $user_name }}{{ quote $user_name }}{{ else }}{{ quote $email }}{{ end }}\u003c/span\u003e\n    \u003cspan class=\"s\"\u003e}\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_oauth2_client_credentials\"\u003eOAuth2 Client Credentials\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThis finalizer drives the \u003ca href=\"https://www.rfc-editor.org/rfc/rfc6749#section-4.4\"\u003eOAuth2 Client Credentials Grant\u003c/a\u003e flow to obtain a token, which should be used for communication with the upstream service. By default, as long as not otherwise configured (see the options below), the obtained token is made available to your upstream service in the HTTP \u003ccode\u003eAuthorization\u003c/code\u003e header with \u003ccode\u003eBearer\u003c/code\u003e scheme set. Unlike the other finalizers, it does not have access to any objects created by the rule execution pipeline.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eTo enable the usage of this finalizer, you have to set the \u003ccode\u003etype\u003c/code\u003e property to \u003ccode\u003eoauth2_client_credentials\u003c/code\u003e.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eConfiguration using the \u003ccode\u003econfig\u003c/code\u003e property is mandatory. Following properties are available:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003etoken_url\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003estring\u003c/em\u003e (mandatory, not overridable)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe token endpoint of the authorization server.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003eclient_id\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003estring\u003c/em\u003e (mandatory, not overridable)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe client identifier for heimdall.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003eclient_secret\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003estring\u003c/em\u003e (mandatory, not overridable)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe client secret for heimdall.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003eauth_method\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003estring\u003c/em\u003e (optional, not overridable)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe authentication method to be used according to \u003ca href=\"https://www.rfc-editor.org/rfc/rfc6749#section-2.3.1\"\u003eRFC 6749, Client Password\u003c/a\u003e. Can be one of\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003ebasic_auth\u003c/code\u003e (default if \u003ccode\u003eauth_method\u003c/code\u003e is not set): With that authentication method, the \u003ccode\u003e\u0026#34;application/x-www-form-urlencoded\u0026#34;\u003c/code\u003e encoded values of \u003ccode\u003eclient_id\u003c/code\u003e and \u003ccode\u003eclient_secret\u003c/code\u003e are sent to the authorization server via the \u003ccode\u003eAuthorization\u003c/code\u003e header using the \u003ccode\u003eBasic\u003c/code\u003e scheme.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003erequest_body\u003c/code\u003e: With that authentication method the \u003ccode\u003eclient_id\u003c/code\u003e and \u003ccode\u003eclient_secret\u003c/code\u003e are sent in the request body together with the other parameters (e.g. \u003ccode\u003escopes\u003c/code\u003e) defined by the flow.\u003c/p\u003e\n\u003cdiv class=\"admonitionblock warning\"\u003e\n\u003ctable\u003e\n\u003ctbody\u003e\u003ctr\u003e\n\u003ctd class=\"icon\"\u003e\n\u003ci class=\"fa icon-warning\" title=\"Warning\"\u003e\u003c/i\u003e\n\u003c/td\u003e\n\u003ctd class=\"content\"\u003e\nUsage of \u003ccode\u003erequest_body\u003c/code\u003e authentication method is not recommended and should be avoided.\n\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003escopes\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003estring array\u003c/em\u003e (optional, overridable)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe scopes required for the access token.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003ecache_ttl\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003e\u003ca href=\"/docs/configuration/types/#_duration\"\u003eDuration\u003c/a\u003e\u003c/em\u003e (optional, overridable)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eHow long to cache the token received from the token endpoint. Defaults to the token expiration information from the token endpoint (the value of the \u003ccode\u003eexpires_in\u003c/code\u003e field) if present. If the token expiration inforation is not present and \u003ccode\u003ecache_ttl\u003c/code\u003e is not configured, the received token is not cached. If the token expiration information is present in the response and \u003ccode\u003ecache_ttl\u003c/code\u003e is configured the shorter value is taken. If caching is enabled, the token is cached until 5 seconds before its expiration. To disable caching, set it to \u003ccode\u003e0s\u003c/code\u003e. The cache key calculation is based on the entire \u003ccode\u003eoauth2_client_credentials\u003c/code\u003e configuration without considering the \u003ccode\u003eheader\u003c/code\u003e property.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003eheader\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003eobject\u003c/em\u003e (optional, overridable)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eDefines the \u003ccode\u003ename\u003c/code\u003e and \u003ccode\u003escheme\u003c/code\u003e to be used for the header. Defaults to \u003ccode\u003eAuthorization\u003c/code\u003e with scheme \u003ccode\u003eBearer\u003c/code\u003e. If defined, the \u003ccode\u003ename\u003c/code\u003e property must be set. If \u003ccode\u003escheme\u003c/code\u003e is not defined, no scheme will be prepended to the resulting JWT.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"exampleblock\"\u003e\n\u003cdiv class=\"title\"\u003eExample 5. OAuth2 Client Credentials finalizer configuration\u003c/div\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"yaml\"\u003e\u003cspan class=\"na\"\u003eid\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eget_token\u003c/span\u003e\n\u003cspan class=\"na\"\u003etype\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eoauth2_client_credentials\u003c/span\u003e\n\u003cspan class=\"na\"\u003econfig\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"na\"\u003ecache_ttl\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e5m\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eheader\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"na\"\u003ename\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eX-Token\u003c/span\u003e\n    \u003cspan class=\"na\"\u003escheme\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eMyScheme\u003c/span\u003e\n  \u003cspan class=\"na\"\u003etoken_url\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ehttps://my-oauth-provider.com/token\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eclient_id\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003emy_client\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eclient_secret\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eVerySecret!\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eauth_method\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ebasic_auth\u003c/span\u003e\n  \u003cspan class=\"na\"\u003escopes\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003efoo\u003c/span\u003e\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003ebar\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n","sections":["Mechanisms"],"tags":null,"title":"Finalizers","url":"/docs/mechanisms/finalizers/"},{"categories":null,"content":" Some of the error handlers may support or require additional configuration. The corresponding properties are annotated with mandatory, respectively optional to denote configuration requirement, as well as with overridable, not overriddable and partially overridable to indicate whether the property can be overridden in a rule pipeline.\nDefault This mechanism is always there and is executed if no other error handler mechanism is responsible for the error. Actually, there is no need to explicitly configure it. The only exception is to allow overriding the default rule’s error handler chain in a specific rule for performance reasons (if configured error handlers in the default rule should not be considered). This mechanism type doesn’t have any configuration options.\nTo enable the usage of this mechanism, you have to set the type property to default.\nExample 1. Configuring Default error handler to enable referencing it from rules id: foo type: default Redirect This error handler mechanism allows redirecting the client to another endpoint, e.g. to let the user authenticate. Technically this error handler returns e.g. a HTTP 302 Found response code and sets the HTTP Location header.\nTo enable the usage of this mechanism, you have to set the type property to redirect.\nConfiguration is mandatory by making use of the if and config properties. The first defines the condition, which must hold true for this error handler to execute and has access to the Request and the Error objects. Latter defines the data to drive the redirect and supports the following properties:\nto: URL (mandatory, not overridable)\nThe url to redirect the client to via the Location header. Can be templated and has access to the Request object.\nWhen creating query parameters by making use of templates, don’t forget to encode the values using the urlenc function. See also examples below. code: int (optional, not overridable)\nThe code to be used for the redirect. Defaults to 302 Found.\nHeimdall does not check the configured code for HTTP redirect validity! Example 2. Redirect error handler configuration The redirect error handler below is configured to kick in if the error is either authentication_error or authorization_error and the request come from a browser (HTTP Accept header contains text/html). If this condition holds true it will redirect the client to http://127.0.0.1:4433/self-service/login/browser and add the return_to query parameter set to the URL encoded value of the current url as well.\nSo, e.g. if heimdall was handling the request for http://my-service.local/foo and run into an error like described above, the HTTP response to the client will have the code 302 Found set and the Location header set to http://127.0.0.1:4433/self-service/login/browser?return_to=http%3A%2F%2Fmy-service.local%2Ffoo\nid: authenticate_with_kratos type: redirect if: | type(Error) in [authentication_error, authorization_error] \u0026amp;\u0026amp; Request.Header(\u0026#34;Accept\u0026#34;).contains(\u0026#34;text/html\u0026#34;) config: to: http://127.0.0.1:4433/self-service/login/browser?return_to={{ .Request.URL | urlenc }} WWW-Authenticate This error handler mechanism responds with HTTP 401 Unauthorized and a WWW-Authenticate HTTP header set. As of now, this error handler is the only one error handler, which transforms heimdall into an authentication system, a very simple one though. By configuring this error handler you can implement the Basic HTTP Authentication Scheme by also making use of the Basic Auth authenticator. Without that authenticator, the usage of this error handler does actually not make any sense.\nTo enable the usage of this error handler, you have to set the type property to www_authenticate.\nConfiguration is mandatory by making use of the if and config properties. The first defines the condition, which must hold true for this error handler to execute and has access to the Request and the Error objects. Latter defines the data to drive the redirect and supports the following properties:\nrealm: string (optional, overridable)\nThe \u0026#34;realm\u0026#34; according to RFC 7235, section 2.2. Defaults to \u0026#34;Please authenticate\u0026#34;.\nExample 3. Configuration of WWW-Authenticate error handler The www authenticate error handler below is configured to kick in if an authentication_error error occurred (an error raised by authenticators) and has been raised by an authenticator with id equal to basic_auth_authenticator. In this case, it will respond with HTTP 401 Unauthorized and a WWW-Authenticate header set to Basic realm=\u0026#34;My fancy app\u0026#34;.\nid: basic_authenticate type: www_authenticate if: | Error.Source == \u0026#34;basic_auth_authenticator\u0026#34; \u0026amp;\u0026amp; type(Error) == authentication_error config: realm: \u0026#34;My fancy app\u0026#34; ","description":"Error handlers kick in when any of the stages of the regular rule pipeline fail and let you define logic to handle such situations. This page describes the available error handler types in detail.","html_content":"\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eSome of the error handlers may support or require additional configuration. The corresponding properties are annotated with \u003ccode\u003emandatory\u003c/code\u003e, respectively \u003ccode\u003eoptional\u003c/code\u003e to denote configuration requirement, as well as with \u003ccode\u003eoverridable\u003c/code\u003e, \u003ccode\u003enot overriddable\u003c/code\u003e and \u003ccode\u003epartially overridable\u003c/code\u003e to indicate whether the property can be overridden in a rule pipeline.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_default\"\u003eDefault\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThis mechanism is always there and is executed if no other error handler mechanism is responsible for the error. Actually, there is no need to explicitly configure it. The only exception is to allow overriding the \u003ca href=\"/docs/rules/default_rule/\"\u003edefault rule’s\u003c/a\u003e error handler chain in a specific rule for performance reasons (if configured error handlers in the default rule should not be considered). This mechanism type doesn’t have any configuration options.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eTo enable the usage of this mechanism, you have to set the \u003ccode\u003etype\u003c/code\u003e property to \u003ccode\u003edefault\u003c/code\u003e.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"exampleblock\"\u003e\n\u003cdiv class=\"title\"\u003eExample 1. Configuring Default error handler to enable referencing it from rules\u003c/div\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"yaml\"\u003e\u003cspan class=\"na\"\u003eid\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003efoo\u003c/span\u003e\n\u003cspan class=\"na\"\u003etype\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003edefault\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_redirect\"\u003eRedirect\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThis error handler mechanism allows redirecting the client to another endpoint, e.g. to let the user authenticate. Technically this error handler returns e.g. a HTTP \u003ccode\u003e302 Found\u003c/code\u003e response code and sets the HTTP \u003ccode\u003eLocation\u003c/code\u003e header.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eTo enable the usage of this mechanism, you have to set the \u003ccode\u003etype\u003c/code\u003e property to \u003ccode\u003eredirect\u003c/code\u003e.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eConfiguration is mandatory by making use of the \u003ccode\u003eif\u003c/code\u003e and \u003ccode\u003econfig\u003c/code\u003e properties. The first defines the condition, which must hold true for this error handler to execute and has access to the \u003ca href=\"/docs/mechanisms/evaluation_objects/#_request\"\u003e\u003ccode\u003eRequest\u003c/code\u003e\u003c/a\u003e and the \u003ca href=\"/docs/mechanisms/evaluation_objects/#_error\"\u003e\u003ccode\u003eError\u003c/code\u003e\u003c/a\u003e objects. Latter defines the data to drive the redirect and supports the following properties:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003eto\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003eURL\u003c/em\u003e (mandatory, not overridable)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe url to redirect the client to via the \u003ccode\u003eLocation\u003c/code\u003e header. Can be templated and has access to the \u003ca href=\"/docs/mechanisms/evaluation_objects/#_request\"\u003e\u003ccode\u003eRequest\u003c/code\u003e\u003c/a\u003e object.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"admonitionblock note\"\u003e\n\u003ctable\u003e\n\u003ctbody\u003e\u003ctr\u003e\n\u003ctd class=\"icon\"\u003e\n\u003ci class=\"fa icon-note\" title=\"Note\"\u003e\u003c/i\u003e\n\u003c/td\u003e\n\u003ctd class=\"content\"\u003e\nWhen creating query parameters by making use of templates, don’t forget to encode the values using the \u003ccode\u003eurlenc\u003c/code\u003e function. See also examples below.\n\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003ecode\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003eint\u003c/em\u003e (optional, not overridable)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe code to be used for the redirect. Defaults to \u003ccode\u003e302 Found\u003c/code\u003e.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"admonitionblock warning\"\u003e\n\u003ctable\u003e\n\u003ctbody\u003e\u003ctr\u003e\n\u003ctd class=\"icon\"\u003e\n\u003ci class=\"fa icon-warning\" title=\"Warning\"\u003e\u003c/i\u003e\n\u003c/td\u003e\n\u003ctd class=\"content\"\u003e\nHeimdall does not check the configured code for HTTP redirect validity!\n\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"exampleblock\"\u003e\n\u003cdiv class=\"title\"\u003eExample 2. Redirect error handler configuration\u003c/div\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe redirect error handler below is configured to kick in if the error is either \u003ccode\u003eauthentication_error\u003c/code\u003e or \u003ccode\u003eauthorization_error\u003c/code\u003e and the request come from a browser (HTTP \u003ccode\u003eAccept\u003c/code\u003e header contains \u003ccode\u003etext/html\u003c/code\u003e). If this condition holds true it will redirect the client to \u003ccode\u003ehttp://127.0.0.1:4433/self-service/login/browser\u003c/code\u003e and add the \u003ccode\u003ereturn_to\u003c/code\u003e query parameter set to the URL encoded value of the current url as well.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eSo, e.g. if heimdall was handling the request for \u003ccode\u003ehttp://my-service.local/foo\u003c/code\u003e and run into an error like described above, the HTTP response to the client will have the code \u003ccode\u003e302 Found\u003c/code\u003e set and the \u003ccode\u003eLocation\u003c/code\u003e header set to \u003ccode\u003ehttp://127.0.0.1:4433/self-service/login/browser?return_to=http%3A%2F%2Fmy-service.local%2Ffoo\u003c/code\u003e\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"yaml\"\u003e\u003cspan class=\"na\"\u003eid\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eauthenticate_with_kratos\u003c/span\u003e\n\u003cspan class=\"na\"\u003etype\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eredirect\u003c/span\u003e\n\u003cspan class=\"na\"\u003eif\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"pi\"\u003e|\u003c/span\u003e\n  \u003cspan class=\"s\"\u003etype(Error) in [authentication_error, authorization_error] \u0026amp;\u0026amp;\u003c/span\u003e\n  \u003cspan class=\"s\"\u003eRequest.Header(\u0026#34;Accept\u0026#34;).contains(\u0026#34;text/html\u0026#34;)\u003c/span\u003e\n\u003cspan class=\"na\"\u003econfig\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eto\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ehttp://127.0.0.1:4433/self-service/login/browser?return_to={{ .Request.URL | urlenc }}\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_www_authenticate\"\u003eWWW-Authenticate\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThis error handler mechanism responds with HTTP \u003ccode\u003e401 Unauthorized\u003c/code\u003e and a \u003ccode\u003eWWW-Authenticate\u003c/code\u003e HTTP header set. As of now, this error handler is the only one error handler, which transforms heimdall into an authentication system, a very simple one though. By configuring this error handler you can implement the \u003ca href=\"https://datatracker.ietf.org/doc/html/rfc7617\"\u003eBasic HTTP Authentication Scheme\u003c/a\u003e by also making use of the \u003ca href=\"/docs/mechanisms/authenticators/#_basic_auth\"\u003eBasic Auth\u003c/a\u003e authenticator. Without that authenticator, the usage of this error handler does actually not make any sense.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eTo enable the usage of this error handler, you have to set the \u003ccode\u003etype\u003c/code\u003e property to \u003ccode\u003ewww_authenticate\u003c/code\u003e.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eConfiguration is mandatory by making use of the \u003ccode\u003eif\u003c/code\u003e and \u003ccode\u003econfig\u003c/code\u003e properties. The first defines the condition, which must hold true for this error handler to execute and has access to the \u003ca href=\"/docs/mechanisms/evaluation_objects/#_request\"\u003e\u003ccode\u003eRequest\u003c/code\u003e\u003c/a\u003e and the \u003ca href=\"/docs/mechanisms/evaluation_objects/#_error\"\u003e\u003ccode\u003eError\u003c/code\u003e\u003c/a\u003e objects. Latter defines the data to drive the redirect and supports the following properties:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003erealm\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003estring\u003c/em\u003e (optional, overridable)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe \u0026#34;realm\u0026#34; according to \u003ca href=\"https://datatracker.ietf.org/doc/html/rfc7235#section-2.2\"\u003eRFC 7235, section 2.2\u003c/a\u003e. Defaults to \u0026#34;Please authenticate\u0026#34;.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"exampleblock\"\u003e\n\u003cdiv class=\"title\"\u003eExample 3. Configuration of WWW-Authenticate error handler\u003c/div\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe www authenticate error handler below is configured to kick in if an \u003ccode\u003eauthentication_error\u003c/code\u003e error occurred (an error raised by authenticators) and has been raised by an authenticator with id equal to \u003ccode\u003ebasic_auth_authenticator\u003c/code\u003e. In this case, it will respond with HTTP \u003ccode\u003e401 Unauthorized\u003c/code\u003e and a \u003ccode\u003eWWW-Authenticate\u003c/code\u003e header set to \u003ccode\u003eBasic realm=\u0026#34;My fancy app\u0026#34;\u003c/code\u003e.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"yaml\"\u003e\u003cspan class=\"na\"\u003eid\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ebasic_authenticate\u003c/span\u003e\n\u003cspan class=\"na\"\u003etype\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ewww_authenticate\u003c/span\u003e\n\u003cspan class=\"na\"\u003eif\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"pi\"\u003e|\u003c/span\u003e\n  \u003cspan class=\"s\"\u003eError.Source == \u0026#34;basic_auth_authenticator\u0026#34; \u0026amp;\u0026amp;\u003c/span\u003e\n  \u003cspan class=\"s\"\u003etype(Error) == authentication_error\u003c/span\u003e\n\u003cspan class=\"na\"\u003econfig\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"na\"\u003erealm\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"s\"\u003eMy\u003c/span\u003e\u003cspan class=\"nv\"\u003e \u003c/span\u003e\u003cspan class=\"s\"\u003efancy\u003c/span\u003e\u003cspan class=\"nv\"\u003e \u003c/span\u003e\u003cspan class=\"s\"\u003eapp\u0026#34;\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n","sections":["Mechanisms"],"tags":null,"title":"Error Handlers","url":"/docs/mechanisms/error_handlers/"},{"categories":null,"content":" In simplest case a regular rule will just reuse mechanisms from a previously defined catalogue in its pipelines. In more complex cases a rule can reconfigure parts of used mechanisms. Which parts can be reconfigured, respectively overridden are mechanism specific and described in the mechanism specific documentation. Reconfiguration is always limited to the particular rule pipeline and does not affect other rules.\nConfiguration A single regular rule consists of the following properties:\nid: string (mandatory)\nThe unique identifier of a rule. It must be unique across all rules loaded by the same Rule Provider. To ensure this, it is recommended to let the id include the name of your upstream service, as well as its purpose. E.g. rule:my-service:public-api.\nmatch: RuleMatcher (mandatory)\nDefines how to match a rule and supports the following properties:\nurl: string (mandatory)\nGlob or Regex pattern of the endpoints of your upstream service, which this rule should apply to. Query parameters are ignored.\nstrategy: string (optional)\nWhich strategy to use for matching of the value, provided in the url property. Can be one of:\nregex - to match url expressions by making use of regular expressions. Internally, heimdall makes use of Heimdall uses dlclark/regexp2 to implement this strategy. Head over to linked resource to get more insights about possible options.\nExample 1. Regular expressions patterns https://mydomain.com/ matches https://mydomain.com/ and doesn’t match https://mydomain.com/foo or https://mydomain.com.\n\u0026lt;https|http\u0026gt;://mydomain.com/\u0026lt;.*\u0026gt; matches https://mydomain.com/ and http://mydomain.com/foo. Doesn’t match https://other-domain.com/ or https://mydomain.com.\nhttp://mydomain.com/\u0026lt;+\u0026gt; matches http://mydomain.com/123, but doesn’t match http://mydomain/abc.\nhttp://mydomain.com/\u0026lt;(?!protected).*\u0026gt; matches http://mydomain.com/resource, but doesn’t match http://mydomain.com/protected.\nglob - to match url expressions by making use of glob expressions. Internally, heimdall makes use of Heimdall uses gobwas/glob to implement this strategy. Head over to linked resource to get more insights about possible options.\nExample 2. Glob patterns https://mydomain.com/\u0026lt;m?n\u0026gt; matches https://mydomain.com/man and does not match http://mydomain.com/foo.\nhttps://mydomain.com/\u0026lt;{foo*,bar*}\u0026gt; matches https://mydomain.com/foo or https://mydomain.com/bar and doesn’t match https://mydomain.com/any.\nallow_encoded_slashes: string (optional)\nDefines how to handle url-encoded slashes in url paths while matching and forwarding the requests. Can be set to the one of the following values, defaulting to off:\noff - Reject requests containing encoded slashes. Means, if the request URL contains an url-encoded slash (%2F), the rule will not match it.\non - Accept requests using encoded slashes, decoding them and making it transparent for the rules and the upstream url. That is, the %2F becomes a / and will be treated as such in all places.\nno_decode - Accept requests using encoded slashes, but not touching them and showing them to the rules and the upstream. That is, the %2F just remains as is.\nSince the proxy integrating with heimdall, heimdall by itself, and the upstream service, all may treat the url-encoded slashes differently, accepting requests with url-encoded slashes can, depending on your rules, lead to Interpretation Conflict vulnerabilities resulting in privilege escalations. methods: string array (optional)\nWhich HTTP methods (GET, POST, PATCH, etc) are allowed for the matched URL. If not specified, every request to that URL will result in 405 Method Not Allowed response from heimdall. If all methods should be allowed, one can use a special ALL placeholder. If all, except some specific methods should be allowed, one can specify ALL and remove specific methods by adding the ! sign to the to be removed method. In that case you have to specify the value in braces. See also examples below.\nExample 3. Methods list which effectively expands to all HTTP methods methods: - ALL Example 4. Methods list consisting of all HTTP methods without TRACE and OPTIONS methods: - ALL - \u0026#34;!TRACE\u0026#34; - \u0026#34;!OPTIONS\u0026#34; forward_to: RequestForwarder (mandatory in Proxy operation mode)\nDefines where to forward the proxied request to. Used only when heimdall is operated in the Proxy operation mode and supports the following properties:\nhost: string (mandatory)\nHost (and port) to be used for request forwarding. If no rewrite property (see below) is specified, all other parts, like scheme, path, etc. of the original url are preserved. E.g. if the original request is https://mydomain.com/api/v1/something?foo=bar\u0026amp;bar=baz and the value of this property is set to my-backend:8080, the url used to forward the request to the upstream will be https://my-backend:8080/api/v1/something?foo=bar\u0026amp;bar=baz\nThe Host header is not preserved while forwarding the request. If you need it to be set to the value from the original request, make use of the header finalizer in your execute pipeline and set it accordingly. The example below demonstrates that. rewrite: OriginalURLRewriter (optional)\nCan be used to rewrite further parts of the original url before forwarding the request. If specified at least one of the following supported (middleware) properties must be specified:\nscheme: string (optional)\nIf defined, heimdall will use the specified value for the url scheme part while forwarding the request to the upstream.\nstrip_path_prefix: string (optional)\nIf defined, heimdall will strip the specified prefix from the original url path. E.g. if the path of the original url is /api/v1/something and the value of this property is set to /api/v1, the request to the upstream will have the url path set to /something.\nadd_path_prefix: string (optional)\nThis middleware is applied after the execution of the strip_path_prefix middleware described above. If defined, heimdall will add the specified path prefix to the path used to forward the request to the upstream service. E.g. if the path of the original url or the pass resulting after the application of the strip_path_prefix middleware is /something and the value of this property is set to /my-backend, the request to the upstream will have the url path set to /my-backend/something.\nstrip_query_parameters: string array (optional)\nIf defined, heimdall will remove the specified query parameters from the original url before forwarding the request to the upstream service. E.g. if the query parameters part of the original url is foo=bar\u0026amp;bar=baz and the value of this property is set to [\u0026#34;foo\u0026#34;], the query part of the request to the upstream will be set to bar=baz\nexecute: Authentication \u0026amp; Authorization Pipeline (mandatory)\nWhich mechanisms to use to authenticate, authorize, contextualize (enrich) and finalize the pipeline.\non_error: Error Pipeline (optional)\nWhich error handler mechanisms to use if any of the mechanisms, defined in the execute property, fails. This property is optional only, if a default rule has been configured and contains an on_error definition.\nExample 5. An example rule id: rule:foo:bar match: url: http://my-service.local/\u0026lt;**\u0026gt; strategy: glob forward_to: host: backend-a:8080 rewrite: scheme: http strip_path_prefix: /api/v1 methods: - GET - POST execute: # the following just demonstrates how to make use of specific # mechanisms in the simplest possible form - authenticator: foo - authorizer: bar - contextualizer: foo - finalizer: zab # the following one demonstrates how to preserve the # Host header from the original request, while forwarding # it to the upstream service - finalizer: preserve-host # the config property can be omitted, if already configured # in the header finalizer mechanism config: headers: Host: \u0026#39;{{ .Request.Header \u0026#34;Host\u0026#34; | quote }}\u0026#39; on_error: - error_handler: foobar Authentication \u0026amp; Authorization Pipeline As described in the Concepts section, this pipeline consists of mechanisms, previously configured in the mechanisms catalogue, organized in stages as described below, with authentication stage (consisting of authenticators) being mandatory.\nAuthentication Stage: List of authenticator references using authenticator as key, followed by the required authenticator id. Authenticators following the first defined in the list are used by heimdall as fallback. That is, if first authenticator fails due to missing authentication data, second is executed, etc. By default, fallback is not used if an authenticator fails due to validation errors of the given authentication data. E.g. if an authenticator fails to validate the signature of a JWT token, the next authenticator in the list will not be executed. Instead, the entire pipeline will fail and lead to the execution of the error pipeline. This list is mandatory if no default rule is configured.\nSome authenticators use the same sources to get subject authentication object from. E.g. the jwt and the oauth2_introspection authenticators can retrieve tokens from the same places in the request. If such authenticators are used in the same pipeline, you should configure the more specific ones before the more general ones to have working default fallbacks. To stay with the above example, the jwt authenticator is more specific compared to oauth2_introspection, as it will be only executed, if the token is in a JWT format. In contrast to this, the oauth2_introspection authenticator is more general and does not care about the token format, thus will feel responsible for the request as soon as it finds a bearer token. You can however also make use of the allow_fallback_on_error configuration property and set it to true. This will allow a fallback even if the verification of the credentials fail. Authorization Stage: List of contextualizer and authorizer references in any order (optional). Can also be mixed. As with authenticators, the list definition happens using either contextualizer or authorizer as key, followed by the required id. All mechanisms in this list are executed in the order, they are defined. If any of these fails, the entire pipeline fails, which leads to the execution of the error pipeline. This list is optional.\nFinalization Stage: List of finalizer references using finalizers as key, followed by the required finalizer id. All finalizers in this list are executed in the order they are defined. If any of these fail, the entire pipeline fails, which leads to the execution of the error pipeline. This list is optional. If a default rule is configured, and no finalizers are configured on a specific rule level, the finalizers from the default rule are used. If the default rule does not have any finalizers configured either, no finalization will take place.\nIn all cases, the used mechanism can be partially reconfigured if supported by the corresponding type. Configuration goes into the config properties. These reconfigurations are always local to the given rule. With other words, you can adjust your rule specific pipeline as you want without any side effects.\nExecution of an contextualizer, authorizer, or finalizer mechanisms can optionally happen conditionally by making use of a CEL expression in an if clause, which has access to the Subject and the Request objects. If the if clause is not present, the corresponding mechanism is always executed.\nExample 6. Complex pipeline # list of authenticators # defining the authentication stage - authenticator: foo - authenticator: bar config: subject: anon # ... any further required authenticator # list of authorizers and contextualizers in any order # defining the authentication stage - contextualizer: baz config: cache_ttl: 0s - authorizer: zab - contextualizer: foo if: Subject.ID != \u0026#34;anonymous\u0026#34; - contextualizer: bar - authorizer: foo if: Request.Method == \u0026#34;POST\u0026#34; config: expressions: - expression: | // some expression logic deviating from the // definition in the pipeline configuration. # ... any further required authorizer or contextualizer # list of finalizers # defining the finalization stage - finalizer: foo - finalizer: bar config: headers: - X-User-ID: {{ quote .ID }} # ... any further required finalizers This example uses\ntwo authenticators, with authenticator named bar being the fallback for the authenticator named foo. This fallback authenticator is obviously of type anonymous as it reconfigures the referenced prototype to use anon for subject id.\nmultiple contextualizers and authorizers, with first contextualizer having its cache disabled (cache_ttl set to 0s) and the last authorizer being of type cel as it reconfigures the referenced prototype to use a different authorization expression.\ntwo finalizers, with the second one being obviously of type header, as it defines a X-User-ID header set to the value of the subject id to be forwarded to the upstream service.\ncontextualizer foo is only executed if the authenticated subject is not anonymous.\nauthorizer foo is only executed if the request method is HTTP POST.\nError Pipeline Compared to the Authentication \u0026amp; Authorization Pipeline, the error pipeline is pretty simple. It is also a list of mechanism references, but all referenced types are error handler types. Thus, each entry in this list must have error_handler as key, followed by the ìd of the required error handler, previously defined in the mechanism catalogue. Error handlers are always executed as fallbacks. So, if the condition of the first error handler does not match, second is selected, if its condition matches, it is executed, otherwise the next one is selected, etc. If none of the conditions of the defined error handlers match, the default error handler is executed.\nAs with the authentication \u0026amp; authorization pipeline, partial reconfiguration of the used mechanisms is possible if supported by the corresponding type. Same is true for overrides of the if conditions. The overrides are always local to the given rule as well.\nExample 7. Two error handlers - error_handler: foo - error_handler: bar if: # rule specific condition config: # rule specific config This example uses two error handlers, named foo and bar. bar will only be selected by heimdall if foo \u0026#39;s error condition (defined in the mechanism catalogue) does not match. bar does also override the error condition as required by the given rule.\n","description":"Regular rules allow definition and as such execution of arbitrary logic required by your upstream service. This page describes the available configuration options for a regular rule in detail.","html_content":"\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eIn simplest case a regular rule will just reuse mechanisms from a previously defined \u003ca href=\"/docs/mechanisms/catalogue/\"\u003ecatalogue\u003c/a\u003e in its pipelines. In more complex cases a rule can reconfigure parts of used mechanisms. Which parts can be reconfigured, respectively overridden are mechanism specific and described in the mechanism specific documentation. Reconfiguration is always limited to the particular rule pipeline and does not affect other rules.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_configuration\"\u003eConfiguration\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eA single regular rule consists of the following properties:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003eid\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003estring\u003c/em\u003e (mandatory)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe unique identifier of a rule. It must be unique across all rules loaded by the same \u003ca href=\"/docs/rules/providers/\"\u003eRule Provider\u003c/a\u003e. To ensure this, it is recommended to let the \u003ccode\u003eid\u003c/code\u003e include the name of your upstream service, as well as its purpose. E.g. \u003ccode\u003erule:my-service:public-api\u003c/code\u003e.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003ematch\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003eRuleMatcher\u003c/em\u003e (mandatory)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eDefines how to match a rule and supports the following properties:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003eurl\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003estring\u003c/em\u003e (mandatory)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eGlob or Regex pattern of the endpoints of your upstream service, which this rule should apply to. Query parameters are ignored.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003estrategy\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003estring\u003c/em\u003e (optional)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eWhich strategy to use for matching of the value, provided in the \u003ccode\u003eurl\u003c/code\u003e property. Can be one of:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003eregex\u003c/code\u003e - to match \u003ccode\u003eurl\u003c/code\u003e expressions by making use of regular expressions. Internally, heimdall makes use of Heimdall uses \u003ca href=\"https://github.com/dlclark/regexp2\"\u003edlclark/regexp2\u003c/a\u003e to implement this strategy. Head over to linked resource to get more insights about possible options.\u003c/p\u003e\n\u003cdiv class=\"exampleblock\"\u003e\n\u003cdiv class=\"title\"\u003eExample 1. Regular expressions patterns\u003c/div\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003ehttps://mydomain.com/\u003c/code\u003e matches \u003ccode\u003ehttps://mydomain.com/\u003c/code\u003e and doesn’t match \u003ccode\u003ehttps://mydomain.com/foo\u003c/code\u003e or \u003ccode\u003ehttps://mydomain.com\u003c/code\u003e.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003e\u0026lt;https|http\u0026gt;://mydomain.com/\u0026lt;.*\u0026gt;\u003c/code\u003e matches \u003ccode\u003ehttps://mydomain.com/\u003c/code\u003e and \u003ccode\u003ehttp://mydomain.com/foo\u003c/code\u003e. Doesn’t match \u003ccode\u003ehttps://other-domain.com/\u003c/code\u003e or \u003ccode\u003ehttps://mydomain.com\u003c/code\u003e.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003ehttp://mydomain.com/\u0026lt;\u003ca id=\":digit:\"\u003e\u003c/a\u003e+\u0026gt;\u003c/code\u003e matches \u003ccode\u003ehttp://mydomain.com/123\u003c/code\u003e, but doesn’t match \u003ccode\u003ehttp://mydomain/abc\u003c/code\u003e.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003ehttp://mydomain.com/\u0026lt;(?!protected).*\u0026gt;\u003c/code\u003e matches \u003ccode\u003ehttp://mydomain.com/resource\u003c/code\u003e, but doesn’t match \u003ccode\u003ehttp://mydomain.com/protected\u003c/code\u003e.\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003eglob\u003c/code\u003e - to match \u003ccode\u003eurl\u003c/code\u003e expressions by making use of glob expressions. Internally, heimdall makes use of Heimdall uses \u003ca href=\"https://github.com/gobwas/glob\"\u003egobwas/glob\u003c/a\u003e to implement this strategy. Head over to linked resource to get more insights about possible options.\u003c/p\u003e\n\u003cdiv class=\"exampleblock\"\u003e\n\u003cdiv class=\"title\"\u003eExample 2. Glob patterns\u003c/div\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003ehttps://mydomain.com/\u0026lt;m?n\u0026gt;\u003c/code\u003e matches \u003ccode\u003ehttps://mydomain.com/man\u003c/code\u003e and does not match \u003ccode\u003ehttp://mydomain.com/foo\u003c/code\u003e.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003ehttps://mydomain.com/\u0026lt;{foo*,bar*}\u0026gt;\u003c/code\u003e matches \u003ccode\u003ehttps://mydomain.com/foo\u003c/code\u003e or \u003ccode\u003ehttps://mydomain.com/bar\u003c/code\u003e and doesn’t match \u003ccode\u003ehttps://mydomain.com/any\u003c/code\u003e.\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003eallow_encoded_slashes\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003estring\u003c/em\u003e (optional)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eDefines how to handle url-encoded slashes in url paths while matching and forwarding the requests. Can be set to the one of the following values, defaulting to \u003ccode\u003eoff\u003c/code\u003e:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003eoff\u003c/code\u003e\u003c/strong\u003e - Reject requests containing encoded slashes. Means, if the request URL contains an url-encoded slash (\u003ccode\u003e%2F\u003c/code\u003e), the rule will not match it.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003eon\u003c/code\u003e\u003c/strong\u003e - Accept requests using encoded slashes, decoding them and making it transparent for the rules and the upstream url. That is, the \u003ccode\u003e%2F\u003c/code\u003e becomes a \u003ccode\u003e/\u003c/code\u003e and will be treated as such in all places.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003eno_decode\u003c/code\u003e\u003c/strong\u003e - Accept requests using encoded slashes, but not touching them and showing them to the rules and the upstream. That is, the \u003ccode\u003e%2F\u003c/code\u003e just remains as is.\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"admonitionblock caution\"\u003e\n\u003ctable\u003e\n\u003ctbody\u003e\u003ctr\u003e\n\u003ctd class=\"icon\"\u003e\n\u003ci class=\"fa icon-caution\" title=\"Caution\"\u003e\u003c/i\u003e\n\u003c/td\u003e\n\u003ctd class=\"content\"\u003e\nSince the proxy integrating with heimdall, heimdall by itself, and the upstream service, all may treat the url-encoded slashes differently, accepting requests with url-encoded slashes can, depending on your rules, lead to \u003ca href=\"https://cwe.mitre.org/data/definitions/436.html\"\u003eInterpretation Conflict\u003c/a\u003e vulnerabilities resulting in privilege escalations.\n\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003emethods\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003estring array\u003c/em\u003e (optional)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eWhich HTTP methods (\u003ccode\u003eGET\u003c/code\u003e, \u003ccode\u003ePOST\u003c/code\u003e, \u003ccode\u003ePATCH\u003c/code\u003e, etc) are allowed for the matched URL. If not specified, every request to that URL will result in \u003ccode\u003e405 Method Not Allowed\u003c/code\u003e response from heimdall. If all methods should be allowed, one can use a special \u003ccode\u003eALL\u003c/code\u003e placeholder. If all, except some specific methods should be allowed, one can specify \u003ccode\u003eALL\u003c/code\u003e and remove specific methods by adding the \u003ccode\u003e!\u003c/code\u003e sign to the to be removed method. In that case you have to specify the value in braces. See also examples below.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"exampleblock\"\u003e\n\u003cdiv class=\"title\"\u003eExample 3. Methods list which effectively expands to all HTTP methods\u003c/div\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"yaml\"\u003e\u003cspan class=\"na\"\u003emethods\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003eALL\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"exampleblock\"\u003e\n\u003cdiv class=\"title\"\u003eExample 4. Methods list consisting of all HTTP methods without \u003ccode\u003eTRACE\u003c/code\u003e and \u003ccode\u003eOPTIONS\u003c/code\u003e\u003c/div\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"yaml\"\u003e\u003cspan class=\"na\"\u003emethods\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003eALL\u003c/span\u003e\n  \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"s\"\u003e!TRACE\u0026#34;\u003c/span\u003e\n  \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"s\"\u003e!OPTIONS\u0026#34;\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003eforward_to\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003eRequestForwarder\u003c/em\u003e (mandatory in Proxy operation mode)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eDefines where to forward the proxied request to. Used only when heimdall is operated in the Proxy operation mode and supports the following properties:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003ehost\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003estring\u003c/em\u003e (mandatory)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eHost (and port) to be used for request forwarding. If no \u003ccode\u003erewrite\u003c/code\u003e property (see below) is specified, all other parts, like scheme, path, etc. of the original url are preserved. E.g. if the original request is \u003ccode\u003ehttps://mydomain.com/api/v1/something?foo=bar\u0026amp;bar=baz\u003c/code\u003e and the value of this property is set to \u003ccode\u003emy-backend:8080\u003c/code\u003e, the url used to forward the request to the upstream will be \u003ccode\u003ehttps://my-backend:8080/api/v1/something?foo=bar\u0026amp;bar=baz\u003c/code\u003e\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"admonitionblock note\"\u003e\n\u003ctable\u003e\n\u003ctbody\u003e\u003ctr\u003e\n\u003ctd class=\"icon\"\u003e\n\u003ci class=\"fa icon-note\" title=\"Note\"\u003e\u003c/i\u003e\n\u003c/td\u003e\n\u003ctd class=\"content\"\u003e\nThe \u003ccode\u003eHost\u003c/code\u003e header is not preserved while forwarding the request. If you need it to be set to the value from the original request, make use of the \u003ca href=\"/docs/mechanisms/finalizers/#_header\"\u003eheader finalizer\u003c/a\u003e in your \u003ccode\u003eexecute\u003c/code\u003e pipeline and set it accordingly. The example below demonstrates that.\n\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003erewrite\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003eOriginalURLRewriter\u003c/em\u003e (optional)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eCan be used to rewrite further parts of the original url before forwarding the request. If specified at least one of the following supported (middleware) properties must be specified:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003escheme\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003estring\u003c/em\u003e (optional)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eIf defined, heimdall will use the specified value for the url scheme part while forwarding the request to the upstream.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003estrip_path_prefix\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003estring\u003c/em\u003e (optional)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eIf defined, heimdall will strip the specified prefix from the original url path. E.g. if the path of the original url is \u003ccode\u003e/api/v1/something\u003c/code\u003e and the value of this property is set to \u003ccode\u003e/api/v1\u003c/code\u003e, the request to the upstream will have the url path set to \u003ccode\u003e/something\u003c/code\u003e.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003eadd_path_prefix\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003estring\u003c/em\u003e (optional)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThis middleware is applied after the execution of the \u003ccode\u003estrip_path_prefix\u003c/code\u003e middleware described above. If defined, heimdall will add the specified path prefix to the path used to forward the request to the upstream service. E.g. if the path of the original url or the pass resulting after the application of the \u003ccode\u003estrip_path_prefix\u003c/code\u003e middleware is \u003ccode\u003e/something\u003c/code\u003e and the value of this property is set to \u003ccode\u003e/my-backend\u003c/code\u003e, the request to the upstream will have the url path set to \u003ccode\u003e/my-backend/something\u003c/code\u003e.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003estrip_query_parameters\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003estring array\u003c/em\u003e (optional)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eIf defined, heimdall will remove the specified query parameters from the original url before forwarding the request to the upstream service. E.g. if the query parameters part of the original url is \u003ccode\u003efoo=bar\u0026amp;bar=baz\u003c/code\u003e and the value of this property is set to \u003ccode\u003e[\u0026#34;foo\u0026#34;]\u003c/code\u003e, the query part of the request to the upstream will be set to \u003ccode\u003ebar=baz\u003c/code\u003e\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003eexecute\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003e\u003ca href=\"#_authentication_authorization_pipeline\"\u003eAuthentication \u0026amp; Authorization Pipeline\u003c/a\u003e\u003c/em\u003e (mandatory)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eWhich mechanisms to use to authenticate, authorize, contextualize (enrich) and finalize the pipeline.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003eon_error\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003e\u003ca href=\"#_error_pipeline\"\u003eError Pipeline\u003c/a\u003e\u003c/em\u003e (optional)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eWhich error handler mechanisms to use if any of the mechanisms, defined in the \u003ccode\u003eexecute\u003c/code\u003e property, fails. This property is optional only, if a \u003ca href=\"/docs/rules/default_rule/\"\u003edefault rule\u003c/a\u003e has been configured and contains an \u003ccode\u003eon_error\u003c/code\u003e definition.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"exampleblock\"\u003e\n\u003cdiv class=\"title\"\u003eExample 5. An example rule\u003c/div\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"yaml\"\u003e\u003cspan class=\"na\"\u003eid\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003erule:foo:bar\u003c/span\u003e\n\u003cspan class=\"na\"\u003ematch\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eurl\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ehttp://my-service.local/\u0026lt;**\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"na\"\u003estrategy\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eglob\u003c/span\u003e\n\u003cspan class=\"na\"\u003eforward_to\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"na\"\u003ehost\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ebackend-a:8080\u003c/span\u003e\n  \u003cspan class=\"na\"\u003erewrite\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"na\"\u003escheme\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ehttp\u003c/span\u003e\n    \u003cspan class=\"na\"\u003estrip_path_prefix\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e/api/v1\u003c/span\u003e\n\u003cspan class=\"na\"\u003emethods\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003eGET\u003c/span\u003e\n  \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003ePOST\u003c/span\u003e\n\u003cspan class=\"na\"\u003eexecute\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"c1\"\u003e# the following just demonstrates how to make use of specific\u003c/span\u003e\n  \u003cspan class=\"c1\"\u003e# mechanisms in the simplest possible form\u003c/span\u003e\n  \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eauthenticator\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003efoo\u003c/span\u003e\n  \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eauthorizer\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ebar\u003c/span\u003e\n  \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003econtextualizer\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003efoo\u003c/span\u003e\n  \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003efinalizer\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ezab\u003c/span\u003e\n  \u003cspan class=\"c1\"\u003e# the following one demonstrates how to preserve the\u003c/span\u003e\n  \u003cspan class=\"c1\"\u003e# Host header from the original request, while forwarding\u003c/span\u003e\n  \u003cspan class=\"c1\"\u003e# it to the upstream service\u003c/span\u003e\n  \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003efinalizer\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003epreserve-host\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e# the config property can be omitted, if already configured\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e# in the header finalizer mechanism\u003c/span\u003e\n    \u003cspan class=\"na\"\u003econfig\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"na\"\u003eheaders\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"na\"\u003eHost\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"s\"\u003e{{\u003c/span\u003e\u003cspan class=\"nv\"\u003e \u003c/span\u003e\u003cspan class=\"s\"\u003e.Request.Header\u003c/span\u003e\u003cspan class=\"nv\"\u003e \u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;Host\u0026#34;\u003c/span\u003e\u003cspan class=\"nv\"\u003e \u003c/span\u003e\u003cspan class=\"s\"\u003e|\u003c/span\u003e\u003cspan class=\"nv\"\u003e \u003c/span\u003e\u003cspan class=\"s\"\u003equote\u003c/span\u003e\u003cspan class=\"nv\"\u003e \u003c/span\u003e\u003cspan class=\"s\"\u003e}}\u0026#39;\u003c/span\u003e\n\u003cspan class=\"na\"\u003eon_error\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eerror_handler\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003efoobar\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_authentication_authorization_pipeline\"\u003eAuthentication \u0026amp; Authorization Pipeline\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eAs described in the \u003ca href=\"/docs/concepts/pipelines/\"\u003eConcepts\u003c/a\u003e section, this pipeline consists of mechanisms, previously configured in the \u003ca href=\"/docs/mechanisms/catalogue/\"\u003emechanisms catalogue\u003c/a\u003e, organized in stages as described below, with authentication stage (consisting of \u003ca href=\"/docs/mechanisms/authenticators/\"\u003eauthenticators\u003c/a\u003e) being mandatory.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eAuthentication Stage:\u003c/strong\u003e List of \u003ca href=\"/docs/mechanisms/authenticators/\"\u003eauthenticator\u003c/a\u003e references using \u003ccode\u003eauthenticator\u003c/code\u003e as key, followed by the required authenticator \u003ccode\u003eid\u003c/code\u003e. Authenticators following the first defined in the list are used by heimdall as fallback. That is, if first authenticator fails due to missing authentication data, second is executed, etc. By default, fallback is not used if an authenticator fails due to validation errors of the given authentication data. E.g. if an authenticator fails to validate the signature of a JWT token, the next authenticator in the list will not be executed. Instead, the entire pipeline will fail and lead to the execution of the \u003ca href=\"#_error_pipeline\"\u003eerror pipeline\u003c/a\u003e. This list is mandatory if no \u003ca href=\"/docs/rules/default_rule/\"\u003edefault rule\u003c/a\u003e is configured.\u003c/p\u003e\n\u003cdiv class=\"admonitionblock note\"\u003e\n\u003ctable\u003e\n\u003ctbody\u003e\u003ctr\u003e\n\u003ctd class=\"icon\"\u003e\n\u003ci class=\"fa icon-note\" title=\"Note\"\u003e\u003c/i\u003e\n\u003c/td\u003e\n\u003ctd class=\"content\"\u003e\nSome authenticators use the same sources to get subject authentication object from. E.g. the \u003ccode\u003ejwt\u003c/code\u003e and the \u003ccode\u003eoauth2_introspection\u003c/code\u003e authenticators can retrieve tokens from the same places in the request. If such authenticators are used in the same pipeline, you should configure the more specific ones before the more general ones to have working default fallbacks. To stay with the above example, the \u003ccode\u003ejwt\u003c/code\u003e authenticator is more specific compared to \u003ccode\u003eoauth2_introspection\u003c/code\u003e, as it will be only executed, if the token is in a JWT format. In contrast to this, the \u003ccode\u003eoauth2_introspection\u003c/code\u003e authenticator is more general and does not care about the token format, thus will feel responsible for the request as soon as it finds a bearer token. You can however also make use of the \u003ccode\u003eallow_fallback_on_error\u003c/code\u003e configuration property and set it to \u003ccode\u003etrue\u003c/code\u003e. This will allow a fallback even if the verification of the credentials fail.\n\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eAuthorization Stage:\u003c/strong\u003e List of \u003ca href=\"/docs/mechanisms/contextualizers/\"\u003econtextualizer\u003c/a\u003e and \u003ca href=\"/docs/mechanisms/authorizers/\"\u003eauthorizer\u003c/a\u003e references in any order (optional). Can also be mixed. As with authenticators, the list definition happens using either \u003ccode\u003econtextualizer\u003c/code\u003e or \u003ccode\u003eauthorizer\u003c/code\u003e as key, followed by the required \u003ccode\u003eid\u003c/code\u003e. All mechanisms in this list are executed in the order, they are defined. If any of these fails, the entire pipeline fails, which leads to the execution of the \u003ca href=\"#_error_pipeline\"\u003eerror pipeline\u003c/a\u003e. This list is optional.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eFinalization Stage:\u003c/strong\u003e List of \u003ca href=\"/docs/mechanisms/finalizers/\"\u003efinalizer\u003c/a\u003e references using \u003ccode\u003efinalizers\u003c/code\u003e as key, followed by the required finalizer \u003ccode\u003eid\u003c/code\u003e. All finalizers in this list are executed in the order they are defined. If any of these fail, the entire pipeline fails, which leads to the execution of the \u003ca href=\"#_error_pipeline\"\u003eerror pipeline\u003c/a\u003e. This list is optional. If a \u003ca href=\"/docs/rules/default_rule/\"\u003edefault rule\u003c/a\u003e is configured, and no \u003ccode\u003efinalizers\u003c/code\u003e are configured on a specific rule level, the \u003ccode\u003efinalizers\u003c/code\u003e from the default rule are used. If the default rule does not have any \u003ccode\u003efinalizers\u003c/code\u003e configured either, no finalization will take place.\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eIn all cases, the used mechanism can be partially reconfigured if supported by the corresponding type. Configuration goes into the \u003ccode\u003econfig\u003c/code\u003e properties. These reconfigurations are always local to the given rule. With other words, you can adjust your rule specific pipeline as you want without any side effects.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eExecution of an \u003ccode\u003econtextualizer\u003c/code\u003e, \u003ccode\u003eauthorizer\u003c/code\u003e, or \u003ccode\u003efinalizer\u003c/code\u003e mechanisms can optionally happen conditionally by making use of a \u003ca href=\"https://github.com/google/cel-spec\"\u003eCEL\u003c/a\u003e expression in an \u003ccode\u003eif\u003c/code\u003e clause, which has access to the \u003ca href=\"/docs/mechanisms/evaluation_objects/#_subject\"\u003e\u003ccode\u003eSubject\u003c/code\u003e\u003c/a\u003e and the \u003ca href=\"/docs/mechanisms/evaluation_objects/#_request\"\u003e\u003ccode\u003eRequest\u003c/code\u003e\u003c/a\u003e objects. If the \u003ccode\u003eif\u003c/code\u003e clause is not present, the corresponding mechanism is always executed.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"exampleblock\"\u003e\n\u003cdiv class=\"title\"\u003eExample 6. Complex pipeline\u003c/div\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"yaml\"\u003e\u003cspan class=\"c1\"\u003e# list of authenticators\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e# defining the authentication stage\u003c/span\u003e\n\u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eauthenticator\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003efoo\u003c/span\u003e\n\u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eauthenticator\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ebar\u003c/span\u003e\n  \u003cspan class=\"na\"\u003econfig\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"na\"\u003esubject\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eanon\u003c/span\u003e\n  \u003cspan class=\"c1\"\u003e# ... any further required authenticator\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e# list of authorizers and contextualizers in any order\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e# defining the authentication stage\u003c/span\u003e\n\u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003econtextualizer\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ebaz\u003c/span\u003e\n  \u003cspan class=\"na\"\u003econfig\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"na\"\u003ecache_ttl\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e0s\u003c/span\u003e\n\u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eauthorizer\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ezab\u003c/span\u003e\n\u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003econtextualizer\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003efoo\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eif\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eSubject.ID != \u0026#34;anonymous\u0026#34;\u003c/span\u003e\n\u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003econtextualizer\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ebar\u003c/span\u003e\n\u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eauthorizer\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003efoo\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eif\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eRequest.Method == \u0026#34;POST\u0026#34;\u003c/span\u003e\n  \u003cspan class=\"na\"\u003econfig\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"na\"\u003eexpressions\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eexpression\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"pi\"\u003e|\u003c/span\u003e\n          \u003cspan class=\"s\"\u003e// some expression logic deviating from the\u003c/span\u003e\n          \u003cspan class=\"s\"\u003e// definition in the pipeline configuration.\u003c/span\u003e\n  \u003cspan class=\"c1\"\u003e# ... any further required authorizer or contextualizer\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e# list of finalizers\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e# defining the finalization stage\u003c/span\u003e\n\u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003efinalizer\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003efoo\u003c/span\u003e\n\u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003efinalizer\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ebar\u003c/span\u003e\n  \u003cspan class=\"na\"\u003econfig\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"na\"\u003eheaders\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eX-User-ID\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"pi\"\u003e{{\u003c/span\u003e \u003cspan class=\"nv\"\u003equote .ID\u003c/span\u003e \u003cspan class=\"pi\"\u003e}}\u003c/span\u003e\n  \u003cspan class=\"c1\"\u003e# ... any further required finalizers\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThis example uses\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003etwo authenticators, with authenticator named \u003ccode\u003ebar\u003c/code\u003e being the fallback for the authenticator named \u003ccode\u003efoo\u003c/code\u003e. This fallback authenticator is obviously of type \u003ca href=\"/docs/mechanisms/authenticators/#_anonymous\"\u003eanonymous\u003c/a\u003e as it reconfigures the referenced prototype to use \u003ccode\u003eanon\u003c/code\u003e for subject id.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003emultiple contextualizers and authorizers, with first contextualizer having its cache disabled (\u003ccode\u003ecache_ttl\u003c/code\u003e set to 0s) and the last authorizer being of type \u003ca href=\"/docs/mechanisms/authorizers/#_local_cel\"\u003ecel\u003c/a\u003e as it reconfigures the referenced prototype to use a different authorization expression.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003etwo finalizers, with the second one being obviously of type \u003ca href=\"/docs/mechanisms/finalizers/#_header\"\u003eheader\u003c/a\u003e, as it defines a \u003ccode\u003eX-User-ID\u003c/code\u003e header set to the value of the subject id to be forwarded to the upstream service.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003econtextualizer \u003ccode\u003efoo\u003c/code\u003e is only executed if the authenticated subject is not anonymous.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eauthorizer \u003ccode\u003efoo\u003c/code\u003e is only executed if the request method is HTTP POST.\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_error_pipeline\"\u003eError Pipeline\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eCompared to the \u003ca href=\"#_authentication_authorization_pipeline\"\u003eAuthentication \u0026amp; Authorization Pipeline\u003c/a\u003e, the error pipeline is pretty simple. It is also a list of mechanism references, but all referenced types are \u003ca href=\"/docs/mechanisms/error_handlers/\"\u003eerror handler types\u003c/a\u003e. Thus, each entry in this list must have \u003ccode\u003eerror_handler\u003c/code\u003e as key, followed by the \u003ccode\u003eìd\u003c/code\u003e of the required error handler, previously defined in the \u003ca href=\"/docs/mechanisms/catalogue/\"\u003emechanism catalogue\u003c/a\u003e. Error handlers are always executed as fallbacks. So, if the condition of the first error handler does not match, second is selected, if its condition matches, it is executed, otherwise the next one is selected, etc. If none of the conditions of the defined error handlers match, the \u003ca href=\"/docs/mechanisms/error_handlers/#_default\"\u003edefault error handler\u003c/a\u003e is executed.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eAs with the authentication \u0026amp; authorization pipeline, partial reconfiguration of the used mechanisms is possible if supported by the corresponding type. Same is true for overrides of the \u003ccode\u003eif\u003c/code\u003e conditions. The overrides are always local to the given rule as well.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"exampleblock\"\u003e\n\u003cdiv class=\"title\"\u003eExample 7. Two error handlers\u003c/div\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"yaml\"\u003e\u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eerror_handler\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003efoo\u003c/span\u003e\n\u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eerror_handler\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ebar\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eif\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"c1\"\u003e# rule specific condition\u003c/span\u003e\n  \u003cspan class=\"na\"\u003econfig\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"c1\"\u003e# rule specific config\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThis example uses two error handlers, named \u003ccode\u003efoo\u003c/code\u003e and \u003ccode\u003ebar\u003c/code\u003e. \u003ccode\u003ebar\u003c/code\u003e will only be selected by heimdall if \u003ccode\u003efoo\u003c/code\u003e \u0026#39;s error condition (defined in the \u003ca href=\"/docs/mechanisms/catalogue/\"\u003emechanism catalogue\u003c/a\u003e) does not match. \u003ccode\u003ebar\u003c/code\u003e does also override the error condition as required by the given rule.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n","sections":["Rules"],"tags":null,"title":"Regular Rule","url":"/docs/rules/regular_rule/"},{"categories":null,"content":" Configuration The configuration of the default rule can be done by making use of the default_rule property and configuring the options shown below.\nThe default rule does not support all the properties, which can be configured in an regular rule. E.g. it can not be used to forward requests to an upstream service, heimdall is protecting. So, if you operate heimdall in the reverse proxy mode, the default rule should be configured to reject requests. Otherwise, heimdall will respond with an error. methods: string array (optional)\nWhich HTTP methods (GET, POST, PATCH, etc) are allowed. Expansion using ALL and removal by prefixing the method with an ! is supported as with the regular rules. Defaults to an empty array. If the default rule is defined and the upstream service API specific rule (see also Rule Configuration does not override it, no methods will be accepted, effectively resulting in 405 Method Not Allowed response to Heimdall’s client for any urls matched by that particular rule.\nexecute: Authentication \u0026amp; Authorization Pipeline (mandatory)\nWhich mechanisms to use for authentication, authorization and finalization stages of the pipeline. At least the authentication stage with at least one authenticator must be defined. A specific rule (see also Regular Rule) can omit the definition of that stage, if it wants to reuse it from in the default rule. Same is true for other stages (See also Rule Inheritance).\non_error: Error Pipeline (mandatory)\nWhich error handler mechanisms to use if any of the mechanisms, defined in the execute property fail. Allows omitting the definition of error handlers in specific rules. As soon as a specific rule defines at least one error handler mechanism, all error handler mechanisms, defined in the default rule are ignored.\nExample 1. Default rule configuration default_rule: methods: - GET - PATCH execute: - authenticator: session_cookie_from_kratos_authn - authenticator: oauth2_introspect_token_from_keycloak_authn - authorizer: deny_all_requests_authz - finalizer: create_jwt on_error: - error_handler: authenticate_with_kratos_eh This example defines a default rule, which allows HTTP GET and PATCH requests on any URL (will respond with 405 Method Not Allowed for any other HTTP method used by a client). The authentication 6 authorization pipeline consists of two authenticators, with session_cookie_from_kratos_authn being the first and oauth2_introspect_token_from_keycloak_authn being the fallback (if the first one fails), a deny_all_requests_authz authorizer and the create_jwt finalizer. The error pipeline is configured to execute only the authenticate_with_kratos_eh error handler.\nObviously, the authentication \u0026amp; authorization pipeline (defined in the execute property) of this default rule will always result in an error due to deny_all_requests_authz. This way it is thought to provide secure defaults and let the upstream specific (regular) rules override at least the part dealing with authorization. Such an upstream specific rule could then look like follows:\nid: rule:my-service:protected-api match: url: http://my-service.local/foo execute: - authorizer: allow_all_requests_authz Take a look at how methods, on_error, as well as the authenticators and finalizers from the execute definition of the default rule are reused. Easy, no?\n","description":"Heimdall lets you not only define upstream service specific rules, it does also support a definition of an optional default rule, which, if defined, kicks in, if no other rule matches. This way you can ensure secure defaults by simultaneously reducing the amount of work while defining upstream service API specific rules.","html_content":"\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_configuration\"\u003eConfiguration\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe configuration of the default rule can be done by making use of the \u003ccode\u003edefault_rule\u003c/code\u003e property and configuring the options shown below.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"admonitionblock note\"\u003e\n\u003ctable\u003e\n\u003ctbody\u003e\u003ctr\u003e\n\u003ctd class=\"icon\"\u003e\n\u003ci class=\"fa icon-note\" title=\"Note\"\u003e\u003c/i\u003e\n\u003c/td\u003e\n\u003ctd class=\"content\"\u003e\nThe default rule does not support all the properties, which can be configured in an \u003ca href=\"/docs/rules/regular_rule/\"\u003eregular rule\u003c/a\u003e. E.g. it can not be used to forward requests to an upstream service, heimdall is protecting. So, if you operate heimdall in the reverse proxy mode, the default rule should be configured to reject requests. Otherwise, heimdall will respond with an error.\n\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003emethods\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003estring array\u003c/em\u003e (optional)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eWhich HTTP methods (\u003ccode\u003eGET\u003c/code\u003e, \u003ccode\u003ePOST\u003c/code\u003e, \u003ccode\u003ePATCH\u003c/code\u003e, etc) are allowed. Expansion using \u003ccode\u003eALL\u003c/code\u003e and removal by prefixing the method with an \u003ccode\u003e!\u003c/code\u003e is supported as with the regular rules. Defaults to an empty array. If the default rule is defined and the upstream service API specific rule (see also \u003ca href=\"/docs/rules/regular_rule/#_configuration\"\u003eRule Configuration\u003c/a\u003e does not override it, no methods will be accepted, effectively resulting in \u003ccode\u003e405 Method Not Allowed\u003c/code\u003e response to Heimdall’s client for any urls matched by that particular rule.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003eexecute\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003e\u003ca href=\"/docs/rules/regular_rule/#_authentication_authorization_pipeline\"\u003eAuthentication \u0026amp; Authorization Pipeline\u003c/a\u003e\u003c/em\u003e (mandatory)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eWhich mechanisms to use for authentication, authorization and finalization stages of the pipeline. At least the authentication stage with at least one \u003ca href=\"/docs/mechanisms/authenticators/\"\u003eauthenticator\u003c/a\u003e must be defined. A specific rule (see also \u003ca href=\"/docs/rules/regular_rule/\"\u003eRegular Rule\u003c/a\u003e) can omit the definition of that stage, if it wants to reuse it from in the default rule. Same is true for other stages (See also \u003ca href=\"/docs/concepts/rules/#_default_rule_inheritance\"\u003eRule Inheritance\u003c/a\u003e).\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003eon_error\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003e\u003ca href=\"/docs/rules/regular_rule/#_error_pipeline\"\u003eError Pipeline\u003c/a\u003e\u003c/em\u003e (mandatory)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eWhich error handler mechanisms to use if any of the mechanisms, defined in the \u003ccode\u003eexecute\u003c/code\u003e property fail. Allows omitting the definition of error handlers in specific rules. As soon as a specific rule defines at least one error handler mechanism, all error handler mechanisms, defined in the default rule are ignored.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"exampleblock\"\u003e\n\u003cdiv class=\"title\"\u003eExample 1. Default rule configuration\u003c/div\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"yaml\"\u003e\u003cspan class=\"na\"\u003edefault_rule\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"na\"\u003emethods\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003eGET\u003c/span\u003e\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003ePATCH\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eexecute\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eauthenticator\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003esession_cookie_from_kratos_authn\u003c/span\u003e\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eauthenticator\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eoauth2_introspect_token_from_keycloak_authn\u003c/span\u003e\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eauthorizer\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003edeny_all_requests_authz\u003c/span\u003e\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003efinalizer\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ecreate_jwt\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eon_error\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eerror_handler\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eauthenticate_with_kratos_eh\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThis example defines a default rule, which allows HTTP \u003ccode\u003eGET\u003c/code\u003e and \u003ccode\u003ePATCH\u003c/code\u003e requests on any URL (will respond with \u003ccode\u003e405 Method Not Allowed\u003c/code\u003e for any other HTTP method used by a client). The authentication 6 authorization pipeline consists of two authenticators, with \u003ccode\u003esession_cookie_from_kratos_authn\u003c/code\u003e being the first and \u003ccode\u003eoauth2_introspect_token_from_keycloak_authn\u003c/code\u003e being the fallback (if the first one fails), a \u003ccode\u003edeny_all_requests_authz\u003c/code\u003e authorizer and the \u003ccode\u003ecreate_jwt\u003c/code\u003e finalizer. The error pipeline is configured to execute only the \u003ccode\u003eauthenticate_with_kratos_eh\u003c/code\u003e error handler.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eObviously, the authentication \u0026amp; authorization pipeline (defined in the \u003ccode\u003eexecute\u003c/code\u003e property) of this default rule will always result in an error due to \u003ccode\u003edeny_all_requests_authz\u003c/code\u003e. This way it is thought to provide secure defaults and let the upstream specific (regular) rules override at least the part dealing with authorization. Such an upstream specific rule could then look like follows:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"yaml\"\u003e\u003cspan class=\"na\"\u003eid\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003erule:my-service:protected-api\u003c/span\u003e\n\u003cspan class=\"na\"\u003ematch\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eurl\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ehttp://my-service.local/foo\u003c/span\u003e\n\u003cspan class=\"na\"\u003eexecute\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eauthorizer\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eallow_all_requests_authz\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eTake a look at how \u003ccode\u003emethods\u003c/code\u003e, \u003ccode\u003eon_error\u003c/code\u003e, as well as the authenticators and finalizers from the \u003ccode\u003eexecute\u003c/code\u003e definition of the default rule are reused. Easy, no?\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n","sections":["Rules"],"tags":null,"title":"Default Rule","url":"/docs/rules/default_rule/"},{"categories":null,"content":" Depending on the configured provider, the rules can be then loaded from e.g. a plain old configuration file, residing in the local file system, or even from a Kubernetes environment as a custom resource. Thus, the structure and format of a rule set depends on the provider used to load it. As of today, there are two supported formats:\nas a regular JSON/YAML file, the so-called regular rule set, and\nas a kubernetes custom resource rule set, which is actually a YAML/JSON file as well, but adheres to corresponding kubernetes requirements.\nThe main difference is the internal structure. Both do however require the specification of a version and a list or rules.\nRegular Rule Set A regular rule set is a just a file with a list of rules and some additional meta information. Latter can be extended by a particular provider supporting that format.\nAvailable properties are:\nversion: string (mandatory)\nThe version schema of the rule set. The current version of heimdall supports only the version 1alpha3.\nname: string (optional)\nThe name of a rule set. Used only for logging purposes.\nrules: Rule Configuration array (mandatory)\nThe list of the actual rule definitions.\nExample 1. Rule set with two rules An imaginary rule set file defining two rules could look like shown below.\nversion: \u0026#34;1alpha3\u0026#34; name: my-rule-set rules: - id: rule:1 match: url: https://my-service1.local/\u0026lt;**\u0026gt; methods: [ \u0026#34;GET\u0026#34; ] execute: - authorizer: foobar - id: rule:2 match: url: https://my-service2.local/\u0026lt;**\u0026gt; methods: [ \u0026#34;GET\u0026#34; ] execute: - authorizer: barfoo Kubernetes Rule Set If you operate heimdall in kubernetes, most probably, you would like to make use of the RuleSet custom resource, which can be loaded by the kubernetes provider.\nConfiguration apiVersion: string (mandatory)\nThe api version of the custom resource definition, the given rule set is based on. The current version of heimdall supports only heimdall.dadrus.github.com/v1alpha3 version.\nkind: string (mandatory)\nThe custom resource kind. Must be set to RuleSet\nmetadata: map (optional)\nThe metadata, you would like to assign to the rule set, like the name of the rule set, labels, etc\nspec: map (mandatory)\nThe actual specification of the rule set. Following attributes are possible, respectively required:\nauthClassName: string (optional)\nReferences the heimdall instance, which should use this RuleSet.\nrules: Rule Configuration array (mandatory)\nThe list of the actual rules.\nTo be able to deploy and make heimdall use the RuleSet custom resources, the corresponding CRD must be deployed. Otherwise, heimdall will not be able to monitor corresponding resources and emit error messages to the log.\nIf you have used the Helm Chart to install heimdall, this CRD is already installed. You can however install it also like this:\n$ kubectl apply -f https://raw.githubusercontent.com/dadrus/heimdall/main/charts/heimdall/crds/ruleset.yaml Example 2. Simple Example apiVersion: heimdall.dadrus.github.com/v1alpha3 kind: RuleSet metadata: name: \u0026#34;\u0026lt;some name\u0026gt;\u0026#34; spec: authClassName: \u0026#34;\u0026lt;optional auth_class reference (see above)\u0026gt; \u0026#34; rules: - id: \u0026#34;\u0026lt;identifier of a rule 1\u0026gt;\u0026#34; match: url: http://127.0.0.1:9090/foo/\u0026lt;**\u0026gt; execute: - authenticator: foo - authorizer: bar Resource Status In addition to configuration attributes described above, a RuleSet resource has a status stanza, which provides information about the usage status as soon as a RuleSet has been loaded by at least one heimdall instance.\nBy making use of kubectl get -n \u0026lt;your namespace\u0026gt; rulesets.heimdall.dadrus.github.com you’ll get an overview of deployed RuleSet resources in a particular namespace, like e.g. shown below\nNAME ACTIVE IN AGE test-rules 2/2 32m The value 2/2 in ACTIVE IN means, \u0026lt;active in heimdall instances\u0026gt;/\u0026lt;matching instances\u0026gt;. With\n\u0026#34;matching instances\u0026#34; being those heimdall instances, which auth_class matches the authClassName in the RuleSet and\n\u0026#34;active in heimdall instances\u0026#34; are those from the \u0026#34;matching instances\u0026#34;, which were able to load the RuleSet.\nIn addition, you can also get further information about the executed reconciliations by the deployed heimdall instances by taking a look at the .status.conditions field. The reconciliation status of matching instances is present there. That also means, if there were errors while loading the RuleSet, these are present in this condition list\nE.g.\n$ kubectl describe -n test rulesets.heimdall.dadrus.github.com test-rules Name: test-rules Namespace: test ... Status: Conditions: Last Transition Time: 2023-11-08T21:55:36Z Message: heimdall-6fb66c47bc-kwqqn instance successfully loaded RuleSet Observed Generation: 1 Reason: RuleSetActive Status: True Type: heimdall-6fb66c47bc-kwqqn/Reconciliation Last Transition Time: 2023-11-08T21:55:36Z Message: heimdall-6fb66c47bc-l7skn instance successfully loaded RuleSet Observed Generation: 1 Reason: RuleSetActive Status: True Type: heimdall-6fb66c47bc-l7skn/Reconciliation Active In: 2/2 Events: \u0026lt;none\u0026gt; ","description":"Rule Sets organize rules, allowing versioning of such and loading by providers.","html_content":"\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eDepending on the configured provider, the rules can be then loaded from e.g. a plain old configuration file, residing in the local file system, or even from a Kubernetes environment as a custom resource. Thus, the structure and format of a rule set depends on the \u003ca href=\"/docs/rules/providers/\"\u003eprovider\u003c/a\u003e used to load it. As of today, there are two supported formats:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eas a regular JSON/YAML file, the so-called \u003ca href=\"#_regular_rule_set\"\u003eregular rule set\u003c/a\u003e, and\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eas a kubernetes \u003ca href=\"#_kubernetes_rule_set\"\u003ecustom resource rule set\u003c/a\u003e, which is actually a YAML/JSON file as well, but adheres to corresponding kubernetes requirements.\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe main difference is the internal structure. Both do however require the specification of a version and a list or rules.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_regular_rule_set\"\u003eRegular Rule Set\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eA regular rule set is a just a file with a list of rules and some additional meta information. Latter can be extended by a particular \u003ca href=\"/docs/rules/providers/\"\u003eprovider\u003c/a\u003e supporting that format.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eAvailable properties are:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003eversion\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003estring\u003c/em\u003e (mandatory)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe version schema of the rule set. The current version of heimdall supports only the version \u003ccode\u003e1alpha3\u003c/code\u003e.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003ename\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003estring\u003c/em\u003e (optional)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe name of a rule set. Used only for logging purposes.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003erules\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003e\u003ca href=\"/docs/rules/regular_rule/#_configuration\"\u003eRule Configuration\u003c/a\u003e array\u003c/em\u003e (mandatory)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe list of the actual rule definitions.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"exampleblock\"\u003e\n\u003cdiv class=\"title\"\u003eExample 1. Rule set with two rules\u003c/div\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eAn imaginary rule set file defining two rules could look like shown below.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"yaml\"\u003e\u003cspan class=\"na\"\u003eversion\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"s\"\u003e1alpha3\u0026#34;\u003c/span\u003e\n\u003cspan class=\"na\"\u003ename\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003emy-rule-set\u003c/span\u003e\n\u003cspan class=\"na\"\u003erules\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n\u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eid\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003erule:1\u003c/span\u003e\n  \u003cspan class=\"na\"\u003ematch\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"na\"\u003eurl\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ehttps://my-service1.local/\u0026lt;**\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"na\"\u003emethods\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"pi\"\u003e[\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"s\"\u003eGET\u0026#34;\u003c/span\u003e \u003cspan class=\"pi\"\u003e]\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eexecute\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eauthorizer\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003efoobar\u003c/span\u003e\n\u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eid\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003erule:2\u003c/span\u003e\n  \u003cspan class=\"na\"\u003ematch\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"na\"\u003eurl\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ehttps://my-service2.local/\u0026lt;**\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"na\"\u003emethods\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"pi\"\u003e[\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"s\"\u003eGET\u0026#34;\u003c/span\u003e \u003cspan class=\"pi\"\u003e]\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eexecute\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eauthorizer\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ebarfoo\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_kubernetes_rule_set\"\u003eKubernetes Rule Set\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eIf you operate heimdall in kubernetes, most probably, you would like to make use of the \u003ccode\u003eRuleSet\u003c/code\u003e custom resource, which can be loaded by the \u003ca href=\"/docs/rules/providers/#_kubernetes\"\u003ekubernetes provider\u003c/a\u003e.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_configuration\"\u003eConfiguration\u003c/h3\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003eapiVersion\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003estring\u003c/em\u003e (mandatory)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe api version of the custom resource definition, the given rule set is based on. The current version of heimdall supports only \u003ccode\u003eheimdall.dadrus.github.com/v1alpha3\u003c/code\u003e version.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003ekind\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003estring\u003c/em\u003e (mandatory)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe custom resource kind. Must be set to \u003ccode\u003eRuleSet\u003c/code\u003e\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003emetadata\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003emap\u003c/em\u003e (optional)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe metadata, you would like to assign to the rule set, like the name of the rule set, labels, etc\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003espec\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003emap\u003c/em\u003e (mandatory)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe actual specification of the rule set. Following attributes are possible, respectively required:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003eauthClassName\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003estring\u003c/em\u003e (optional)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eReferences the heimdall instance, which should use this \u003ccode\u003eRuleSet\u003c/code\u003e.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003erules\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003e\u003ca href=\"/docs/rules/regular_rule/#_configuration\"\u003eRule Configuration\u003c/a\u003e array\u003c/em\u003e (mandatory)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe list of the actual rules.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"admonitionblock note\"\u003e\n\u003ctable\u003e\n\u003ctbody\u003e\u003ctr\u003e\n\u003ctd class=\"icon\"\u003e\n\u003ci class=\"fa icon-note\" title=\"Note\"\u003e\u003c/i\u003e\n\u003c/td\u003e\n\u003ctd class=\"content\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eTo be able to deploy and make heimdall use the \u003ccode\u003eRuleSet\u003c/code\u003e custom resources, the corresponding CRD must be deployed. Otherwise, heimdall will not be able to monitor corresponding resources and emit error messages to the log.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eIf you have used the \u003ca href=\"/docs/getting_started/installation/#_helm_chart\"\u003eHelm Chart\u003c/a\u003e to install heimdall, this CRD is already installed. You can however install it also like this:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"bash\"\u003e\u003cspan class=\"nv\"\u003e$ \u003c/span\u003ekubectl apply \u003cspan class=\"nt\"\u003e-f\u003c/span\u003e https://raw.githubusercontent.com/dadrus/heimdall/main/charts/heimdall/crds/ruleset.yaml\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003cdiv class=\"exampleblock\"\u003e\n\u003cdiv class=\"title\"\u003eExample 2. Simple Example\u003c/div\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"yaml\"\u003e\u003cspan class=\"na\"\u003eapiVersion\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eheimdall.dadrus.github.com/v1alpha3\u003c/span\u003e\n\u003cspan class=\"na\"\u003ekind\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eRuleSet\u003c/span\u003e\n\u003cspan class=\"na\"\u003emetadata\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"na\"\u003ename\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026lt;some\u003c/span\u003e\u003cspan class=\"nv\"\u003e \u003c/span\u003e\u003cspan class=\"s\"\u003ename\u0026gt;\u0026#34;\u003c/span\u003e\n\u003cspan class=\"na\"\u003espec\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eauthClassName\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026lt;optional\u003c/span\u003e\u003cspan class=\"nv\"\u003e \u003c/span\u003e\u003cspan class=\"s\"\u003eauth_class\u003c/span\u003e\u003cspan class=\"nv\"\u003e \u003c/span\u003e\u003cspan class=\"s\"\u003ereference\u003c/span\u003e\u003cspan class=\"nv\"\u003e \u003c/span\u003e\u003cspan class=\"s\"\u003e(see\u003c/span\u003e\u003cspan class=\"nv\"\u003e \u003c/span\u003e\u003cspan class=\"s\"\u003eabove)\u0026gt;\u003c/span\u003e\u003cspan class=\"nv\"\u003e \u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;\u003c/span\u003e\n  \u003cspan class=\"na\"\u003erules\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eid\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026lt;identifier\u003c/span\u003e\u003cspan class=\"nv\"\u003e \u003c/span\u003e\u003cspan class=\"s\"\u003eof\u003c/span\u003e\u003cspan class=\"nv\"\u003e \u003c/span\u003e\u003cspan class=\"s\"\u003ea\u003c/span\u003e\u003cspan class=\"nv\"\u003e \u003c/span\u003e\u003cspan class=\"s\"\u003erule\u003c/span\u003e\u003cspan class=\"nv\"\u003e \u003c/span\u003e\u003cspan class=\"s\"\u003e1\u0026gt;\u0026#34;\u003c/span\u003e\n      \u003cspan class=\"na\"\u003ematch\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"na\"\u003eurl\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ehttp://127.0.0.1:9090/foo/\u0026lt;**\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"na\"\u003eexecute\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eauthenticator\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003efoo\u003c/span\u003e\n        \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eauthorizer\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ebar\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_resource_status\"\u003eResource Status\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eIn addition to configuration attributes described above, a \u003ccode\u003eRuleSet\u003c/code\u003e resource has a \u003ccode\u003estatus\u003c/code\u003e stanza, which provides information about the usage status as soon as a \u003ccode\u003eRuleSet\u003c/code\u003e has been loaded by at least one heimdall instance.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eBy making use of \u003ccode\u003ekubectl get -n \u0026lt;your namespace\u0026gt; rulesets.heimdall.dadrus.github.com\u003c/code\u003e you’ll get an overview of deployed \u003ccode\u003eRuleSet\u003c/code\u003e resources in a particular namespace, like e.g. shown below\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"bash\"\u003eNAME             ACTIVE IN       AGE\ntest-rules       2/2             32m\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe value \u003ccode\u003e2/2\u003c/code\u003e in \u003ccode\u003eACTIVE IN\u003c/code\u003e means, \u0026lt;active in heimdall instances\u0026gt;/\u0026lt;matching instances\u0026gt;. With\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u0026#34;matching instances\u0026#34; being those heimdall instances, which \u003ccode\u003eauth_class\u003c/code\u003e matches the \u003ccode\u003eauthClassName\u003c/code\u003e in the \u003ccode\u003eRuleSet\u003c/code\u003e and\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u0026#34;active in heimdall instances\u0026#34; are those from the \u0026#34;matching instances\u0026#34;, which were able to load the \u003ccode\u003eRuleSet\u003c/code\u003e.\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eIn addition, you can also get further information about the executed reconciliations by the deployed heimdall instances by taking a look at the \u003ccode\u003e.status.conditions\u003c/code\u003e field. The reconciliation status of matching instances is present there. That also means, if there were errors while loading the \u003ccode\u003eRuleSet\u003c/code\u003e, these are present in this condition list\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eE.g.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"bash\"\u003e\u003cspan class=\"nv\"\u003e$ \u003c/span\u003ekubectl describe \u003cspan class=\"nt\"\u003e-n\u003c/span\u003e \u003cspan class=\"nb\"\u003etest \u003c/span\u003erulesets.heimdall.dadrus.github.com test-rules\n\nName:         test-rules\nNamespace:    \u003cspan class=\"nb\"\u003etest\u003c/span\u003e\n...\nStatus:\n  Conditions:\n    Last Transition Time:  2023-11-08T21:55:36Z\n    Message:               heimdall-6fb66c47bc-kwqqn instance successfully loaded RuleSet\n    Observed Generation:   1\n    Reason:                RuleSetActive\n    Status:                True\n    Type:                  heimdall-6fb66c47bc-kwqqn/Reconciliation\n    Last Transition Time:  2023-11-08T21:55:36Z\n    Message:               heimdall-6fb66c47bc-l7skn instance successfully loaded RuleSet\n    Observed Generation:   1\n    Reason:                RuleSetActive\n    Status:                True\n    Type:                  heimdall-6fb66c47bc-l7skn/Reconciliation\n  Active In:               2/2\n  Events:                  \u0026lt;none\u0026gt;\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n","sections":["Rules"],"tags":null,"title":"Rule Sets","url":"/docs/rules/rule_sets/"},{"categories":null,"content":" Providers allow definition of sources to load the rule sets from. These make heimdall’s behavior dynamic. All providers, you want to enable for a heimdall instance must be configured within the providers section of heimdall’s configuration.\nBelow, you can find the description and configuration options for currently supported providers.\nFilesystem The filesystem provider allows loading of regular rule sets in JSON or YAML format from a file system.\nConfiguration The configuration of this provider goes into the file_system property. This provider is handy for e.g. starting playing around with heimdall, e.g. locally, or using a container runtime, as well as if your deployment strategy considers deploying a heimdall instance as a Side-Car for each of your services.\nFollowing configuration options are supported:\nsrc: string (mandatory)\nCan either be a single file, containing a rule set, or a directory with files, each containing a rule set.\nwatch: boolean (optional)\nWhether the configured src should be watched for updates. Defaults to false. If the src has been configured to a single file, the provider will watch for changes in that file. Otherwise, if the src has been configured to a directory, the provider will watch for files appearing and disappearing in this directory, as well as for changes in each particular file in this directory. Recursive lookup is not supported. That is, if the configured directory contains further directories, these, as well as their contents are ignored.\nenv_vars_enabled: boolean (optional)\nWhether to enable environment variables access in the rule set files. Defaults to false. If set to true, environment variables usage using Bash syntax is possible as with the static configuration.\nAll environment variables, used in the rule set files must be known in advance to the heimdall process (when it starts). In addition, the usage of that functionality might lead to security issues. If an adversary is somehow able to add new or update existing rule sets, it would be theoretically able exfiltrating environment variables available to the heimdall process by crafting contextualizers or authorizers, which would forward the corresponding values to a controlled service. So, use with caution, disable the watching of rule set updates and try to avoid! Example 1. Rule set making use of environment variables version: \u0026#34;1alpha3\u0026#34; name: my-rule-set rules: - id: rule:1 match: url: https://my-service1.local/\u0026lt;**\u0026gt; forward_to: host: ${UPSTREAM_HOST:=\u0026#34;default-backend:8080\u0026#34;} methods: [ \u0026#34;GET\u0026#34; ] execute: - authorizer: foobar Examples Example 2. Load rule sets from the files residing in the /path/to/rules/dir directory and watch for changes. file_system: src: /path/to/rules/dir watch: true Example 3. Load rule sets from the /path/to/rules.yaml file without watching it for changes. file_system: src: /path/to/rules.yaml HTTP Endpoint This provider allows loading of regular rule sets in JSON or YAML format from any remote endpoint accessible via HTTP(s). The format selection happens based on the Content-Type set in the response from the endpoint, which must be either application/yaml or application/json, otherwise an error is logged and the response from the endpoint is ignored.\nThe loading and removal of rules happens as follows:\nif the response status code is an HTTP 200 OK and contains a rule sets in a known format (see above), the corresponding rules are loaded (if the definitions are valid)\nin case of network issues, like dns errors, timeouts and alike, the rule sets previously received from the corresponding endpoints are preserved.\nin any other case related to network communication (e.g. not 200 status code, empty response body, unsupported format, etc.), the corresponding rules are removed if previously loaded.\nConfiguration The configuration of this provider goes into the http_endpoint property. In contrast to the Filesystem provider, it can be configured with as many endpoints to load rule sets from as required for the particular use case.\nFollowing configuration options are supported:\nwatch_interval: Duration (optional)\nWhether the configured endpoints should be polled for updates. Defaults to 0s (polling disabled).\nendpoints: RuleSetEndpoint array (mandatory)\nEach entry of that array supports all the properties defined by Endpoint, except method, which is always GET. As with the Endpoint type, at least the url must be configured. Following properties are defined in addition:\nrule_path_match_prefix: string (optional)\nThis property can be used to create kind of a namespace for the rule sets retrieved from the different endpoints. If set, the provider checks whether the urls specified in all rules retrieved from the referenced endpoint have the defined path prefix. If not, a warning is emitted and the rule set is ignored. This can be used to ensure a rule retrieved from one endpoint does not collide with a rule from another endpoint.\nHTTP caching according to RFC 7234 is enabled by default. It can be disabled by setting http_cache.enabled to false. Examples Example 4. Minimal possible configuration Here the provider is configured to load a rule set from one endpoint without polling it for changes.\nhttp_endpoint: endpoints: - url: http://foo.bar/ruleset1 Example 5. Load rule sets from remote endpoints and watch for changes. Here, the provider is configured to poll the two defined rule set endpoints for changes every 5 minutes.\nThe configuration for the first endpoint instructs heimdall to ensure all urls defined in the rules coming from that endpoint must match the defined path prefix.\nThe configuration for the second endpoint defines the rule_path_match_prefix as well. It also defines a couple of other properties. One to ensure the communication to that endpoint is more resilient by setting the retry options and since this endpoint is protected by an API key, it defines the corresponding options as well.\nhttp_endpoint: watch_interval: 5m endpoints: - url: http://foo.bar/ruleset1 rule_path_match_prefix: /foo/bar - url: http://foo.bar/ruleset2 rule_path_match_prefix: /bar/foo retry: give_up_after: 5s max_delay: 250ms auth: type: api_key config: name: X-Api-Key value: super-secret in: header Cloud Blob This provider allows loading of regular rule sets from cloud blobs, like AWS S3 buckets, Google Cloud Storage, Azure Blobs, or other API compatible implementations and supports rule sets in YAML, as well as in JSON format. The format selection happens based on the Content-Type set in the metadata of the loaded blob, which must be either application/yaml or application/json, otherwise an error is logged and the blob is ignored.\nThe loading and removal of rules happens as follows:\nif the response status code is an HTTP 200 OK and contains a rule set in a known format (see above), the corresponding rules are loaded (if the definitions are valid)\nin case of network issues, like dns errors, timeouts and alike, the rule sets previously received from the corresponding buckets are preserved.\nin any other case like, not 200 status code, empty response body, unsupported format, etc, the corresponding rules are removed if previously loaded.\nConfiguration The configuration of this provider goes into the cloud_blob property. As with HTTP Endpoint provider, it can be configured with as many buckets/blobs to load rule sets from as required for the particular use case.\nFollowing configuration options are supported:\nwatch_interval: Duration (optional)\nWhether the configured buckets should be polled for updates. Defaults to 0s (polling disabled).\nbuckets: BlobReference array (mandatory)\nEach BlobReference entry in that array supports the following properties:\nurl: string (mandatory)\nThe actual url to the bucket or to a specific blob in the bucket.\nprefix: string (optional)\nIndicates that only blobs with a key starting with this prefix should be retrieved\nrule_path_match_prefix: string (optional)\nCreates kind of a namespace for the rule sets retrieved from the blobs. If set, the provider checks whether the urls patterns specified in all rules retrieved from the referenced bucket have the defined path prefix. If that rule is violated, a warning is emitted and the rule set is ignored. This can be used to ensure a rule retrieved from one endpoint does not override a rule from another endpoint.\nThe differentiation which storage is used is based on the URL scheme. These are:\ns3 for AWS S3 buckets\ngs for Google Cloud Storage and\nazblob for Azure Blob Storage\nOther API compatible storage services, like Minio, Ceph, SeaweedFS, etc. can be used as well. The corresponding and other options can be found in the Go CDK Blob documentation, the implementation of this provider is based on.\nThe communication to the storage services requires an active session to the corresponding cloud provider. The session information is taken from the vendor specific environment variables, respectively configuration. See AWS Session, GC Application Default Credentials and Azure Storage Access for more information. Examples Example 6. Minimal possible configuration Here the provider is configured to load rule sets from all blobs stored on the Google Cloud Storage bucket named \u0026#34;my-bucket\u0026#34; without polling for changes.\ncloud_blob: buckets: - url: gs://my-bucket Example 7. Load rule sets from AWS S3 buckets and watch for changes. cloud_blob: watch_interval: 2m buckets: - url: gs://my-bucket prefix: service1 rule_path_match_prefix: /service1 - url: gs://my-bucket prefix: service2 rule_path_match_prefix: /service2 - url: s3://my-bucket/my-rule-set?region=us-west-1 Here, the provider is configured to poll multiple buckets with rule sets for changes every 2 minutes.\nThe first two bucket reference configurations reference actually the same bucket on Google Cloud Storage, but different blobs based on the configured blob prefix. The first one will let heimdall loading only those blobs, which start with service1, the second only those, which start with service2. As rule_path_match_prefix are defined for both as well, heimdall will ensure, that rule sets loaded from the corresponding blobs will not overlap in their url matching definitions.\nThe last one instructs heimdall to load rule set from a specific blob, namely a blob named my-rule-set, which resides on the my-bucket AWS S3 bucket, which is located in the us-west-1 AWS region.\nKubernetes This provider is only supported if heimdall is running within Kubernetes and allows usage (validation and loading) of RuleSet custom resources deployed to the same Kubernetes environment.\nConfiguration The configuration of this provider goes into the kubernetes property and supports the following configuration options:\nauth_class: string (optional)\nBy making use of this property, you can specify which rule sets should be used by this particular heimdall instance. If specified, heimdall will consider the value of the authClassName attribute of each RuleSet resource deployed to the cluster and validate, respectively load only those rules, which authClassName values matching the value of auth_class. If not set all RuleSet resources will be used.\ntls: TLS (optional)\nIf configured, heimdall will start and expose a validating admission controller service on port 4458 listening on all interfaces. This service allows integration with the Kubernetes API server enabling validation of the applied RuleSet resources before these are made available to heimdall for loading. This way you will get a direct feedback about issues without the need to look into heimdall logs if a RuleSet resource could not be loaded (See also API documentation for more details).\nTo let the Kubernetes API server use the admission controller, there is a need for a properly configured ValidatingWebhookConfiguration. The Helm Chart shipped with heimdall does this automatically as soon as this property is configured. It does however need a caBundle to be set or injected. Otherwise, the Kubernetes API server won’t trust the configured TLS certificate and won’t use the endpoint.\nSince multiple heimdall deployments with different configured auth_class names can coexist, RuleSet resources with mismatching authClassName will be ignored by a particular deployment. In addition, Kubernetes API server validation requests for mismatching rule sets result in a successful response. This behavior is required as otherwise, as soon as the API server receives even a single failed validation response, the affected RuleSet resource will be discarded and not made available for loading to any of the available heimdall deployments.\nThat also means, if there is no heimdall deployment feeling responsible for the given RuleSet resource (due to authClassName - auth_class mismatch), the affected RuleSet resource will be silently ignored.\nExamples Example 8. Minimal possible configuration Here, the provider is just enabled. Since no auth_class is configured, it will load all RuleSet resources deployed to the Kubernetes environment.\nkubernetes: {} Example 9. Configuration with auth_class set Here, the provider is configured to consider only those RuleSet resources, which authClassName is set to foo.\nkubernetes: auth_class: foo Example 10. Configuration with auth_class set and enabled validating admission controller As with the previous example, the provider is configured to consider only those RuleSet resources, which authClassName is set to foo. The admission controller is enabled as well and will validate RuleSet resources before these are made available for loading.\nkubernetes: auth_class: foo tls: # below is the minimal required configuration key_store: path: /path/to/file.pem This provider requires a RuleSet CRD being deployed, otherwise heimdall will not be able to monitor corresponding resources and emit error messages to the log.\nIf you have used the Helm Chart to install heimdall, this CRD is already installed. You can however install it also like this:\n$ kubectl apply -f https://raw.githubusercontent.com/dadrus/heimdall/main/charts/heimdall/crds/ruleset.yaml ","description":"Rule providers manage rules in heimdall. They load, reload or remove rules when new rule sets appear, changes are detected, or rule sets are deleted.","html_content":"\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eProviders allow definition of sources to load the \u003ca href=\"/docs/rules/rule_sets/\"\u003erule sets\u003c/a\u003e from. These make heimdall’s behavior dynamic. All providers, you want to enable for a heimdall instance must be configured within the \u003ccode\u003eproviders\u003c/code\u003e section of heimdall’s configuration.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eBelow, you can find the description and configuration options for currently supported providers.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_filesystem\"\u003eFilesystem\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe filesystem provider allows loading of \u003ca href=\"/docs/rules/rule_sets/#_regular_rule_set\"\u003eregular rule sets\u003c/a\u003e in JSON or YAML format from a file system.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_configuration\"\u003eConfiguration\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe configuration of this provider goes into the \u003ccode\u003efile_system\u003c/code\u003e property. This provider is handy for e.g. starting playing around with heimdall, e.g. locally, or using a container runtime, as well as if your deployment strategy considers deploying a heimdall instance as a Side-Car for each of your services.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eFollowing configuration options are supported:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003esrc\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003estring\u003c/em\u003e (mandatory)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eCan either be a single file, containing a rule set, or a directory with files, each containing a rule set.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003ewatch\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003eboolean\u003c/em\u003e (optional)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eWhether the configured \u003ccode\u003esrc\u003c/code\u003e should be watched for updates. Defaults to \u003ccode\u003efalse\u003c/code\u003e. If the \u003ccode\u003esrc\u003c/code\u003e has been configured to a single file, the provider will watch for changes in that file. Otherwise, if the \u003ccode\u003esrc\u003c/code\u003e has been configured to a directory, the provider will watch for files appearing and disappearing in this directory, as well as for changes in each particular file in this directory. Recursive lookup is not supported. That is, if the configured directory contains further directories, these, as well as their contents are ignored.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003eenv_vars_enabled\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003eboolean\u003c/em\u003e (optional)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eWhether to enable environment variables access in the rule set files. Defaults to \u003ccode\u003efalse\u003c/code\u003e. If set to \u003ccode\u003etrue\u003c/code\u003e, environment variables usage using Bash syntax is possible as with the \u003ca href=\"/docs/operations/configuration/#_configuration_file\"\u003estatic configuration\u003c/a\u003e.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"admonitionblock warning\"\u003e\n\u003ctable\u003e\n\u003ctbody\u003e\u003ctr\u003e\n\u003ctd class=\"icon\"\u003e\n\u003ci class=\"fa icon-warning\" title=\"Warning\"\u003e\u003c/i\u003e\n\u003c/td\u003e\n\u003ctd class=\"content\"\u003e\nAll environment variables, used in the rule set files must be known in advance to the heimdall process (when it starts). In addition, the usage of that functionality might lead to security issues. If an adversary is somehow able to add new or update existing rule sets, it would be theoretically able exfiltrating environment variables available to the heimdall process by crafting contextualizers or authorizers, which would forward the corresponding values to a controlled service. So, use with caution, disable the watching of rule set updates and try to avoid!\n\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003cdiv class=\"exampleblock\"\u003e\n\u003cdiv class=\"title\"\u003eExample 1. Rule set making use of environment variables\u003c/div\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"yaml\"\u003e\u003cspan class=\"na\"\u003eversion\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"s\"\u003e1alpha3\u0026#34;\u003c/span\u003e\n\u003cspan class=\"na\"\u003ename\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003emy-rule-set\u003c/span\u003e\n\u003cspan class=\"na\"\u003erules\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n\u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eid\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003erule:1\u003c/span\u003e\n  \u003cspan class=\"na\"\u003ematch\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"na\"\u003eurl\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ehttps://my-service1.local/\u0026lt;**\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eforward_to\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"na\"\u003ehost\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e${UPSTREAM_HOST:=\u0026#34;default-backend:8080\u0026#34;}\u003c/span\u003e\n  \u003cspan class=\"na\"\u003emethods\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"pi\"\u003e[\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"s\"\u003eGET\u0026#34;\u003c/span\u003e \u003cspan class=\"pi\"\u003e]\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eexecute\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eauthorizer\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003efoobar\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_examples\"\u003eExamples\u003c/h3\u003e\n\u003cdiv class=\"exampleblock\"\u003e\n\u003cdiv class=\"title\"\u003eExample 2. Load rule sets from the files residing in the  \u003ccode\u003e/path/to/rules/dir\u003c/code\u003e directory and watch for changes.\u003c/div\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"yaml\"\u003e\u003cspan class=\"na\"\u003efile_system\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"na\"\u003esrc\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e/path/to/rules/dir\u003c/span\u003e\n  \u003cspan class=\"na\"\u003ewatch\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"exampleblock\"\u003e\n\u003cdiv class=\"title\"\u003eExample 3. Load rule sets from the \u003ccode\u003e/path/to/rules.yaml\u003c/code\u003e file without watching it for changes.\u003c/div\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"yaml\"\u003e\u003cspan class=\"na\"\u003efile_system\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"na\"\u003esrc\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e/path/to/rules.yaml\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_http_endpoint\"\u003eHTTP Endpoint\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThis provider allows loading of \u003ca href=\"/docs/rules/rule_sets/#_regular_rule_set\"\u003eregular rule sets\u003c/a\u003e in JSON or YAML format from any remote endpoint accessible via HTTP(s). The format selection happens based on the \u003ccode\u003eContent-Type\u003c/code\u003e set in the response from the endpoint, which must be either \u003ccode\u003eapplication/yaml\u003c/code\u003e or \u003ccode\u003eapplication/json\u003c/code\u003e, otherwise an error is logged and the response from the endpoint is ignored.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe loading and removal of rules happens as follows:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eif the response status code is an HTTP 200 OK and contains a rule sets in a known format (see above), the corresponding rules are loaded (if the definitions are valid)\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003ein case of network issues, like dns errors, timeouts and alike, the rule sets previously received from the corresponding endpoints are preserved.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003ein any other case related to network communication (e.g. not 200 status code, empty response body, unsupported format, etc.), the corresponding rules are removed if previously loaded.\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_configuration_2\"\u003eConfiguration\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe configuration of this provider goes into the \u003ccode\u003ehttp_endpoint\u003c/code\u003e property. In contrast to the \u003ca href=\"#_filesystem\"\u003eFilesystem\u003c/a\u003e provider, it can be configured with as many endpoints to load rule sets from as required for the particular use case.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eFollowing configuration options are supported:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003ewatch_interval\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003e\u003ca href=\"/docs/configuration/types/#_duration\"\u003eDuration\u003c/a\u003e\u003c/em\u003e (optional)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eWhether the configured \u003ccode\u003eendpoints\u003c/code\u003e should be polled for updates. Defaults to \u003ccode\u003e0s\u003c/code\u003e (polling disabled).\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003eendpoints\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003eRuleSetEndpoint array\u003c/em\u003e (mandatory)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eEach entry of that array supports all the properties defined by \u003ca href=\"/docs/configuration/types/#_endpoint\"\u003eEndpoint\u003c/a\u003e, except \u003ccode\u003emethod\u003c/code\u003e, which is always \u003ccode\u003eGET\u003c/code\u003e. As with the \u003ca href=\"/docs/configuration/types/#_endpoint\"\u003eEndpoint\u003c/a\u003e type, at least the \u003ccode\u003eurl\u003c/code\u003e must be configured. Following properties are defined in addition:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003erule_path_match_prefix\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003estring\u003c/em\u003e (optional)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThis property can be used to create kind of a namespace for the rule sets retrieved from the different endpoints. If set, the provider checks whether the urls specified in all rules retrieved from the referenced endpoint have the defined path prefix. If not, a warning is emitted and the rule set is ignored. This can be used to ensure a rule retrieved from one endpoint does not collide with a rule from another endpoint.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"admonitionblock note\"\u003e\n\u003ctable\u003e\n\u003ctbody\u003e\u003ctr\u003e\n\u003ctd class=\"icon\"\u003e\n\u003ci class=\"fa icon-note\" title=\"Note\"\u003e\u003c/i\u003e\n\u003c/td\u003e\n\u003ctd class=\"content\"\u003e\nHTTP caching according to \u003ca href=\"https://www.rfc-editor.org/rfc/rfc7234\"\u003eRFC 7234\u003c/a\u003e is enabled by default. It can be disabled by setting \u003ccode\u003ehttp_cache.enabled\u003c/code\u003e to \u003ccode\u003efalse\u003c/code\u003e.\n\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_examples_2\"\u003eExamples\u003c/h3\u003e\n\u003cdiv class=\"exampleblock\"\u003e\n\u003cdiv class=\"title\"\u003eExample 4. Minimal possible configuration\u003c/div\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eHere the provider is configured to load a rule set from one endpoint without polling it for changes.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"yaml\"\u003e\u003cspan class=\"na\"\u003ehttp_endpoint\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eendpoints\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eurl\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ehttp://foo.bar/ruleset1\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"exampleblock\"\u003e\n\u003cdiv class=\"title\"\u003eExample 5. Load rule sets from remote endpoints and watch for changes.\u003c/div\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eHere, the provider is configured to poll the two defined rule set endpoints for changes every 5 minutes.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe configuration for the first endpoint instructs heimdall to ensure all urls defined in the rules coming from that endpoint must match the defined path prefix.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe configuration for the second endpoint defines the \u003ccode\u003erule_path_match_prefix\u003c/code\u003e as well. It also defines a couple of other properties. One to ensure the communication to that endpoint is more resilient by setting the \u003ccode\u003eretry\u003c/code\u003e options and since this endpoint is protected by an API key, it defines the corresponding options as well.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"yaml\"\u003e\u003cspan class=\"na\"\u003ehttp_endpoint\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"na\"\u003ewatch_interval\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e5m\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eendpoints\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eurl\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ehttp://foo.bar/ruleset1\u003c/span\u003e\n      \u003cspan class=\"na\"\u003erule_path_match_prefix\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e/foo/bar\u003c/span\u003e\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eurl\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ehttp://foo.bar/ruleset2\u003c/span\u003e\n      \u003cspan class=\"na\"\u003erule_path_match_prefix\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e/bar/foo\u003c/span\u003e\n      \u003cspan class=\"na\"\u003eretry\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"na\"\u003egive_up_after\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e5s\u003c/span\u003e\n        \u003cspan class=\"na\"\u003emax_delay\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e250ms\u003c/span\u003e\n      \u003cspan class=\"na\"\u003eauth\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"na\"\u003etype\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eapi_key\u003c/span\u003e\n        \u003cspan class=\"na\"\u003econfig\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n          \u003cspan class=\"na\"\u003ename\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eX-Api-Key\u003c/span\u003e\n          \u003cspan class=\"na\"\u003evalue\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003esuper-secret\u003c/span\u003e\n          \u003cspan class=\"na\"\u003ein\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eheader\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_cloud_blob\"\u003eCloud Blob\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThis provider allows loading of \u003ca href=\"/docs/rules/rule_sets/#_regular_rule_set\"\u003eregular rule sets\u003c/a\u003e from cloud blobs, like AWS S3 buckets, Google Cloud Storage, Azure Blobs, or other API compatible implementations and supports rule sets in YAML, as well as in JSON format. The format selection happens based on the \u003ccode\u003eContent-Type\u003c/code\u003e set in the metadata of the loaded blob, which must be either \u003ccode\u003eapplication/yaml\u003c/code\u003e or \u003ccode\u003eapplication/json\u003c/code\u003e, otherwise an error is logged and the blob is ignored.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe loading and removal of rules happens as follows:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eif the response status code is an HTTP 200 OK and contains a rule set in a known format (see above), the corresponding rules are loaded (if the definitions are valid)\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003ein case of network issues, like dns errors, timeouts and alike, the rule sets previously received from the corresponding buckets are preserved.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003ein any other case like, not 200 status code, empty response body, unsupported format, etc, the corresponding rules are removed if previously loaded.\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_configuration_3\"\u003eConfiguration\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe configuration of this provider goes into the \u003ccode\u003ecloud_blob\u003c/code\u003e property. As with \u003ca href=\"#_http_endpoint\"\u003eHTTP Endpoint\u003c/a\u003e provider, it can be configured with as many buckets/blobs to load rule sets from as required for the particular use case.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eFollowing configuration options are supported:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003ewatch_interval\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003e\u003ca href=\"/docs/configuration/types/#_duration\"\u003eDuration\u003c/a\u003e\u003c/em\u003e (optional)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eWhether the configured \u003ccode\u003ebuckets\u003c/code\u003e should be polled for updates. Defaults to \u003ccode\u003e0s\u003c/code\u003e (polling disabled).\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003ebuckets\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003eBlobReference array\u003c/em\u003e (mandatory)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eEach \u003cem\u003eBlobReference\u003c/em\u003e entry in that array supports the following properties:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003eurl\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003estring\u003c/em\u003e (mandatory)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe actual url to the bucket or to a specific blob in the bucket.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003eprefix\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003estring\u003c/em\u003e (optional)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eIndicates that only blobs with a key starting with this prefix should be retrieved\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003erule_path_match_prefix\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003estring\u003c/em\u003e (optional)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eCreates kind of a namespace for the rule sets retrieved from the blobs. If set, the provider checks whether the urls patterns specified in all rules retrieved from the referenced bucket have the defined path prefix. If that rule is violated, a warning is emitted and the rule set is ignored. This can be used to ensure a rule retrieved from one endpoint does not override a rule from another endpoint.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe differentiation which storage is used is based on the URL scheme. These are:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003es3\u003c/code\u003e for \u003ca href=\"https://aws.amazon.com/s3/\"\u003eAWS S3\u003c/a\u003e buckets\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003egs\u003c/code\u003e for \u003ca href=\"https://cloud.google.com/storage/\"\u003eGoogle Cloud Storage\u003c/a\u003e and\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003eazblob\u003c/code\u003e for \u003ca href=\"https://azure.microsoft.com/en-us/services/storage/blobs/\"\u003eAzure Blob Storage\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eOther API compatible storage services, like \u003ca href=\"https://www.minio.io/\"\u003eMinio\u003c/a\u003e, \u003ca href=\"https://ceph.com/\"\u003eCeph\u003c/a\u003e, \u003ca href=\"https://github.com/chrislusf/seaweedfs\"\u003eSeaweedFS\u003c/a\u003e, etc. can be used as well. The corresponding and other options can be found in the \u003ca href=\"https://gocloud.dev/howto/blob/\"\u003eGo CDK Blob\u003c/a\u003e documentation, the implementation of this provider is based on.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"admonitionblock note\"\u003e\n\u003ctable\u003e\n\u003ctbody\u003e\u003ctr\u003e\n\u003ctd class=\"icon\"\u003e\n\u003ci class=\"fa icon-note\" title=\"Note\"\u003e\u003c/i\u003e\n\u003c/td\u003e\n\u003ctd class=\"content\"\u003e\nThe communication to the storage services requires an active session to the corresponding cloud provider. The session information is taken from the vendor specific environment variables, respectively configuration. See \u003ca href=\"https://docs.aws.amazon.com/sdk-for-go/api/aws/session/\"\u003eAWS Session\u003c/a\u003e, \u003ca href=\"https://cloud.google.com/docs/authentication/application-default-credentials\"\u003eGC Application Default Credentials\u003c/a\u003e and \u003ca href=\"https://learn.microsoft.com/en-us/azure/storage/common/authorize-data-access?toc=%2Fazure%2Fstorage%2Fblobs%2Ftoc.json\"\u003eAzure Storage Access\u003c/a\u003e for more information.\n\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_examples_3\"\u003eExamples\u003c/h3\u003e\n\u003cdiv class=\"exampleblock\"\u003e\n\u003cdiv class=\"title\"\u003eExample 6. Minimal possible configuration\u003c/div\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eHere the provider is configured to load rule sets from all blobs stored on the Google Cloud Storage bucket named \u0026#34;my-bucket\u0026#34; without polling for changes.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"yaml\"\u003e\u003cspan class=\"na\"\u003ecloud_blob\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"na\"\u003ebuckets\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eurl\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003egs://my-bucket\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"exampleblock\"\u003e\n\u003cdiv class=\"title\"\u003eExample 7. Load rule sets from AWS S3 buckets and watch for changes.\u003c/div\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"yaml\"\u003e\u003cspan class=\"na\"\u003ecloud_blob\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"na\"\u003ewatch_interval\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e2m\u003c/span\u003e\n  \u003cspan class=\"na\"\u003ebuckets\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eurl\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003egs://my-bucket\u003c/span\u003e\n      \u003cspan class=\"na\"\u003eprefix\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eservice1\u003c/span\u003e\n      \u003cspan class=\"na\"\u003erule_path_match_prefix\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e/service1\u003c/span\u003e\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eurl\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003egs://my-bucket\u003c/span\u003e\n      \u003cspan class=\"na\"\u003eprefix\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eservice2\u003c/span\u003e\n      \u003cspan class=\"na\"\u003erule_path_match_prefix\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e/service2\u003c/span\u003e\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eurl\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003es3://my-bucket/my-rule-set?region=us-west-1\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eHere, the provider is configured to poll multiple buckets with rule sets for changes every 2 minutes.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe first two bucket reference configurations reference actually the same bucket on Google Cloud Storage, but different blobs based on the configured blob prefix. The first one will let heimdall loading only those blobs, which start with \u003ccode\u003eservice1\u003c/code\u003e, the second only those, which start with \u003ccode\u003eservice2\u003c/code\u003e.\nAs \u003ccode\u003erule_path_match_prefix\u003c/code\u003e are defined for both as well, heimdall will ensure, that rule sets loaded from the corresponding blobs will not overlap in their url matching definitions.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe last one instructs heimdall to load rule set from a specific blob, namely a blob named \u003ccode\u003emy-rule-set\u003c/code\u003e, which resides on the \u003ccode\u003emy-bucket\u003c/code\u003e AWS S3 bucket, which is located in the \u003ccode\u003eus-west-1\u003c/code\u003e AWS region.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_kubernetes\"\u003eKubernetes\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThis provider is only supported if heimdall is running within Kubernetes and allows usage (validation and loading) of \u003ca href=\"/docs/rules/rule_sets/#_kubernetes_rule_set\"\u003e\u003ccode\u003eRuleSet\u003c/code\u003e custom resources\u003c/a\u003e deployed to the same Kubernetes environment.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_configuration_4\"\u003eConfiguration\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe configuration of this provider goes into the \u003ccode\u003ekubernetes\u003c/code\u003e property and supports the following configuration options:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003eauth_class\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003estring\u003c/em\u003e (optional)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eBy making use of this property, you can specify which rule sets should be used by this particular heimdall instance. If specified, heimdall will consider the value of the \u003ccode\u003eauthClassName\u003c/code\u003e attribute of each \u003ccode\u003eRuleSet\u003c/code\u003e resource deployed to the cluster and validate, respectively load only those rules, which \u003ccode\u003eauthClassName\u003c/code\u003e values matching the value of \u003ccode\u003eauth_class\u003c/code\u003e. If not set all \u003ccode\u003eRuleSet\u003c/code\u003e resources will be used.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003etls\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003e\u003ca href=\"/docs/configuration/types/#_tls\"\u003eTLS\u003c/a\u003e\u003c/em\u003e (optional)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eIf configured, heimdall will start and expose a validating admission controller service on port \u003ccode\u003e4458\u003c/code\u003e listening on all interfaces. This service allows integration with the Kubernetes API server enabling validation of the applied \u003ccode\u003eRuleSet\u003c/code\u003e resources before these are made available to heimdall for loading. This way you will get a direct feedback about issues without the need to look into heimdall logs if a \u003ccode\u003eRuleSet\u003c/code\u003e resource could not be loaded (See also \u003ca href=\"/openapi/#tag/Validating-Admission-Controller\"\u003eAPI\u003c/a\u003e documentation for more details).\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eTo let the Kubernetes API server use the admission controller, there is a need for a properly configured \u003ca href=\"https://kubernetes.io/docs/reference/access-authn-authz/extensible-admission-controllers/#deploy-the-admission-webhook-service\"\u003e\u003ccode\u003eValidatingWebhookConfiguration\u003c/code\u003e\u003c/a\u003e. The \u003ca href=\"https://github.com/dadrus/heimdall/tree/main/charts/heimdall\"\u003eHelm Chart\u003c/a\u003e shipped with heimdall does this automatically as soon as this property is configured. It does however need a \u003ccode\u003ecaBundle\u003c/code\u003e to be set or injected. Otherwise, the Kubernetes API server won’t trust the configured TLS certificate and won’t use the endpoint.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"admonitionblock caution\"\u003e\n\u003ctable\u003e\n\u003ctbody\u003e\u003ctr\u003e\n\u003ctd class=\"icon\"\u003e\n\u003ci class=\"fa icon-caution\" title=\"Caution\"\u003e\u003c/i\u003e\n\u003c/td\u003e\n\u003ctd class=\"content\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eSince multiple heimdall deployments with different configured \u003ccode\u003eauth_class\u003c/code\u003e names can coexist, \u003ccode\u003eRuleSet\u003c/code\u003e resources with mismatching \u003ccode\u003eauthClassName\u003c/code\u003e will be ignored by a particular deployment. In addition, Kubernetes API server validation requests for mismatching rule sets result in a successful response. This behavior is required as otherwise, as soon as the API server receives even a single failed validation response, the affected \u003ccode\u003eRuleSet\u003c/code\u003e resource will be discarded and not made available for loading to any of the available heimdall deployments.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThat also means, if there is no heimdall deployment feeling responsible for the given \u003ccode\u003eRuleSet\u003c/code\u003e resource (due to \u003ccode\u003eauthClassName\u003c/code\u003e - \u003ccode\u003eauth_class\u003c/code\u003e mismatch), the affected \u003ccode\u003eRuleSet\u003c/code\u003e resource will be silently ignored.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_examples_4\"\u003eExamples\u003c/h3\u003e\n\u003cdiv class=\"exampleblock\"\u003e\n\u003cdiv class=\"title\"\u003eExample 8. Minimal possible configuration\u003c/div\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eHere, the provider is just enabled. Since no \u003ccode\u003eauth_class\u003c/code\u003e is configured, it will load all \u003ccode\u003eRuleSet\u003c/code\u003e  resources deployed to the Kubernetes environment.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"yaml\"\u003e\u003cspan class=\"na\"\u003ekubernetes\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"pi\"\u003e{}\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"exampleblock\"\u003e\n\u003cdiv class=\"title\"\u003eExample 9. Configuration with \u003ccode\u003eauth_class\u003c/code\u003e set\u003c/div\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eHere, the provider is configured to consider only those \u003ccode\u003eRuleSet\u003c/code\u003e resources, which \u003ccode\u003eauthClassName\u003c/code\u003e is set to \u003ccode\u003efoo\u003c/code\u003e.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"yaml\"\u003e\u003cspan class=\"na\"\u003ekubernetes\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eauth_class\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003efoo\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"exampleblock\"\u003e\n\u003cdiv class=\"title\"\u003eExample 10. Configuration with \u003ccode\u003eauth_class\u003c/code\u003e set and enabled validating admission controller\u003c/div\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eAs with the previous example, the provider is configured to consider only those \u003ccode\u003eRuleSet\u003c/code\u003e resources, which \u003ccode\u003eauthClassName\u003c/code\u003e is set to \u003ccode\u003efoo\u003c/code\u003e. The admission controller is enabled as well and will validate \u003ccode\u003eRuleSet\u003c/code\u003e resources before these are made available for loading.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"yaml\"\u003e\u003cspan class=\"na\"\u003ekubernetes\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eauth_class\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003efoo\u003c/span\u003e\n  \u003cspan class=\"na\"\u003etls\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e# below is the minimal required configuration\u003c/span\u003e\n    \u003cspan class=\"na\"\u003ekey_store\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"na\"\u003epath\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e/path/to/file.pem\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"admonitionblock note\"\u003e\n\u003ctable\u003e\n\u003ctbody\u003e\u003ctr\u003e\n\u003ctd class=\"icon\"\u003e\n\u003ci class=\"fa icon-note\" title=\"Note\"\u003e\u003c/i\u003e\n\u003c/td\u003e\n\u003ctd class=\"content\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThis provider requires a RuleSet CRD being deployed, otherwise heimdall will not be able to monitor corresponding resources and emit error messages to the log.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eIf you have used the \u003ca href=\"/docs/getting_started/installation/#_helm_chart\"\u003eHelm Chart\u003c/a\u003e to install heimdall, this CRD is already installed. You can however install it also like this:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"bash\"\u003e\u003cspan class=\"nv\"\u003e$ \u003c/span\u003ekubectl apply \u003cspan class=\"nt\"\u003e-f\u003c/span\u003e https://raw.githubusercontent.com/dadrus/heimdall/main/charts/heimdall/crds/ruleset.yaml\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n","sections":["Rules"],"tags":null,"title":"Rule Providers","url":"/docs/rules/providers/"},{"categories":null,"content":" Assertions This type enables configuration of required token and claim assertions. Depending on the object type (JWT or introspection response), the assertions apply to different parts of such objects.\nscopes: Scopes Matcher (optional)\nRequired scopes given to the client.\naudience: string array (optional)\nValues to be matched in the aud claim. This assertion evaluates to true if at least one entry in the given audience array is present in the aud claim. Both cases, either as whitespace separated string, or a JSON array are considered.\nissuers: string array (optional)\nIssuers to trust.\nallowed_algorithms: string array (optional)\nAlgorithms, which are trusted (according to RFC 7518). Defaults to the following list: ES256, ES384, ES512, PS256, PS384, PS512.\nvalidity_leeway Duration (optional)\nThe time leeway to consider while verifying the iat, exp and the nbf. Defaults to 10 seconds.\nExample 1. Assertions configuration issuers: - foo - bar audience: - zap scopes: - baz allowed_algorithms: - ES512 validity_leeway: 5s Here we say, the token must have been issued either by the issuer foo, or the issuer bar, the aud claim must contain zap, the scope claim (either scp or scope) must be present and contain the scope baz, if the token or the introspection response is signed, it must have been signed by using the ES512 algorithm (ECDSA using P-521 and SHA-512) and if the information about token validity is present, we respect a deviation of 5 seconds.\nAuthentication Data Source An authentication data source is actually a list of possible strategies for subject authentication data retrieval. The entries following the first one are fallbacks and are only executed if the previous strategy could not retrieve the required authentication data from the request.\nThis fallback mechanism can become handy, if different clients of your application send the authentication data using different methods. RFC 6750 describes for example how to use bearer tokens in HTTP requests to access OAuth 2.0 protected resources. This RFC says, a token can either be sent in the Authorization header, or in a query parameter, or even as part of the HTTP body. So you can define the following list to let Heimdall try to extract the access token from all three places:\n- header: Authorization scheme: Bearer - query_parameter: access_token - body_parameter: access_token The available strategies are described in the following sections.\nCookie Strategy This strategy can retrieve authentication data from a specific HTTP cookie. Following properties are supported:\ncookie: string (mandatory)\nThe name of the cookie to use.\nExample 2. Cookie Strategy usage Imagine you want Heimdall to verify an authentication session, which is represented by a specific cookie before the request hits your upstream service. If the client of your upstream application, which is case of a cookie would usually be a browser sends a cookie named \u0026#34;session\u0026#34;, you can inform Heimdall to extract and use it by configuring this strategy as follows:\n- cookie: my_session_cookie Header Strategy This strategy can retrieve authentication data from a specific HTTP header. Following properties are supported:\nheader: string (mandatory)\nThe name of the header to use.\nscheme: string (optional)\nScheme, which should be present in the header value. If specified, but not present in the header value, the authentication data cannot be retrieved, effectively making the affected authenticator feel not responsible for the request.\nExample 3. Header Strategy usage Imagine you want Heimdall to verify an access token used to protect your upstream service. If the client of your upstream application sends the access token in the HTTP Authorization header, you can inform Heimdall to extract it from there by configuring this strategy as follows:\n- header: Authorization scheme: Bearer Query Parameter Strategy query_parameter: string (mandatory)\nThe name of the query parameter to use.\nExample 4. Query Parameter Strategy usage Imagine you want Heimdall to verify an access token used to protect your upstream service. If the client of your upstream application sends the access token in the query parameter named \u0026#34;access_token\u0026#34;, you can inform Heimdall to extract it from there by configuring this strategy as follows:\n- query_parameter: access_token Body Parameter Strategy The usage of this strategy is only possible when the request payload is either JSON or application/x-www-form-urlencoded encoded. The Content-Type of the request must also either be set to application/x-www-form-urlencoded or to a MIME type, which contains json.\nbody_parameter: string (mandatory)\nThe name of the body parameter to use.\nExample 5. Body Parameter Strategy usage Imagine you want Heimdall to verify an access token used to protect your upstream service. If the client of your upstream application sends the access token in the body parameter named \u0026#34;access_token\u0026#34;, you can inform Heimdall to extract it from there by configuring this strategy as follows:\n- body_parameter: access_token Authentication Data Forward Strategy Authentication data strategy defines the way how heimdall should forward the authentication data extracted from the request to the used identity management system.\nAn Authentication Data Forward Strategy configuration entry must contain the following two properties:\ntype - The type of the strategy. Available types are described in the following sections.\nconfig - The strategy specific configuration.\nBody Forward Strategy This strategy can be used to embed the extracted authentication data into a body parameter of the request to the identity management system.\ntype must be set to body. config supports the following properties:\nname: string (mandatory)\nThe name of the property for the authentication data.\nExample 6. Body strategy configuration The following snippet shows how to configure this strategy to send e.g. a token in a property named \u0026#34;idToken\u0026#34;.\ntype: body config: name: idToken Depending on the configured \u0026#34;Content-Type\u0026#34; header for the request (see Endpoint headers) the result might look like\nidToken=\u0026lt;whatever the token value is\u0026gt; if the \u0026#34;Content-Type\u0026#34; header was set to application/x-www-form-urlencoded, or\n{ \u0026#34;idToken\u0026#34;: \u0026#34;\u0026lt;whatever the token value is\u0026gt;\u0026#34; } otherwise\nCookie Forward Strategy This strategy can be used to embed the extracted authentication data into a cookie of the request to the identity management system.\ntype must be set to cookie. config supports the following properties:\nname: string (mandatory)\nThe name of the cookie for the authentication data.\nExample 7. Cookie strategy configuration The following snippet shows how to configure this strategy to send e.g. a token in a cookie named \u0026#34;it_token\u0026#34;.\ntype: cookie config: name: it_token Header Forward Strategy This strategy can be used to embed the extracted authentication data into a header of the request to the identity management system.\ntype must be set to header. config supports the following properties:\nname: string (mandatory)\nThe name of the header for the authentication data.\nscheme: string (optional)\nThe scheme for the header added in front of the authentication data value.\nExample 8. Header strategy configuration The following snippet shows how to configure this strategy to send e.g. a token in a header named \u0026#34;X-ID-Token\u0026#34; with scheme \u0026#34;Bearer\u0026#34;.\ntype: header config: name: X-ID-Token scheme: Bearer Query Forward Strategy This strategy can be used to embed the extracted authentication data into a query parameter of the request to the identity management system.\nUsing this strategy is discouraged, as it will expose the authentication data to access logs, metrics and tracing. type must be set to query. config supports the following properties:\nname: string (mandatory)\nThe name of the query parameter for the authentication data.\nExample 9. Query strategy configuration The following snippet shows how to configure this strategy to send e.g. a token in a query named \u0026#34;token\u0026#34;.\ntype: query config: name: token Authentication Strategy Authentication strategy is kind of abstract type, so you have to define which specific type to use. Each type has its own configuration options.\nAn AuthStrategy configuration entry must contain the following two properties:\ntype - The type of the strategy. Available types are described in the following sections.\nconfig - The strategy specific configuration.\nAvailable strategies are described in the following sections.\nAPI Key Strategy This strategy can be used if your endpoint expects a specific api key be sent in a header, a cookie or query.\ntype must be set to api_key. config supports the following properties:\nin: string (mandatory)\nWhere to put the api key. Can be either header, cookie, or query.\nUsing query strategy will expose the api key to access logs and tracing. name: string (mandatory)\nThe name of either the header or the cookie.\nvalue: string (mandatory)\nThe value of the api key.\nExample 10. API Key Strategy configuration The following snippet shows how to configure this strategy to send an api key in the X-My-API-Key HTTP header.\ntype: api_key config: in: header name: X-My-API-Key value: super-duper-secret-key Basic Auth Strategy This strategy can be used if your endpoint is protected by HTTP basic authentication and expects the HTTP Authorization header with required values.\ntype must be set to basic_auth. config supports the following properties:\nuser: string (mandatory)\nThe user-id.\npassword: string (mandatory)\nThe password.\nExample 11. Basic Auth Strategy configuration The following snippet shows how to configure this strategy with user set to \u0026#34;Alladin\u0026#34; and password set to \u0026#34;open sesame\u0026#34;\ntype: basic_auth config: user: Alladin password: open sesame OAuth2 Client Credentials Grant Flow Strategy This strategy implements the OAuth2 Client Credentials Grant Flow to obtain an access token expected by the endpoint. Heimdall caches the received access token.\ntype must be set to oauth2_client_credentials. config supports the following properties:\ntoken_url: string (mandatory)\nThe token endpoint of the authorization server.\nclient_id: string (mandatory)\nThe client identifier for heimdall.\nclient_secret: string (mandatory)\nThe client secret for heimdall.\nauth_method: string (optional)\nThe authentication method to be used according to RFC 6749, Client Password. Can be one of\nbasic_auth (default if auth_method is not set): With that authentication method, the \u0026#34;application/x-www-form-urlencoded\u0026#34; encoded values of client_id and client_secret are sent to the authorization server via the Authorization header using the Basic scheme.\nrequest_body: With that authentication method the client_id and client_secret are sent in the request body together with the other parameters (e.g. scopes) defined by the flow.\nUsage of request_body authentication method is not recommended and should be avoided. scopes: string array (optional)\nThe scopes required for the access token.\ncache_ttl: Duration (optional)\nHow long to cache the token received from the token endpoint. Defaults to the token expiration information from the token endpoint (the value of the expires_in field) if present. If the token expiration inforation is not present and cache_ttl is not configured, the received token is not cached. If the token expiration information is present in the response and cache_ttl is configured the shorter value is taken. If caching is enabled, the token is cached until 5 seconds before its expiration. To disable caching, set it to 0s. The cache key calculation is based on the values of token_url, client_id, client_secret and the scopes properties.\nheader: object (optional, overridable)\nDefines the name and scheme to be used for the header. Defaults to Authorization with scheme Bearer. If defined, the name property must be set. If scheme is not defined, no scheme will be prepended to the resulting JWT.\nExample 12. Strategy configuration type: oauth2_client_credentials config: header: name: X-My-Token token_url: https://my-auth.provider/token client_id: foo client_secret: bar auth_method: basic_auth ttl: 10m scopes: - baz - zap Authorization Expression Authorization expressions define, as the name implies expressions for authorization purposes and have the following properties:\nexpression string (mandatory)\nThe expression to execute.\nmessage string (optional)\nThe message to include into the error if the expression fails.\nExample 13. Example expression using CEL The expression below determine whether attributes property of a subject object (also shown below) has at least one key that starts with the group prefix, and ensure that all group-like keys have list values containing only strings that end with @acme.co.\nsubject id: \u0026#34;foobar\u0026#34; attributes: group1: [\u0026#34;admin@acme.co\u0026#34;, \u0026#34;analyst@acme.co\u0026#34;] labels: [\u0026#34;metadata\u0026#34;, \u0026#34;prod\u0026#34;, \u0026#34;pii\u0026#34;] groupN: [\u0026#34;forever@acme.co\u0026#34;] expression: | subject.attributes.exists(c, c.startsWith(\u0026#39;group\u0026#39;)) \u0026amp;\u0026amp; subject.attributes .filter(c, c.startsWith(\u0026#39;group\u0026#39;)) .all(c, subject.attributes[c] .all(g, g.endsWith(\u0026#39;@acme.co\u0026#39;))) message: No groups ending with @acme.co present ByteSize ByteSize is actually a string type, which adheres to the following pattern: ^[0-9]+(B|KB|MB)$\nSo with 10B you can define the byte size of 10 bytes and with 2MB you can say 2 megabytes.\nCORS CORS (Cross-Origin Resource Sharing) headers can be added and configured by making use of this type. This functionality allows for advanced security features to quickly be set. If CORS headers are set, then heimdall does not pass preflight requests to its decision pipeline, instead the response will be generated and sent back to the client directly. Following properties are supported:\nallowed_origins: string array (optional)\nList of origins that may access the resource. Defaults to all, if not set, but any of the other CORS options are configured.\nallowed_methods: string array (optional)\nList of methods allowed when accessing the resource. This is used in response to a preflight request. Defaults to GET, POST, HEAD, PUT, DELETE and PATCH if not set, but any of the other CORS options are configured.\nallowed_headers: string array (optional)\nList of request headers that can be used when making the actual request.\nexposed_headers: string array (optional)\n\u0026#34;Allow-List\u0026#34; of headers that clients are allowed to access.\nallow_credentials: boolean (optional)\nIndicates whether the response to the request can be exposed when the credentials flag is true. When used as part of a response to a preflight request, this indicates whether the actual request can be made using credentials. Defaults to false if not set, but any of the other CORS options are configured.\nmax_age: Duration (optional)\nIndicates how long the results of a preflight request can be cached. Defaults to 0 seconds if not set, but any of the other CORS options are configured.\nExample 14. Possible configuration allowed_origins: - example.org allowed_methods: - HEAD - PATCH allow_credentials: true max_age: 10s Duration Duration is actually a string type, which adheres to the following pattern: ^[0-9]+(ns|us|ms|s|m|h)$\nSo with 10s you can define the duration of 10 seconds and with 2h you can say 2 hours.\nEndpoint The Endpoint type defines properties required for the communication with an endpoint.\nIf only the URL is required to be set, you can specify it by using just a string. If more than the URL is required to be specified, following properties are available:\nurl string (mandatory)\nThe actual url of the endpoint. Depending on the mechanism, a URL can be templated\nIf templating is used, user info, scheme and host parts of the URL cannot be templated. Attempts to do so will result in runtime errors. method string (optional)\nThe HTTP method to use while communicating with the endpoint. If not set POST is used.\nretry Retry (optional)\nWhat to do if the communication fails. If not configured, no retry attempts are done.\nauth Authentication Strategy (optional)\nAuthentication strategy to apply, if the endpoint requires authentication.\nheaders map of strings (optional)\nHTTP headers to be sent to the endpoint.\nThese headers are not analyzed by heimdall and are just forwarded to the endpoint. E.g. if you configure the Content-Encoding to something like gzip, the service behind the used endpoint might fail to answer, as it would expect the body to be compressed. http_cache object (optional)\nControls whether HTTP caching according to RFC 7234 should be used. To support this, that object defines the following properties:\nenabled boolean (optional)\nDefaults to false if not otherwise stated in the description of the configuration type, making use of the endpoint property. If set to true heimdall will strictly follow the requirements from RFC 7234 and cache the responses if possible and reuse these if still valid.\ncache_ttl Duration (optional)\nSpecifies how long heimdall should cache the response if the endpoint referenced by the URL does not provide any explicit expiration time (no heuristic freshness lifetime is calculated). Without configuring this property, heimdall treats such responses as not cacheable. Defaults to 0s if not otherwise stated in the description of the configuration type making use of the endpoint property.\nExample 15. Endpoint configuration as string http://foo.bar Example 16. Structured Endpoint configuration url: http://foo.bar method: GET retry: give_up_after: 5s max_delay: 1s auth: type: api_key config: name: foo value: bar in: cookie headers: X-My-First-Header: foobar X-My-Second-Header: barfoo enable_http_cache: true Error/State Type Heimdall defines a couple of error/state types, which it uses to signal errors. Those, which are marked with (*) are available in CEL expressions. All can be used to define overrides for the HTTP response codes.\nFollowing types are available:\naccepted - this is the only state type in this list and is used to signal, the matched decision pipeline has been executed successfully, so the request can be forwarded to the upstream service. The response of that type results by default in a 200 OK response.\nauthentication_error (*) - used if an authenticator failed to verify authentication data available in the request. E.g. an authenticator was configured to verify a JWT and the signature of it was invalid. If none of the authenticators used in a pipeline were able to authenticate the user, and the default error handler was used to handle such error, it will by default result in a 401 Unauthorized response.\nauthorization_error (*) - used if an authorizer failed to authorize the subject. E.g. an authorizer is configured to use an expression on the given subject and request context, but that expression returned with an error. Error of this type results by default in 403 Forbidden response if the default error handler was used to handle such error.\ncommunication_error (*) - this error is used to signal a communication error while communicating to a remote system during the execution of the pipeline of the matched rule. Timeouts of DNSs errors result in such an error. Error of this type results by default in 502 Bad Gateway HTTP code if handled by the default error handler.\ninternal_error - used if heimdall run into an internal error condition while processing the request. E.g. something went wrong while unmarshalling a JSON object, or if there was a configuration error, which couldn’t be raised while loading a rule, etc. Results by default in 500 Internal Server Error response to the caller.\nmethod_error - this error is used to signal that a matched rule does not allow usage of the HTTP method used to submit the request. Error of this type results by default in 405 Method Not Allowed HTTP code.\nno_rule_error - this error is used to signal, there is no matching rule to handle the given request. Error of this type results by default in 404 Not Found HTTP code.\nprecondition_error (*) - used if the request does not contain required/expected data. E.g. if an authenticator could not find a cookie configured. Error of this type results by default in 400 Bad Request HTTP code if handled by the default error handler.\nKey Store This type configures a key store holding keys and corresponding certificate chains. PKCS#1, as well as PKCS#8 encodings are supported for private keys.\nWhile loading a key store following verifications are done:\nUniqueness of key ids and rejection of key stores which violate this condition (see also Key-Id Lookup)\nCorrelation of keys and certificates to build a valid certificate chain for every given key if certificates are present. If the correlation fails, an error is raised and heimdall will refuse to start.\nCertificate chain validation. If the chain is invalid, an error is raised and heimdall will refuse to start.\nFollowing configuration properties are available:\npath: string (mandatory)\nThe path to the PEM file with the cryptographic material. Watching for secrets rotation is supported.\npassword: string (optional)\nIf the key material is protected with a password, this property can be set to decipher it. Password protection is only supported for PKCS#8 encoded keys\nIf the key store contains multiple keys and these keys are password protected, same password must be used for all of these. Example 17. Example configuration path: /path/to/keystore.pem password: VeryInsecure! Respond This type enables instructing heimdall to preserve error information and provide it in the response body to the caller, as well as to use HTTP status codes deviating from those heimdall would usually use. The configuration, which can be done using this type affects only the behavior of the default error handler.\nFollowing properties are supported:\nverbose: boolean (optional)\nBy making use of this property you can instruct heimdall to preserve error information and provide it in the response body to the caller. Defaults to false.\nHeimdall supports MIME type negotiation. So, if the client sets the HTTP Accept header to e.g. application/json, and Heimdall run into an unhandled internal error condition, in addition to responding with 500 Internal Server Error, it will render an error message, like shown below, if verbose has been set to true.\n{ \u0026#34;code\u0026#34;: \u0026#34;internal error\u0026#34;, \u0026#34;message\u0026#34;: \u0026#34;whatever led to the error\u0026#34; } The message will however contain just high-level information, like \u0026#34;failed to parse something\u0026#34;, but will not contain any stack traces.\nwith: ResponseOverride set (optional)\nThis property enables mapping between response/error types used by heimdall and the corresponding HTTP status codes. Each entry must be from the list of the supported Error/State Types and contain exactly one property named code, which then defines the desired mapping.\nExample 18. Making error responses verbose and changing the HTTP codes for some errors verbose: true with: authentication_error: code: 404 authorization_error: code: 404 Retry Implements an exponential backoff strategy for endpoint communication. It increases the backoff exponentially by multiplying the max_delay with 2^(attempt count)\ngive_up_after: Duration (optional)\nSets an upper bound on the maximum time to wait between two requests. Default to 0, which means no upper bound.\nmax_delay: Duration (mandatory)\nThe initial backoff.\nExample 19. Retry configuration In this example the backoff will be 1, 2, 4, 8, 16, 32, 60, …​\ngive_up_after: 60s max_delay: 1s Scopes Matcher Scopes matcher is a configuration type allowing configuration of different strategies to match required scopes. In its simplest shape it can be just an array of strings (implemented by the Exact) scope matcher. To cover many use cases, different strategies are available and described in the following sections.\nRegardless of the strategy, each matcher can explicitly be configured and supports the following configuration properties:\nmatching_strategy - the type of the mathing strategy.\nvalues - the list of scope patterns\nExact This the simplest matcher and is automatically selected, if just an array of strings is configured as shown in the following snippet:\n- foo - bar However, as written in the Scopes Matcher section, it can also explicitly be selected by setting matching_strategy to exact and defining the required scopes in the values property.\nExample 20. Essentially same configurations matching_strategy: exact values: - foo - bar - foo - bar Hierarchic This matcher enables matching hierarchical scopes, which use . as separator. Imagine your system is organized that way, that it defines namespaces for different services like this:\nmy-service being the top namespace\nmy-service.booking - being the namespace of the booking service\nmy-service.orders - being the namespace of the orders service\nmy-service.orders.partners - being the namespace of the order service for partners and\nmy-service.orders.customers - being the namespace of the order service for customers\nBasically you’ve established an identity for each of your services (this is comparable to how SPIFFE IDs are organized and also used for).\nNow, imagine you use these namespaces as scope values to limit the usage of the issued tokens. In such situations the hierarchic scope matcher can become handy if you would like to assert any scope of the token must be in e.g. the my-service or the my-service.orders namespace.\nThis matcher can only be used by explicitly setting the matching_strategy to hierarchic and defining the required patterns in the values property.\nExample 21. Matching of hierarchic scopes matching_strategy: hierarchic values: - my-service This configuration will ensure all scopes withing the scope or scp claim are within the my-service namespace. So scope claim like\n{ \u0026#34;scope\u0026#34;: [\u0026#34;my-service.orders\u0026#34;, \u0026#34;my-service.orders.customers\u0026#34;] } would match, but\n{ \u0026#34;scope\u0026#34;: [\u0026#34;not-my-service\u0026#34;, \u0026#34;my-service.orders.customers\u0026#34;] } would not match.\nWildcard This matcher enables matching scopes using wildcards. It goes beyond the Hierarchic scope matcher by enabling usage of wildcards.\nThis matcher can only be used by explicitly setting the matching_strategy to wildcard and defining the required patterns in the values property.\nSubject This configuration type enables extraction of subject information from responses received by Heimdall from authentication services. Following properties are available.\nid: string (mandatory)\nA GJSON Path pointing to the id of the subject in the JSON object.\nattributes: string (optional)\nA GJSON Path pointing to the attributes of the subject in the JSON object. Defaults to @this.\nExample 22. Extracting subject id from an OAuth2 Introspection endpoint response. This example shows how to extract the subject id from an OAuth2 Introspection endpoint response and set the subject attributes to the entire response\nid: sub attributes: @this Setting attributes was actually not required, as @this would be set by default anyway.\nExample 23. Extracting subject id from an Ory Kratos \u0026#34;whoami\u0026#34; endpoint response This example shows how to extract the subject id from an Ory Kratos \u0026#34;whoami\u0026#34; endpoint response and set the subject attributes to the entire response. attributes is not configured, so default is used.\nid: identity.id Session Lifespan This configuration type enables the configuration of session lifespans, used for session validation for those authenticators, which act on non-standard protocols. Following properties are available.\nactive: string (optional)\nA GJSON Path pointing to the field describing the \u0026#34;active\u0026#34; status of the session in the corresponding JSON object. The actual value in that field should be convertable to a bool type. If not provided, or not found in the session object, the session is considered to be \u0026#34;active\u0026#34;. \u0026#34;active\u0026#34; means it can be used and represent a valid session between the authentication system and the subject, the session has been issued to.\nissued_at: string (optional)\nA GJSON Path pointing to the field in the corresponding JSON object, describing the time, when the session object has been issued. If not provided or not found, the issuance time is not considered during session validation.\nnot_before: string (optional)\nA GJSON Path pointing to the field in the corresponding JSON object describing the time, until which the session object is not allowed to be used. If not provided or not found, the corresponding time is not considered during session validation.\nnot_after: string (optional)\nA GJSON Path pointing to the field in the corresponding JSON object describing the time, after which the session object is not allowed to be used. If not provided or not found, the corresponding time is not considered during session validation.\ntime_format: string (optional)\nSince different authentication system use different representations for time strings, this property allows the definition of the time format/layout used by the authentication system. Defaults to Unix Epoch time stamp.\nYou can use the following Go Playground link to test your time format settings. validity_leeway: Duration (optional)\nEnables definition of an allowed time drift between the authentication system and heimdall for the validation of the session validity. Defaults to 0.\nExample 24. Making use of session information received from Ory’s Kratos A typical response from Kratos\u0026#39; whoami endpoint looks like follows (stripped to the most interesting parts):\n{ \u0026#34;id\u0026#34;: \u0026#34;1338410d-c473-4503-a96a-53efa06e2531\u0026#34;, \u0026#34;active\u0026#34;: true, \u0026#34;expires_at\u0026#34;: \u0026#34;2021-10-15T15:58:57.683338Z\u0026#34;, \u0026#34;authenticated_at\u0026#34;: \u0026#34;2021-10-14T15:58:57.683338Z\u0026#34;, \u0026#34;issued_at\u0026#34;: \u0026#34;2021-10-14T15:58:57.683338Z\u0026#34;, \u0026#34;identity\u0026#34;: { \u0026#34;id\u0026#34;: \u0026#34;9496bbd5-f426-473f-b087-c7df853f274a\u0026#34;, ... } } To enable usage of these properties in Heimdall, you can configure the Session Lifespan as follows:\nactive: active issued_at: issued_at not_before: authenticated_at not_after: expires_at time_format: \u0026#34;2006-01-02T15:04:05.999999Z07\u0026#34; validity_leeway: 10s Example 25. Making use of session information received from a compliant OAuth2 authorization service A typical response from a token introspection endpoint looks like follows:\n{ \u0026#34;active\u0026#34;: true, \u0026#34;client_id\u0026#34;: \u0026#34;l238j323ds-23ij4\u0026#34;, \u0026#34;username\u0026#34;: \u0026#34;jdoe\u0026#34;, \u0026#34;scope\u0026#34;: \u0026#34;read write dolphin\u0026#34;, \u0026#34;sub\u0026#34;: \u0026#34;Z5O3upPC88QrAjx00dis\u0026#34;, \u0026#34;aud\u0026#34;: \u0026#34;https://protected.example.net/resource\u0026#34;, \u0026#34;iss\u0026#34;: \u0026#34;https://server.example.com/\u0026#34;, \u0026#34;exp\u0026#34;: 1419356238, \u0026#34;iat\u0026#34;: 1419350238, \u0026#34;extension_field\u0026#34;: \u0026#34;twenty-seven\u0026#34; } To enable usage of these properties in Heimdall, you can configure the Session Lifespan as follows:\nactive: active issued_at: iat not_after: exp validity_leeway: 10s As you see, there is no need to define the time format as the times values appearing in the responses from an introspection endpoint are Unix Epoch time stamps.\nTLS Following are the supported TLS configuration properties:\nkey_store: Key Store (mandatory)\nThe key store containing the cryptographic material. At least one private key and the corresponding certificate must be present.\nkey_id: string (optional)\nIf the key_store contains multiple keys, this property can be used to specify the key to use (see also Key-Id Lookup). If not specified, the first key is used. If specified, but there is no key for the given key id present, an error is raised and heimdall will refuse to start.\nmin_version: string (optional)\nThe minimal TLS version to support. Can be either TLS1.2 or TLS1.3. Defaults to TLS1.3.\ncipher_suites: string array (optional)\nCan be configured if min_version is set to TLS1.2. If min_version is set to TLS1.3 the configured values are ignored. Only the following PFS cipher suites are supported:\nTLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA256\nTLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256\nTLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256\nTLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256\nTLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384\nTLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384\nTLS_ECDHE_RSA_WITH_CHACHA20_POLY1305_SHA256\nTLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305_SHA256\nDefaults to the last six cipher suites if min_version is set to TLS1.2 and cipher_suites is not configured.\nExample 26. Example configuration key_store: path: /path/to/keystore.pem password: VeryInsecure! key_id: foobar min_version: TLS1.2 cipher_suites: - TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384 - TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384 Key-Id Lookup When heimdall loads a key store, following algorithm is used to get the key id for the key:\nif the PEM entry with the private key has X-Key-ID header specified, this value is used as key id\nOtherwise, if an X.509 certificate is present for the private key, and it has the Subject Key Identifier extension set, the hex representation of it is used as key id.\nOtherwise, heimdall calculates the value for the Subject Key Identifier according to RFC 3280, Section 4.2.1.2 and uses hex representation of it as key id.\n","description":"","html_content":"\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_assertions\"\u003eAssertions\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThis type enables configuration of required token and claim assertions. Depending on the object type (JWT or introspection response), the assertions apply to different parts of such objects.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003escopes\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003e\u003ca href=\"#_scopes_matcher\"\u003eScopes Matcher\u003c/a\u003e\u003c/em\u003e (optional)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eRequired scopes given to the client.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003eaudience\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003estring array\u003c/em\u003e (optional)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eValues to be matched in the \u003ccode\u003eaud\u003c/code\u003e claim. This assertion evaluates to \u003ccode\u003etrue\u003c/code\u003e if at least one entry in the given \u003ccode\u003eaudience\u003c/code\u003e array is present in the \u003ccode\u003eaud\u003c/code\u003e claim. Both cases, either as whitespace separated string, or a JSON array are considered.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003eissuers\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003estring array\u003c/em\u003e (optional)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eIssuers to trust.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003eallowed_algorithms\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003estring array\u003c/em\u003e (optional)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eAlgorithms, which are trusted (according to \u003ca href=\"https://datatracker.ietf.org/doc/html/rfc7518\"\u003eRFC 7518\u003c/a\u003e). Defaults to the following list: ES256, ES384, ES512, PS256, PS384, PS512.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003evalidity_leeway\u003c/code\u003e\u003c/strong\u003e \u003cem\u003e\u003ca href=\"#_duration\"\u003eDuration\u003c/a\u003e\u003c/em\u003e (optional)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe time leeway to consider while verifying the \u003ccode\u003eiat\u003c/code\u003e, \u003ccode\u003eexp\u003c/code\u003e and the \u003ccode\u003enbf\u003c/code\u003e. Defaults to 10 seconds.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"exampleblock\"\u003e\n\u003cdiv class=\"title\"\u003eExample 1. Assertions configuration\u003c/div\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"yaml\"\u003e\u003cspan class=\"na\"\u003eissuers\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003efoo\u003c/span\u003e\n \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003ebar\u003c/span\u003e\n\u003cspan class=\"na\"\u003eaudience\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003ezap\u003c/span\u003e\n\u003cspan class=\"na\"\u003escopes\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003ebaz\u003c/span\u003e\n\u003cspan class=\"na\"\u003eallowed_algorithms\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003eES512\u003c/span\u003e\n\u003cspan class=\"na\"\u003evalidity_leeway\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e5s\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eHere we say, the token must have been issued either by the issuer \u003ccode\u003efoo\u003c/code\u003e, or the issuer \u003ccode\u003ebar\u003c/code\u003e, the \u003ccode\u003eaud\u003c/code\u003e claim must contain \u003ccode\u003ezap\u003c/code\u003e, the scope claim (either \u003ccode\u003escp\u003c/code\u003e or \u003ccode\u003escope\u003c/code\u003e) must be present and contain the scope \u003ccode\u003ebaz\u003c/code\u003e, if the token or the introspection response is signed, it must have been signed by using the \u003ccode\u003eES512\u003c/code\u003e algorithm (ECDSA using P-521 and SHA-512) and if the information about token validity is present, we respect a deviation of 5 seconds.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_authentication_data_source\"\u003eAuthentication Data Source\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eAn authentication data source is actually a list of possible strategies for subject authentication data retrieval. The entries following the first one are fallbacks and are only executed if the previous strategy could not retrieve the required authentication data from the request.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThis fallback mechanism can become handy, if different clients of your application send the authentication data using different methods. \u003ca href=\"https://datatracker.ietf.org/doc/html/rfc6750\"\u003eRFC 6750\u003c/a\u003e describes for example how to use bearer tokens in HTTP requests to access OAuth 2.0 protected resources. This RFC says, a token can either be sent in the \u003ccode\u003eAuthorization\u003c/code\u003e header, or in a query parameter, or even as part of the HTTP body. So you can define the following list to let Heimdall try to extract the access token from all three places:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"yaml\"\u003e\u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eheader\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eAuthorization\u003c/span\u003e\n  \u003cspan class=\"na\"\u003escheme\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eBearer\u003c/span\u003e\n\u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003equery_parameter\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eaccess_token\u003c/span\u003e\n\u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003ebody_parameter\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eaccess_token\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe available strategies are described in the following sections.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_cookie_strategy\"\u003eCookie Strategy\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThis strategy can retrieve authentication data from a specific HTTP cookie. Following properties are supported:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003ecookie\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003estring\u003c/em\u003e (mandatory)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe name of the cookie to use.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"exampleblock\"\u003e\n\u003cdiv class=\"title\"\u003eExample 2. Cookie Strategy usage\u003c/div\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eImagine you want Heimdall to verify an authentication session, which is represented by a specific cookie before the request hits your upstream service. If the client of your upstream application, which is case of a cookie would usually be a browser sends a cookie named \u0026#34;session\u0026#34;, you can inform Heimdall to extract and use it by configuring this strategy as follows:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"yaml\"\u003e\u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003ecookie\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003emy_session_cookie\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_header_strategy\"\u003eHeader Strategy\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThis strategy can retrieve authentication data from a specific HTTP header. Following properties are supported:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003eheader\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003estring\u003c/em\u003e (mandatory)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe name of the header to use.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003escheme\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003estring\u003c/em\u003e (optional)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eScheme, which should be present in the header value. If specified, but not present in the header value, the authentication data cannot be retrieved, effectively making the affected authenticator feel not responsible for the request.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"exampleblock\"\u003e\n\u003cdiv class=\"title\"\u003eExample 3. Header Strategy usage\u003c/div\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eImagine you want Heimdall to verify an access token used to protect your upstream service. If the client of your upstream application sends the access token in the HTTP \u003ccode\u003eAuthorization\u003c/code\u003e header, you can inform Heimdall to extract it from there by configuring this strategy as follows:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"yaml\"\u003e\u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eheader\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eAuthorization\u003c/span\u003e\n  \u003cspan class=\"na\"\u003escheme\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eBearer\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_query_parameter_strategy\"\u003eQuery Parameter Strategy\u003c/h3\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003equery_parameter\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003estring\u003c/em\u003e (mandatory)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe name of the query parameter to use.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"exampleblock\"\u003e\n\u003cdiv class=\"title\"\u003eExample 4. Query Parameter Strategy usage\u003c/div\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eImagine you want Heimdall to verify an access token used to protect your upstream service. If the client of your upstream application sends the access token in the query parameter named \u0026#34;access_token\u0026#34;, you can inform Heimdall to extract it from there by configuring this strategy as follows:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"yaml\"\u003e\u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003equery_parameter\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eaccess_token\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_body_parameter_strategy\"\u003eBody Parameter Strategy\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe usage of this strategy is only possible when the request payload is either JSON or \u003ccode\u003eapplication/x-www-form-urlencoded\u003c/code\u003e encoded. The \u003ccode\u003eContent-Type\u003c/code\u003e of the request must also either be set to \u003ccode\u003eapplication/x-www-form-urlencoded\u003c/code\u003e or to a MIME type, which contains \u003ccode\u003ejson\u003c/code\u003e.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003ebody_parameter\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003estring\u003c/em\u003e (mandatory)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe name of the body parameter to use.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"exampleblock\"\u003e\n\u003cdiv class=\"title\"\u003eExample 5. Body Parameter Strategy usage\u003c/div\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eImagine you want Heimdall to verify an access token used to protect your upstream service. If the client of your upstream application sends the access token in the body parameter named \u0026#34;access_token\u0026#34;, you can inform Heimdall to extract it from there by configuring this strategy as follows:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"yaml\"\u003e\u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003ebody_parameter\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eaccess_token\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_authentication_data_forward_strategy\"\u003eAuthentication Data Forward Strategy\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eAuthentication data strategy defines the way how heimdall should forward the authentication data extracted from the request to the used identity management system.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eAn Authentication Data Forward Strategy configuration entry must contain the following two properties:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003etype\u003c/code\u003e - The type of the strategy. Available types are described in the following sections.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003econfig\u003c/code\u003e - The strategy specific configuration.\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_body_forward_strategy\"\u003eBody Forward Strategy\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThis strategy can be used to embed the extracted authentication data into a body parameter of the request to the identity management system.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e\u003ccode\u003etype\u003c/code\u003e must be set to \u003ccode\u003ebody\u003c/code\u003e. \u003ccode\u003econfig\u003c/code\u003e supports the following properties:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003ename\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003estring\u003c/em\u003e (mandatory)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe name of the property for the authentication data.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"exampleblock\"\u003e\n\u003cdiv class=\"title\"\u003eExample 6. Body strategy configuration\u003c/div\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe following snippet shows how to configure this strategy to send e.g. a token in a property named \u0026#34;idToken\u0026#34;.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"yaml\"\u003e\u003cspan class=\"na\"\u003etype\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ebody\u003c/span\u003e\n\u003cspan class=\"na\"\u003econfig\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"na\"\u003ename\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eidToken\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eDepending on the configured \u0026#34;Content-Type\u0026#34; header for the request (see \u003ca href=\"#_endpoint\"\u003e\u003ccode\u003eEndpoint\u003c/code\u003e\u003c/a\u003e \u003ccode\u003eheaders\u003c/code\u003e) the result might look like\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"text\"\u003eidToken=\u0026lt;whatever the token value is\u0026gt;\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eif the \u0026#34;Content-Type\u0026#34; header was set to \u003ccode\u003eapplication/x-www-form-urlencoded\u003c/code\u003e, or\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"json\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;idToken\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u0026lt;whatever the token value is\u0026gt;\u0026#34;\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eotherwise\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_cookie_forward_strategy\"\u003eCookie Forward Strategy\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThis strategy can be used to embed the extracted authentication data into a cookie of the request to the identity management system.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e\u003ccode\u003etype\u003c/code\u003e must be set to \u003ccode\u003ecookie\u003c/code\u003e. \u003ccode\u003econfig\u003c/code\u003e supports the following properties:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003ename\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003estring\u003c/em\u003e (mandatory)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe name of the cookie for the authentication data.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"exampleblock\"\u003e\n\u003cdiv class=\"title\"\u003eExample 7. Cookie strategy configuration\u003c/div\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe following snippet shows how to configure this strategy to send e.g. a token in a cookie named \u0026#34;it_token\u0026#34;.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"yaml\"\u003e\u003cspan class=\"na\"\u003etype\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ecookie\u003c/span\u003e\n\u003cspan class=\"na\"\u003econfig\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"na\"\u003ename\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eit_token\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_header_forward_strategy\"\u003eHeader Forward Strategy\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThis strategy can be used to embed the extracted authentication data into a header of the request to the identity management system.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e\u003ccode\u003etype\u003c/code\u003e must be set to \u003ccode\u003eheader\u003c/code\u003e. \u003ccode\u003econfig\u003c/code\u003e supports the following properties:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003ename\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003estring\u003c/em\u003e (mandatory)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe name of the header for the authentication data.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003escheme\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003estring\u003c/em\u003e (optional)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe scheme for the header added in front of the authentication data value.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"exampleblock\"\u003e\n\u003cdiv class=\"title\"\u003eExample 8. Header strategy configuration\u003c/div\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe following snippet shows how to configure this strategy to send e.g. a token in a header named \u0026#34;X-ID-Token\u0026#34; with scheme \u0026#34;Bearer\u0026#34;.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"yaml\"\u003e\u003cspan class=\"na\"\u003etype\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eheader\u003c/span\u003e\n\u003cspan class=\"na\"\u003econfig\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"na\"\u003ename\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eX-ID-Token\u003c/span\u003e\n  \u003cspan class=\"na\"\u003escheme\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eBearer\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_query_forward_strategy\"\u003eQuery Forward Strategy\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThis strategy can be used to embed the extracted authentication data into a query parameter of the request to the identity management system.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"admonitionblock warning\"\u003e\n\u003ctable\u003e\n\u003ctbody\u003e\u003ctr\u003e\n\u003ctd class=\"icon\"\u003e\n\u003ci class=\"fa icon-warning\" title=\"Warning\"\u003e\u003c/i\u003e\n\u003c/td\u003e\n\u003ctd class=\"content\"\u003e\nUsing this strategy is discouraged, as it will expose the authentication data to access logs, metrics and tracing.\n\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e\u003ccode\u003etype\u003c/code\u003e must be set to \u003ccode\u003equery\u003c/code\u003e. \u003ccode\u003econfig\u003c/code\u003e supports the following properties:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003ename\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003estring\u003c/em\u003e (mandatory)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe name of the query parameter for the authentication data.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"exampleblock\"\u003e\n\u003cdiv class=\"title\"\u003eExample 9. Query strategy configuration\u003c/div\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe following snippet shows how to configure this strategy to send e.g. a token in a query named \u0026#34;token\u0026#34;.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"yaml\"\u003e\u003cspan class=\"na\"\u003etype\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003equery\u003c/span\u003e\n\u003cspan class=\"na\"\u003econfig\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"na\"\u003ename\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003etoken\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_authentication_strategy\"\u003eAuthentication Strategy\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eAuthentication strategy is kind of abstract type, so you have to define which specific type to use. Each type has its own configuration options.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eAn AuthStrategy configuration entry must contain the following two properties:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003etype\u003c/code\u003e - The type of the strategy. Available types are described in the following sections.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003econfig\u003c/code\u003e - The strategy specific configuration.\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eAvailable strategies are described in the following sections.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_api_key_strategy\"\u003eAPI Key Strategy\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThis strategy can be used if your endpoint expects a specific api key be sent in a header, a cookie or query.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e\u003ccode\u003etype\u003c/code\u003e must be set to \u003ccode\u003eapi_key\u003c/code\u003e. \u003ccode\u003econfig\u003c/code\u003e supports the following properties:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003ein\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003estring\u003c/em\u003e (mandatory)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eWhere to put the api key. Can be either \u003ccode\u003eheader\u003c/code\u003e, \u003ccode\u003ecookie\u003c/code\u003e, or \u003ccode\u003equery\u003c/code\u003e.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"admonitionblock warning\"\u003e\n\u003ctable\u003e\n\u003ctbody\u003e\u003ctr\u003e\n\u003ctd class=\"icon\"\u003e\n\u003ci class=\"fa icon-warning\" title=\"Warning\"\u003e\u003c/i\u003e\n\u003c/td\u003e\n\u003ctd class=\"content\"\u003e\nUsing \u003ccode\u003equery\u003c/code\u003e strategy will expose the api key to access logs and tracing.\n\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003ename\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003estring\u003c/em\u003e (mandatory)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe name of either the header or the cookie.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003evalue\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003estring\u003c/em\u003e (mandatory)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe value of the api key.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"exampleblock\"\u003e\n\u003cdiv class=\"title\"\u003eExample 10. API Key Strategy configuration\u003c/div\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe following snippet shows how to configure this strategy to send an api key in the \u003ccode\u003eX-My-API-Key\u003c/code\u003e HTTP header.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"yaml\"\u003e\u003cspan class=\"na\"\u003etype\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eapi_key\u003c/span\u003e\n\u003cspan class=\"na\"\u003econfig\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"na\"\u003ein\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eheader\u003c/span\u003e\n  \u003cspan class=\"na\"\u003ename\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eX-My-API-Key\u003c/span\u003e\n  \u003cspan class=\"na\"\u003evalue\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003esuper-duper-secret-key\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_basic_auth_strategy\"\u003eBasic Auth Strategy\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThis strategy can be used if your endpoint is protected by HTTP basic authentication and expects the HTTP \u003ccode\u003eAuthorization\u003c/code\u003e header with required values.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e\u003ccode\u003etype\u003c/code\u003e must be set to \u003ccode\u003ebasic_auth\u003c/code\u003e. \u003ccode\u003econfig\u003c/code\u003e supports the following properties:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003euser\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003estring\u003c/em\u003e (mandatory)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe user-id.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003epassword\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003estring\u003c/em\u003e (mandatory)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe password.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"exampleblock\"\u003e\n\u003cdiv class=\"title\"\u003eExample 11. Basic Auth Strategy configuration\u003c/div\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe following snippet shows how to configure this strategy with user set to \u0026#34;Alladin\u0026#34; and password set to \u0026#34;open sesame\u0026#34;\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"yaml\"\u003e\u003cspan class=\"na\"\u003etype\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ebasic_auth\u003c/span\u003e\n\u003cspan class=\"na\"\u003econfig\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"na\"\u003euser\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eAlladin\u003c/span\u003e\n  \u003cspan class=\"na\"\u003epassword\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eopen sesame\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_oauth2_client_credentials_grant_flow_strategy\"\u003eOAuth2 Client Credentials Grant Flow Strategy\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThis strategy implements the \u003ca href=\"https://datatracker.ietf.org/doc/html/rfc6749#section-4.4\"\u003eOAuth2 Client Credentials Grant Flow\u003c/a\u003e to obtain an access token expected by the endpoint. Heimdall caches the received access token.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e\u003ccode\u003etype\u003c/code\u003e must be set to \u003ccode\u003eoauth2_client_credentials\u003c/code\u003e. \u003ccode\u003econfig\u003c/code\u003e supports the following properties:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003etoken_url\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003estring\u003c/em\u003e (mandatory)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe token endpoint of the authorization server.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003eclient_id\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003estring\u003c/em\u003e (mandatory)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe client identifier for heimdall.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003eclient_secret\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003estring\u003c/em\u003e (mandatory)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe client secret for heimdall.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003eauth_method\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003estring\u003c/em\u003e (optional)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe authentication method to be used according to \u003ca href=\"https://www.rfc-editor.org/rfc/rfc6749#section-2.3.1\"\u003eRFC 6749, Client Password\u003c/a\u003e. Can be one of\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003ebasic_auth\u003c/code\u003e (default if \u003ccode\u003eauth_method\u003c/code\u003e is not set): With that authentication method, the \u003ccode\u003e\u0026#34;application/x-www-form-urlencoded\u0026#34;\u003c/code\u003e encoded values of \u003ccode\u003eclient_id\u003c/code\u003e and \u003ccode\u003eclient_secret\u003c/code\u003e are sent to the authorization server via the \u003ccode\u003eAuthorization\u003c/code\u003e header using the \u003ccode\u003eBasic\u003c/code\u003e scheme.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003erequest_body\u003c/code\u003e: With that authentication method the \u003ccode\u003eclient_id\u003c/code\u003e and \u003ccode\u003eclient_secret\u003c/code\u003e are sent in the request body together with the other parameters (e.g. \u003ccode\u003escopes\u003c/code\u003e) defined by the flow.\u003c/p\u003e\n\u003cdiv class=\"admonitionblock warning\"\u003e\n\u003ctable\u003e\n\u003ctbody\u003e\u003ctr\u003e\n\u003ctd class=\"icon\"\u003e\n\u003ci class=\"fa icon-warning\" title=\"Warning\"\u003e\u003c/i\u003e\n\u003c/td\u003e\n\u003ctd class=\"content\"\u003e\nUsage of \u003ccode\u003erequest_body\u003c/code\u003e authentication method is not recommended and should be avoided.\n\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003escopes\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003estring array\u003c/em\u003e (optional)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe scopes required for the access token.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003ecache_ttl\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003e\u003ca href=\"#_duration\"\u003eDuration\u003c/a\u003e\u003c/em\u003e (optional)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eHow long to cache the token received from the token endpoint. Defaults to the token expiration information from the token endpoint (the value of the \u003ccode\u003eexpires_in\u003c/code\u003e field) if present. If the token expiration inforation is not present and \u003ccode\u003ecache_ttl\u003c/code\u003e is not configured, the received token is not cached. If the token expiration information is present in the response and \u003ccode\u003ecache_ttl\u003c/code\u003e is configured the shorter value is taken. If caching is enabled, the token is cached until 5 seconds before its expiration. To disable caching, set it to \u003ccode\u003e0s\u003c/code\u003e. The cache key calculation is based on the values of \u003ccode\u003etoken_url\u003c/code\u003e, \u003ccode\u003eclient_id\u003c/code\u003e, \u003ccode\u003eclient_secret\u003c/code\u003e and the \u003ccode\u003escopes\u003c/code\u003e properties.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003eheader\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003eobject\u003c/em\u003e (optional, overridable)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eDefines the \u003ccode\u003ename\u003c/code\u003e and \u003ccode\u003escheme\u003c/code\u003e to be used for the header. Defaults to \u003ccode\u003eAuthorization\u003c/code\u003e with scheme \u003ccode\u003eBearer\u003c/code\u003e. If defined, the \u003ccode\u003ename\u003c/code\u003e property must be set. If \u003ccode\u003escheme\u003c/code\u003e is not defined, no scheme will be prepended to the resulting JWT.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"exampleblock\"\u003e\n\u003cdiv class=\"title\"\u003eExample 12. Strategy configuration\u003c/div\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"yaml\"\u003e\u003cspan class=\"na\"\u003etype\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eoauth2_client_credentials\u003c/span\u003e\n\u003cspan class=\"na\"\u003econfig\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eheader\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"na\"\u003ename\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eX-My-Token\u003c/span\u003e\n  \u003cspan class=\"na\"\u003etoken_url\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ehttps://my-auth.provider/token\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eclient_id\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003efoo\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eclient_secret\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ebar\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eauth_method\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ebasic_auth\u003c/span\u003e\n  \u003cspan class=\"na\"\u003ettl\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e10m\u003c/span\u003e\n  \u003cspan class=\"na\"\u003escopes\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003ebaz\u003c/span\u003e\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003ezap\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_authorization_expression\"\u003eAuthorization Expression\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eAuthorization expressions define, as the name implies expressions for authorization purposes and have the following properties:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003eexpression\u003c/code\u003e\u003c/strong\u003e \u003cem\u003estring\u003c/em\u003e (mandatory)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe expression to execute.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003emessage\u003c/code\u003e\u003c/strong\u003e \u003cem\u003estring\u003c/em\u003e (optional)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe message to include into the error if the expression fails.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"exampleblock\"\u003e\n\u003cdiv class=\"title\"\u003eExample 13. Example expression using \u003ca href=\"https://github.com/google/cel-spec\"\u003eCEL\u003c/a\u003e\u003c/div\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe expression below determine whether \u003ccode\u003eattributes\u003c/code\u003e property of a \u003ccode\u003esubject\u003c/code\u003e object (also shown below) has at least one key that starts with the \u003ccode\u003egroup\u003c/code\u003e prefix, and ensure that all group-like keys have list values containing only strings that end with \u003ccode\u003e@acme.co\u003c/code\u003e.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"title\"\u003esubject\u003c/div\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"yaml\"\u003e\u003cspan class=\"na\"\u003eid\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"s\"\u003efoobar\u0026#34;\u003c/span\u003e\n\u003cspan class=\"na\"\u003eattributes\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"na\"\u003egroup1\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"pi\"\u003e[\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"s\"\u003eadmin@acme.co\u0026#34;\u003c/span\u003e\u003cspan class=\"pi\"\u003e,\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"s\"\u003eanalyst@acme.co\u0026#34;\u003c/span\u003e\u003cspan class=\"pi\"\u003e]\u003c/span\u003e\n  \u003cspan class=\"na\"\u003elabels\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"pi\"\u003e[\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"s\"\u003emetadata\u0026#34;\u003c/span\u003e\u003cspan class=\"pi\"\u003e,\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"s\"\u003eprod\u0026#34;\u003c/span\u003e\u003cspan class=\"pi\"\u003e,\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"s\"\u003epii\u0026#34;\u003c/span\u003e\u003cspan class=\"pi\"\u003e]\u003c/span\u003e\n  \u003cspan class=\"na\"\u003egroupN\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"pi\"\u003e[\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"s\"\u003eforever@acme.co\u0026#34;\u003c/span\u003e\u003cspan class=\"pi\"\u003e]\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"yaml\"\u003e\u003cspan class=\"na\"\u003eexpression\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"pi\"\u003e|\u003c/span\u003e\n  \u003cspan class=\"s\"\u003esubject.attributes.exists(c, c.startsWith(\u0026#39;group\u0026#39;)) \u0026amp;\u0026amp;\u003c/span\u003e\n  \u003cspan class=\"s\"\u003esubject.attributes\u003c/span\u003e\n      \u003cspan class=\"s\"\u003e.filter(c, c.startsWith(\u0026#39;group\u0026#39;))\u003c/span\u003e\n      \u003cspan class=\"s\"\u003e.all(c, subject.attributes[c]\u003c/span\u003e\n      \u003cspan class=\"s\"\u003e.all(g, g.endsWith(\u0026#39;@acme.co\u0026#39;)))\u003c/span\u003e\n\u003cspan class=\"na\"\u003emessage\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eNo groups ending with @acme.co present\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_bytesize\"\u003eByteSize\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eByteSize is actually a string type, which adheres to the following pattern: \u003ccode\u003e^[0-9]+(B|KB|MB)$\u003c/code\u003e\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eSo with \u003ccode\u003e10B\u003c/code\u003e you can define the byte size of 10 bytes and with \u003ccode\u003e2MB\u003c/code\u003e you can say 2 megabytes.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_cors\"\u003eCORS\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e\u003ca href=\"https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS\"\u003eCORS\u003c/a\u003e (Cross-Origin Resource Sharing) headers can be added and configured by making use of this type. This functionality allows for advanced security features to quickly be set. If CORS headers are set, then heimdall does not pass preflight requests to its decision pipeline, instead the response will be generated and sent back to the client directly. Following properties are supported:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003eallowed_origins\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003estring array\u003c/em\u003e (optional)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eList of origins that may access the resource. Defaults to all, if not set, but any of the other CORS options are configured.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003eallowed_methods\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003estring array\u003c/em\u003e (optional)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eList of methods allowed when accessing the resource. This is used in response to a preflight request. Defaults to \u003ccode\u003eGET\u003c/code\u003e, \u003ccode\u003ePOST\u003c/code\u003e, \u003ccode\u003eHEAD\u003c/code\u003e, \u003ccode\u003ePUT\u003c/code\u003e, \u003ccode\u003eDELETE\u003c/code\u003e and \u003ccode\u003ePATCH\u003c/code\u003e if not set, but any of the other CORS options are configured.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003eallowed_headers\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003estring array\u003c/em\u003e (optional)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eList of request headers that can be used when making the actual request.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003eexposed_headers\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003estring array\u003c/em\u003e (optional)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003e\u0026#34;Allow-List\u0026#34; of headers that clients are allowed to access.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003eallow_credentials\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003eboolean\u003c/em\u003e (optional)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eIndicates whether the response to the request can be exposed when the credentials flag is true. When used as part of a response to a preflight request, this indicates whether the actual request can be made using credentials. Defaults to \u003ccode\u003efalse\u003c/code\u003e if not set, but any of the other CORS options are configured.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003emax_age\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003e\u003ca href=\"#_duration\"\u003eDuration\u003c/a\u003e\u003c/em\u003e (optional)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eIndicates how long the results of a preflight request can be cached. Defaults to 0 seconds if not set, but any of the other CORS options are configured.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"exampleblock\"\u003e\n\u003cdiv class=\"title\"\u003eExample 14. Possible configuration\u003c/div\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"yaml\"\u003e\u003cspan class=\"na\"\u003eallowed_origins\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003eexample.org\u003c/span\u003e\n\u003cspan class=\"na\"\u003eallowed_methods\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003eHEAD\u003c/span\u003e\n  \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003ePATCH\u003c/span\u003e\n\u003cspan class=\"na\"\u003eallow_credentials\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\n\u003cspan class=\"na\"\u003emax_age\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e10s\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_duration\"\u003eDuration\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eDuration is actually a string type, which adheres to the following pattern: \u003ccode\u003e^[0-9]+(ns|us|ms|s|m|h)$\u003c/code\u003e\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eSo with \u003ccode\u003e10s\u003c/code\u003e you can define the duration of 10 seconds and with \u003ccode\u003e2h\u003c/code\u003e you can say 2 hours.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_endpoint\"\u003eEndpoint\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe Endpoint type defines properties required for the communication with an endpoint.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eIf only the URL is required to be set, you can specify it by using just a string. If more than the URL is required to be specified, following properties are available:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003eurl\u003c/code\u003e\u003c/strong\u003e \u003cem\u003estring\u003c/em\u003e (mandatory)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe actual url of the endpoint. Depending on the mechanism, a URL can be templated\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"admonitionblock note\"\u003e\n\u003ctable\u003e\n\u003ctbody\u003e\u003ctr\u003e\n\u003ctd class=\"icon\"\u003e\n\u003ci class=\"fa icon-note\" title=\"Note\"\u003e\u003c/i\u003e\n\u003c/td\u003e\n\u003ctd class=\"content\"\u003e\nIf templating is used, user info, scheme and host parts of the URL cannot be templated. Attempts to do so will result in runtime errors.\n\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003emethod\u003c/code\u003e\u003c/strong\u003e \u003cem\u003estring\u003c/em\u003e (optional)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe HTTP method to use while communicating with the endpoint. If not set \u003ccode\u003ePOST\u003c/code\u003e is used.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003eretry\u003c/code\u003e\u003c/strong\u003e \u003cem\u003e\u003ca href=\"#_retry\"\u003eRetry\u003c/a\u003e\u003c/em\u003e (optional)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eWhat to do if the communication fails. If not configured, no retry attempts are done.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003eauth\u003c/code\u003e\u003c/strong\u003e \u003cem\u003e\u003ca href=\"#_authentication_strategy\"\u003eAuthentication Strategy\u003c/a\u003e\u003c/em\u003e (optional)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eAuthentication strategy to apply, if the endpoint requires authentication.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003eheaders\u003c/code\u003e\u003c/strong\u003e \u003cem\u003emap of strings\u003c/em\u003e (optional)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eHTTP headers to be sent to the endpoint.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"admonitionblock caution\"\u003e\n\u003ctable\u003e\n\u003ctbody\u003e\u003ctr\u003e\n\u003ctd class=\"icon\"\u003e\n\u003ci class=\"fa icon-caution\" title=\"Caution\"\u003e\u003c/i\u003e\n\u003c/td\u003e\n\u003ctd class=\"content\"\u003e\nThese headers are not analyzed by heimdall and are just forwarded to the endpoint. E.g. if you configure the \u003ccode\u003eContent-Encoding\u003c/code\u003e to something like \u003ccode\u003egzip\u003c/code\u003e, the service behind the used endpoint might fail to answer, as it would expect the body to be compressed.\n\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003ehttp_cache\u003c/code\u003e\u003c/strong\u003e \u003cem\u003eobject\u003c/em\u003e (optional)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eControls whether HTTP caching according to \u003ca href=\"https://www.rfc-editor.org/rfc/rfc7234\"\u003eRFC 7234\u003c/a\u003e should be used. To support this, that object defines the following properties:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003eenabled\u003c/code\u003e\u003c/strong\u003e \u003cem\u003eboolean\u003c/em\u003e (optional)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eDefaults to \u003ccode\u003efalse\u003c/code\u003e if not otherwise stated in the description of the configuration type, making use of the \u003ccode\u003eendpoint\u003c/code\u003e property. If set to \u003ccode\u003etrue\u003c/code\u003e heimdall will strictly follow the requirements from RFC 7234 and cache the responses if possible and reuse these if still valid.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003ecache_ttl\u003c/code\u003e\u003c/strong\u003e \u003cem\u003e\u003ca href=\"#_duration\"\u003eDuration\u003c/a\u003e\u003c/em\u003e (optional)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eSpecifies how long heimdall should cache the response if the endpoint referenced by the URL does not provide any explicit expiration time (no heuristic freshness lifetime is calculated). Without configuring this property, heimdall treats such responses as not cacheable. Defaults to \u003ccode\u003e0s\u003c/code\u003e if not otherwise stated in the description of the configuration type making use of the \u003ccode\u003eendpoint\u003c/code\u003e property.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"exampleblock\"\u003e\n\u003cdiv class=\"title\"\u003eExample 15. Endpoint configuration as string\u003c/div\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"text\"\u003ehttp://foo.bar\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"exampleblock\"\u003e\n\u003cdiv class=\"title\"\u003eExample 16. Structured Endpoint configuration\u003c/div\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"yaml\"\u003e\u003cspan class=\"na\"\u003eurl\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ehttp://foo.bar\u003c/span\u003e\n\u003cspan class=\"na\"\u003emethod\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eGET\u003c/span\u003e\n\u003cspan class=\"na\"\u003eretry\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"na\"\u003egive_up_after\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e5s\u003c/span\u003e\n  \u003cspan class=\"na\"\u003emax_delay\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e1s\u003c/span\u003e\n\u003cspan class=\"na\"\u003eauth\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"na\"\u003etype\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eapi_key\u003c/span\u003e\n  \u003cspan class=\"na\"\u003econfig\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"na\"\u003ename\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003efoo\u003c/span\u003e\n    \u003cspan class=\"na\"\u003evalue\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ebar\u003c/span\u003e\n    \u003cspan class=\"na\"\u003ein\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ecookie\u003c/span\u003e\n\u003cspan class=\"na\"\u003eheaders\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eX-My-First-Header\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003efoobar\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eX-My-Second-Header\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ebarfoo\u003c/span\u003e\n\u003cspan class=\"na\"\u003eenable_http_cache\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_errorstate_type\"\u003eError/State Type\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eHeimdall defines a couple of error/state types, which it uses to signal errors. Those, which are marked with (*) are available in CEL expressions. All can be used to define overrides for the HTTP response codes.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eFollowing types are available:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003eaccepted\u003c/code\u003e - this is the only state type in this list and is used to signal, the matched decision pipeline has been executed successfully, so the request can be forwarded to the upstream service. The response of that type results by default in a \u003ccode\u003e200 OK\u003c/code\u003e response.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003eauthentication_error\u003c/code\u003e (*) - used if an authenticator failed to verify authentication data available in the request. E.g. an authenticator was configured to verify a JWT and the signature of it was invalid. If none of the authenticators used in a pipeline were able to authenticate the user, and the default error handler was used to handle such error, it will by default result in a \u003ccode\u003e401 Unauthorized\u003c/code\u003e response.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003eauthorization_error\u003c/code\u003e (*) - used if an authorizer failed to authorize the subject. E.g. an authorizer is configured to use an expression on the given subject and request context, but that expression returned with an error. Error of this type results by default in \u003ccode\u003e403 Forbidden\u003c/code\u003e response if the default error handler was used to handle such error.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003ecommunication_error\u003c/code\u003e (*) - this error is used to signal a communication error while communicating to a remote system during the execution of the pipeline of the matched rule. Timeouts of DNSs errors result in such an error. Error of this type results by default in \u003ccode\u003e502 Bad Gateway\u003c/code\u003e HTTP code if handled by the default error handler.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003einternal_error\u003c/code\u003e - used if heimdall run into an internal error condition while processing the request. E.g. something went wrong while unmarshalling a JSON object, or if there was a configuration error, which couldn’t be raised while loading a rule, etc. Results by default in \u003ccode\u003e500 Internal Server Error\u003c/code\u003e response to the caller.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003emethod_error\u003c/code\u003e - this error is used to signal that a matched rule does not allow usage of the HTTP method used to submit the request. Error of this type results by default in \u003ccode\u003e405 Method Not Allowed\u003c/code\u003e HTTP code.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003eno_rule_error\u003c/code\u003e - this error is used to signal, there is no matching rule to handle the given request. Error of this type results by default in \u003ccode\u003e404 Not Found\u003c/code\u003e HTTP code.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003eprecondition_error\u003c/code\u003e (*) - used if the request does not contain required/expected data. E.g. if an authenticator could not find a cookie configured. Error of this type results by default in \u003ccode\u003e400 Bad Request\u003c/code\u003e HTTP code if handled by the default error handler.\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_key_store\"\u003eKey Store\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThis type configures a key store holding keys and corresponding certificate chains. PKCS#1, as well as PKCS#8 encodings are supported for private keys.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eWhile loading a key store following verifications are done:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"olist arabic\"\u003e\n\u003col class=\"arabic\"\u003e\n\u003cli\u003e\n\u003cp\u003eUniqueness of key ids and rejection of key stores which violate this condition (see also \u003ca href=\"#_key_id_lookup\"\u003eKey-Id Lookup\u003c/a\u003e)\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eCorrelation of keys and certificates to build a valid certificate chain for every given key if certificates are present. If the correlation fails, an error is raised and heimdall will refuse to start.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eCertificate chain validation. If the chain is invalid, an error is raised and heimdall will refuse to start.\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eFollowing configuration properties are available:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003epath\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003estring\u003c/em\u003e (mandatory)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe path to the PEM file with the cryptographic material. Watching for secrets rotation is supported.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003epassword\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003estring\u003c/em\u003e (optional)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eIf the key material is protected with a password, this property can be set to decipher it. Password protection is only supported for PKCS#8 encoded keys\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"admonitionblock caution\"\u003e\n\u003ctable\u003e\n\u003ctbody\u003e\u003ctr\u003e\n\u003ctd class=\"icon\"\u003e\n\u003ci class=\"fa icon-caution\" title=\"Caution\"\u003e\u003c/i\u003e\n\u003c/td\u003e\n\u003ctd class=\"content\"\u003e\nIf the key store contains multiple keys and these keys are password protected, same password must be used for all of these.\n\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"exampleblock\"\u003e\n\u003cdiv class=\"title\"\u003eExample 17. Example configuration\u003c/div\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"yaml\"\u003e\u003cspan class=\"na\"\u003epath\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e/path/to/keystore.pem\u003c/span\u003e\n\u003cspan class=\"na\"\u003epassword\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eVeryInsecure!\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_respond\"\u003eRespond\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThis type enables instructing heimdall to preserve error information and provide it in the response body to the caller, as well as to use HTTP status codes deviating from those heimdall would usually use. The configuration, which can be done using this type affects only the behavior of the default error handler.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eFollowing properties are supported:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003everbose\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003eboolean\u003c/em\u003e (optional)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eBy making use of this property you can instruct heimdall to preserve error information and provide it in the response body to the caller. Defaults to \u003ccode\u003efalse\u003c/code\u003e.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eHeimdall supports MIME type negotiation. So, if the client sets the HTTP \u003ccode\u003eAccept\u003c/code\u003e header to e.g. \u003ccode\u003eapplication/json\u003c/code\u003e, and Heimdall run into an unhandled internal error condition, in addition to responding with \u003ccode\u003e500 Internal Server Error\u003c/code\u003e, it will render an error message, like shown below, if \u003ccode\u003everbose\u003c/code\u003e has been set to \u003ccode\u003etrue\u003c/code\u003e.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"json\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"w\"\u003e\n  \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;code\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;internal error\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n  \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;message\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;whatever led to the error\u0026#34;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe \u003ccode\u003emessage\u003c/code\u003e will however contain just high-level information, like \u0026#34;failed to parse something\u0026#34;, but will not contain any stack traces.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003ewith\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003eResponseOverride set\u003c/em\u003e (optional)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThis property enables mapping between response/error types used by heimdall and the corresponding HTTP status codes. Each entry must be from the list of the supported \u003ca href=\"#_errorstate_type\"\u003eError/State Types\u003c/a\u003e and contain exactly one property named \u003ccode\u003ecode\u003c/code\u003e, which then defines the desired mapping.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"exampleblock\"\u003e\n\u003cdiv class=\"title\"\u003eExample 18. Making error responses verbose and changing the HTTP codes for some errors\u003c/div\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"yaml\"\u003e\u003cspan class=\"na\"\u003everbose\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\n\u003cspan class=\"na\"\u003ewith\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eauthentication_error\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"na\"\u003ecode\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"m\"\u003e404\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eauthorization_error\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"na\"\u003ecode\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e404\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_retry\"\u003eRetry\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eImplements an exponential backoff strategy for endpoint communication. It increases the backoff exponentially by multiplying the \u003ccode\u003emax_delay\u003c/code\u003e with 2^(attempt count)\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003egive_up_after\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003e\u003ca href=\"#_duration\"\u003eDuration\u003c/a\u003e\u003c/em\u003e (optional)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eSets an upper bound on the maximum time to wait between two requests. Default to 0, which means no upper bound.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003emax_delay\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003e\u003ca href=\"#_duration\"\u003eDuration\u003c/a\u003e\u003c/em\u003e (mandatory)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe initial backoff.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"exampleblock\"\u003e\n\u003cdiv class=\"title\"\u003eExample 19. Retry configuration\u003c/div\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eIn this example the backoff will be 1, 2, 4, 8, 16, 32, 60, …​\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"yaml\"\u003e\u003cspan class=\"na\"\u003egive_up_after\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e60s\u003c/span\u003e\n\u003cspan class=\"na\"\u003emax_delay\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e1s\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_scopes_matcher\"\u003eScopes Matcher\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eScopes matcher is a configuration type allowing configuration of different strategies to match required scopes. In its simplest shape it can be just an array of strings (implemented by the \u003ca href=\"#_exact\"\u003eExact\u003c/a\u003e) scope matcher. To cover many use cases, different strategies are available and described in the following sections.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eRegardless of the strategy, each matcher can explicitly be configured and supports the following configuration properties:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003ematching_strategy\u003c/code\u003e - the type of the mathing strategy.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003evalues\u003c/code\u003e - the list of scope patterns\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_exact\"\u003eExact\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThis the simplest matcher and is automatically selected, if just an array of strings is configured as shown in the following snippet:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"yaml\"\u003e\u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003efoo\u003c/span\u003e\n\u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003ebar\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eHowever, as written in the \u003ca href=\"#_scopes_matcher\"\u003eScopes Matcher\u003c/a\u003e section, it can also explicitly be selected by setting \u003ccode\u003ematching_strategy\u003c/code\u003e to \u003ccode\u003eexact\u003c/code\u003e and defining the required scopes in the \u003ccode\u003evalues\u003c/code\u003e property.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"exampleblock\"\u003e\n\u003cdiv class=\"title\"\u003eExample 20. Essentially same configurations\u003c/div\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"yaml\"\u003e\u003cspan class=\"na\"\u003ematching_strategy\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eexact\u003c/span\u003e\n\u003cspan class=\"na\"\u003evalues\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003efoo\u003c/span\u003e\n  \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003ebar\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"yaml\"\u003e  \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003efoo\u003c/span\u003e\n  \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003ebar\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_hierarchic\"\u003eHierarchic\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThis matcher enables matching hierarchical scopes, which use \u003ccode\u003e.\u003c/code\u003e as separator. Imagine your system is organized that way, that it defines namespaces for different services like this:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003emy-service\u003c/code\u003e being the top namespace\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003emy-service.booking\u003c/code\u003e - being the namespace of the booking service\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003emy-service.orders\u003c/code\u003e - being the namespace of the orders service\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003emy-service.orders.partners\u003c/code\u003e - being the namespace of the order service for partners and\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003emy-service.orders.customers\u003c/code\u003e - being the namespace of the order service for customers\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eBasically you’ve established an identity for each of your services (this is comparable to how \u003ca href=\"https://spiffe.io/docs/latest/spiffe-about/spiffe-concepts/#spiffe-id\"\u003eSPIFFE IDs\u003c/a\u003e are organized and also used for).\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eNow, imagine you use these namespaces as scope values to limit the usage of the issued tokens. In such situations the hierarchic scope matcher can become handy if you would like to assert any scope of the token must be in e.g. the \u003ccode\u003emy-service\u003c/code\u003e or the \u003ccode\u003emy-service.orders\u003c/code\u003e namespace.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThis matcher can only be used by explicitly setting the \u003ccode\u003ematching_strategy\u003c/code\u003e to \u003ccode\u003ehierarchic\u003c/code\u003e and defining the required patterns in the \u003ccode\u003evalues\u003c/code\u003e property.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"exampleblock\"\u003e\n\u003cdiv class=\"title\"\u003eExample 21. Matching of hierarchic scopes\u003c/div\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"yaml\"\u003e\u003cspan class=\"na\"\u003ematching_strategy\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ehierarchic\u003c/span\u003e\n\u003cspan class=\"na\"\u003evalues\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003emy-service\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThis configuration will ensure all scopes withing the scope or scp claim are within the \u003ccode\u003emy-service\u003c/code\u003e namespace. So scope claim like\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"json\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"w\"\u003e\n  \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;scope\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;my-service.orders\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;my-service.orders.customers\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003ewould match, but\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"json\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"w\"\u003e\n  \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;scope\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;not-my-service\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;my-service.orders.customers\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003ewould not match.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect2\"\u003e\n\u003ch3 id=\"_wildcard\"\u003eWildcard\u003c/h3\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThis matcher enables matching scopes using wildcards. It goes beyond the \u003ca href=\"#_hierarchic\"\u003eHierarchic\u003c/a\u003e scope matcher by enabling usage of wildcards.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThis matcher can only be used by explicitly setting the \u003ccode\u003ematching_strategy\u003c/code\u003e to \u003ccode\u003ewildcard\u003c/code\u003e and defining the required patterns in the \u003ccode\u003evalues\u003c/code\u003e property.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_subject\"\u003eSubject\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThis configuration type enables extraction of subject information from responses received by Heimdall from authentication services. Following properties are available.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003eid\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003estring\u003c/em\u003e (mandatory)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eA \u003ca href=\"https://github.com/tidwall/gjson/blob/master/SYNTAX.md\"\u003eGJSON Path\u003c/a\u003e pointing to the id of the subject in the JSON object.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003eattributes\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003estring\u003c/em\u003e (optional)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eA \u003ca href=\"https://github.com/tidwall/gjson/blob/master/SYNTAX.md\"\u003eGJSON Path\u003c/a\u003e pointing to the attributes of the subject in the JSON object. Defaults to \u003ccode\u003e@this\u003c/code\u003e.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"exampleblock\"\u003e\n\u003cdiv class=\"title\"\u003eExample 22. Extracting subject id from an \u003ca href=\"https://tools.ietf.org/html/rfc7662\"\u003eOAuth2 Introspection\u003c/a\u003e endpoint response.\u003c/div\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThis example shows how to extract the subject id from an \u003ca href=\"https://tools.ietf.org/html/rfc7662\"\u003eOAuth2 Introspection\u003c/a\u003e endpoint response and set the subject attributes to the entire response\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"yaml\"\u003e\u003cspan class=\"na\"\u003eid\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003esub\u003c/span\u003e\n\u003cspan class=\"na\"\u003eattributes\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"err\"\u003e@\u003c/span\u003e\u003cspan class=\"s\"\u003ethis\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eSetting \u003ccode\u003eattributes\u003c/code\u003e was actually not required, as \u003ccode\u003e@this\u003c/code\u003e would be set by default anyway.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"exampleblock\"\u003e\n\u003cdiv class=\"title\"\u003eExample 23. Extracting subject id from an \u003ca href=\"https://www.ory.sh/docs/kratos/\"\u003eOry Kratos\u003c/a\u003e \u0026#34;whoami\u0026#34; endpoint response\u003c/div\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThis example shows how to extract the subject id from an \u003ca href=\"https://www.ory.sh/docs/kratos/\"\u003eOry Kratos\u003c/a\u003e \u0026#34;whoami\u0026#34; endpoint response and set the subject attributes to the entire response. \u003ccode\u003eattributes\u003c/code\u003e is not configured, so default is used.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"yaml\"\u003e\u003cspan class=\"na\"\u003eid\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eidentity.id\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_session_lifespan\"\u003eSession Lifespan\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThis configuration type enables the configuration of session lifespans, used for session validation for those authenticators, which act on non-standard protocols. Following properties are available.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003eactive\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003estring\u003c/em\u003e (optional)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eA \u003ca href=\"https://github.com/tidwall/gjson/blob/master/SYNTAX.md\"\u003eGJSON Path\u003c/a\u003e pointing to the field describing the \u0026#34;active\u0026#34; status of the session in the corresponding JSON object. The actual value in that field should be convertable to a \u003ccode\u003ebool\u003c/code\u003e type. If not provided, or not found in the session object, the session is considered to be \u0026#34;active\u0026#34;. \u0026#34;active\u0026#34; means it can be used and represent a valid session between the authentication system and the subject, the session has been issued to.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003eissued_at\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003estring\u003c/em\u003e (optional)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eA \u003ca href=\"https://github.com/tidwall/gjson/blob/master/SYNTAX.md\"\u003eGJSON Path\u003c/a\u003e pointing to the field in the corresponding JSON object, describing the time, when the session object has been issued. If not provided or not found, the issuance time is not considered during session validation.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003enot_before\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003estring\u003c/em\u003e (optional)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eA \u003ca href=\"https://github.com/tidwall/gjson/blob/master/SYNTAX.md\"\u003eGJSON Path\u003c/a\u003e pointing to the field in the corresponding JSON object describing the time, until which the session object is not allowed to be used. If not provided or not found, the corresponding time is not considered during session validation.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003enot_after\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003estring\u003c/em\u003e (optional)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eA \u003ca href=\"https://github.com/tidwall/gjson/blob/master/SYNTAX.md\"\u003eGJSON Path\u003c/a\u003e pointing to the field in the corresponding JSON object describing the time, after which the session object is not allowed to be used. If not provided or not found, the corresponding time is not considered during session validation.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003etime_format\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003estring\u003c/em\u003e (optional)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eSince different authentication system use different representations for time strings, this property allows the definition of the \u003ca href=\"https://pkg.go.dev/time#pkg-constants\"\u003etime format/layout\u003c/a\u003e used by the authentication system. Defaults to Unix Epoch time stamp.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"admonitionblock note\"\u003e\n\u003ctable\u003e\n\u003ctbody\u003e\u003ctr\u003e\n\u003ctd class=\"icon\"\u003e\n\u003ci class=\"fa icon-note\" title=\"Note\"\u003e\u003c/i\u003e\n\u003c/td\u003e\n\u003ctd class=\"content\"\u003e\nYou can use the following \u003ca href=\"https://go.dev/play/p/VjtvWMmp-Ua\"\u003eGo Playground\u003c/a\u003e link to test your time format settings.\n\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003evalidity_leeway\u003c/code\u003e\u003c/strong\u003e: \u003ca href=\"#_duration\"\u003eDuration\u003c/a\u003e (optional)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eEnables definition of an allowed time drift between the authentication system and heimdall for the validation of the session validity. Defaults to 0.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"exampleblock\"\u003e\n\u003cdiv class=\"title\"\u003eExample 24. Making use of session information received from Ory’s Kratos\u003c/div\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eA typical response from Kratos\u0026#39; \u003ccode\u003ewhoami\u003c/code\u003e endpoint looks like follows (stripped to the most interesting parts):\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"json\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"w\"\u003e\n  \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;id\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;1338410d-c473-4503-a96a-53efa06e2531\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n  \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;active\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n  \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;expires_at\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;2021-10-15T15:58:57.683338Z\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n  \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;authenticated_at\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;2021-10-14T15:58:57.683338Z\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n  \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;issued_at\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;2021-10-14T15:58:57.683338Z\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n  \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;identity\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;id\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;9496bbd5-f426-473f-b087-c7df853f274a\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"err\"\u003e...\u003c/span\u003e\u003cspan class=\"w\"\u003e\n  \u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eTo enable usage of these properties in Heimdall, you can configure the Session Lifespan as follows:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"yaml\"\u003e\u003cspan class=\"na\"\u003eactive\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eactive\u003c/span\u003e\n\u003cspan class=\"na\"\u003eissued_at\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eissued_at\u003c/span\u003e\n\u003cspan class=\"na\"\u003enot_before\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eauthenticated_at\u003c/span\u003e\n\u003cspan class=\"na\"\u003enot_after\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eexpires_at\u003c/span\u003e\n\u003cspan class=\"na\"\u003etime_format\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"s\"\u003e2006-01-02T15:04:05.999999Z07\u0026#34;\u003c/span\u003e\n\u003cspan class=\"na\"\u003evalidity_leeway\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e10s\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"exampleblock\"\u003e\n\u003cdiv class=\"title\"\u003eExample 25. Making use of session information received from a compliant OAuth2 authorization service\u003c/div\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eA typical response from a token \u003ccode\u003eintrospection\u003c/code\u003e endpoint looks like follows:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"json\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"w\"\u003e\n  \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;active\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n  \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;client_id\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;l238j323ds-23ij4\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n  \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;username\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;jdoe\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n  \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;scope\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;read write dolphin\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n  \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;sub\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;Z5O3upPC88QrAjx00dis\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n  \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;aud\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;https://protected.example.net/resource\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n  \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;iss\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;https://server.example.com/\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n  \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;exp\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"mi\"\u003e1419356238\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n  \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;iat\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"mi\"\u003e1419350238\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n  \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026#34;extension_field\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;twenty-seven\u0026#34;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n \u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eTo enable usage of these properties in Heimdall, you can configure the Session Lifespan as follows:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"yaml\"\u003e\u003cspan class=\"na\"\u003eactive\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eactive\u003c/span\u003e\n\u003cspan class=\"na\"\u003eissued_at\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eiat\u003c/span\u003e\n\u003cspan class=\"na\"\u003enot_after\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eexp\u003c/span\u003e\n\u003cspan class=\"na\"\u003evalidity_leeway\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e10s\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eAs you see, there is no need to define the time format as the times values appearing in the responses from an introspection endpoint are Unix Epoch time stamps.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_tls\"\u003eTLS\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eFollowing are the supported TLS configuration properties:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003ekey_store\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003e\u003ca href=\"#_key_store\"\u003eKey Store\u003c/a\u003e\u003c/em\u003e (mandatory)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe key store containing the cryptographic material. At least one private key and the corresponding certificate must be present.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003ekey_id\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003estring\u003c/em\u003e (optional)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eIf the \u003ccode\u003ekey_store\u003c/code\u003e contains multiple keys, this property can be used to specify the key to use (see also \u003ca href=\"#_key_id_lookup\"\u003eKey-Id Lookup\u003c/a\u003e). If not specified, the first key is used. If specified, but there is no key for the given key id present, an error is raised and heimdall will refuse to start.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003emin_version\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003estring\u003c/em\u003e (optional)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe minimal TLS version to support. Can be either \u003ccode\u003eTLS1.2\u003c/code\u003e or \u003ccode\u003eTLS1.3\u003c/code\u003e. Defaults to \u003ccode\u003eTLS1.3\u003c/code\u003e.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003ecipher_suites\u003c/code\u003e\u003c/strong\u003e: \u003cem\u003estring array\u003c/em\u003e (optional)\u003c/p\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eCan be configured if \u003ccode\u003emin_version\u003c/code\u003e is set to \u003ccode\u003eTLS1.2\u003c/code\u003e. If \u003ccode\u003emin_version\u003c/code\u003e is set to \u003ccode\u003eTLS1.3\u003c/code\u003e the configured values are ignored. Only the following PFS cipher suites are supported:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003eTLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA256\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003eTLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003eTLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003eTLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003eTLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003eTLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003eTLS_ECDHE_RSA_WITH_CHACHA20_POLY1305_SHA256\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003eTLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305_SHA256\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eDefaults to the last six cipher suites if \u003ccode\u003emin_version\u003c/code\u003e is set to \u003ccode\u003eTLS1.2\u003c/code\u003e and \u003ccode\u003ecipher_suites\u003c/code\u003e is not configured.\u003c/p\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv class=\"exampleblock\"\u003e\n\u003cdiv class=\"title\"\u003eExample 26. Example configuration\u003c/div\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"yaml\"\u003e\u003cspan class=\"na\"\u003ekey_store\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"na\"\u003epath\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e/path/to/keystore.pem\u003c/span\u003e\n  \u003cspan class=\"na\"\u003epassword\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eVeryInsecure!\u003c/span\u003e\n\u003cspan class=\"na\"\u003ekey_id\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003efoobar\u003c/span\u003e\n\u003cspan class=\"na\"\u003emin_version\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eTLS1.2\u003c/span\u003e\n\u003cspan class=\"na\"\u003ecipher_suites\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003eTLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384\u003c/span\u003e\n  \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003eTLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"sect1\"\u003e\n\u003ch2 id=\"_key_id_lookup\"\u003eKey-Id Lookup\u003c/h2\u003e\n\u003cdiv class=\"sectionbody\"\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eWhen heimdall loads a key store, following algorithm is used to get the key id for the key:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"ulist\"\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eif the PEM entry with the private key has \u003ccode\u003eX-Key-ID\u003c/code\u003e header specified, this value is used as key id\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eOtherwise, if an X.509 certificate is present for the private key, and it has the \u003ccode\u003eSubject Key Identifier\u003c/code\u003e extension set, the hex representation of it is used as key id.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eOtherwise, heimdall calculates the value for the \u003ccode\u003eSubject Key Identifier\u003c/code\u003e according to \u003ca href=\"https://www.ietf.org/rfc/rfc3280.html#section-4.2.1.2\"\u003eRFC 3280, Section 4.2.1.2\u003c/a\u003e and uses hex representation of it as key id.\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n","sections":["Configuration Reference"],"tags":null,"title":"Type Definitions","url":"/docs/configuration/types/"},{"categories":null,"content":" Below you can find possible contents (not exhaustive) for Heimdall’s config.yaml file. Head over to configuration documentation to get detailed explanation.\nserve: decision: host: 127.0.0.1 port: 4468 respond: verbose: true with: accepted: code: 201 authorization_error: code: 404 authentication_error: code: 404 timeout: read: 2s write: 5s idle: 2m buffer_limit: read: 10KB write: 10KB tls: key_store: path: /path/to/key/store.pem password: VerySecure! trusted_proxies: - 192.168.1.0/24 proxy: host: 127.0.0.1 port: 4469 respond: verbose: true with: authorization_error: code: 404 authentication_error: code: 404 timeout: read: 2s write: 5s idle: 2m connections_limit: max_per_host: 10 max_idle: 100 max_idle_per_host: 50 buffer_limit: read: 10KB write: 10KB cors: allowed_origins: - example.org allowed_methods: - GET - POST allowed_headers: - Authorization exposed_headers: - X-My-Header allow_credentials: true max_age: 1m tls: key_store: path: /path/to/key/store.pem password: VerySecure! key_id: first_entry min_version: TLS1.2 cipher_suites: - TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384 - TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384 - TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305_SHA256 - TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305_SHA256 trusted_proxies: - 192.168.1.0/24 management: host: 127.0.0.1 port: 4457 verbose_errors: false timeout: read: 2s write: 5s idle: 2m cors: allowed_origins: - example.org allowed_methods: - GET - POST allowed_headers: - Authorization exposed_headers: - X-My-Header allow_credentials: true max_age: 1m tls: key_store: path: /path/to/key/store.pem min_version: TLS1.2 cache: type: redis-sentinel config: db: 2 master: whatever nodes: - foo:1234 - bar:1234 credentials: path: /path/to/credentials.yaml tls: key_store: path: /path/to/redis_client_keystore.pem key_id: bf5d129a7fec8b1fde11eab459784cc2f14e6c1d min_version: TLS1.2 cipher_suites: - TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384 - TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384 - TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305_SHA256 - TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305_SHA256 client_cache: ttl: 10m max_flush_delay: 20us secrets_reload_enabled: true log: level: debug format: text tracing: enabled: true span_processor: batch metrics: enabled: true profiling: enabled: false host: 0.0.0.0 port: 9000 signer: name: foobar key_store: path: /opt/heimdall/keystore.pem password: VeryInsecure! key_id: foo mechanisms: authenticators: - id: anonymous_authenticator type: anonymous - id: unauthorized_authenticator type: unauthorized - id: foo type: basic_auth config: user_id: bar password: baz allow_fallback_on_error: true - id: kratos_session_authenticator type: generic config: identity_info_endpoint: url: http://127.0.0.1:4433/sessions/whoami auth: auth: type: basic_auth config: user: foo password: bar retry: max_delay: 300ms give_up_after: 2s authentication_data_source: - cookie: ory_kratos_session forward_cookies: - ory_kratos_session subject: attributes: \u0026#34;@this\u0026#34; id: \u0026#34;identity.id\u0026#34; allow_fallback_on_error: true - id: hydra_authenticator type: oauth2_introspection config: introspection_endpoint: url: http://hydra:4445/oauth2/introspect retry: max_delay: 300ms give_up_after: 2s auth: type: api_key config: in: header name: X-Api-Key value: VerySecret! token_source: - header: Authorization scheme: Bearer - query_parameter: access_token - body_parameter: access_token assertions: issuers: - http://127.0.0.1:4444/ scopes: - foo - bar audience: - bla subject: attributes: \u0026#34;@this\u0026#34; id: \u0026#34;sub\u0026#34; allow_fallback_on_error: true - id: jwt_authenticator type: jwt config: metadata_endpoint: url: http://auth-server/.well-known/oauth-authorization-server disable_issuer_identifier_verification: true http_cache: enabled: true cache_ttl: 1h jwt_source: - header: Authorization scheme: Bearer - query_parameter: access_token - body_parameter: access_token assertions: audience: - bla scopes: - foo allowed_algorithms: - RS256 subject: attributes: \u0026#34;@this\u0026#34; id: \u0026#34;identity.id\u0026#34; cache_ttl: 5m allow_fallback_on_error: true authorizers: - id: allow_all_authorizer type: allow - id: deny_all_authorizer type: deny - id: remote_authorizer type: remote config: endpoint: url: http://my-authz-system/{{ .Values.some-key }} method: POST headers: foo-bar: \u0026#34;{{ .Subject.ID }}\u0026#34; auth: type: api_key config: in: header name: X-API-Key value: super duper secret values: some-key: some-value payload: \u0026#34;https://bla.bar\u0026#34; expressions: - expression: | Payload.response == true forward_response_headers_to_upstream: - bla-bar - id: user_is_admin_authz type: cel config: expressions: - expression: \u0026#34;\u0026#39;admin\u0026#39; in Subject.Attributes.groups\u0026#34; contextualizers: - id: subscription_contextualizer type: generic config: endpoint: url: http://foo.bar method: GET headers: bla: bla auth: type: oauth2_client_credentials config: auth_method: request_body token_url: http://bar.foo client_id: foo client_secret: bar cache_ttl: 20s header: name: X-Foo scheme: Bar payload: http://foo - id: profile_data_contextualizer type: generic config: endpoint: url: http://profile headers: foo: bar continue_pipeline_on_error: true finalizers: - id: jwt type: jwt config: ttl: 5m header: name: Foo scheme: Bar claims: \u0026#34;{\u0026#39;user\u0026#39;: {{ quote .Subject.ID }} }\u0026#34; - id: bla type: header config: headers: foo-bar: bla - id: blabla type: cookie config: cookies: foo-bar: \u0026#39;{{ .Subject.ID }}\u0026#39; - id: get_token type: oauth2_client_credentials config: header: name: X-Token token_url: https://my-oauth-provider.com/token client_id: my_client client_secret: VerySecret! auth_method: basic_auth cache_ttl: 5m scopes: - foo - bar error_handlers: - id: default type: default - id: authenticate_with_kratos type: redirect config: to: http://127.0.0.1:4433/self-service/login/browser?return_to={{ .Request.URL | urlenc }} when: - error: - type: authentication_error raised_by: kratos_session_authenticator - type: authorization_error request_headers: Accept: - \u0026#39;*/*\u0026#39; default_rule: methods: - GET - POST execute: - authenticator: anonymous_authenticator - finalizer: jwt on_error: - error_handler: authenticate_with_kratos providers: file_system: src: test_rules.yaml watch: true http_endpoint: watch_interval: 5m endpoints: - url: http://foo.bar/ruleset1 expected_path_prefix: /foo/bar enable_http_cache: false - url: http://foo.bar/ruleset2 retry: give_up_after: 5s max_delay: 250ms auth: type: api_key config: name: api_key value: super-secret in: cookie header: X-Customer-Header: Some Value cloud_blob: watch_interval: 1m buckets: - url: gs://my-bucket prefix: service1 rule_path_match_prefix: /service1 - url: azblob://my-bucket prefix: service2 rule_path_match_prefix: /service2 - url: s3://my-bucket/my-rule-set kubernetes: auth_class: foo tls: key_id: foo key_store: path: /path/to/pem.file password: VerySecret! min_version: TLS1.3 ","description":"","html_content":"\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eBelow you can find possible contents (not exhaustive) for Heimdall’s \u003ccode\u003econfig.yaml\u003c/code\u003e file. Head over to configuration documentation to get detailed explanation.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"rouge highlight\"\u003e\u003ccode data-lang=\"yaml\"\u003e\u003cspan class=\"na\"\u003eserve\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"na\"\u003edecision\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"na\"\u003ehost\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e127.0.0.1\u003c/span\u003e\n    \u003cspan class=\"na\"\u003eport\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"m\"\u003e4468\u003c/span\u003e\n    \u003cspan class=\"na\"\u003erespond\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"na\"\u003everbose\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\n      \u003cspan class=\"na\"\u003ewith\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"na\"\u003eaccepted\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n          \u003cspan class=\"na\"\u003ecode\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"m\"\u003e201\u003c/span\u003e\n        \u003cspan class=\"na\"\u003eauthorization_error\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n          \u003cspan class=\"na\"\u003ecode\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"m\"\u003e404\u003c/span\u003e\n        \u003cspan class=\"na\"\u003eauthentication_error\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n          \u003cspan class=\"na\"\u003ecode\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"m\"\u003e404\u003c/span\u003e\n    \u003cspan class=\"na\"\u003etimeout\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"na\"\u003eread\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e2s\u003c/span\u003e\n      \u003cspan class=\"na\"\u003ewrite\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e5s\u003c/span\u003e\n      \u003cspan class=\"na\"\u003eidle\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e2m\u003c/span\u003e\n    \u003cspan class=\"na\"\u003ebuffer_limit\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"na\"\u003eread\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e10KB\u003c/span\u003e\n      \u003cspan class=\"na\"\u003ewrite\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e10KB\u003c/span\u003e\n    \u003cspan class=\"na\"\u003etls\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"na\"\u003ekey_store\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"na\"\u003epath\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e/path/to/key/store.pem\u003c/span\u003e\n        \u003cspan class=\"na\"\u003epassword\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eVerySecure!\u003c/span\u003e\n    \u003cspan class=\"na\"\u003etrusted_proxies\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003e192.168.1.0/24\u003c/span\u003e\n\n  \u003cspan class=\"na\"\u003eproxy\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"na\"\u003ehost\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e127.0.0.1\u003c/span\u003e\n    \u003cspan class=\"na\"\u003eport\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"m\"\u003e4469\u003c/span\u003e\n    \u003cspan class=\"na\"\u003erespond\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"na\"\u003everbose\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\n      \u003cspan class=\"na\"\u003ewith\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"na\"\u003eauthorization_error\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n          \u003cspan class=\"na\"\u003ecode\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"m\"\u003e404\u003c/span\u003e\n        \u003cspan class=\"na\"\u003eauthentication_error\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n          \u003cspan class=\"na\"\u003ecode\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"m\"\u003e404\u003c/span\u003e\n    \u003cspan class=\"na\"\u003etimeout\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"na\"\u003eread\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e2s\u003c/span\u003e\n      \u003cspan class=\"na\"\u003ewrite\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e5s\u003c/span\u003e\n      \u003cspan class=\"na\"\u003eidle\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e2m\u003c/span\u003e\n    \u003cspan class=\"na\"\u003econnections_limit\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"na\"\u003emax_per_host\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"m\"\u003e10\u003c/span\u003e\n      \u003cspan class=\"na\"\u003emax_idle\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"m\"\u003e100\u003c/span\u003e\n      \u003cspan class=\"na\"\u003emax_idle_per_host\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"m\"\u003e50\u003c/span\u003e\n    \u003cspan class=\"na\"\u003ebuffer_limit\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"na\"\u003eread\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e10KB\u003c/span\u003e\n      \u003cspan class=\"na\"\u003ewrite\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e10KB\u003c/span\u003e\n    \u003cspan class=\"na\"\u003ecors\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"na\"\u003eallowed_origins\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003eexample.org\u003c/span\u003e\n      \u003cspan class=\"na\"\u003eallowed_methods\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003eGET\u003c/span\u003e\n        \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003ePOST\u003c/span\u003e\n      \u003cspan class=\"na\"\u003eallowed_headers\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003eAuthorization\u003c/span\u003e\n      \u003cspan class=\"na\"\u003eexposed_headers\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003eX-My-Header\u003c/span\u003e\n      \u003cspan class=\"na\"\u003eallow_credentials\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\n      \u003cspan class=\"na\"\u003emax_age\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e1m\u003c/span\u003e\n    \u003cspan class=\"na\"\u003etls\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"na\"\u003ekey_store\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"na\"\u003epath\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e/path/to/key/store.pem\u003c/span\u003e\n        \u003cspan class=\"na\"\u003epassword\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eVerySecure!\u003c/span\u003e\n      \u003cspan class=\"na\"\u003ekey_id\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003efirst_entry\u003c/span\u003e\n      \u003cspan class=\"na\"\u003emin_version\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eTLS1.2\u003c/span\u003e\n      \u003cspan class=\"na\"\u003ecipher_suites\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003eTLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384\u003c/span\u003e\n        \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003eTLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384\u003c/span\u003e\n        \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003eTLS_ECDHE_RSA_WITH_CHACHA20_POLY1305_SHA256\u003c/span\u003e\n        \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003eTLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305_SHA256\u003c/span\u003e\n    \u003cspan class=\"na\"\u003etrusted_proxies\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003e192.168.1.0/24\u003c/span\u003e\n\n  \u003cspan class=\"na\"\u003emanagement\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"na\"\u003ehost\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e127.0.0.1\u003c/span\u003e\n    \u003cspan class=\"na\"\u003eport\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"m\"\u003e4457\u003c/span\u003e\n    \u003cspan class=\"na\"\u003everbose_errors\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003efalse\u003c/span\u003e\n    \u003cspan class=\"na\"\u003etimeout\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"na\"\u003eread\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e2s\u003c/span\u003e\n      \u003cspan class=\"na\"\u003ewrite\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e5s\u003c/span\u003e\n      \u003cspan class=\"na\"\u003eidle\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e2m\u003c/span\u003e\n    \u003cspan class=\"na\"\u003ecors\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"na\"\u003eallowed_origins\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003eexample.org\u003c/span\u003e\n      \u003cspan class=\"na\"\u003eallowed_methods\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003eGET\u003c/span\u003e\n        \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003ePOST\u003c/span\u003e\n      \u003cspan class=\"na\"\u003eallowed_headers\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003eAuthorization\u003c/span\u003e\n      \u003cspan class=\"na\"\u003eexposed_headers\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003eX-My-Header\u003c/span\u003e\n      \u003cspan class=\"na\"\u003eallow_credentials\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\n      \u003cspan class=\"na\"\u003emax_age\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e1m\u003c/span\u003e\n    \u003cspan class=\"na\"\u003etls\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"na\"\u003ekey_store\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"na\"\u003epath\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e/path/to/key/store.pem\u003c/span\u003e\n      \u003cspan class=\"na\"\u003emin_version\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eTLS1.2\u003c/span\u003e\n\n\u003cspan class=\"na\"\u003ecache\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"na\"\u003etype\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eredis-sentinel\u003c/span\u003e\n  \u003cspan class=\"na\"\u003econfig\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"na\"\u003edb\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"m\"\u003e2\u003c/span\u003e\n    \u003cspan class=\"na\"\u003emaster\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ewhatever\u003c/span\u003e\n    \u003cspan class=\"na\"\u003enodes\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003efoo:1234\u003c/span\u003e\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003ebar:1234\u003c/span\u003e\n    \u003cspan class=\"na\"\u003ecredentials\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"na\"\u003epath\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e/path/to/credentials.yaml\u003c/span\u003e\n    \u003cspan class=\"na\"\u003etls\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"na\"\u003ekey_store\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"na\"\u003epath\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e/path/to/redis_client_keystore.pem\u003c/span\u003e\n      \u003cspan class=\"na\"\u003ekey_id\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ebf5d129a7fec8b1fde11eab459784cc2f14e6c1d\u003c/span\u003e\n      \u003cspan class=\"na\"\u003emin_version\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eTLS1.2\u003c/span\u003e\n      \u003cspan class=\"na\"\u003ecipher_suites\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003eTLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384\u003c/span\u003e\n        \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003eTLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384\u003c/span\u003e\n        \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003eTLS_ECDHE_RSA_WITH_CHACHA20_POLY1305_SHA256\u003c/span\u003e\n        \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003eTLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305_SHA256\u003c/span\u003e\n    \u003cspan class=\"na\"\u003eclient_cache\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"na\"\u003ettl\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e10m\u003c/span\u003e\n    \u003cspan class=\"na\"\u003emax_flush_delay\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e20us\u003c/span\u003e\n\n\u003cspan class=\"na\"\u003esecrets_reload_enabled\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\n\n\u003cspan class=\"na\"\u003elog\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"na\"\u003elevel\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003edebug\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eformat\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003etext\u003c/span\u003e\n\n\u003cspan class=\"na\"\u003etracing\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eenabled\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\n  \u003cspan class=\"na\"\u003espan_processor\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ebatch\u003c/span\u003e\n\n\u003cspan class=\"na\"\u003emetrics\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eenabled\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\n\n\u003cspan class=\"na\"\u003eprofiling\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eenabled\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003efalse\u003c/span\u003e\n  \u003cspan class=\"na\"\u003ehost\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e0.0.0.0\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eport\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"m\"\u003e9000\u003c/span\u003e\n\n\u003cspan class=\"na\"\u003esigner\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"na\"\u003ename\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003efoobar\u003c/span\u003e\n  \u003cspan class=\"na\"\u003ekey_store\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"na\"\u003epath\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e/opt/heimdall/keystore.pem\u003c/span\u003e\n    \u003cspan class=\"na\"\u003epassword\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eVeryInsecure!\u003c/span\u003e\n  \u003cspan class=\"na\"\u003ekey_id\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003efoo\u003c/span\u003e\n\n\u003cspan class=\"na\"\u003emechanisms\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eauthenticators\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eid\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eanonymous_authenticator\u003c/span\u003e\n    \u003cspan class=\"na\"\u003etype\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eanonymous\u003c/span\u003e\n  \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eid\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eunauthorized_authenticator\u003c/span\u003e\n    \u003cspan class=\"na\"\u003etype\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eunauthorized\u003c/span\u003e\n  \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eid\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003efoo\u003c/span\u003e\n    \u003cspan class=\"na\"\u003etype\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ebasic_auth\u003c/span\u003e\n    \u003cspan class=\"na\"\u003econfig\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"na\"\u003euser_id\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ebar\u003c/span\u003e\n      \u003cspan class=\"na\"\u003epassword\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ebaz\u003c/span\u003e\n      \u003cspan class=\"na\"\u003eallow_fallback_on_error\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\n  \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eid\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ekratos_session_authenticator\u003c/span\u003e\n    \u003cspan class=\"na\"\u003etype\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003egeneric\u003c/span\u003e\n    \u003cspan class=\"na\"\u003econfig\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"na\"\u003eidentity_info_endpoint\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"na\"\u003eurl\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ehttp://127.0.0.1:4433/sessions/whoami\u003c/span\u003e\n        \u003cspan class=\"na\"\u003eauth\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n          \u003cspan class=\"na\"\u003eauth\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"na\"\u003etype\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ebasic_auth\u003c/span\u003e\n            \u003cspan class=\"na\"\u003econfig\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n              \u003cspan class=\"na\"\u003euser\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003efoo\u003c/span\u003e\n              \u003cspan class=\"na\"\u003epassword\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ebar\u003c/span\u003e\n        \u003cspan class=\"na\"\u003eretry\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n          \u003cspan class=\"na\"\u003emax_delay\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e300ms\u003c/span\u003e\n          \u003cspan class=\"na\"\u003egive_up_after\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e2s\u003c/span\u003e\n      \u003cspan class=\"na\"\u003eauthentication_data_source\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003ecookie\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eory_kratos_session\u003c/span\u003e\n      \u003cspan class=\"na\"\u003eforward_cookies\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003eory_kratos_session\u003c/span\u003e\n      \u003cspan class=\"na\"\u003esubject\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"na\"\u003eattributes\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"s\"\u003e@this\u0026#34;\u003c/span\u003e\n        \u003cspan class=\"na\"\u003eid\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"s\"\u003eidentity.id\u0026#34;\u003c/span\u003e\n      \u003cspan class=\"na\"\u003eallow_fallback_on_error\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\n  \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eid\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ehydra_authenticator\u003c/span\u003e\n    \u003cspan class=\"na\"\u003etype\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eoauth2_introspection\u003c/span\u003e\n    \u003cspan class=\"na\"\u003econfig\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"na\"\u003eintrospection_endpoint\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"na\"\u003eurl\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ehttp://hydra:4445/oauth2/introspect\u003c/span\u003e\n        \u003cspan class=\"na\"\u003eretry\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n          \u003cspan class=\"na\"\u003emax_delay\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e300ms\u003c/span\u003e\n          \u003cspan class=\"na\"\u003egive_up_after\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e2s\u003c/span\u003e\n        \u003cspan class=\"na\"\u003eauth\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n          \u003cspan class=\"na\"\u003etype\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eapi_key\u003c/span\u003e\n          \u003cspan class=\"na\"\u003econfig\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"na\"\u003ein\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eheader\u003c/span\u003e\n            \u003cspan class=\"na\"\u003ename\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eX-Api-Key\u003c/span\u003e\n            \u003cspan class=\"na\"\u003evalue\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eVerySecret!\u003c/span\u003e\n      \u003cspan class=\"na\"\u003etoken_source\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eheader\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eAuthorization\u003c/span\u003e\n          \u003cspan class=\"na\"\u003escheme\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eBearer\u003c/span\u003e\n        \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003equery_parameter\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eaccess_token\u003c/span\u003e\n        \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003ebody_parameter\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eaccess_token\u003c/span\u003e\n      \u003cspan class=\"na\"\u003eassertions\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"na\"\u003eissuers\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n          \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003ehttp://127.0.0.1:4444/\u003c/span\u003e\n        \u003cspan class=\"na\"\u003escopes\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n          \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003efoo\u003c/span\u003e\n          \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003ebar\u003c/span\u003e\n        \u003cspan class=\"na\"\u003eaudience\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n          \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003ebla\u003c/span\u003e\n      \u003cspan class=\"na\"\u003esubject\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"na\"\u003eattributes\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"s\"\u003e@this\u0026#34;\u003c/span\u003e\n        \u003cspan class=\"na\"\u003eid\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"s\"\u003esub\u0026#34;\u003c/span\u003e\n      \u003cspan class=\"na\"\u003eallow_fallback_on_error\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\n  \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eid\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ejwt_authenticator\u003c/span\u003e\n    \u003cspan class=\"na\"\u003etype\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ejwt\u003c/span\u003e\n    \u003cspan class=\"na\"\u003econfig\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"na\"\u003emetadata_endpoint\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"na\"\u003eurl\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ehttp://auth-server/.well-known/oauth-authorization-server\u003c/span\u003e\n        \u003cspan class=\"na\"\u003edisable_issuer_identifier_verification\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\n        \u003cspan class=\"na\"\u003ehttp_cache\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n          \u003cspan class=\"na\"\u003eenabled\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\n          \u003cspan class=\"na\"\u003ecache_ttl\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e1h\u003c/span\u003e\n      \u003cspan class=\"na\"\u003ejwt_source\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eheader\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eAuthorization\u003c/span\u003e\n          \u003cspan class=\"na\"\u003escheme\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eBearer\u003c/span\u003e\n        \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003equery_parameter\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eaccess_token\u003c/span\u003e\n        \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003ebody_parameter\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eaccess_token\u003c/span\u003e\n      \u003cspan class=\"na\"\u003eassertions\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"na\"\u003eaudience\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n          \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003ebla\u003c/span\u003e\n        \u003cspan class=\"na\"\u003escopes\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n          \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003efoo\u003c/span\u003e\n        \u003cspan class=\"na\"\u003eallowed_algorithms\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n          \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003eRS256\u003c/span\u003e\n      \u003cspan class=\"na\"\u003esubject\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"na\"\u003eattributes\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"s\"\u003e@this\u0026#34;\u003c/span\u003e\n        \u003cspan class=\"na\"\u003eid\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"s\"\u003eidentity.id\u0026#34;\u003c/span\u003e\n      \u003cspan class=\"na\"\u003ecache_ttl\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e5m\u003c/span\u003e\n      \u003cspan class=\"na\"\u003eallow_fallback_on_error\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\n\n  \u003cspan class=\"na\"\u003eauthorizers\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eid\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eallow_all_authorizer\u003c/span\u003e\n    \u003cspan class=\"na\"\u003etype\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eallow\u003c/span\u003e\n  \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eid\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003edeny_all_authorizer\u003c/span\u003e\n    \u003cspan class=\"na\"\u003etype\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003edeny\u003c/span\u003e\n  \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eid\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eremote_authorizer\u003c/span\u003e\n    \u003cspan class=\"na\"\u003etype\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eremote\u003c/span\u003e\n    \u003cspan class=\"na\"\u003econfig\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"na\"\u003eendpoint\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"na\"\u003eurl\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ehttp://my-authz-system/{{ .Values.some-key }}\u003c/span\u003e\n        \u003cspan class=\"na\"\u003emethod\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ePOST\u003c/span\u003e\n        \u003cspan class=\"na\"\u003eheaders\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n          \u003cspan class=\"na\"\u003efoo-bar\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"s\"\u003e{{\u003c/span\u003e\u003cspan class=\"nv\"\u003e \u003c/span\u003e\u003cspan class=\"s\"\u003e.Subject.ID\u003c/span\u003e\u003cspan class=\"nv\"\u003e \u003c/span\u003e\u003cspan class=\"s\"\u003e}}\u0026#34;\u003c/span\u003e\n        \u003cspan class=\"na\"\u003eauth\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n          \u003cspan class=\"na\"\u003etype\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eapi_key\u003c/span\u003e\n          \u003cspan class=\"na\"\u003econfig\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"na\"\u003ein\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eheader\u003c/span\u003e\n            \u003cspan class=\"na\"\u003ename\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eX-API-Key\u003c/span\u003e\n            \u003cspan class=\"na\"\u003evalue\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003esuper duper secret\u003c/span\u003e\n      \u003cspan class=\"na\"\u003evalues\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"na\"\u003esome-key\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003esome-value\u003c/span\u003e\n      \u003cspan class=\"na\"\u003epayload\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"s\"\u003ehttps://bla.bar\u0026#34;\u003c/span\u003e\n      \u003cspan class=\"na\"\u003eexpressions\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eexpression\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"pi\"\u003e|\u003c/span\u003e\n            \u003cspan class=\"s\"\u003ePayload.response == true\u003c/span\u003e\n      \u003cspan class=\"na\"\u003eforward_response_headers_to_upstream\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003ebla-bar\u003c/span\u003e\n  \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eid\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003euser_is_admin_authz\u003c/span\u003e\n    \u003cspan class=\"na\"\u003etype\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ecel\u003c/span\u003e\n    \u003cspan class=\"na\"\u003econfig\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"na\"\u003eexpressions\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eexpression\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#39;admin\u0026#39;\u003c/span\u003e\u003cspan class=\"nv\"\u003e \u003c/span\u003e\u003cspan class=\"s\"\u003ein\u003c/span\u003e\u003cspan class=\"nv\"\u003e \u003c/span\u003e\u003cspan class=\"s\"\u003eSubject.Attributes.groups\u0026#34;\u003c/span\u003e\n\n  \u003cspan class=\"na\"\u003econtextualizers\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eid\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003esubscription_contextualizer\u003c/span\u003e\n    \u003cspan class=\"na\"\u003etype\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003egeneric\u003c/span\u003e\n    \u003cspan class=\"na\"\u003econfig\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"na\"\u003eendpoint\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"na\"\u003eurl\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ehttp://foo.bar\u003c/span\u003e\n        \u003cspan class=\"na\"\u003emethod\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eGET\u003c/span\u003e\n        \u003cspan class=\"na\"\u003eheaders\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n          \u003cspan class=\"na\"\u003ebla\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ebla\u003c/span\u003e\n        \u003cspan class=\"na\"\u003eauth\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n          \u003cspan class=\"na\"\u003etype\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eoauth2_client_credentials\u003c/span\u003e\n          \u003cspan class=\"na\"\u003econfig\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"na\"\u003eauth_method\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003erequest_body\u003c/span\u003e\n            \u003cspan class=\"na\"\u003etoken_url\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ehttp://bar.foo\u003c/span\u003e\n            \u003cspan class=\"na\"\u003eclient_id\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003efoo\u003c/span\u003e\n            \u003cspan class=\"na\"\u003eclient_secret\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ebar\u003c/span\u003e\n            \u003cspan class=\"na\"\u003ecache_ttl\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e20s\u003c/span\u003e\n            \u003cspan class=\"na\"\u003eheader\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n              \u003cspan class=\"na\"\u003ename\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eX-Foo\u003c/span\u003e\n              \u003cspan class=\"na\"\u003escheme\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eBar\u003c/span\u003e\n      \u003cspan class=\"na\"\u003epayload\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ehttp://foo\u003c/span\u003e\n  \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eid\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eprofile_data_contextualizer\u003c/span\u003e\n    \u003cspan class=\"na\"\u003etype\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003egeneric\u003c/span\u003e\n    \u003cspan class=\"na\"\u003econfig\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"na\"\u003eendpoint\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"na\"\u003eurl\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ehttp://profile\u003c/span\u003e\n        \u003cspan class=\"na\"\u003eheaders\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n          \u003cspan class=\"na\"\u003efoo\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ebar\u003c/span\u003e\n      \u003cspan class=\"na\"\u003econtinue_pipeline_on_error\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\n\n  \u003cspan class=\"na\"\u003efinalizers\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eid\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ejwt\u003c/span\u003e\n    \u003cspan class=\"na\"\u003etype\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ejwt\u003c/span\u003e\n    \u003cspan class=\"na\"\u003econfig\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"na\"\u003ettl\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e5m\u003c/span\u003e\n      \u003cspan class=\"na\"\u003eheader\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"na\"\u003ename\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eFoo\u003c/span\u003e\n        \u003cspan class=\"na\"\u003escheme\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eBar\u003c/span\u003e\n      \u003cspan class=\"na\"\u003eclaims\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"s\"\u003e{\u0026#39;user\u0026#39;:\u003c/span\u003e\u003cspan class=\"nv\"\u003e \u003c/span\u003e\u003cspan class=\"s\"\u003e{{\u003c/span\u003e\u003cspan class=\"nv\"\u003e \u003c/span\u003e\u003cspan class=\"s\"\u003equote\u003c/span\u003e\u003cspan class=\"nv\"\u003e \u003c/span\u003e\u003cspan class=\"s\"\u003e.Subject.ID\u003c/span\u003e\u003cspan class=\"nv\"\u003e \u003c/span\u003e\u003cspan class=\"s\"\u003e}}\u003c/span\u003e\u003cspan class=\"nv\"\u003e \u003c/span\u003e\u003cspan class=\"s\"\u003e}\u0026#34;\u003c/span\u003e\n  \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eid\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ebla\u003c/span\u003e\n    \u003cspan class=\"na\"\u003etype\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eheader\u003c/span\u003e\n    \u003cspan class=\"na\"\u003econfig\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"na\"\u003eheaders\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"na\"\u003efoo-bar\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ebla\u003c/span\u003e\n  \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eid\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eblabla\u003c/span\u003e\n    \u003cspan class=\"na\"\u003etype\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ecookie\u003c/span\u003e\n    \u003cspan class=\"na\"\u003econfig\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"na\"\u003ecookies\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"na\"\u003efoo-bar\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"s\"\u003e{{\u003c/span\u003e\u003cspan class=\"nv\"\u003e \u003c/span\u003e\u003cspan class=\"s\"\u003e.Subject.ID\u003c/span\u003e\u003cspan class=\"nv\"\u003e \u003c/span\u003e\u003cspan class=\"s\"\u003e}}\u0026#39;\u003c/span\u003e\n  \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eid\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eget_token\u003c/span\u003e\n    \u003cspan class=\"na\"\u003etype\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eoauth2_client_credentials\u003c/span\u003e\n    \u003cspan class=\"na\"\u003econfig\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"na\"\u003eheader\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"na\"\u003ename\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eX-Token\u003c/span\u003e\n      \u003cspan class=\"na\"\u003etoken_url\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ehttps://my-oauth-provider.com/token\u003c/span\u003e\n      \u003cspan class=\"na\"\u003eclient_id\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003emy_client\u003c/span\u003e\n      \u003cspan class=\"na\"\u003eclient_secret\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eVerySecret!\u003c/span\u003e\n      \u003cspan class=\"na\"\u003eauth_method\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ebasic_auth\u003c/span\u003e\n      \u003cspan class=\"na\"\u003ecache_ttl\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e5m\u003c/span\u003e\n      \u003cspan class=\"na\"\u003escopes\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003efoo\u003c/span\u003e\n        \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003ebar\u003c/span\u003e\n\n  \u003cspan class=\"na\"\u003eerror_handlers\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eid\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003edefault\u003c/span\u003e\n    \u003cspan class=\"na\"\u003etype\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003edefault\u003c/span\u003e\n  \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eid\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eauthenticate_with_kratos\u003c/span\u003e\n    \u003cspan class=\"na\"\u003etype\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eredirect\u003c/span\u003e\n    \u003cspan class=\"na\"\u003econfig\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"na\"\u003eto\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ehttp://127.0.0.1:4433/self-service/login/browser?return_to={{ .Request.URL | urlenc }}\u003c/span\u003e\n      \u003cspan class=\"na\"\u003ewhen\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eerror\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n          \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003etype\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eauthentication_error\u003c/span\u003e\n            \u003cspan class=\"na\"\u003eraised_by\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ekratos_session_authenticator\u003c/span\u003e\n          \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003etype\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eauthorization_error\u003c/span\u003e\n          \u003cspan class=\"na\"\u003erequest_headers\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"na\"\u003eAccept\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"s\"\u003e*/*\u0026#39;\u003c/span\u003e\n\n\u003cspan class=\"na\"\u003edefault_rule\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"na\"\u003emethods\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003eGET\u003c/span\u003e\n  \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003ePOST\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eexecute\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eauthenticator\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eanonymous_authenticator\u003c/span\u003e\n  \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003efinalizer\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ejwt\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eon_error\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eerror_handler\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eauthenticate_with_kratos\u003c/span\u003e\n\n\u003cspan class=\"na\"\u003eproviders\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"na\"\u003efile_system\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"na\"\u003esrc\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003etest_rules.yaml\u003c/span\u003e\n    \u003cspan class=\"na\"\u003ewatch\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\n\n  \u003cspan class=\"na\"\u003ehttp_endpoint\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"na\"\u003ewatch_interval\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e5m\u003c/span\u003e\n    \u003cspan class=\"na\"\u003eendpoints\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eurl\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ehttp://foo.bar/ruleset1\u003c/span\u003e\n        \u003cspan class=\"na\"\u003eexpected_path_prefix\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e/foo/bar\u003c/span\u003e\n        \u003cspan class=\"na\"\u003eenable_http_cache\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003efalse\u003c/span\u003e\n      \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eurl\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ehttp://foo.bar/ruleset2\u003c/span\u003e\n        \u003cspan class=\"na\"\u003eretry\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n          \u003cspan class=\"na\"\u003egive_up_after\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e5s\u003c/span\u003e\n          \u003cspan class=\"na\"\u003emax_delay\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e250ms\u003c/span\u003e\n        \u003cspan class=\"na\"\u003eauth\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n          \u003cspan class=\"na\"\u003etype\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eapi_key\u003c/span\u003e\n          \u003cspan class=\"na\"\u003econfig\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"na\"\u003ename\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eapi_key\u003c/span\u003e\n            \u003cspan class=\"na\"\u003evalue\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003esuper-secret\u003c/span\u003e\n            \u003cspan class=\"na\"\u003ein\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ecookie\u003c/span\u003e\n        \u003cspan class=\"na\"\u003eheader\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n          \u003cspan class=\"na\"\u003eX-Customer-Header\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eSome Value\u003c/span\u003e\n\n  \u003cspan class=\"na\"\u003ecloud_blob\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"na\"\u003ewatch_interval\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e1m\u003c/span\u003e\n    \u003cspan class=\"na\"\u003ebuckets\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eurl\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003egs://my-bucket\u003c/span\u003e\n        \u003cspan class=\"na\"\u003eprefix\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eservice1\u003c/span\u003e\n        \u003cspan class=\"na\"\u003erule_path_match_prefix\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e/service1\u003c/span\u003e\n      \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eurl\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eazblob://my-bucket\u003c/span\u003e\n        \u003cspan class=\"na\"\u003eprefix\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eservice2\u003c/span\u003e\n        \u003cspan class=\"na\"\u003erule_path_match_prefix\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e/service2\u003c/span\u003e\n      \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eurl\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003es3://my-bucket/my-rule-set\u003c/span\u003e\n\n  \u003cspan class=\"na\"\u003ekubernetes\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"na\"\u003eauth_class\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003efoo\u003c/span\u003e\n    \u003cspan class=\"na\"\u003etls\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"na\"\u003ekey_id\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003efoo\u003c/span\u003e\n      \u003cspan class=\"na\"\u003ekey_store\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"na\"\u003epath\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e/path/to/pem.file\u003c/span\u003e\n        \u003cspan class=\"na\"\u003epassword\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eVerySecret!\u003c/span\u003e\n      \u003cspan class=\"na\"\u003emin_version\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eTLS1.3\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n","sections":["Configuration Reference"],"tags":null,"title":"Reference","url":"/docs/configuration/reference/"}]